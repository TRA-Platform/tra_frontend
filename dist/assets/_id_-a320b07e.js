import{L as Ne,N as He,b5 as lt,R as Ge,S as rt,W as st,b6 as ot,a9 as Ee,p as e,G as Ie,a8 as kt,Z as Pe,E as K,ac as it,Q as nt,b7 as ct,O as ut,b8 as wt,Y as tt,a1 as Vt,$ as qt,ap as k,b9 as Ct,ba as St,bb as Ut,k as S,I as ke,o as n,b as g,y as t,aI as Q,aY as G,C as R,m as i,A as l,b2 as ue,D as d,aV as Me,bc as W,aD as be,aB as ce,aJ as ie,aL as xe,q as a,aK as ae,c as v,aj as C,F as Z,a as se,at as Se,bd as Le,r as ve,aZ as je,aX as ye,ar as we,w as Ue,ah as me,H as Be,a$ as dt,s as Ze,b1 as pt,be as mt,aa as vt,b4 as _t,b0 as Dt,t as zt}from"./index-7675577c.js";import{V as ge}from"./VDialog-d70ac910.js";import{a as he,u as It,_ as Pt,V as Mt}from"./ProjectCreateDialog-d8650e7a.js";import{V as le,a as A}from"./VRow-4662fa7c.js";import{V as J}from"./VChip-0e25079c.js";import{V as X}from"./VDivider-4a81dced.js";import{a as Je,g as fe,b as ft}from"./formatters-61b2616d.js";import{V as ee}from"./VSpacer-0f38eeeb.js";import{b as Qe,c as de,V as $e,a as ht}from"./VTabs-dadab318.js";import{V as We,a as pe}from"./VSlideGroup-0dc95b98.js";import{V as Ve}from"./VForm-a35e3561.js";import{b as oe}from"./VTextField-74f641fe.js";import{V as ne}from"./VSelect-62cc520e.js";import{V as Re,a as Oe,b as Ae}from"./VList-12873fe5.js";import{V as Bt}from"./VTooltip-44452bf2.js";import{b as at}from"./route-block-83d24a4e.js";import{V as $t}from"./VMenu-db61968c.js";import"./index-07da1904.js";import"./VCheckboxBtn-01e7f2e1.js";import"./ssrBoot-bac4086a.js";const Te=Ne()({name:"VTable",props:{fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...He(),...lt(),...Ge(),...rt()},setup(r,u){let{slots:o}=u;const{themeClasses:s}=st(r),{densityClasses:f}=ot(r);return Ee(()=>e(r.tag,{class:["v-table",{"v-table--fixed-height":!!r.height,"v-table--fixed-header":r.fixedHeader,"v-table--fixed-footer":r.fixedFooter,"v-table--has-top":!!o.top,"v-table--has-bottom":!!o.bottom,"v-table--hover":r.hover},s.value,f.value,r.class],style:r.style},{default:()=>{var c,p,_;return[(c=o.top)==null?void 0:c.call(o),o.default?e("div",{class:"v-table__wrapper",style:{height:Ie(r.height)}},[e("table",null,[o.default()])]):(p=o.wrapper)==null?void 0:p.call(o),(_=o.bottom)==null?void 0:_.call(o)]}})),{}}}),gt=Ne()({name:"VTimeline",props:{align:{type:String,default:"center",validator:r=>["center","start"].includes(r)},direction:{type:String,default:"vertical",validator:r=>["vertical","horizontal"].includes(r)},justify:{type:String,default:"auto",validator:r=>["auto","center"].includes(r)},side:{type:String,validator:r=>r==null||["start","end"].includes(r)},lineInset:{type:[String,Number],default:0},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:r=>["start","end","both"].includes(r)},...He(),...lt(),...Ge(),...rt()},setup(r,u){let{slots:o}=u;const{themeClasses:s}=st(r),{densityClasses:f}=ot(r);kt({VTimelineDivider:{lineColor:Pe(r,"lineColor")},VTimelineItem:{density:Pe(r,"density"),lineInset:Pe(r,"lineInset")}});const c=K(()=>{const _=r.side?r.side:r.density!=="default"?"end":null;return _&&`v-timeline--side-${_}`}),p=K(()=>{const _=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(r.truncateLine){case"both":return _;case"start":return _[0];case"end":return _[1];default:return null}});return Ee(()=>e(r.tag,{class:["v-timeline",`v-timeline--${r.direction}`,`v-timeline--align-${r.align}`,`v-timeline--justify-${r.justify}`,p.value,{"v-timeline--inset-line":!!r.lineInset},s.value,f.value,c.value,r.class],style:[{"--v-timeline-line-thickness":Ie(r.lineThickness)},r.style]},o)),{}}}),Ft=Ne()({name:"VTimelineDivider",props:{dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:it,iconColor:String,lineColor:String,...He(),...nt(),...ct(),...ut()},setup(r,u){let{slots:o}=u;const{sizeClasses:s,sizeStyles:f}=wt(r,"v-timeline-divider__dot"),{backgroundColorStyles:c,backgroundColorClasses:p}=tt(Pe(r,"dotColor")),{roundedClasses:_}=Vt(r,"v-timeline-divider__dot"),{elevationClasses:y}=qt(r),{backgroundColorClasses:x,backgroundColorStyles:w}=tt(Pe(r,"lineColor"));return Ee(()=>e("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":r.fillDot},r.class],style:r.style},[e("div",{class:["v-timeline-divider__before",x.value],style:w.value},null),!r.hideDot&&e("div",{key:"dot",class:["v-timeline-divider__dot",y.value,_.value,s.value],style:f.value},[e("div",{class:["v-timeline-divider__inner-dot",p.value,_.value],style:c.value},[o.default?e(Ct,{key:"icon-defaults",disabled:!r.icon,defaults:{VIcon:{color:r.iconColor,icon:r.icon,size:r.size}}},o.default):e(k,{key:"icon",color:r.iconColor,icon:r.icon,size:r.size},null)])]),e("div",{class:["v-timeline-divider__after",x.value],style:w.value},null)])),{}}}),yt=Ne()({name:"VTimelineItem",props:{density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:it,iconColor:String,lineInset:[Number,String],...He(),...St(),...ut(),...nt(),...ct(),...Ge()},setup(r,u){let{slots:o}=u;const{dimensionStyles:s}=Ut(r),f=S(0),c=S();return ke(c,p=>{var _;p&&(f.value=((_=p.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:_.getBoundingClientRect().width)??0)},{flush:"post"}),Ee(()=>{var p,_;return e("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":r.fillDot},r.class],style:[{"--v-timeline-dot-size":Ie(f.value),"--v-timeline-line-inset":r.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${Ie(r.lineInset)})`:Ie(0)},r.style]},[e("div",{class:"v-timeline-item__body",style:s.value},[(p=o.default)==null?void 0:p.call(o)]),e(Ft,{ref:c,hideDot:r.hideDot,icon:r.icon,iconColor:r.iconColor,size:r.size,elevation:r.elevation,dotColor:r.dotColor,fillDot:r.fillDot,rounded:r.rounded},{default:o.icon}),r.density!=="compact"&&e("div",{class:"v-timeline-item__opposite"},[!r.hideOpposite&&((_=o.opposite)==null?void 0:_.call(o))])])}),{}}}),Lt=i("span",{class:"text-5xl"},"!",-1),Rt={class:"text-lg font-weight-medium"},Fe={__name:"ConfirmDialog",props:{confirmationMsg:{type:String,required:!0},isDialogVisible:{type:Boolean,required:!0}},emits:["update:isDialogVisible","confirm"],setup(r,{emit:u}){const o=r,s=p=>{u("update:isDialogVisible",p)},f=()=>{u("confirm",!0),s(!1)},c=()=>{u("confirm",!1),u("update:isDialogVisible",!1)};return(p,_)=>(n(),g(ge,{"max-width":"500","model-value":o.isDialogVisible,"onUpdate:modelValue":s},{default:t(()=>[e(Q,{class:"text-center px-10 py-6"},{default:t(()=>[e(G,null,{default:t(()=>[e(R,{icon:"",variant:"outlined",color:"warning",class:"mb-4",style:{width:"88px",height:"88px","pointer-events":"none"}},{default:t(()=>[Lt]),_:1}),i("h6",Rt,l(o.confirmationMsg),1)]),_:1}),e(ue,{class:"align-center justify-center gap-2"},{default:t(()=>[e(R,{variant:"elevated",onClick:f},{default:t(()=>[d(" Confirm ")]),_:1}),e(R,{color:"secondary",variant:"tonal",onClick:c},{default:t(()=>[d(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Xe=Me({id:"UserStoryStore",state:()=>({userStories:[],currentUserStory:null,loading:!1,error:null}),actions:{async fetchUserStories(r=null){this.loading=!0;try{let u="/service/user-stories/";r&&(u+=`?requirement=${r}`);const o=await W.get(u);return o.status===200?(this.userStories=o.data,{data:o.data,error:null}):{data:[],error:o.data}}catch(u){return this.error=u.message||"Failed to fetch user stories",{data:[],error:this.error}}finally{this.loading=!1}},async fetchUserStoryById(r){this.loading=!0;try{const u=await W.get(`/service/user-stories/${r}/`);return u.status===200?(this.currentUserStory=u.data,{data:u.data,error:null}):{data:null,error:u.data}}catch(u){return this.error=u.message||"Failed to fetch user story",{data:null,error:this.error}}finally{this.loading=!1}},async createUserStory(r){this.loading=!0;try{const u=await W.post("/service/user-stories/",r);return u.status===201?(this.userStories.length&&this.userStories.push(u.data),{data:u.data,error:null}):{data:null,error:u.data}}catch(u){return this.error=u.message||"Failed to create user story",{data:null,error:this.error}}finally{this.loading=!1}},async updateUserStory(r,u){this.loading=!0;try{const o=await W.put(`/service/user-stories/${r}/`,u);if(o.status===200){if(this.userStories.length){const s=this.userStories.findIndex(f=>f.id===r);s!==-1&&(this.userStories[s]=o.data)}return this.currentUserStory&&this.currentUserStory.id===r&&(this.currentUserStory=o.data),{data:o.data,error:null}}return{data:null,error:o.data}}catch(o){return this.error=o.message||"Failed to update user story",{data:null,error:this.error}}finally{this.loading=!1}},async deleteUserStory(r){this.loading=!0;try{const u=await W.delete(`/service/user-stories/${r}/`);return u.status===204?(this.userStories.length&&(this.userStories=this.userStories.filter(o=>o.id!==r)),this.currentUserStory&&this.currentUserStory.id===r&&(this.currentUserStory=null),{success:!0,error:null}):{success:!1,error:u.data}}catch(u){return this.error=u.message||"Failed to delete user story",{success:!1,error:this.error}}finally{this.loading=!1}},async regenerateUserStory(r,u=""){this.loading=!0;try{const o=await W.post(`/service/user-stories/${r}/regenerate/`,{feedback:u});return o.status===202?{data:o.data,error:null}:{data:null,error:o.data}}catch(o){return this.error=o.message||"Failed to regenerate user story",{data:null,error:this.error}}finally{this.loading=!1}},async createComment(r,u){this.loading=!0;try{const o=await W.post("/service/user-story-comments/",{user_story:r,text:u.text,status:u.status||"active"});return o.status===201?{data:o.data,error:null}:{data:null,error:o.data}}catch(o){return this.error=o.message||"Failed to create comment",{data:null,error:this.error}}finally{this.loading=!1}},async deleteComment(r){this.loading=!0;try{const u=await W.delete(`/service/user-story-comments/${r}/`);return u.status===204?{success:!0,error:null}:{success:!1,error:u.data}}catch(u){return this.error=u.message||"Failed to delete comment",{success:!1,error:this.error}}finally{this.loading=!1}}}}),et=Me({id:"UmlDiagramStore",state:()=>({diagrams:[],currentDiagram:null,loading:!1,error:null}),actions:{async fetchDiagrams(r=null,u=null){this.loading=!0;try{let o="/service/uml-diagrams/";const s={};r&&(s.project=r),u&&(s.diagram_type=u);const f=await W.get(o,{params:s});return f.status===200?(this.diagrams=f.data,{data:f.data,error:null}):{data:[],error:f.data}}catch(o){return this.error=o.message||"Failed to fetch UML diagrams",{data:[],error:this.error}}finally{this.loading=!1}},async fetchDiagramById(r){this.loading=!0;try{const u=await W.get(`/service/uml-diagrams/${r}/`);return u.status===200?(this.currentDiagram=u.data,{data:u.data,error:null}):{data:null,error:u.data}}catch(u){return this.error=u.message||"Failed to fetch UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async createDiagram(r){this.loading=!0;try{const u=await W.post("/service/uml-diagrams/",r);return u.status===201?(this.diagrams.length&&this.diagrams.push(u.data),{data:u.data,error:null}):{data:null,error:u.data}}catch(u){return this.error=u.message||"Failed to create UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async updateDiagram(r,u){this.loading=!0;try{const o=await W.put(`/service/uml-diagrams/${r}/`,u);if(o.status===200){if(this.diagrams.length){const s=this.diagrams.findIndex(f=>f.id===r);s!==-1&&(this.diagrams[s]=o.data)}return this.currentDiagram&&this.currentDiagram.id===r&&(this.currentDiagram=o.data),{data:o.data,error:null}}return{data:null,error:o.data}}catch(o){return this.error=o.message||"Failed to update UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async deleteDiagram(r){this.loading=!0;try{const u=await W.delete(`/service/uml-diagrams/${r}/`);return u.status===204?(this.diagrams.length&&(this.diagrams=this.diagrams.filter(o=>o.id!==r)),this.currentDiagram&&this.currentDiagram.id===r&&(this.currentDiagram=null),{success:!0,error:null}):{success:!1,error:u.data}}catch(u){return this.error=u.message||"Failed to delete UML diagram",{success:!1,error:this.error}}finally{this.loading=!1}},async regenerateDiagram(r){this.loading=!0;try{const u=await W.post(`/service/uml-diagrams/${r}/regenerate/`);return u.status===202?{data:u.data,error:null}:{data:null,error:u.data}}catch(u){return this.error=u.message||"Failed to regenerate UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async generateDiagrams(r,u="class"){this.loading=!0;try{const o=await W.post(`/service/projects/${r}/generate_uml_diagrams/`,{diagram_type:u});return o.status===202?{data:o.data,error:null}:{data:null,error:o.data}}catch(o){return this.error=o.message||"Failed to generate UML diagrams",{data:null,error:this.error}}finally{this.loading=!1}}}}),Ot={class:"d-flex flex-column gap-4"},At={class:"d-flex flex-column gap-2"},Tt={class:"d-flex align-center"},Nt={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},Ht={class:"d-flex align-center"},Et={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},Kt={class:"d-flex align-center"},Yt={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},Jt={class:"d-flex align-center"},Gt={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},Zt={key:0,class:"d-flex align-center"},Qt={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},Wt={key:1,class:"d-flex align-center"},Xt={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},ea={key:2,class:"d-flex align-center"},ta={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},aa={class:"d-flex align-center"},la=["title"],ra={class:"ms-2"},sa={class:"whitespace-pre-wrap"},oa={class:"d-flex flex-column gap-4"},ia={key:0},na={class:"text-subtitle-1 font-weight-bold mb-2"},ca={class:"whitespace-pre-wrap"},ua={key:1},da={class:"text-subtitle-1 font-weight-bold mb-2"},pa={class:"d-flex flex-column gap-4"},ma={class:"whitespace-pre-wrap mb-4"},va={key:0,class:"whitespace-pre-wrap"},_a={class:"text-subtitle-1 font-weight-bold mb-2"},fa={class:"whitespace-pre-wrap"},ha={class:"whitespace-pre-wrap"},ga={class:"whitespace-pre-wrap"},ya={class:"d-flex flex-column gap-3"},ba={class:"font-weight-medium mb-1"},ja={class:"d-flex justify-space-between mt-1"},xa={class:"font-weight-medium mb-1"},ka={class:"d-flex justify-space-between mt-1"},wa={class:"font-weight-medium mb-1"},Va={class:"d-flex align-center gap-2"},qa={class:"flex-grow-1"},Ca={class:"font-weight-medium mb-1"},Sa={class:"d-flex justify-space-between mt-1"},Ua={__name:"ProjectDetailsInfo",props:{project:{type:Object,required:!0},loading:{type:Boolean,default:!1}},setup(r){const u=r,{t:o}=ce(),s=_=>_?new Date(parseInt(_)).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):o("projects.details.not_set"),f=K(()=>{switch(u.project.status){case"draft":return"warning";case"active":return"success";case"archived":return"secondary";case"completed":return"info";default:return"primary"}}),c=K(()=>{switch(u.project.type_of_application){case"website":return"tabler-world-www";case"mobile":return"tabler-device-mobile";case"desktop":return"tabler-device-desktop";case"api":return"tabler-api";default:return"tabler-code"}}),p={en:"English",ru:"Russian",de:"German"};return(_,y)=>(n(),g(G,{class:"pa-6"},{default:t(()=>[e(le,null,{default:t(()=>[e(A,{cols:"12",md:"6"},{default:t(()=>[i("div",Ot,[e(Q,{border:"",class:"project-info-card"},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(xe,{color:"primary",variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(k,{icon:a(c)},null,8,["icon"])]),_:1})]),append:t(()=>[e(J,{size:"small",color:a(f),label:""},{default:t(()=>[d(l(a(o)(`projects.status.${r.project.status}`)),1)]),_:1},8,["color"])]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(o)("projects.details.project_overview")),1)]),_:1})]),_:1}),e(X),e(G,null,{default:t(()=>[i("div",At,[i("div",Tt,[i("span",Nt,l(a(o)("projects.details.created_at"))+":",1),i("span",null,l(s(r.project.created_at)),1)]),i("div",Ht,[i("span",Et,l(a(o)("projects.details.updated_at"))+":",1),i("span",null,l(s(r.project.updated_at)),1)]),i("div",Kt,[i("span",Yt,l(a(o)("projects.details.type"))+":",1),e(J,{size:"small"},{default:t(()=>[d(l(a(o)(`projects.types.${r.project.type_of_application}`)),1)]),_:1})]),i("div",Jt,[i("span",Gt,l(a(o)("projects.details.language"))+":",1),e(J,{size:"small"},{default:t(()=>{return[d(l((x=r.project.language,p[x]||x)),1)];var x}),_:1})]),r.project.deadline?(n(),v("div",Zt,[i("span",Qt,l(a(o)("projects.details.deadline"))+":",1),i("span",null,l(s(r.project.deadline)),1)])):C("",!0),r.project.preliminary_budget?(n(),v("div",Wt,[i("span",Xt,l(a(o)("projects.details.budget"))+":",1),i("span",null,"$"+l(r.project.preliminary_budget),1)])):C("",!0),r.project.color_scheme?(n(),v("div",ea,[i("span",ta,l(a(o)("projects.details.color_scheme"))+":",1),i("div",aa,[(n(!0),v(Z,null,se(r.project.color_scheme.split(","),(x,w)=>(n(),v("div",{key:w,class:"color-swatch rounded me-1",style:Se({backgroundColor:x.trim()}),title:a(o)("projects.details.color")},null,12,la))),128)),i("span",ra,l(r.project.color_scheme),1)])])):C("",!0)])]),_:1})]),_:1}),r.project.additional_requirements?(n(),g(Q,{key:0,border:"",class:"project-info-card"},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(k,{color:"primary",icon:"tabler-list-details"})]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(o)("projects.details.additional_requirements")),1)]),_:1})]),_:1}),e(X),e(G,null,{default:t(()=>[i("div",sa,l(r.project.additional_requirements),1)]),_:1})]),_:1})):C("",!0),r.project.technology_stack||r.project.operating_system?(n(),g(Q,{key:1,border:"",class:"project-info-card"},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(k,{color:"primary",icon:"tabler-device-laptop-code"})]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(o)("projects.details.technical_details")),1)]),_:1})]),_:1}),e(X),e(G,null,{default:t(()=>[i("div",oa,[r.project.technology_stack?(n(),v("div",ia,[i("h6",na,l(a(o)("projects.details.technology_stack")),1),i("div",ca,l(r.project.technology_stack),1)])):C("",!0),r.project.operating_system?(n(),v("div",ua,[i("h6",da,l(a(o)("projects.details.operating_system")),1),i("div",null,l(r.project.operating_system),1)])):C("",!0)])]),_:1})]),_:1})):C("",!0)])]),_:1}),e(A,{cols:"12",md:"6"},{default:t(()=>[i("div",pa,[e(Q,{border:"",class:"project-info-card"},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(k,{color:"primary",icon:"tabler-file-description"})]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(o)("projects.details.description")),1)]),_:1})]),_:1}),e(X),e(G,null,{default:t(()=>[i("div",ma,l(r.project.short_description),1),r.project.application_description?(n(),v("div",va,[i("h6",_a,l(a(o)("projects.details.application_description")),1),i("div",null,l(r.project.application_description),1)])):C("",!0)]),_:1})]),_:1}),r.project.target_users?(n(),g(Q,{key:0,border:"",class:"project-info-card"},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(k,{color:"primary",icon:"tabler-users"})]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(o)("projects.details.target_users")),1)]),_:1})]),_:1}),e(X),e(G,null,{default:t(()=>[i("div",fa,l(r.project.target_users),1)]),_:1})]),_:1})):C("",!0),r.project.non_functional_requirements?(n(),g(Q,{key:1,border:"",class:"project-info-card"},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(k,{color:"primary",icon:"tabler-chart-bubble"})]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(o)("projects.details.non_functional_requirements")),1)]),_:1})]),_:1}),e(X),e(G,null,{default:t(()=>[i("div",ha,l(r.project.non_functional_requirements),1)]),_:1})]),_:1})):C("",!0),r.project.priority_modules?(n(),g(Q,{key:2,border:"",class:"project-info-card"},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(k,{color:"primary",icon:"tabler-star"})]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(o)("projects.details.priority_modules")),1)]),_:1})]),_:1}),e(X),e(G,null,{default:t(()=>[i("div",ga,l(r.project.priority_modules),1)]),_:1})]),_:1})):C("",!0),r.project.generation_progress?(n(),g(Q,{key:3,border:"",class:"project-info-card"},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(xe,{color:"info",variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(k,{icon:"tabler-info-circle"})]),_:1})]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(o)("projects.details.generation_status")),1)]),_:1})]),_:1}),e(X),e(G,null,{default:t(()=>[i("div",ya,[i("div",null,[i("div",ba,l(a(o)("projects.details.requirements")),1),e(Le,{"model-value":r.project.generation_progress.requirements.status==="completed"?100:r.project.generation_progress.requirements.status==="in_progress"?50:r.project.generation_progress.requirements.status==="pending"?10:0,color:r.project.generation_progress.requirements.status==="completed"?"success":r.project.generation_progress.requirements.status==="in_progress"?"info":r.project.generation_progress.requirements.status==="failed"?"error":"warning",height:"8",rounded:""},null,8,["model-value","color"]),i("div",ja,[i("small",null,l(a(o)(`projects.details.${r.project.generation_progress.requirements.status}`)),1),i("small",null,l(r.project.requirements?r.project.requirements.length:0)+" "+l(a(o)("projects.details.requirements_count")),1)])]),i("div",null,[i("div",xa,l(a(o)("projects.details.user_stories")),1),e(Le,{"model-value":r.project.generation_progress.user_stories.total>0?r.project.generation_progress.user_stories.completed/r.project.generation_progress.user_stories.total*100:0,color:"info",height:"8",rounded:""},null,8,["model-value"]),i("div",ka,[i("small",null,l(r.project.generation_progress.user_stories.completed)+" "+l(a(o)("projects.details.completed")),1),i("small",null,l(r.project.generation_progress.user_stories.total)+" "+l(a(o)("projects.details.total")),1)])]),i("div",null,[i("div",wa,l(a(o)("projects.details.mockups")),1),i("div",Va,[i("div",qa,[e(Le,{"model-value":r.project.mockups&&r.project.mockups.length?r.project.mockups.filter(x=>x.generation_status==="completed"&&!x.needs_regeneration).length/r.project.mockups.length*100:0,color:"success",height:"8",rounded:""},null,8,["model-value"])]),i("div",null,[r.project.mockups&&r.project.mockups.some(x=>x.needs_regeneration||x.generation_status==="in_progress"||x.generation_status==="pending")?(n(),g(J,{key:0,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[d(l(r.project.mockups.filter(x=>x.needs_regeneration||x.generation_status==="in_progress"||x.generation_status==="pending").length)+" "+l(a(o)("projects.details.pending")),1)]),_:1})):C("",!0)])])]),i("div",null,[i("div",Ca,l(a(o)("projects.details.uml_diagrams")),1),e(Le,{"model-value":r.project.generation_progress.uml_diagrams.total>0?r.project.generation_progress.uml_diagrams.completed/r.project.generation_progress.uml_diagrams.total*100:0,color:"primary",height:"8",rounded:""},null,8,["model-value"]),i("div",Sa,[i("small",null,l(r.project.generation_progress.uml_diagrams.completed)+" "+l(a(o)("projects.details.completed")),1),i("small",null,l(r.project.generation_progress.uml_diagrams.total)+" "+l(a(o)("projects.details.total")),1)])])])]),_:1})]),_:1})):C("",!0)])]),_:1})]),_:1})]),_:1}))}},Da=be(Ua,[["__scopeId","data-v-a9aecf26"]]),bt=Me({id:"RequirementStore",state:()=>({requirements:[],currentRequirement:null,loading:!1,error:null}),actions:{async fetchRequirements(r=null){this.loading=!0;try{let u="/service/requirements/";r&&(u+=`?project=${r}`);const o=await W.get(u);return o.status===200?(this.requirements=o.data,{data:o.data,error:null}):{data:[],error:o.data}}catch(u){return this.error=u.message||"Failed to fetch requirements",{data:[],error:this.error}}finally{this.loading=!1}},async fetchRequirementById(r){this.loading=!0;try{const u=await W.get(`/service/requirements/${r}/`);return u.status===200?(this.currentRequirement=u.data,{data:u.data,error:null}):{data:null,error:u.data}}catch(u){return this.error=u.message||"Failed to fetch requirement",{data:null,error:this.error}}finally{this.loading=!1}},async createRequirement(r){this.loading=!0;try{const u=await W.post("/service/requirements/",r);return u.status===201?(this.requirements.length&&this.requirements.push(u.data),{data:u.data,error:null}):{data:null,error:u.data}}catch(u){return this.error=u.message||"Failed to create requirement",{data:null,error:this.error}}finally{this.loading=!1}},async updateRequirement(r,u){this.loading=!0;try{const o=await W.put(`/service/requirements/${r}/`,u);if(o.status===200){if(this.requirements.length){const s=this.requirements.findIndex(f=>f.id===r);s!==-1&&(this.requirements[s]=o.data)}return this.currentRequirement&&this.currentRequirement.id===r&&(this.currentRequirement=o.data),{data:o.data,error:null}}return{data:null,error:o.data}}catch(o){return this.error=o.message||"Failed to update requirement",{data:null,error:this.error}}finally{this.loading=!1}},async deleteRequirement(r){this.loading=!0;try{const u=await W.delete(`/service/requirements/${r}/`);return u.status===204?(this.requirements.length&&(this.requirements=this.requirements.filter(o=>o.id!==r)),this.currentRequirement&&this.currentRequirement.id===r&&(this.currentRequirement=null),{success:!0,error:null}):{success:!1,error:u.data}}catch(u){return this.error=u.message||"Failed to delete requirement",{success:!1,error:this.error}}finally{this.loading=!1}},async createComment(r,u){this.loading=!0;try{const o=await W.post("/service/requirement-comments/",{requirement:r,text:u.text,status:u.status||"active",responsible_user:u.responsibleUser||null});return o.status===201?{data:o.data,error:null}:{data:null,error:o.data}}catch(o){return this.error=o.message||"Failed to create comment",{data:null,error:this.error}}finally{this.loading=!1}},async deleteComment(r){this.loading=!0;try{const u=await W.delete(`/service/requirement-comments/${r}/`);return u.status===204?{success:!0,error:null}:{success:!1,error:u.data}}catch(u){return this.error=u.message||"Failed to delete comment",{success:!1,error:this.error}}finally{this.loading=!1}}}}),za={key:0,class:"text-h5"},Ia={key:1,class:"text-h5"},Pa={key:0},Ma={key:1},Ba={class:"d-flex align-center mb-5"},$a={class:"text-medium-emphasis d-flex align-center"},Fa={class:"text-caption me-4"},La={class:"text-caption"},Ra={class:"text-h4 mb-4"},Oa={class:"text-body-1 whitespace-pre-wrap"},Aa={key:0,class:"text-center pa-6"},Ta={class:"text-h6 mb-2"},Na={class:"text-medium-emphasis mb-4"},Ha={key:1},Ea={class:"d-flex justify-space-between align-center mb-4"},Ka={class:"text-h5"},Ya={class:"mb-2"},Ja={key:0,class:"mt-3"},Ga={class:"text-subtitle-2"},Za={class:"pl-4"},Qa={key:0},Wa={key:0,class:"text-center mt-4"},Xa={key:0,class:"text-center pa-6"},el={class:"text-h6 mb-2"},tl={class:"text-medium-emphasis"},al={key:1},ll={class:"text-caption"},rl={class:"text-caption text-medium-emphasis"},sl={class:"d-flex align-center mb-2"},ol={class:"text-caption"},il={class:"text-body-2 whitespace-pre-wrap"},nl={class:"d-flex justify-end mt-2"},cl={key:1,class:"text-center pa-6"},ul={class:"text-h6 mb-2"},dl={class:"text-medium-emphasis"},pl={key:2},ml={class:"d-flex align-center"},vl={class:"d-flex align-center"},_l={class:"text-caption text-medium-emphasis ml-2"},fl={class:"comment-text mt-2 whitespace-pre-wrap"},hl={__name:"RequirementDetailsDialog",props:{modelValue:{type:Boolean,default:!1},requirement:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},hasModeratorPermission:{type:Boolean,default:!1}},emits:["update:modelValue","update","delete","view-user-stories"],setup(r,{emit:u}){const o=r,{t:s}=ce(),f=K({get:()=>o.modelValue,set:V=>u("update:modelValue",V)}),c=bt(),p=S(0),_=S(!1),y=S({...o.requirement}),x=S(""),w=S(!1),$=S({show:!1,text:"",color:"success"}),P=[{title:s("projects.categories.functional"),value:"functional"},{title:s("projects.categories.nonfunctional"),value:"nonfunctional"},{title:s("projects.categories.uiux"),value:"uiux"},{title:s("projects.categories.other"),value:"other"}],I=[{title:s("projects.status.draft"),value:"draft"},{title:s("projects.status.active"),value:"active"},{title:s("projects.status.archived"),value:"archived"},{title:s("projects.status.completed"),value:"completed"}],B=[{title:s("projects.requirements.types.feature"),value:"feature"},{title:s("projects.requirements.types.constraint"),value:"constraint"},{title:s("projects.requirements.types.quality"),value:"quality"},{title:s("projects.requirements.types.interface"),value:"interface"},{title:s("projects.requirements.types.security"),value:"security"},{title:s("projects.requirements.types.performance"),value:"performance"},{title:s("projects.requirements.types.other"),value:"other"}],N=K(()=>o.requirement.history||[]),F=K(()=>o.requirement.comments||[]),D=K(()=>o.requirement.user_stories||[]),H=V=>V?(V=parseInt(V),new Date(V).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",U=()=>{_.value&&(y.value={...o.requirement}),_.value=!_.value},E=()=>{u("update",y.value),_.value=!1},O=()=>{u("delete")},j=()=>{u("view-user-stories",o.requirement),f.value=!1},re=async()=>{if(x.value.trim()){w.value=!0;try{const{data:V,error:h}=await c.createComment(o.requirement.id,{text:x.value,status:"active"});if(V&&!h){L(s("projects.requirements.notifications.comment_added")),x.value="";const{data:q}=await c.fetchRequirementById(o.requirement.id);q&&Object.assign(o.requirement,q)}else L(s("projects.requirements.notifications.comment_add_failed"),"error")}catch(V){L(s("projects.requirements.notifications.comment_add_failed")+": "+V.message,"error")}finally{w.value=!1}}},L=(V,h="success")=>{$.value={show:!0,text:V,color:h}};return ke(()=>o.requirement,V=>{y.value={...V}},{deep:!0}),(V,h)=>{const q=ve("IconBtn");return n(),g(ge,{modelValue:a(f),"onUpdate:modelValue":h[11]||(h[11]=m=>we(f)?f.value=m:null),"max-width":"900",scrollable:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{class:"d-flex pt-5 px-5"},{default:t(()=>[_.value?(n(),v("h5",za,l(a(s)("projects.requirements.actions.edit")),1)):(n(),v("h5",Ia,l(a(s)("projects.requirements.actions.view_details")),1)),e(ee),e(q,{onClick:h[0]||(h[0]=m=>f.value=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),_:1}),e(G,{class:"pb-0"},{default:t(()=>[e(Qe,{modelValue:p.value,"onUpdate:modelValue":h[1]||(h[1]=m=>p.value=m),"slider-color":"primary","align-tabs":"start"},{default:t(()=>[e(de,{value:"0"},{default:t(()=>[e(k,{size:"18",icon:"tabler-info-circle",start:""}),d(" "+l(a(s)("projects.requirements.tabs.details")),1)]),_:1}),e(de,{value:"1"},{default:t(()=>[e(k,{size:"18",icon:"tabler-user-check",start:""}),d(" "+l(a(s)("projects.requirements.tabs.user_stories"))+" ",1),a(D).length?(n(),g(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[d(l(a(D).length),1)]),_:1})):C("",!0)]),_:1}),e(de,{value:"2"},{default:t(()=>[e(k,{size:"18",icon:"tabler-history",start:""}),d(" "+l(a(s)("projects.requirements.tabs.history"))+" ",1),a(N).length?(n(),g(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[d(l(a(N).length),1)]),_:1})):C("",!0)]),_:1}),e(de,{value:"3"},{default:t(()=>[e(k,{size:"18",icon:"tabler-messages",start:""}),d(" "+l(a(s)("projects.requirements.tabs.comments"))+" ",1),a(F).length?(n(),g(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[d(l(a(F).length),1)]),_:1})):C("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(X),e(G,{class:"pa-6",style:{"min-height":"400px","max-height":"70vh"}},{default:t(()=>[e(We,{modelValue:p.value,"onUpdate:modelValue":h[8]||(h[8]=m=>p.value=m),class:"mt-5"},{default:t(()=>[e(pe,{value:"0"},{default:t(()=>[_.value?(n(),v("div",Pa,[e(Ve,{onSubmit:je(E,["prevent"])},{default:t(()=>[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e(oe,{modelValue:y.value.title,"onUpdate:modelValue":h[2]||(h[2]=m=>y.value.title=m),label:a(s)("projects.requirements.title"),required:"",rules:[m=>!!m||a(s)("validation.required")]},null,8,["modelValue","label","rules"])]),_:1}),e(A,{cols:"12",md:"4"},{default:t(()=>[e(ne,{modelValue:y.value.category,"onUpdate:modelValue":h[3]||(h[3]=m=>y.value.category=m),label:a(s)("projects.requirements.category"),items:P,required:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12",md:"4"},{default:t(()=>[e(ne,{modelValue:y.value.requirement_type,"onUpdate:modelValue":h[4]||(h[4]=m=>y.value.requirement_type=m),label:a(s)("projects.requirements.type"),items:B,required:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12",md:"4"},{default:t(()=>[e(ne,{modelValue:y.value.status,"onUpdate:modelValue":h[5]||(h[5]=m=>y.value.status=m),label:a(s)("projects.requirements.status"),items:I,required:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(he,{modelValue:y.value.description,"onUpdate:modelValue":h[6]||(h[6]=m=>y.value.description=m),label:a(s)("projects.requirements.description"),required:"",rows:"8",rules:[m=>!!m||a(s)("validation.required")]},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),v("div",Ma,[i("div",Ba,[e(J,{color:a(Je)(r.requirement.category),size:"small",label:"",class:"me-2"},{default:t(()=>[d(l(a(s)(`projects.categories.${r.requirement.category}`)),1)]),_:1},8,["color"]),e(J,{color:a(fe)(r.requirement.status),size:"small",label:""},{default:t(()=>[d(l(a(s)(`projects.status.${r.requirement.status}`)),1)]),_:1},8,["color"]),e(J,{color:"secondary",size:"small",label:"",class:"ms-2"},{default:t(()=>[d(" v"+l(r.requirement.version_number),1)]),_:1}),r.requirement.requirement_type?(n(),g(J,{key:0,color:"info",size:"small",label:"",class:"ms-2"},{default:t(()=>[d(l(a(s)(`projects.requirements.types.${r.requirement.requirement_type}`)),1)]),_:1})):C("",!0),e(ee),i("div",$a,[e(k,{size:"18",icon:"tabler-calendar",class:"me-1"}),i("span",Fa,l(a(s)("projects.details.updated_at"))+": "+l(H(r.requirement.updated_at)),1),e(k,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),i("span",La,l(a(s)("projects.details.created_at"))+": "+l(H(r.requirement.created_at)),1)])]),i("h4",Ra,l(r.requirement.title),1),i("div",Oa,l(r.requirement.description),1)]))]),_:1}),e(pe,{value:"1"},{default:t(()=>[a(D).length===0?(n(),v("div",Aa,[e(k,{icon:"tabler-user-check",size:"64",color:"secondary",class:"mb-3"}),i("h4",Ta,l(a(s)("projects.requirements.user_stories.empty.title")),1),i("p",Na,l(a(s)("projects.requirements.user_stories.empty.description")),1),e(R,{color:"primary",onClick:j},{default:t(()=>[d(l(a(s)("projects.requirements.actions.generate_user_stories")),1)]),_:1})])):(n(),v("div",Ha,[i("div",Ea,[i("h5",Ka,l(a(s)("projects.requirements.user_stories.title")),1),e(R,{color:"primary",variant:"tonal",onClick:j},{default:t(()=>[d(l(a(s)("projects.requirements.actions.view_all_stories")),1)]),_:1})]),(n(!0),v(Z,null,se(a(D).slice(0,3),(m,M)=>(n(),g(Q,{key:m.id,class:"mb-4",border:""},{default:t(()=>[e(ie,null,{append:t(()=>[e(J,{color:a(fe)(m.status),size:"small",label:""},{default:t(()=>[d(l(a(s)(`projects.status.${m.status}`)),1)]),_:2},1032,["color"])]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(s)("projects.requirements.user_stories.as_a",{role:m.role})),1)]),_:2},1024)]),_:2},1024),e(G,null,{default:t(()=>[i("p",Ya,[i("strong",null,l(a(s)("projects.requirements.user_stories.i_want_to"))+":",1),d(" "+l(m.action),1)]),i("p",null,[i("strong",null,l(a(s)("projects.requirements.user_stories.so_that"))+":",1),d(" "+l(m.benefit),1)]),m.acceptance_criteria&&m.acceptance_criteria.length>0?(n(),v("div",Ja,[i("div",Ga,l(a(s)("projects.requirements.user_stories.acceptance_criteria"))+":",1),i("ul",Za,[(n(!0),v(Z,null,se(m.acceptance_criteria.slice(0,2),(b,T)=>(n(),v("li",{key:T},l(b),1))),128)),m.acceptance_criteria.length>2?(n(),v("li",Qa,l(a(s)("projects.requirements.user_stories.and_more",{count:m.acceptance_criteria.length-2})),1)):C("",!0)])])):C("",!0)]),_:2},1024)]),_:2},1024))),128)),a(D).length>3?(n(),v("div",Wa,[e(R,{color:"primary",variant:"tonal",onClick:j},{default:t(()=>[d(l(a(s)("projects.requirements.actions.view_all_stories_count",{count:a(D).length})),1)]),_:1})])):C("",!0)]))]),_:1}),e(pe,{value:"2"},{default:t(()=>[a(N).length===0?(n(),v("div",Xa,[e(k,{icon:"tabler-history",size:"64",color:"secondary",class:"mb-3"}),i("h4",el,l(a(s)("projects.requirements.history.empty.title")),1),i("p",tl,l(a(s)("projects.requirements.history.empty.description")),1)])):(n(),v("div",al,[e(gt,{density:"compact",align:"start"},{default:t(()=>[(n(!0),v(Z,null,se(a(N),(m,M)=>(n(),g(yt,{key:M,"dot-color":"primary",size:"small"},{opposite:t(()=>[i("div",ll,l(H(m.changed_at)),1),i("div",rl,"v"+l(m.version_number),1)]),default:t(()=>[e(Q,{border:""},{default:t(()=>[e(ie,null,{append:t(()=>[e(J,{color:a(fe)(m.status),size:"small",label:"",class:"ms-2"},{default:t(()=>[d(l(a(s)(`projects.status.${m.status}`)),1)]),_:2},1032,["color"])]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(m.title),1)]),_:2},1024)]),_:2},1024),e(G,null,{default:t(()=>[i("div",sl,[e(J,{color:a(Je)(m.category),size:"small",label:"",class:"me-2"},{default:t(()=>[d(l(a(s)(`projects.categories.${m.category}`)),1)]),_:2},1032,["color"]),i("span",ol,l(a(s)("projects.requirements.history.changed_by"))+": "+l(m.changed_by?m.changed_by.username:a(s)("projects.requirements.history.unknown")),1)]),i("div",il,l(m.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1}),e(pe,{value:"3"},{default:t(()=>[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e(he,{modelValue:x.value,"onUpdate:modelValue":h[7]||(h[7]=m=>x.value=m),label:a(s)("projects.requirements.comments.add"),rows:"3",counter:"",disabled:w.value},null,8,["modelValue","label","disabled"]),i("div",nl,[e(R,{color:"primary",size:"small",loading:w.value,disabled:!x.value.trim(),onClick:re},{default:t(()=>[d(l(a(s)("projects.requirements.comments.add_button")),1)]),_:1},8,["loading","disabled"])])]),_:1}),e(A,{cols:"12"},{default:t(()=>[a(F).length?(n(),g(X,{key:0,class:"mb-4"})):C("",!0),a(F).length===0?(n(),v("div",cl,[e(k,{icon:"tabler-messages",size:"64",color:"secondary",class:"mb-3"}),i("h4",ul,l(a(s)("projects.requirements.comments.empty.title")),1),i("p",dl,l(a(s)("projects.requirements.comments.empty.description")),1)])):(n(),v("div",pl,[(n(!0),v(Z,null,se(a(F),m=>(n(),v("div",{key:m.id,class:"comment-item mb-4"},[e(Q,{border:""},{default:t(()=>[e(G,{class:"py-2"},{default:t(()=>[i("div",ml,[e(xe,{color:"primary",variant:"tonal",size:"36",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-user"})]),_:1}),i("div",null,[i("div",vl,[i("strong",null,l(m.user?m.user.username:a(s)("projects.requirements.comments.unknown_user")),1),i("div",_l,l(H(m.created_at)),1)])]),e(ee),r.isAdmin||r.hasManagerPermission?(n(),g(q,{key:0,size:"small",color:"error",variant:"text",onClick:M=>(async b=>{w.value=!0;try{const{success:T,error:z}=await c.deleteComment(b);if(T&&!z){L(s("projects.requirements.notifications.comment_deleted"));const{data:te}=await c.fetchRequirementById(o.requirement.id);te&&Object.assign(o.requirement,te)}else L(s("projects.requirements.notifications.comment_delete_failed"),"error")}catch(T){L(s("projects.requirements.notifications.comment_delete_failed")+": "+T.message,"error")}finally{w.value=!1}})(m.id),disabled:w.value},{default:t(()=>[e(k,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick","disabled"])):C("",!0)]),i("div",fl,l(m.text),1)]),_:2},1024)]),_:2},1024)]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(X),e(ue,{class:"pa-4"},{default:t(()=>[_.value?(n(),v(Z,{key:0},[e(R,{color:"secondary",variant:"tonal",onClick:U},{default:t(()=>[d(l(a(s)("projects.actions.cancel")),1)]),_:1}),e(ee),e(R,{color:"primary",onClick:E},{default:t(()=>[d(l(a(s)("projects.actions.save")),1)]),_:1})],64)):(n(),v(Z,{key:1},[r.isAdmin?(n(),g(R,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:O},{default:t(()=>[d(l(a(s)("projects.requirements.actions.delete")),1)]),_:1})):C("",!0),r.hasModeratorPermission&&a(D).length===0?(n(),g(R,{key:1,color:"info",variant:"tonal","prepend-icon":"tabler-user-check",class:"ms-2",onClick:j},{default:t(()=>[d(l(a(s)("projects.requirements.actions.generate_user_stories")),1)]),_:1})):C("",!0),e(ee),r.hasModeratorPermission?(n(),g(R,{key:2,color:"primary","prepend-icon":"tabler-edit",onClick:U},{default:t(()=>[d(l(a(s)("projects.requirements.actions.edit")),1)]),_:1})):C("",!0)],64))]),_:1})]),_:1}),e(ye,{modelValue:$.value.show,"onUpdate:modelValue":h[10]||(h[10]=m=>$.value.show=m),color:$.value.color,timeout:5e3},{actions:t(()=>[e(q,{onClick:h[9]||(h[9]=m=>$.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l($.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue"])}}},gl=be(hl,[["__scopeId","data-v-3201dc21"]]),yl={class:"text-h5"},bl={__name:"RequirementCreateDialog",props:{modelValue:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},requirementData:{type:Object,default:()=>({})}},emits:["update:modelValue","submit"],setup(r,{emit:u}){const o=r,{t:s}=ce(),f=K({get:()=>o.modelValue,set:B=>u("update:modelValue",B)}),c=S({title:o.editMode&&o.requirementData?o.requirementData.title:"",description:o.editMode&&o.requirementData?o.requirementData.description:"",category:o.editMode&&o.requirementData?o.requirementData.category:"functional",status:o.editMode&&o.requirementData?o.requirementData.status:"draft"}),p=[B=>!!B||s("validation.required"),B=>B.length<=255||s("projects.requirements.validation.title_length")],_=[B=>!!B||s("validation.required")],y=[{title:s("projects.categories.functional"),value:"functional"},{title:s("projects.categories.nonfunctional"),value:"nonfunctional"},{title:s("projects.categories.uiux"),value:"uiux"},{title:s("projects.categories.other"),value:"other"}],x=[{title:s("projects.status.draft"),value:"draft"},{title:s("projects.status.active"),value:"active"},{title:s("projects.status.archived"),value:"archived"},{title:s("projects.status.completed"),value:"completed"}],w=S(null),$=()=>{c.value={title:"",description:"",category:"functional",status:"draft"},w.value&&w.value.resetValidation()},P=()=>{f.value=!1,$()},I=async()=>{const{valid:B}=await w.value.validate();B&&(u("submit",c.value),f.value=!1,$())};return ke(f,B=>{B||$()}),(B,N)=>{const F=ve("IconBtn");return n(),g(ge,{modelValue:a(f),"onUpdate:modelValue":N[4]||(N[4]=D=>we(f)?f.value=D:null),"max-width":"700",persistent:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{class:"d-flex pt-5 px-5"},{default:t(()=>[i("h5",yl,l(o.editMode?a(s)("projects.requirements.actions.edit"):a(s)("projects.requirements.actions.add")),1),e(ee),e(F,{onClick:P},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),_:1}),e(G,{class:"px-5 pt-4"},{default:t(()=>[e(Ve,{ref_key:"formRef",ref:w,onSubmit:je(I,["prevent"])},{default:t(()=>[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e(oe,{modelValue:c.value.title,"onUpdate:modelValue":N[0]||(N[0]=D=>c.value.title=D),label:a(s)("projects.requirements.title"),rules:p,required:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12",md:"6"},{default:t(()=>[e(ne,{modelValue:c.value.category,"onUpdate:modelValue":N[1]||(N[1]=D=>c.value.category=D),label:a(s)("projects.requirements.category"),items:y,required:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12",md:"6"},{default:t(()=>[e(ne,{modelValue:c.value.status,"onUpdate:modelValue":N[2]||(N[2]=D=>c.value.status=D),label:a(s)("projects.requirements.status"),items:x,required:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(he,{modelValue:c.value.description,"onUpdate:modelValue":N[3]||(N[3]=D=>c.value.description=D),label:a(s)("projects.requirements.description"),rules:_,required:"",rows:"6"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(X),e(ue,{class:"pa-4"},{default:t(()=>[e(R,{variant:"tonal",color:"secondary",onClick:P},{default:t(()=>[d(l(a(s)("projects.actions.cancel")),1)]),_:1}),e(ee),e(R,{color:"primary",onClick:I},{default:t(()=>[d(l(o.editMode?a(s)("projects.actions.update"):a(s)("projects.actions.create")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},jl={key:0,class:"d-flex justify-center align-center",style:{height:"300px"}},xl={key:1,class:"text-center pa-4"},kl={class:"text-h6 mb-2"},wl={class:"text-body-1 text-medium-emphasis mb-6"},Vl={class:"text-body-2 mb-3"},ql={class:"d-flex align-center justify-space-between mb-2"},Cl={class:"d-flex align-center"},Sl={class:"text-caption text-capitalize"},Ul={class:"d-flex align-center"},Dl={class:"text-caption"},zl={class:"d-flex align-center"},Il={class:"text-caption"},Pl={key:0,class:"mt-3"},Ml={__name:"ProjectRequirementsList",props:{projectId:{type:String,required:!0},requirements:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh","view-user-stories"],setup(r,{emit:u}){const o=r,{t:s}=ce(),f=bt(),c=Ue(),p=S(""),_=S([]),y=S(["draft","active","completed"]),x=S(null),w=S(!1),$=S(!1),P=S(!1),I=S(!1),B=S({show:!1,text:"",color:"success"}),N=K(()=>c.is_admin()),F=K(()=>c.userData.role>=2),D=K(()=>c.userData.role>=3),H=[{title:s("projects.categories.functional"),value:"functional"},{title:s("projects.categories.nonfunctional"),value:"nonfunctional"},{title:s("projects.categories.uiux"),value:"uiux"},{title:s("projects.categories.other"),value:"other"}],U=[{title:s("projects.status.draft"),value:"draft"},{title:s("projects.status.active"),value:"active"},{title:s("projects.status.archived"),value:"archived"},{title:s("projects.status.completed"),value:"completed"}],E=K(()=>o.requirements.filter(m=>{const M=!p.value||m.title.toLowerCase().includes(p.value.toLowerCase())||m.description.toLowerCase().includes(p.value.toLowerCase()),b=_.value.length===0||_.value.includes(m.category),T=y.value.includes(m.status);return M&&b&&T})),O=()=>{$.value=!0},j=async m=>{I.value=!0;try{const{data:M,error:b}=await f.createRequirement({...m,project:o.projectId});M&&!b?(h("projects.requirements.notifications.created"),u("refresh")):h("projects.requirements.notifications.create_failed","error")}catch{h("projects.requirements.notifications.create_failed","error")}finally{I.value=!1}},re=async m=>{I.value=!0;try{const{data:M,error:b}=await f.updateRequirement(x.value.id,m);M&&!b?(h("projects.requirements.notifications.updated"),u("refresh")):h("projects.requirements.notifications.update_failed","error")}catch{h("projects.requirements.notifications.update_failed","error")}finally{I.value=!1}},L=async()=>{if(x.value){I.value=!0,P.value=!1;try{const{success:m,error:M}=await f.deleteRequirement(x.value.id);m&&!M?(h("projects.requirements.notifications.deleted"),u("refresh"),w.value=!1):h("projects.requirements.notifications.delete_failed","error")}catch{h("projects.requirements.notifications.delete_failed","error")}finally{I.value=!1}}},V=m=>{u("view-user-stories",m)},h=(m,M="success")=>{B.value={show:!0,text:s(m),color:M}},q=(m,M=120)=>!m||m.length<=M?m:m.substring(0,M)+"...";return(m,M)=>{const b=Fe,T=ve("IconBtn");return n(),g(G,{class:"pa-6"},{default:t(()=>[e(le,null,{default:t(()=>[e(A,{cols:"12",md:"4"},{default:t(()=>[e(oe,{modelValue:p.value,"onUpdate:modelValue":M[0]||(M[0]=z=>p.value=z),density:"compact",placeholder:a(s)("projects.requirements.actions.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(A,{cols:"12",md:"3"},{default:t(()=>[e(ne,{modelValue:_.value,"onUpdate:modelValue":M[1]||(M[1]=z=>_.value=z),items:H,density:"compact","hide-details":"",label:a(s)("projects.requirements.actions.category"),variant:"outlined",multiple:"",chips:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12",md:"3"},{default:t(()=>[e(ne,{modelValue:y.value,"onUpdate:modelValue":M[2]||(M[2]=z=>y.value=z),items:U,density:"compact","hide-details":"",label:a(s)("projects.requirements.actions.status"),variant:"outlined",multiple:"",chips:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[a(D)?(n(),g(R,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:O,loading:I.value,block:""},{default:t(()=>[d(l(a(s)("projects.requirements.actions.add")),1)]),_:1},8,["loading"])):C("",!0)]),_:1})]),_:1}),e(X,{class:"my-5"}),r.loading?(n(),v("div",jl,[e(me,{indeterminate:"",color:"primary"})])):a(E).length===0?(n(),v("div",xl,[e(k,{icon:"tabler-file-search",size:"64",color:"secondary",class:"mb-4"}),i("h4",kl,l(a(s)("projects.requirements.empty.title")),1),i("p",wl,l(p.value||_.value.length>0||y.value.length>0?a(s)("projects.requirements.empty.filtered"):a(s)("projects.requirements.empty.no_requirements")),1),a(D)&&!p.value&&_.value.length===0&&y.value.length===0?(n(),g(R,{key:0,color:"primary",onClick:O,"prepend-icon":"tabler-plus"},{default:t(()=>[d(l(a(s)("projects.requirements.actions.add_requirement")),1)]),_:1})):C("",!0)])):(n(),g(le,{key:2},{default:t(()=>[(n(!0),v(Z,null,se(a(E),z=>(n(),g(A,{key:z.id,cols:"12"},{default:t(()=>[e(Q,{class:"requirement-card",onClick:te=>(Ce=>{x.value=Ce,w.value=!0})(z),border:"",hover:""},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(xe,{color:a(Je)(z.category),variant:"tonal",size:"42"},{default:t(()=>[z.category==="functional"?(n(),g(k,{key:0,icon:"tabler-function"})):z.category==="nonfunctional"?(n(),g(k,{key:1,icon:"tabler-chart-bar"})):z.category==="uiux"?(n(),g(k,{key:2,icon:"tabler-palette"})):(n(),g(k,{key:3,icon:"tabler-file-description"}))]),_:2},1032,["color"])]),append:t(()=>[e(J,{color:a(fe)(z.status),size:"small",label:""},{default:t(()=>{return[d(l((te=z.status,te?te.charAt(0).toUpperCase()+te.slice(1):"")),1)];var te}),_:2},1032,["color"])]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(z.handle)+" "+l(z.title),1)]),_:2},1024)]),_:2},1024),e(G,null,{default:t(()=>{return[i("p",Vl,l(q(z.description)),1),i("div",ql,[i("div",Cl,[e(k,{size:"16",icon:"tabler-tag",class:"me-1"}),i("span",Sl,l(z.category),1)]),i("div",Ul,[e(k,{size:"16",icon:"tabler-calendar",class:"me-1"}),i("span",Dl,l((te=z.updated_at,te?(te=parseInt(te),new Date(te).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"")),1)]),i("div",zl,[e(k,{size:"16",icon:"tabler-history",class:"me-1"}),i("span",Il,"v"+l(z.version_number),1)])]),z.user_stories&&z.user_stories.length>0?(n(),v("div",Pl,[e(R,{size:"small",variant:"tonal",color:"primary","prepend-icon":"tabler-user-check",onClick:je(Ce=>V(z),["stop"])},{default:t(()=>[d(l(z.user_stories.length)+" "+l(a(s)(z.user_stories.length===1?"projects.requirements.user_stories.single":"projects.requirements.user_stories.multiple")),1)]),_:2},1032,["onClick"])])):C("",!0)];var te}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),x.value?(n(),g(gl,{key:3,modelValue:w.value,"onUpdate:modelValue":M[3]||(M[3]=z=>w.value=z),requirement:x.value,onDelete:M[4]||(M[4]=z=>P.value=!0),onUpdate:re,onViewUserStories:V,"is-admin":a(N),"has-manager-permission":a(F),"has-moderator-permission":a(D)},null,8,["modelValue","requirement","is-admin","has-manager-permission","has-moderator-permission"])):C("",!0),e(bl,{modelValue:$.value,"onUpdate:modelValue":M[5]||(M[5]=z=>$.value=z),onSubmit:j},null,8,["modelValue"]),e(b,{isDialogVisible:P.value,"onUpdate:isDialogVisible":M[6]||(M[6]=z=>P.value=z),confirmationMsg:a(s)("projects.requirements.delete_confirm.message"),onConfirm:L},null,8,["isDialogVisible","confirmationMsg"]),e(ye,{modelValue:B.value.show,"onUpdate:modelValue":M[8]||(M[8]=z=>B.value.show=z),color:B.value.color,timeout:5e3},{actions:t(()=>[e(T,{onClick:M[7]||(M[7]=z=>B.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l(B.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},Bl=be(Ml,[["__scopeId","data-v-04291289"]]),jt=Me("mockup",()=>{const r=S([]),u=S(!1),o=S(null);return{mockups:r,loading:u,error:o,fetchProjectMockups:async s=>{u.value=!0,o.value=null;try{const f=await W.get(`/service/projects/${s}/mockups/`);return r.value=f.data,f.data}catch(f){throw o.value="Failed to fetch mockups",console.error(f),f}finally{u.value=!1}},fetchMockup:async s=>{u.value=!0,o.value=null;try{const f=await W.get(`/service/mockups/${s}/`),c=r.value.findIndex(p=>p.id===s);return c!==-1&&(r.value[c]=f.data),f.data}catch(f){throw o.value="Failed to fetch mockup",console.error(f),f}finally{u.value=!1}},regenerateMockup:async s=>{u.value=!0,o.value=null;try{const f=await W.post(`/service/mockups/${s}/regenerate/`),c=r.value.findIndex(p=>p.id===s);return c!==-1&&(r.value[c]=f.data),f.data}catch(f){throw o.value="Failed to regenerate mockup",console.error(f),f}finally{u.value=!1}},regenerateAllMockups:async s=>{u.value=!0,o.value=null;try{const f=await W.post(`/service/projects/${s}/regenerate-mockups/`);return r.value=f.data,f.data}catch(f){throw o.value="Failed to regenerate all mockups",console.error(f),f}finally{u.value=!1}}}}),$l={key:0,class:"text-h5"},Fl={class:"text-h5"},Ll={key:0,class:"ms-2 d-flex align-center"},Rl={class:"text-caption"},Ol={key:0},Al={key:1},Tl={class:"mockup-metadata d-flex align-center px-6 py-3"},Nl={class:"d-flex align-center"},Hl={class:"text-caption"},El={class:"d-flex align-center ms-4"},Kl={class:"text-caption"},Yl={key:0,class:"d-flex align-center ms-4"},Jl={class:"text-caption"},Gl={key:1,class:"d-flex align-center ms-4"},Zl={class:"text-caption"},Ql={class:"mockup-content pa-0"},Wl={class:"text-h6 mb-2"},Xl={class:"text-body-1 text-medium-emphasis max-width-md text-center"},er=["srcdoc","title"],tr={key:2,class:"d-flex flex-column justify-center align-center pa-6",style:{height:"400px"}},ar={class:"text-h6 mb-2"},lr={class:"text-medium-emphasis text-center"},rr={__name:"MockupPreviewDialog",props:{modelValue:{type:Boolean,default:!1},mockup:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1}},emits:["update:modelValue","delete","regenerate"],setup(r,{emit:u}){const o=r,{t:s}=ce(),f=K({get:()=>o.modelValue,set:O=>u("update:modelValue",O)}),c=jt(),p=S(!1),_=S(!1),y=S({...o.mockup}),x=S(!1),w=S(null),$=S({show:!1,text:"",color:"success"}),P=K(()=>o.mockup.generation_status==="in_progress"||o.mockup.generation_status==="pending"||o.mockup.needs_regeneration),I=O=>O?(O=parseInt(O),new Date(O).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",B=()=>{p.value=!p.value},N=()=>{_.value&&(y.value={...o.mockup}),_.value=!_.value},F=async()=>{x.value=!0;try{const{data:O,error:j}=await c.updateMockup(o.mockup.id,y.value);O&&!j?(U(s("projects.mockups.notifications.updated")),Object.assign(o.mockup,O),_.value=!1):U(s("projects.mockups.notifications.update_failed"),"error")}catch(O){U(s("projects.mockups.notifications.update_error",{error:O.message}),"error")}finally{x.value=!1}},D=()=>{u("delete")},H=async()=>{x.value=!0;try{o.mockup.user_story?await c.regenerateMockup(o.mockup.id,{user_story_id:o.mockup.user_story.id}):o.mockup.requirement?await c.regenerateMockup(o.mockup.id,{requirement_id:o.mockup.requirement.id}):await c.regenerateMockup(o.mockup.id),U(s("projects.mockups.notifications.regeneration_started"))}catch(O){U(s("projects.mockups.notifications.regeneration_error",{error:O.message}),"error")}finally{x.value=!1}},U=(O,j="success")=>{$.value={show:!0,text:O,color:j}},E=()=>{P.value&&f.value&&c.fetchMockupById(o.mockup.id).then(({data:O})=>{O&&Object.assign(o.mockup,O)})};return ke(()=>o.mockup,O=>{y.value={...O}},{deep:!0}),Be(()=>{w.value=setInterval(E,5e3)}),dt(()=>{w.value&&clearInterval(w.value)}),(O,j)=>{const re=ve("IconBtn");return n(),g(ge,{modelValue:a(f),"onUpdate:modelValue":j[6]||(j[6]=L=>we(f)?f.value=L:null),fullscreen:p.value,"max-width":p.value?"100%":"900",scrollable:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{class:"d-flex py-3 px-5"},{default:t(()=>[_.value?(n(),v("h5",$l,l(a(s)("projects.mockups.actions.edit")),1)):(n(),v(Z,{key:1},[i("h5",Fl,l(r.mockup.name),1),e(J,{color:a(fe)(r.mockup.status),size:"small",label:""},{default:t(()=>[d(l(a(s)(`projects.status.${r.mockup.status}`)),1)]),_:1},8,["color"]),a(P)?(n(),v("div",Ll,[e(me,{indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"}),i("span",Rl,l(r.mockup.generation_status==="in_progress"?a(s)("projects.mockups.status.generating"):a(s)("projects.mockups.status.pending")),1)])):C("",!0)],64)),e(ee),e(R,{icon:"",variant:"text",onClick:B},{default:t(()=>[e(k,{icon:p.value?"tabler-minimize":"tabler-maximize"},null,8,["icon"])]),_:1}),e(re,{onClick:j[0]||(j[0]=L=>f.value=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),_:1}),e(X),e(G,{class:Ze({"pa-0":!_.value&&r.mockup.html_content,"pa-6":_.value||!r.mockup.html_content}),style:Se({height:p.value?"calc(100vh - 120px)":"70vh",maxHeight:"800px"})},{default:t(()=>[_.value?(n(),v("div",Ol,[e(Ve,{onSubmit:je(F,["prevent"])},{default:t(()=>[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e(oe,{modelValue:y.value.name,"onUpdate:modelValue":j[1]||(j[1]=L=>y.value.name=L),label:a(s)("projects.mockups.name"),required:"",rules:[L=>!!L||a(s)("projects.mockups.validation.name_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(A,{cols:"12",md:"6"},{default:t(()=>[e(ne,{modelValue:y.value.status,"onUpdate:modelValue":j[2]||(j[2]=L=>y.value.status=L),label:a(s)("projects.details.status"),items:[{title:a(s)("projects.status.draft"),value:"draft"},{title:a(s)("projects.status.active"),value:"active"},{title:a(s)("projects.status.archived"),value:"archived"},{title:a(s)("projects.status.completed"),value:"completed"}],required:""},null,8,["modelValue","label","items"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(he,{modelValue:y.value.html_content,"onUpdate:modelValue":j[3]||(j[3]=L=>y.value.html_content=L),label:a(s)("projects.mockups.html_content"),rows:"15",rules:[L=>!!L||a(s)("projects.mockups.validation.html_required")],monospace:""},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),v("div",Al,[i("div",Tl,[i("div",Nl,[e(k,{icon:"tabler-calendar",class:"me-2",size:"18"}),i("span",Hl,l(a(s)("projects.details.created_at"))+": "+l(I(r.mockup.created_at)),1)]),i("div",El,[e(k,{icon:"tabler-calendar-event",class:"me-2",size:"18"}),i("span",Kl,l(a(s)("projects.details.updated_at"))+": "+l(I(r.mockup.updated_at)),1)]),r.mockup.requirement?(n(),v("div",Yl,[e(k,{icon:"tabler-file-check",class:"me-2",size:"18"}),i("span",Jl,l(a(s)("projects.details.requirement"))+": "+l(r.mockup.requirement_name),1)])):C("",!0),r.mockup.user_story?(n(),v("div",Gl,[e(k,{icon:"tabler-user-check",class:"me-2",size:"18"}),i("span",Zl,l(a(s)("projects.details.user_story"))+": "+l(r.mockup.user_story_name),1)])):C("",!0)]),e(X),i("div",Ql,[a(P)?(n(),v("div",{key:0,class:"d-flex flex-column justify-center align-center",style:Se({height:p.value?"calc(100vh - 180px)":"calc(70vh - 110px)"})},[e(me,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),i("h4",Wl,l(r.mockup.generation_status==="in_progress"?a(s)("projects.mockups.status.generating"):a(s)("projects.mockups.status.preparing")),1),i("p",Xl,l(r.mockup.generation_status==="in_progress"?a(s)("projects.mockups.status.generating_description"):a(s)("projects.mockups.status.preparing_description")),1)],4)):r.mockup.html_content?(n(),v("iframe",{key:1,srcdoc:r.mockup.html_content,class:"mockup-iframe",style:Se([{width:"100%",border:"none"},{height:p.value?"calc(100vh - 180px)":"calc(70vh - 110px)"}]),sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",title:a(s)("projects.mockups.preview")},null,12,er)):(n(),v("div",tr,[e(k,{icon:"tabler-code-off",size:"64",color:"secondary",class:"mb-4"}),i("h4",ar,l(a(s)("projects.mockups.no_content.title")),1),i("p",lr,l(a(s)("projects.mockups.no_content.description")),1)]))])]))]),_:1},8,["class","style"]),e(X),e(ue,{class:"pa-4"},{default:t(()=>[_.value?(n(),v(Z,{key:0},[e(R,{color:"secondary",variant:"tonal",onClick:N,disabled:x.value},{default:t(()=>[d(l(a(s)("projects.actions.cancel")),1)]),_:1},8,["disabled"]),e(ee),e(R,{color:"primary",onClick:F,loading:x.value},{default:t(()=>[d(l(a(s)("projects.actions.save")),1)]),_:1},8,["loading"])],64)):(n(),v(Z,{key:1},[r.isAdmin?(n(),g(R,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:D},{default:t(()=>[d(l(a(s)("projects.actions.delete")),1)]),_:1})):C("",!0),r.hasManagerPermission?(n(),g(R,{key:1,color:"warning",variant:"tonal","prepend-icon":"tabler-refresh",onClick:H,loading:a(P)||x.value,disabled:a(P),class:"ms-2"},{default:t(()=>[d(l(a(s)("projects.mockups.actions.regenerate")),1)]),_:1},8,["loading","disabled"])):C("",!0),e(ee),r.hasManagerPermission?(n(),g(R,{key:2,color:"primary","prepend-icon":"tabler-edit",onClick:N},{default:t(()=>[d(l(a(s)("projects.actions.edit")),1)]),_:1})):C("",!0),r.hasManagerPermission?(n(),g(R,{key:3,class:"ms-2",color:"primary",variant:"tonal","prepend-icon":"tabler-code",onClick:N},{default:t(()=>[d(l(a(s)("projects.mockups.actions.view_html")),1)]),_:1})):C("",!0)],64))]),_:1})]),_:1}),e(ye,{modelValue:$.value.show,"onUpdate:modelValue":j[5]||(j[5]=L=>$.value.show=L),color:$.value.color,timeout:5e3},{actions:t(()=>[e(re,{onClick:j[4]||(j[4]=L=>$.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l($.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue","fullscreen","max-width"])}}},sr=be(rr,[["__scopeId","data-v-7f9dae9c"]]),or={class:"d-flex align-center"},ir={key:0,class:"d-flex justify-center align-center",style:{height:"300px"}},nr={key:1,class:"text-center pa-4"},cr={class:"text-h6 mb-2"},ur={class:"text-body-1 text-medium-emphasis mb-6"},dr={class:"d-flex align-center"},pr={class:"mockup-preview mb-3"},mr={class:"overflow-hidden position-relative rounded bg-grey-lighten-4",style:{height:"150px"}},vr={key:0,class:"d-flex justify-center align-center h-100"},_r={class:"text-center"},fr={class:"text-caption"},hr={key:1,class:"html-preview"},gr=["innerHTML"],yr={key:2,class:"d-flex justify-center align-center h-100"},br={class:"preview-overlay d-flex justify-center align-center"},jr={key:0,class:"mb-2"},xr={key:1,class:"mb-2"},kr={class:"text-caption font-weight-medium"},wr={class:"d-flex align-center justify-space-between"},Vr={class:"d-flex align-center"},qr={class:"text-caption"},Cr=be({__name:"ProjectMockupsList",props:{projectId:{type:String,required:!0},mockups:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(r,{emit:u}){const o=r,s=jt(),f=Ue(),{t:c}=ce(),p=S(""),_=S(null),y=S(!1),x=S(!1),w=S(!1),$=S(null),P=S({show:!1,text:"",color:"success"}),I=K(()=>f.is_admin()),B=K(()=>f.userData.role>=2);K(()=>f.userData.role>=3);const N=K(()=>o.mockups.filter(O=>O.needs_regeneration||O.generation_status==="in_progress"||O.generation_status==="pending").length),F=K(()=>o.mockups.filter(O=>!p.value||O.name.toLowerCase().includes(p.value.toLowerCase())||O.requirement&&O.requirement.toLowerCase().includes(p.value.toLowerCase()))),D=async()=>{if(_.value){w.value=!0,x.value=!1;try{const{success:O,error:j}=await s.deleteMockup(_.value.id);O&&!j?(H(c("projects.mockups.notifications.deleted")),u("refresh"),y.value=!1):H(c("projects.mockups.notifications.delete_failed"),"error")}catch(O){H(c("projects.mockups.notifications.delete_failed")+": "+O.message,"error")}finally{w.value=!1}}},H=(O,j="success")=>{P.value={show:!0,text:O,color:j}},U=(O,j=150)=>{if(!O||O.length<=j)return O;const re=O.replace(/<[^>]*>/g,"");return re.length<=j?O:re.substring(0,j)+"..."},E=()=>{N.value>0&&u("refresh")};return Be(()=>{$.value=setInterval(E,1e4)}),dt(()=>{$.value&&clearInterval($.value)}),(O,j)=>{const re=Fe,L=ve("IconBtn");return n(),g(G,{class:"pa-6"},{default:t(()=>[e(le,null,{default:t(()=>[e(A,{cols:"12",md:"6"},{default:t(()=>[e(oe,{modelValue:p.value,"onUpdate:modelValue":j[0]||(j[0]=V=>p.value=V),density:"compact",placeholder:a(c)("projects.mockups.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(A,{cols:"12",md:"6",class:"d-flex align-center"},{default:t(()=>[a(N)>0?(n(),g($e,{key:0,type:"info",variant:"tonal",density:"compact",class:"mb-0 flex-grow-1 me-2"},{default:t(()=>[i("div",or,[e(me,{indeterminate:"",color:"info",size:"16",width:"2",class:"me-2"}),i("span",null,l(a(N))+" "+l(a(c)("projects.mockups.status.pending_count")),1)])]),_:1})):C("",!0)]),_:1})]),_:1}),e(X,{class:"my-5"}),r.loading?(n(),v("div",ir,[e(me,{indeterminate:"",color:"primary"})])):a(F).length===0?(n(),v("div",nr,[e(k,{icon:"tabler-photo-off",size:"64",color:"secondary",class:"mb-4"}),i("h4",cr,l(a(c)("projects.mockups.empty.title")),1),i("p",ur,l(p.value?a(c)("projects.mockups.empty.filtered"):a(c)("projects.mockups.empty.description")),1)])):(n(),g(le,{key:2},{default:t(()=>[(n(!0),v(Z,null,se(a(F),V=>(n(),g(A,{key:V.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(Q,{class:"mockup-card h-100",onClick:h=>(q=>{_.value=q,y.value=!0})(V),border:"",hover:""},{default:t(()=>[e(ie,null,{append:t(()=>[i("div",dr,[V.generation_status==="in_progress"||V.generation_status==="pending"||V.needs_regeneration?(n(),g(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):C("",!0),e(J,{color:a(fe)(V.status),size:"small",label:""},{default:t(()=>[d(l(a(c)(`projects.status.${V.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(V.name),1)]),_:2},1024)]),_:2},1024),e(X),e(G,null,{default:t(()=>{return[i("div",pr,[i("div",mr,[V.generation_status==="in_progress"||V.generation_status==="pending"?(n(),v("div",vr,[i("div",_r,[e(me,{indeterminate:"",color:"primary",size:"40",class:"mb-2"}),i("div",fr,l(a(c)("projects.mockups.status.generating")),1)])])):V.html_content?(n(),v("div",hr,[i("div",{innerHTML:U(V.html_content)},null,8,gr)])):(n(),v("div",yr,[e(k,{icon:"tabler-file-code",size:"48",color:"secondary"})])),i("div",br,[e(R,{color:"primary",variant:"elevated",size:"small","prepend-icon":"tabler-eye",disabled:V.generation_status==="in_progress"||V.generation_status==="pending"},{default:t(()=>[d(l(a(c)("projects.mockups.actions.preview")),1)]),_:2},1032,["disabled"])])])]),V.needs_regeneration?(n(),v("div",jr,[e(J,{color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[d(l(a(c)("projects.mockups.status.regenerating")),1)]),_:1})])):C("",!0),V.requirement?(n(),v("div",xr,[i("span",kr,l(a(c)("projects.details.requirement"))+": ",1),e(J,{size:"x-small",color:"primary",class:"ms-1"},{default:t(()=>[d(l(V.requirement_name),1)]),_:2},1024)])):C("",!0),i("div",wr,[i("div",Vr,[e(k,{size:"16",icon:"tabler-calendar",class:"me-1"}),i("span",qr,l((h=V.created_at,h?new Date(parseInt(h)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"")),1)])])];var h}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),_.value?(n(),g(sr,{key:3,modelValue:y.value,"onUpdate:modelValue":j[1]||(j[1]=V=>y.value=V),mockup:_.value,onDelete:j[2]||(j[2]=V=>x.value=!0),"is-admin":a(I),"has-manager-permission":a(B)},null,8,["modelValue","mockup","is-admin","has-manager-permission"])):C("",!0),e(re,{isDialogVisible:x.value,"onUpdate:isDialogVisible":j[3]||(j[3]=V=>x.value=V),confirmationMsg:a(c)("projects.mockups.delete_confirm.message"),onConfirm:D},null,8,["isDialogVisible","confirmationMsg"]),e(ye,{modelValue:P.value.show,"onUpdate:modelValue":j[5]||(j[5]=V=>P.value.show=V),color:P.value.color,timeout:5e3},{actions:t(()=>[e(L,{onClick:j[4]||(j[4]=V=>P.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l(P.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},[["__scopeId","data-v-087fb3cc"]]),xt=Me({id:"DevelopmentPlanStore",state:()=>({plans:[],currentPlan:null,loading:!1,error:null}),actions:{async fetchDevelopmentPlans(r=null){this.loading=!0;try{let u="/service/development-plans/";r&&(u+=`?project=${r}`);const o=await W.get(u);return o.status===200?(this.plans=o.data,{data:o.data,error:null}):{data:[],error:o.data}}catch(u){return this.error=u.message||"Failed to fetch development plans",{data:[],error:this.error}}finally{this.loading=!1}},async fetchDevelopmentPlanById(r){this.loading=!0;try{const u=await W.get(`/service/development-plans/${r}/`);return u.status===200?(this.currentPlan=u.data,{data:u.data,error:null}):{data:null,error:u.data}}catch(u){return this.error=u.message||"Failed to fetch development plan",{data:null,error:this.error}}finally{this.loading=!1}},async createDevelopmentPlan(r){this.loading=!0;try{const u=await W.post("/service/development-plans/",{project:r,status:"draft"});return u.status===201?{data:u.data,error:null}:{data:null,error:u.data}}catch(u){return this.error=u.message||"Failed to create development plan",{data:null,error:this.error}}finally{this.loading=!1}},async updateDevelopmentPlan(r,u){this.loading=!0;try{const o=await W.put(`/service/development-plans/${r}/`,u);return o.status===200?(this.currentPlan&&this.currentPlan.id===r&&(this.currentPlan=o.data),{data:o.data,error:null}):{data:null,error:o.data}}catch(o){return this.error=o.message||"Failed to update development plan",{data:null,error:this.error}}finally{this.loading=!1}},async createPlanVersion(r,u){this.loading=!0;try{const o=await W.post(`/service/development-plans/${r}/new_version/`,u);return o.status===201?{data:o.data,error:null}:{data:null,error:o.data}}catch(o){return this.error=o.message||"Failed to create plan version",{data:null,error:this.error}}finally{this.loading=!1}},async fetchPlanVersionById(r){this.loading=!0;try{const u=await W.get(`/service/development-plan-versions/${r}/`);return u.status===200?{data:u.data,error:null}:{data:null,error:u.data}}catch(u){return this.error=u.message||"Failed to fetch plan version",{data:null,error:this.error}}finally{this.loading=!1}},async updatePlanVersion(r,u){this.loading=!0;try{const o=await W.put(`/service/development-plan-versions/${r}/`,u);return o.status===200?{data:o.data,error:null}:{data:null,error:o.data}}catch(o){return this.error=o.message||"Failed to update plan version",{data:null,error:this.error}}finally{this.loading=!1}},async setCurrentPlanVersion(r,u){this.loading=!0;try{const o=await this.fetchDevelopmentPlanById(r);if(!o.data)return{data:null,error:"Plan not found"};const s=await this.fetchPlanVersionById(u);return s.data?await this.updateDevelopmentPlan(r,{current_version_number:s.data.version_number,status:o.data.status}):{data:null,error:"Version not found"}}catch(o){return this.error=o.message||"Failed to set current plan version",{data:null,error:this.error}}finally{this.loading=!1}}}}),Sr={key:0,class:"text-h5"},Ur={key:1,class:"text-h5"},Dr={key:0},zr={class:"text-subtitle-1 font-weight-bold mb-2"},Ir={key:1},Pr={class:"d-flex flex-wrap justify-space-between mb-4"},Mr={class:"d-flex align-center"},Br={class:"d-flex align-center"},$r={class:"text-caption"},Fr={key:0,class:"text-caption ms-3"},Lr={class:"text-h4 font-weight-bold"},Rr={class:"text-caption text-medium-emphasis text-right"},Or={class:"text-right"},Ar={class:"text-right"},Tr={class:"text-right"},Nr={class:"text-right"},Hr={key:0},Er={colspan:"3",class:"text-center"},Kr={class:"text-body-1 whitespace-pre-wrap"},Yr=be({__name:"PlanVersionDialog",props:{modelValue:{type:Boolean,default:!1},version:{type:Object,required:!0},isCurrent:{type:Boolean,default:!1},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},planId:{type:String,default:null}},emits:["update:modelValue","refresh"],setup(r,{emit:u}){const o=r,{t:s}=ce(),f=K({get:()=>o.modelValue,set:F=>u("update:modelValue",F)}),c=xt(),p=S(!1),_=S({...o.version}),y=S(!1),x=S({show:!1,text:"",color:"success"}),w=F=>F||F===0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(F):"-",$=()=>{p.value&&(_.value={...o.version}),p.value=!p.value},P=async()=>{y.value=!0;try{const{data:F,error:D}=await c.updatePlanVersion(o.version.id,_.value);F&&!D?(N(s("projects.development_plan.notifications.version_updated")),Object.assign(o.version,F),p.value=!1,u("refresh")):N(s("projects.development_plan.notifications.version_update_failed"),"error")}catch(F){N(s("projects.development_plan.notifications.version_update_failed")+": "+F.message,"error")}finally{y.value=!1}},I=async()=>{if(o.planId){y.value=!0;try{const{data:F,error:D}=await c.setCurrentPlanVersion(o.planId,o.version.id);F&&!D?(N(s("projects.development_plan.notifications.set_current_success")),u("refresh")):N(s("projects.development_plan.notifications.set_current_failed"),"error")}catch(F){N(s("projects.development_plan.notifications.set_current_failed")+": "+F.message,"error")}finally{y.value=!1}}},B=F=>{if(!F)return[];try{return typeof F=="string"?JSON.parse(F):F}catch(D){return console.error("Error parsing roles and hours:",D),[]}},N=(F,D="success")=>{x.value={show:!0,text:F,color:D}};return ke(()=>o.version,F=>{_.value={...F}},{deep:!0}),(F,D)=>{const H=ve("IconBtn");return n(),g(ge,{modelValue:a(f),"onUpdate:modelValue":D[7]||(D[7]=U=>we(f)?f.value=U:null),"max-width":"900",scrollable:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{class:"d-flex py-3 px-5"},{default:t(()=>[p.value?(n(),v("h5",Sr,l(a(s)("projects.development_plan.actions.edit")),1)):(n(),v("h5",Ur,[d(l(a(s)("projects.development_plan.version.version"))+" "+l(r.version.version_number)+" ",1),r.isCurrent?(n(),g(J,{key:0,color:"primary",size:"small",label:"",class:"ms-2"},{default:t(()=>[d(l(a(s)("projects.development_plan.version.current")),1)]),_:1})):C("",!0)])),e(ee),e(H,{onClick:D[0]||(D[0]=U=>f.value=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),_:1}),e(X),e(G,{class:"pa-6"},{default:t(()=>[p.value?(n(),v("div",Dr,[e(Ve,{onSubmit:je(P,["prevent"])},{default:t(()=>[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12",md:"4"},{default:t(()=>[e(oe,{modelValue:_.value.estimated_cost,"onUpdate:modelValue":D[1]||(D[1]=U=>_.value.estimated_cost=U),modelModifiers:{number:!0},label:a(s)("projects.development_plan.estimated_cost"),type:"number",required:"",rules:[U=>!!U||a(s)("projects.development_plan.validation.estimated_cost_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(A,{cols:"12",md:"4"},{default:t(()=>[e(ne,{modelValue:_.value.status,"onUpdate:modelValue":D[2]||(D[2]=U=>_.value.status=U),label:a(s)("projects.details.status"),items:[{title:a(s)("projects.status.draft"),value:"draft"},{title:a(s)("projects.status.active"),value:"active"},{title:a(s)("projects.status.archived"),value:"archived"},{title:a(s)("projects.status.completed"),value:"completed"}],required:""},null,8,["modelValue","label","items"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(he,{modelValue:_.value.notes,"onUpdate:modelValue":D[3]||(D[3]=U=>_.value.notes=U),label:a(s)("projects.development_plan.notes"),rows:"4"},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[i("p",zr,l(a(s)("projects.development_plan.version.roles_hours_breakdown")),1),e(he,{modelValue:_.value.roles_and_hours,"onUpdate:modelValue":D[4]||(D[4]=U=>_.value.roles_and_hours=U),label:a(s)("projects.development_plan.roles_hours"),rows:"8",monospace:"",hint:a(s)("projects.development_plan.roles_hours_hint"),"persistent-hint":""},null,8,["modelValue","label","hint"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),v("div",Ir,[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12"},{default:t(()=>{return[i("div",Pr,[i("div",Mr,[e(J,{color:a(fe)(r.version.status),size:"small",label:""},{default:t(()=>[d(l(pt(r.version.status)),1)]),_:1},8,["color"])]),i("div",Br,[i("span",$r,l(a(s)("projects.development_plan.version.created"))+": "+l((U=r.version.created_at,U?new Date(parseInt(U)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"")),1),r.version.created_by?(n(),v("span",Fr,l(a(s)("projects.development_plan.version.created_by"))+": "+l(r.version.created_by.username),1)):C("",!0)]),i("div",null,[i("h4",Lr,l(w(r.version.estimated_cost)),1),i("div",Rr,l(a(s)("projects.development_plan.version.estimated_total_cost")),1)])])];var U}),_:1}),e(A,{cols:"12"},{default:t(()=>[e(Q,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(s)("projects.development_plan.version.roles_hours_breakdown")),1)]),_:1}),e(G,null,{default:t(()=>[e(Te,null,{default:t(()=>[i("thead",null,[i("tr",null,[i("th",null,l(a(s)("projects.development_plan.version.role")),1),i("th",Or,l(a(s)("projects.development_plan.version.hours")),1),i("th",Ar,l(a(s)("projects.development_plan.version.cost")),1)])]),i("tbody",null,[(n(!0),v(Z,null,se(B(r.version.roles_and_hours),(U,E)=>(n(),v("tr",{key:E},[i("td",null,l(U.role),1),i("td",Tr,l(U.hours),1),i("td",Nr,l(w(U.cost)),1)]))),128)),B(r.version.roles_and_hours).length===0?(n(),v("tr",Hr,[i("td",Er,l(a(s)("projects.development_plan.version.no_roles")),1)])):C("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),r.version.notes?(n(),g(A,{key:0,cols:"12"},{default:t(()=>[e(Q,{variant:"outlined"},{default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(s)("projects.development_plan.notes")),1)]),_:1}),e(G,null,{default:t(()=>[i("div",Kr,l(r.version.notes),1)]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1})]))]),_:1}),e(X),e(ue,{class:"pa-4"},{default:t(()=>[p.value?(n(),v(Z,{key:0},[e(R,{color:"secondary",variant:"tonal",onClick:$,disabled:y.value},{default:t(()=>[d(l(a(s)("projects.actions.cancel")),1)]),_:1},8,["disabled"]),e(ee),e(R,{color:"primary",onClick:P,loading:y.value},{default:t(()=>[d(l(a(s)("projects.actions.save")),1)]),_:1},8,["loading"])],64)):(n(),v(Z,{key:1},[!r.isCurrent&&r.hasManagerPermission?(n(),g(R,{key:0,color:"primary",variant:"tonal",onClick:I,loading:y.value,"prepend-icon":"tabler-check"},{default:t(()=>[d(l(a(s)("projects.development_plan.actions.set_current")),1)]),_:1},8,["loading"])):C("",!0),e(ee),r.hasManagerPermission?(n(),g(R,{key:1,color:"primary","prepend-icon":"tabler-edit",onClick:$},{default:t(()=>[d(l(a(s)("projects.development_plan.actions.edit")),1)]),_:1})):C("",!0)],64))]),_:1})]),_:1}),e(ye,{modelValue:x.value.show,"onUpdate:modelValue":D[6]||(D[6]=U=>x.value.show=U),color:x.value.color,timeout:5e3},{actions:t(()=>[e(H,{onClick:D[5]||(D[5]=U=>x.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l(x.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-b6e56a6b"]]),Jr={class:"text-h5"},Gr={class:"text-subtitle-1 mb-4"},Zr={__name:"PlanVersionCreateDialog",props:{modelValue:{type:Boolean,default:!1},planId:{type:String,required:!0},currentVersionNumber:{type:Number,default:0}},emits:["update:modelValue","submit"],setup(r,{emit:u}){const o=r,{t:s}=ce(),f=K({get:()=>o.modelValue,set:P=>u("update:modelValue",P)}),c=S({roles_and_hours:'[{"role": "Project Manager", "hours": 20, "cost": 2000}, {"role": "Developer", "hours": 80, "cost": 8000}]',estimated_cost:1e4,notes:"",status:"draft"}),p=[P=>!!P||s("projects.development_plan.validation.estimated_cost_required"),P=>!isNaN(parseFloat(P))||s("projects.development_plan.validation.estimated_cost_number")],_=[P=>{try{return JSON.parse(P),!0}catch{return s("projects.development_plan.validation.roles_hours_json")}}],y=S(null),x=()=>{c.value={roles_and_hours:'[{"role": "Project Manager", "hours": 20, "cost": 2000}, {"role": "Developer", "hours": 80, "cost": 8000}]',estimated_cost:1e4,notes:"",status:"draft"},y.value&&y.value.resetValidation()},w=()=>{f.value=!1,x()},$=async()=>{const{valid:P}=await y.value.validate();if(P){const I={...c.value};I.estimated_cost=parseFloat(I.estimated_cost),u("submit",I),f.value=!1,x()}};return ke(f,P=>{P||x()}),(P,I)=>{const B=ve("IconBtn");return n(),g(ge,{modelValue:a(f),"onUpdate:modelValue":I[4]||(I[4]=N=>we(f)?f.value=N:null),"max-width":"700",persistent:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{class:"d-flex pt-5 px-5"},{default:t(()=>[i("h5",Jr,l(a(s)("projects.development_plan.actions.new_version")),1),e(ee),e(B,{onClick:w},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),_:1}),e(G,{class:"px-5 pt-4"},{default:t(()=>[i("p",Gr,l(a(s)("projects.development_plan.creating_version",{version:r.currentVersionNumber+1})),1),e(Ve,{ref_key:"formRef",ref:y,onSubmit:je($,["prevent"])},{default:t(()=>[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12",md:"6"},{default:t(()=>[e(oe,{modelValue:c.value.estimated_cost,"onUpdate:modelValue":I[0]||(I[0]=N=>c.value.estimated_cost=N),modelModifiers:{number:!0},label:a(s)("projects.development_plan.estimated_cost"),type:"number",rules:p,required:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12",md:"6"},{default:t(()=>[e(ne,{modelValue:c.value.status,"onUpdate:modelValue":I[1]||(I[1]=N=>c.value.status=N),label:a(s)("projects.details.status"),items:[{title:a(s)("projects.status.draft"),value:"draft"},{title:a(s)("projects.status.active"),value:"active"},{title:a(s)("projects.status.archived"),value:"archived"},{title:a(s)("projects.status.completed"),value:"completed"}],required:""},null,8,["modelValue","label","items"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(he,{modelValue:c.value.roles_and_hours,"onUpdate:modelValue":I[2]||(I[2]=N=>c.value.roles_and_hours=N),label:a(s)("projects.development_plan.roles_hours"),rules:_,rows:"6",monospace:"",hint:a(s)("projects.development_plan.roles_hours_hint"),"persistent-hint":""},null,8,["modelValue","label","hint"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(he,{modelValue:c.value.notes,"onUpdate:modelValue":I[3]||(I[3]=N=>c.value.notes=N),label:a(s)("projects.development_plan.notes"),rows:"4"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(X),e(ue,{class:"pa-4"},{default:t(()=>[e(R,{variant:"tonal",color:"secondary",onClick:w},{default:t(()=>[d(l(a(s)("projects.actions.cancel")),1)]),_:1}),e(ee),e(R,{color:"primary",onClick:$},{default:t(()=>[d(l(a(s)("projects.development_plan.actions.create_version")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Qr={key:0,class:"d-flex justify-center align-center",style:{height:"300px"}},Wr={key:1,class:"text-center pa-6"},Xr={class:"text-h6 mb-2"},es={class:"text-body-1 text-medium-emphasis mb-6"},ts={key:2},as={class:"d-flex flex-column"},ls={class:"text-h6 mb-2"},rs={class:"text-h4 font-weight-bold"},ss={class:"text-caption text-medium-emphasis"},os={class:"text-h6 mb-3"},is={class:"text-right"},ns={class:"text-right"},cs={class:"text-right"},us={class:"text-right"},ds={class:"d-flex align-center justify-space-between mb-4"},ps={class:"text-h5"},ms={class:"text-right"},vs={class:"text-right"},_s=["onClick"],fs={class:"d-flex align-center"},hs={class:"font-weight-medium"},gs={class:"text-right"},ys={class:"text-right"},bs={key:1,class:"text-center pa-4"},js={class:"text-medium-emphasis"},xs={key:2,class:"text-center pa-4"},ks={class:"text-medium-emphasis"},ws={__name:"ProjectDevelopmentPlan",props:{projectId:{type:String,required:!0},developmentPlan:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(r,{emit:u}){const o=r,{t:s}=ce(),f=xt(),c=Ue(),p=S(null),_=S(!1),y=S(!1),x=S(!1),w=S({show:!1,text:"",color:"success"}),$=K(()=>c.is_admin()),P=K(()=>c.userData.role>=2),I=K(()=>o.developmentPlan&&o.developmentPlan.id),B=K(()=>I.value&&o.developmentPlan.versions?[...o.developmentPlan.versions].sort((L,V)=>V.version_number-L.version_number):[]),N=K(()=>I.value?B.value.find(L=>L.version_number===o.developmentPlan.current_version_number):null),F=L=>L?new Date(parseInt(L)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",D=L=>L||L===0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(L):"-",H=L=>{p.value=L,_.value=!0},U=()=>{y.value=!0},E=async L=>{x.value=!0;try{const{data:V,error:h}=await f.createPlanVersion(o.developmentPlan.id,L);V&&!h?(j(s("projects.development_plan.notifications.version_created")),u("refresh")):j(s("projects.development_plan.notifications.version_create_failed"),"error")}catch(V){j(s("projects.development_plan.notifications.version_create_failed")+": "+V.message,"error")}finally{x.value=!1,y.value=!1}},O=async()=>{x.value=!0;try{const{data:L,error:V}=await f.createDevelopmentPlan(o.projectId);L&&!V?(j(s("projects.development_plan.notifications.created")),u("refresh")):j(s("projects.development_plan.notifications.create_failed"),"error")}catch(L){j(s("projects.development_plan.notifications.create_failed")+": "+L.message,"error")}finally{x.value=!1}},j=(L,V="success")=>{w.value={show:!0,text:L,color:V}},re=L=>{if(!L)return[];try{return typeof L=="string"?JSON.parse(L):L}catch(V){return console.error("Error parsing roles and hours:",V),[]}};return(L,V)=>{const h=ve("IconBtn");return n(),g(G,{class:"pa-6"},{default:t(()=>[r.loading?(n(),v("div",Qr,[e(me,{indeterminate:"",color:"primary"})])):a(I)?(n(),v("div",ts,[e(le,null,{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e(Q,{border:"",class:"mb-4"},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(xe,{color:"primary",variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(k,{icon:"tabler-calendar-stats"})]),_:1})]),append:t(()=>[e(J,{color:"primary",size:"small",label:"",class:"me-2"},{default:t(()=>[d(" v"+l(r.developmentPlan.current_version_number),1)]),_:1}),e(J,{color:r.developmentPlan.status==="active"?"success":"warning",size:"small",label:""},{default:t(()=>[d(l(a(s)(`projects.status.${r.developmentPlan.status}`)),1)]),_:1},8,["color"])]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(s)("projects.development_plan.current_plan")),1)]),_:1})]),_:1}),e(X),a(N)?(n(),g(G,{key:0},{default:t(()=>[e(le,null,{default:t(()=>[e(A,{cols:"12",md:"4"},{default:t(()=>[i("div",as,[i("div",ls,l(a(s)("projects.development_plan.estimated_cost")),1),i("div",rs,l(D(a(N).estimated_cost)),1),i("div",ss,l(a(s)("projects.development_plan.version.created"))+": "+l(F(a(N).created_at)),1)])]),_:1}),e(A,{cols:"12",md:"8"},{default:t(()=>[i("div",os,l(a(s)("projects.development_plan.version.roles_hours_breakdown")),1),e(Te,{density:"compact"},{default:t(()=>[i("thead",null,[i("tr",null,[i("th",null,l(a(s)("projects.development_plan.version.role")),1),i("th",is,l(a(s)("projects.development_plan.version.hours")),1),i("th",ns,l(a(s)("projects.development_plan.version.cost")),1)])]),i("tbody",null,[(n(!0),v(Z,null,se(re(a(N).roles_and_hours),(q,m)=>(n(),v("tr",{key:m},[i("td",null,l(q.role),1),i("td",cs,l(q.hours),1),i("td",us,l(D(q.cost)),1)]))),128))])]),_:1}),e(R,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:V[0]||(V[0]=q=>H(a(N)))},{default:t(()=>[d(l(a(s)("projects.development_plan.actions.view_details")),1)]),_:1})]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1})]),_:1}),e(A,{cols:"12"},{default:t(()=>[i("div",ds,[i("h5",ps,l(a(s)("projects.development_plan.version_history")),1),a(P)?(n(),g(R,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:U,disabled:x.value},{default:t(()=>[d(l(a(s)("projects.development_plan.actions.new_version")),1)]),_:1},8,["disabled"])):C("",!0)]),a(B).length>1?(n(),g(Te,{key:0},{default:t(()=>[i("thead",null,[i("tr",null,[i("th",null,l(a(s)("projects.development_plan.version.version")),1),i("th",null,l(a(s)("projects.development_plan.version.created")),1),i("th",null,l(a(s)("projects.details.status")),1),i("th",ms,l(a(s)("projects.development_plan.estimated_cost")),1),i("th",vs,l(a(s)("projects.actions.title")),1)])]),i("tbody",null,[(n(!0),v(Z,null,se(a(B),q=>(n(),v("tr",{key:q.id,class:Ze({"bg-primary-lighten-5":q.version_number===r.developmentPlan.current_version_number}),style:{cursor:"pointer"},onClick:m=>H(q)},[i("td",null,[i("div",fs,[i("span",hs,"v"+l(q.version_number),1),q.version_number===r.developmentPlan.current_version_number?(n(),g(J,{key:0,color:"primary",size:"x-small",label:"",class:"ms-2"},{default:t(()=>[d(l(a(s)("projects.development_plan.version.current")),1)]),_:1})):C("",!0)])]),i("td",null,l(F(q.created_at)),1),i("td",null,[e(J,{color:q.status==="active"?"success":"warning",size:"small",label:""},{default:t(()=>[d(l(a(s)(`projects.status.${q.status}`)),1)]),_:2},1032,["color"])]),i("td",gs,l(D(q.estimated_cost)),1),i("td",ys,[e(R,{icon:"",variant:"text",size:"small",color:"primary",onClick:je(m=>H(q),["stop"])},{default:t(()=>[e(k,{icon:"tabler-eye"})]),_:2},1032,["onClick"])])],10,_s))),128))])]),_:1})):a(B).length===1?(n(),v("div",bs,[i("p",js,l(a(s)("projects.development_plan.version.only_one_version")),1)])):(n(),v("div",xs,[i("p",ks,l(a(s)("projects.development_plan.version.no_versions")),1)]))]),_:1})]),_:1})])):(n(),v("div",Wr,[e(k,{icon:"tabler-calendar-time",size:"64",color:"secondary",class:"mb-4"}),i("h4",Xr,l(a(s)("projects.development_plan.empty.title")),1),i("p",es,l(a(s)("projects.development_plan.empty.description")),1),a(P)?(n(),g(R,{key:0,color:"primary",onClick:O,loading:x.value},{default:t(()=>[d(l(a(s)("projects.development_plan.actions.create_plan")),1)]),_:1},8,["loading"])):C("",!0)])),p.value?(n(),g(Yr,{key:3,modelValue:_.value,"onUpdate:modelValue":V[1]||(V[1]=q=>_.value=q),version:p.value,"is-current":p.value&&r.developmentPlan&&p.value.version_number===r.developmentPlan.current_version_number,"is-admin":a($),"has-manager-permission":a(P),"plan-id":r.developmentPlan?r.developmentPlan.id:null,onRefresh:V[2]||(V[2]=q=>u("refresh"))},null,8,["modelValue","version","is-current","is-admin","has-manager-permission","plan-id"])):C("",!0),e(Zr,{modelValue:y.value,"onUpdate:modelValue":V[3]||(V[3]=q=>y.value=q),"plan-id":r.developmentPlan?r.developmentPlan.id:null,"current-version-number":r.developmentPlan?r.developmentPlan.current_version_number:0,onSubmit:E},null,8,["modelValue","plan-id","current-version-number"]),e(ye,{modelValue:w.value.show,"onUpdate:modelValue":V[5]||(V[5]=q=>w.value.show=q),color:w.value.color,timeout:5e3},{actions:t(()=>[e(h,{onClick:V[4]||(V[4]=q=>w.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l(w.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},Vs={key:0,class:"text-h5"},qs={key:1,class:"text-h5"},Cs={key:0},Ss={class:"align-center justify-space-between mb-3"},Us={class:"text-subtitle-1 font-weight-medium"},Ds={key:1,class:"text-medium-emphasis text-center pa-4 rounded bg-grey-lighten-5"},zs={key:1},Is={class:"d-flex align-center mb-5"},Ps={class:"text-medium-emphasis d-flex align-center"},Ms={class:"text-caption me-4"},Bs={class:"text-caption"},$s={class:"user-story-format mb-6"},Fs={class:"text-h5 mb-4"},Ls={class:"text-primary"},Rs={class:"text-h5 mb-4"},Os={class:"text-primary"},As={class:"text-h5 mb-4"},Ts={class:"text-primary"},Ns={key:0},Hs={class:"text-h6 mb-3"},Es={key:1,class:"text-medium-emphasis text-center pa-4"},Ks={key:2,class:"mt-6"},Ys={key:0,class:"text-center pa-6"},Js={class:"text-h6 mb-2"},Gs={class:"text-medium-emphasis"},Zs={key:1},Qs={class:"text-caption"},Ws={class:"text-caption text-medium-emphasis"},Xs={class:"text-primary"},eo={class:"mb-2"},to={class:"text-primary"},ao={class:"mb-4"},lo={class:"text-primary"},ro={key:0},so={class:"text-subtitle-2 font-weight-medium mb-2"},oo={class:"ms-3"},io={class:"text-caption mt-3"},no={class:"d-flex justify-end mt-2"},co={key:1,class:"text-center pa-6"},uo={class:"text-h6 mb-2"},po={class:"text-medium-emphasis"},mo={key:2},vo={class:"d-flex align-center"},_o={class:"d-flex align-center"},fo={class:"text-caption text-medium-emphasis ml-2"},ho={class:"comment-text mt-2 whitespace-pre-wrap"},go={class:"text-body-1 mb-3"},yo=be({__name:"UserStoryDetailsDialog",props:{modelValue:{type:Boolean,default:!1},userStory:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},hasModeratorPermission:{type:Boolean,default:!1}},emits:["update:modelValue","update","delete","regenerate"],setup(r,{emit:u}){const o=r,s=K({get:()=>o.modelValue,set:q=>u("update:modelValue",q)}),f=Xe(),{t:c}=ce(),p=S(0),_=S(!1),y=S({...o.userStory}),x=S(""),w=S(""),$=S(""),P=S(!1),I=S(!1),B=S({show:!1,text:"",color:"success"}),N=[{title:"Draft",value:"draft"},{title:"Active",value:"active"},{title:"Archived",value:"archived"},{title:"Completed",value:"completed"}],F=K(()=>o.userStory.history||[]),D=K(()=>o.userStory.comments||[]),H=q=>q?(q=parseInt(q),new Date(q).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",U=()=>{_.value&&(y.value={...o.userStory},x.value=""),_.value=!_.value},E=()=>{x.value.trim()&&(y.value.acceptance_criteria||(y.value.acceptance_criteria=[]),y.value.acceptance_criteria.push(x.value.trim()),x.value="")},O=()=>{u("update",y.value),_.value=!1},j=()=>{u("delete")},re=()=>{$.value="",P.value=!0},L=()=>{u("regenerate",$.value),P.value=!1},V=async()=>{if(w.value.trim()){I.value=!0;try{const{data:q,error:m}=await f.createComment(o.userStory.id,{text:w.value,status:"active"});if(q&&!m){h("Comment added successfully"),w.value="";const{data:M}=await f.fetchUserStoryById(o.userStory.id);M&&Object.assign(o.userStory,M)}else h("Failed to add comment","error")}catch(q){h("Failed to add comment: "+q.message,"error")}finally{I.value=!1}}},h=(q,m="success")=>{B.value={show:!0,text:q,color:m}};return ke(()=>o.userStory,q=>{y.value={...q}},{deep:!0}),(q,m)=>{const M=ve("IconBtn");return n(),g(ge,{modelValue:a(s),"onUpdate:modelValue":m[14]||(m[14]=b=>we(s)?s.value=b:null),"max-width":"900",scrollable:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{class:"d-flex pt-5 px-5"},{default:t(()=>[_.value?(n(),v("h5",Vs,l(a(c)("projects.user_stories.title.edit")),1)):(n(),v("h5",qs,l(a(c)("projects.user_stories.title.details")),1)),e(ee),e(M,{onClick:m[0]||(m[0]=b=>s.value=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),_:1}),e(G,{class:"pb-0"},{default:t(()=>[e(Qe,{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=b=>p.value=b),"slider-color":"primary","align-tabs":"start"},{default:t(()=>[e(de,{value:"0"},{default:t(()=>[e(k,{size:"18",icon:"tabler-user-check",start:""}),d(" "+l(a(c)("projects.requirements.tabs.details")),1)]),_:1}),e(de,{value:"1"},{default:t(()=>[e(k,{size:"18",icon:"tabler-history",start:""}),d(" "+l(a(c)("projects.requirements.tabs.history"))+" ",1),a(F).length?(n(),g(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[d(l(a(F).length),1)]),_:1})):C("",!0)]),_:1}),e(de,{value:"2"},{default:t(()=>[e(k,{size:"18",icon:"tabler-messages",start:""}),d(" "+l(a(c)("projects.requirements.tabs.comments"))+" ",1),a(D).length?(n(),g(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[d(l(a(D).length),1)]),_:1})):C("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(X),e(G,{class:"pa-6",style:{"min-height":"400px","max-height":"70vh"}},{default:t(()=>[e(We,{modelValue:p.value,"onUpdate:modelValue":m[8]||(m[8]=b=>p.value=b),class:"mt-5"},{default:t(()=>[e(pe,{value:"0"},{default:t(()=>[_.value?(n(),v("div",Cs,[e(Ve,{onSubmit:je(O,["prevent"])},{default:t(()=>[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e(oe,{modelValue:y.value.role,"onUpdate:modelValue":m[2]||(m[2]=b=>y.value.role=b),label:a(c)("projects.user_stories.fields.role"),required:"",rules:[b=>!!b||a(c)("projects.user_stories.validation.role_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(oe,{modelValue:y.value.action,"onUpdate:modelValue":m[3]||(m[3]=b=>y.value.action=b),label:a(c)("projects.user_stories.fields.action"),required:"",rules:[b=>!!b||a(c)("projects.user_stories.validation.action_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(oe,{modelValue:y.value.benefit,"onUpdate:modelValue":m[4]||(m[4]=b=>y.value.benefit=b),label:a(c)("projects.user_stories.fields.benefit"),required:"",rules:[b=>!!b||a(c)("projects.user_stories.validation.benefit_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(A,{cols:"12",md:"6"},{default:t(()=>[e(ne,{modelValue:y.value.status,"onUpdate:modelValue":m[5]||(m[5]=b=>y.value.status=b),label:a(c)("projects.user_stories.fields.status"),items:N,required:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[i("div",Ss,[i("div",Us,l(a(c)("projects.user_stories.fields.acceptance_criteria")),1),e(le,{class:"w-100"},{default:t(()=>[e(A,{cols:"10",sm:"8"},{default:t(()=>[e(oe,{modelValue:x.value,"onUpdate:modelValue":m[6]||(m[6]=b=>x.value=b),placeholder:a(c)("projects.user_stories.fields.add_criterion"),density:"compact","hide-details":"",class:"me-2",onKeyup:mt(E,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1}),e(A,{cols:"2",sm:"4"},{default:t(()=>[e(R,{color:"primary",size:"small",disabled:!x.value.trim(),onClick:E},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.add")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),y.value.acceptance_criteria&&y.value.acceptance_criteria.length>0?(n(),g(Re,{key:0},{default:t(()=>[(n(!0),v(Z,null,se(y.value.acceptance_criteria,(b,T)=>(n(),g(Oe,{key:T},{prepend:t(()=>[e(k,{icon:"tabler-check",color:"success"})]),append:t(()=>[e(M,{color:"error",variant:"text",size:"small",onClick:z=>(te=>{y.value.acceptance_criteria.splice(te,1)})(T)},{default:t(()=>[e(k,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick"])]),default:t(()=>[e(Ae,null,{default:t(()=>[d(l(b),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),v("div",Ds,l(a(c)("projects.user_stories.empty.acceptance_criteria.description")),1))]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),v("div",zs,[i("div",Is,[e(J,{color:a(fe)(r.userStory.status),size:"small",label:"",class:"me-2"},{default:t(()=>[d(l(pt(r.userStory.status)),1)]),_:1},8,["color"]),e(J,{color:"secondary",size:"small",label:"",class:"ms-2"},{default:t(()=>[d(" v"+l(r.userStory.version_number),1)]),_:1}),e(ee),i("div",Ps,[e(k,{size:"18",icon:"tabler-calendar",class:"me-1"}),i("span",Ms,l(a(c)("projects.details.updated_at"))+": "+l(H(r.userStory.updated_at)),1),e(k,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),i("span",Bs,l(a(c)("projects.details.created_at"))+": "+l(H(r.userStory.created_at)),1)])]),i("div",$s,[i("div",Fs,[i("span",Ls,l(a(c)("projects.user_stories.fields.role")),1),d(" "+l(r.userStory.role)+", ",1)]),i("div",Rs,[i("span",Os,l(a(c)("projects.user_stories.fields.action")),1),d(" "+l(r.userStory.action)+", ",1)]),i("div",As,[i("span",Ts,l(a(c)("projects.user_stories.fields.benefit")),1),d(" "+l(r.userStory.benefit)+". ",1)])]),e(X,{class:"mb-4"}),r.userStory.acceptance_criteria&&r.userStory.acceptance_criteria.length>0?(n(),v("div",Ns,[i("div",Hs,l(a(c)("projects.user_stories.fields.acceptance_criteria")),1),e(Re,null,{default:t(()=>[(n(!0),v(Z,null,se(r.userStory.acceptance_criteria,(b,T)=>(n(),g(Oe,{key:T,class:"px-0"},{prepend:t(()=>[e(k,{icon:"tabler-check",color:"success",class:"me-2"})]),default:t(()=>[e(Ae,null,{default:t(()=>[d(l(b),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):(n(),v("div",Es,l(a(c)("projects.user_stories.empty.acceptance_criteria.description")),1)),r.userStory.generation_status==="in_progress"?(n(),v("div",Ks,[e($e,{color:"info",variant:"tonal",icon:"tabler-refresh"},{default:t(()=>[e(ht,null,{default:t(()=>[d(l(a(c)("projects.user_stories.regeneration.title")),1)]),_:1}),i("p",null,l(a(c)("projects.user_stories.regeneration.description")),1)]),_:1})])):C("",!0)]))]),_:1}),e(pe,{value:"1"},{default:t(()=>[a(F).length===0?(n(),v("div",Ys,[e(k,{icon:"tabler-history",size:"64",color:"secondary",class:"mb-3"}),i("h4",Js,l(a(c)("projects.user_stories.empty.history.title")),1),i("p",Gs,l(a(c)("projects.user_stories.empty.history.description")),1)])):(n(),v("div",Zs,[e(gt,{density:"compact",align:"start"},{default:t(()=>[(n(!0),v(Z,null,se(a(F),(b,T)=>(n(),g(yt,{key:T,"dot-color":"primary",size:"small"},{opposite:t(()=>[i("div",Qs,l(H(b.changed_at)),1),i("div",Ws,"v"+l(b.version_number),1)]),default:t(()=>[e(Q,{border:""},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(xe,{color:"primary",variant:"tonal",size:"36"},{default:t(()=>[e(k,{icon:"tabler-user-check"})]),_:1})]),append:t(()=>[e(J,{color:a(fe)(b.status),size:"small",label:"",class:"ms-2"},{default:t(()=>[d(l(b.status),1)]),_:2},1032,["color"])]),default:t(()=>[e(ae,null,{default:t(()=>[i("span",Xs,l(a(c)("projects.user_stories.fields.role")),1),d(" "+l(b.role),1)]),_:2},1024)]),_:2},1024),e(G,null,{default:t(()=>[i("p",eo,[i("span",to,l(a(c)("projects.user_stories.fields.action")),1),d(" "+l(b.action),1)]),i("p",ao,[i("span",lo,l(a(c)("projects.user_stories.fields.benefit")),1),d(" "+l(b.benefit),1)]),b.acceptance_criteria&&b.acceptance_criteria.length>0?(n(),v("div",ro,[i("div",so,l(a(c)("projects.user_stories.fields.acceptance_criteria"))+":",1),i("ul",oo,[(n(!0),v(Z,null,se(b.acceptance_criteria,(z,te)=>(n(),v("li",{key:te},l(z),1))),128))])])):C("",!0),i("div",io,l(a(c)("projects.requirements.history.changed_by"))+": "+l(b.changed_by?b.changed_by.username:a(c)("projects.requirements.history.unknown")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1}),e(pe,{value:"2"},{default:t(()=>[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e(he,{modelValue:w.value,"onUpdate:modelValue":m[7]||(m[7]=b=>w.value=b),label:a(c)("projects.requirements.comments.add"),rows:"3",counter:"",disabled:I.value},null,8,["modelValue","label","disabled"]),i("div",no,[e(R,{color:"primary",size:"small",loading:I.value,disabled:!w.value.trim(),onClick:V},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.add_comment")),1)]),_:1},8,["loading","disabled"])])]),_:1}),e(A,{cols:"12"},{default:t(()=>[a(D).length?(n(),g(X,{key:0,class:"mb-4"})):C("",!0),a(D).length===0?(n(),v("div",co,[e(k,{icon:"tabler-messages",size:"64",color:"secondary",class:"mb-3"}),i("h4",uo,l(a(c)("projects.user_stories.empty.comments.title")),1),i("p",po,l(a(c)("projects.user_stories.empty.comments.description")),1)])):(n(),v("div",mo,[(n(!0),v(Z,null,se(a(D),b=>(n(),v("div",{key:b.id,class:"comment-item mb-4"},[e(Q,{border:""},{default:t(()=>[e(G,{class:"py-2"},{default:t(()=>[i("div",vo,[e(xe,{color:"primary",variant:"tonal",size:"36",class:"me-3"},{default:t(()=>[e(k,{icon:"tabler-user"})]),_:1}),i("div",null,[i("div",_o,[i("strong",null,l(b.user?b.user.username:a(c)("projects.requirements.comments.unknown_user")),1),i("div",fo,l(H(b.created_at)),1)])]),e(ee),r.isAdmin||r.hasManagerPermission?(n(),g(M,{key:0,size:"small",color:"error",variant:"text",onClick:T=>(async z=>{I.value=!0;try{const{success:te,error:Ce}=await f.deleteComment(z);if(te&&!Ce){h("Comment deleted successfully");const{data:Y}=await f.fetchUserStoryById(o.userStory.id);Y&&Object.assign(o.userStory,Y)}else h("Failed to delete comment","error")}catch(te){h("Failed to delete comment: "+te.message,"error")}finally{I.value=!1}})(b.id),disabled:I.value},{default:t(()=>[e(k,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick","disabled"])):C("",!0)]),i("div",ho,l(b.text),1)]),_:2},1024)]),_:2},1024)]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(X),e(ue,{class:"pa-4"},{default:t(()=>[_.value?(n(),v(Z,{key:0},[e(R,{color:"secondary",variant:"tonal",onClick:U},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.cancel")),1)]),_:1}),e(ee),e(R,{color:"primary",onClick:O},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.save")),1)]),_:1})],64)):(n(),v(Z,{key:1},[r.isAdmin?(n(),g(R,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:j},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.delete")),1)]),_:1})):C("",!0),r.hasModeratorPermission?(n(),g(R,{key:1,color:"info",variant:"tonal","prepend-icon":"tabler-refresh",class:"ms-2",onClick:re},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.regenerate")),1)]),_:1})):C("",!0),e(ee),r.hasModeratorPermission?(n(),g(R,{key:2,color:"primary","prepend-icon":"tabler-edit",onClick:U},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.edit")),1)]),_:1})):C("",!0)],64))]),_:1})]),_:1}),e(ge,{modelValue:P.value,"onUpdate:modelValue":m[11]||(m[11]=b=>P.value=b),"max-width":"600",persistent:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{class:"pt-3 pb-0"},{default:t(()=>[d(l(a(c)("projects.user_stories.regeneration.title")),1)]),_:1}),e(G,null,{default:t(()=>[i("p",go,l(a(c)("projects.user_stories.regeneration.description")),1),e(he,{modelValue:$.value,"onUpdate:modelValue":m[9]||(m[9]=b=>$.value=b),label:a(c)("projects.user_stories.fields.feedback"),placeholder:a(c)("projects.user_stories.placeholders.feedback"),rows:"4",counter:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(ue,null,{default:t(()=>[e(R,{color:"secondary",variant:"tonal",onClick:m[10]||(m[10]=b=>P.value=!1)},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.cancel")),1)]),_:1}),e(ee),e(R,{color:"primary",onClick:L},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.regenerate")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ye,{modelValue:B.value.show,"onUpdate:modelValue":m[13]||(m[13]=b=>B.value.show=b),color:B.value.color,timeout:5e3},{actions:t(()=>[e(M,{onClick:m[12]||(m[12]=b=>B.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l(B.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-737e26a0"]]),bo={class:"text-h5"},jo={class:"text-subtitle-1 font-weight-medium"},xo={class:"d-flex align-center justify-space-between mb-3"},ko={key:1,class:"text-medium-emphasis text-center pa-4 rounded bg-grey-lighten-5"},wo={__name:"UserStoryCreateDialog",props:{modelValue:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},userStoryData:{type:Object,default:()=>({})}},emits:["update:modelValue","submit"],setup(r,{emit:u}){const o=r,{t:s}=ce(),f=K({get:()=>o.modelValue,set:F=>u("update:modelValue",F)}),c=S({role:o.editMode&&o.userStoryData?o.userStoryData.role:"",action:o.editMode&&o.userStoryData?o.userStoryData.action:"",benefit:o.editMode&&o.userStoryData?o.userStoryData.benefit:"",acceptance_criteria:o.editMode&&o.userStoryData?[...o.userStoryData.acceptance_criteria]:[],status:o.editMode&&o.userStoryData?o.userStoryData.status:"draft"}),p=S(""),_=S(null),y=[F=>!!F||s("projects.user_stories.validation.role_required")],x=[F=>!!F||s("projects.user_stories.validation.action_required")],w=[F=>!!F||s("projects.user_stories.validation.benefit_required")],$=[{title:s("projects.status.draft"),value:"draft"},{title:s("projects.status.active"),value:"active"},{title:s("projects.status.archived"),value:"archived"},{title:s("projects.status.completed"),value:"completed"}],P=()=>{p.value.trim()&&(c.value.acceptance_criteria||(c.value.acceptance_criteria=[]),c.value.acceptance_criteria.push(p.value.trim()),p.value="")},I=()=>{c.value={role:"",action:"",benefit:"",acceptance_criteria:[],status:"draft"},p.value="",_.value&&_.value.resetValidation()},B=()=>{f.value=!1,I()},N=async()=>{const{valid:F}=await _.value.validate();F&&(u("submit",c.value),f.value=!1,I())};return ke(f,F=>{F||I()}),(F,D)=>{const H=ve("IconBtn");return n(),g(ge,{modelValue:a(f),"onUpdate:modelValue":D[5]||(D[5]=U=>we(f)?f.value=U:null),"max-width":"700",persistent:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{class:"d-flex pt-5 px-5"},{default:t(()=>[i("h5",bo,l(o.editMode?a(s)("projects.user_stories.title.edit"):a(s)("projects.user_stories.title.create")),1),e(ee),e(H,{onClick:B},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),_:1}),e(G,{class:"px-5 pt-4"},{default:t(()=>[e(Ve,{ref_key:"formRef",ref:_,onSubmit:je(N,["prevent"])},{default:t(()=>[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e(oe,{modelValue:c.value.role,"onUpdate:modelValue":D[0]||(D[0]=U=>c.value.role=U),label:a(s)("projects.user_stories.fields.role"),rules:y,placeholder:a(s)("projects.user_stories.placeholders.role"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(oe,{modelValue:c.value.action,"onUpdate:modelValue":D[1]||(D[1]=U=>c.value.action=U),label:a(s)("projects.user_stories.fields.action"),rules:x,placeholder:a(s)("projects.user_stories.placeholders.action"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(oe,{modelValue:c.value.benefit,"onUpdate:modelValue":D[2]||(D[2]=U=>c.value.benefit=U),label:a(s)("projects.user_stories.fields.benefit"),rules:w,placeholder:a(s)("projects.user_stories.placeholders.benefit"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(A,{cols:"12",md:"6"},{default:t(()=>[e(ne,{modelValue:c.value.status,"onUpdate:modelValue":D[3]||(D[3]=U=>c.value.status=U),label:a(s)("projects.user_stories.fields.status"),items:$,required:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[i("div",jo,l(a(s)("projects.user_stories.fields.acceptance_criteria")),1),i("div",xo,[e(le,{class:"w-100"},{default:t(()=>[e(A,{cols:"10",sm:"8"},{default:t(()=>[e(oe,{modelValue:p.value,"onUpdate:modelValue":D[4]||(D[4]=U=>p.value=U),placeholder:a(s)("projects.user_stories.fields.add_criterion"),density:"compact","hide-details":"",class:"me-2",onKeyup:mt(P,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1}),e(A,{cols:"2",sm:"4"},{default:t(()=>[e(R,{color:"primary",size:"small",disabled:!p.value.trim(),onClick:P},{default:t(()=>[d(l(a(s)("projects.user_stories.actions.add")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),c.value.acceptance_criteria&&c.value.acceptance_criteria.length>0?(n(),g(Re,{key:0},{default:t(()=>[(n(!0),v(Z,null,se(c.value.acceptance_criteria,(U,E)=>(n(),g(Oe,{key:E},{prepend:t(()=>[e(k,{icon:"tabler-check",color:"success"})]),append:t(()=>[e(H,{color:"error",variant:"text",size:"small",onClick:O=>(j=>{c.value.acceptance_criteria.splice(j,1)})(E)},{default:t(()=>[e(k,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick"])]),default:t(()=>[e(Ae,null,{default:t(()=>[d(l(U),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),v("div",ko,l(a(s)("projects.user_stories.empty.acceptance_criteria.description")),1))]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(X),e(ue,{class:"pa-4"},{default:t(()=>[e(R,{variant:"tonal",color:"secondary",onClick:B},{default:t(()=>[d(l(a(s)("projects.user_stories.actions.cancel")),1)]),_:1}),e(ee),e(R,{color:"primary",onClick:N},{default:t(()=>[d(l(o.editMode?a(s)("projects.user_stories.actions.save"):a(s)("projects.user_stories.actions.create")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Vo={key:0,class:"d-flex justify-center align-center",style:{height:"300px"}},qo={key:1,class:"text-center pa-4"},Co={class:"text-h6 mb-2"},So={class:"text-body-1 text-medium-emphasis mb-6"},Uo={class:"text-body-1 mb-2"},Do={class:"font-weight-medium text-primary"},zo={class:"text-body-1 mb-4"},Io={class:"font-weight-medium text-primary"},Po={key:0},Mo={class:"text-subtitle-2 font-weight-medium mb-2 text-primary"},Bo={class:"ml-4"},$o={key:0},Fo={class:"d-flex align-center justify-space-between mt-3"},Lo={class:"d-flex align-center"},Ro={class:"text-caption"},Oo={class:"d-flex align-center"},Ao={class:"text-caption"},To=be({__name:"UserStoriesList",props:{projectId:{type:String,required:!0},requirementId:{type:String,required:!1,default:null},userStories:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(r,{emit:u}){const o=r,s=Xe(),f=Ue(),{t:c}=ce(),p=S(""),_=S(["draft","active","completed"]),y=S(null),x=S(!1),w=S(!1),$=S(!1),P=S(!1),I=S({show:!1,text:"",color:"success"}),B=K(()=>f.is_admin()),N=K(()=>f.userData.role>=2),F=K(()=>f.userData.role>=3),D=[{title:c("projects.status.draft"),value:"draft"},{title:c("projects.status.active"),value:"active"},{title:c("projects.status.archived"),value:"archived"},{title:c("projects.status.completed"),value:"completed"}],H=K(()=>o.userStories.filter(V=>{const h=!p.value||V.role.toLowerCase().includes(p.value.toLowerCase())||V.action.toLowerCase().includes(p.value.toLowerCase())||V.benefit.toLowerCase().includes(p.value.toLowerCase()),q=_.value.includes(V.status);return h&&q})),U=()=>{w.value=!0},E=async V=>{P.value=!0;try{const{data:h,error:q}=await s.createUserStory({...V,requirement:o.requirementId});h&&!q?(L("User story created successfully"),u("refresh")):L("Failed to create user story","error")}catch(h){L("Failed to create user story: "+h.message,"error")}finally{P.value=!1}},O=async V=>{P.value=!0;try{const{data:h,error:q}=await s.updateUserStory(y.value.id,V);h&&!q?(L("User story updated successfully"),u("refresh")):L("Failed to update user story","error")}catch(h){L("Failed to update user story: "+h.message,"error")}finally{P.value=!1}},j=async()=>{if(y.value){P.value=!0,$.value=!1;try{const{success:V,error:h}=await s.deleteUserStory(y.value.id);V&&!h?(L("User story deleted successfully"),u("refresh"),x.value=!1):L("Failed to delete user story","error")}catch(V){L("Failed to delete user story: "+V.message,"error")}finally{P.value=!1}}},re=async(V="")=>{if(y.value){P.value=!0;try{const{data:h,error:q}=await s.regenerateUserStory(y.value.id,V);h&&!q?(L("User story regeneration started"),setTimeout(()=>{u("refresh")},3e3)):L("Failed to regenerate user story","error")}catch(h){L("Failed to regenerate user story: "+h.message,"error")}finally{P.value=!1}}},L=(V,h="success")=>{I.value={show:!0,text:V,color:h}};return Be(()=>{!o.requirementId||o.userStories.length||o.loading||s.fetchUserStories(o.requirementId).then(({data:V})=>{V&&u("refresh")})}),(V,h)=>{const q=Fe,m=ve("IconBtn");return n(),g(G,{class:"pa-6"},{default:t(()=>[e(le,null,{default:t(()=>[e(A,{cols:"12",md:"6"},{default:t(()=>[e(oe,{modelValue:p.value,"onUpdate:modelValue":h[0]||(h[0]=M=>p.value=M),density:"compact",placeholder:a(c)("projects.user_stories.actions.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(A,{cols:"12",md:"4"},{default:t(()=>[e(ne,{modelValue:_.value,"onUpdate:modelValue":h[1]||(h[1]=M=>_.value=M),items:D,density:"compact","hide-details":"",label:a(c)("projects.user_stories.fields.status"),variant:"outlined",multiple:"",chips:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[a(F)&&r.requirementId?(n(),g(R,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:U,loading:P.value,block:""},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.add")),1)]),_:1},8,["loading"])):C("",!0)]),_:1})]),_:1}),e(X,{class:"my-5"}),r.loading?(n(),v("div",Vo,[e(me,{indeterminate:"",color:"primary"})])):a(H).length===0?(n(),v("div",qo,[e(k,{icon:"tabler-notebook",size:"64",color:"secondary",class:"mb-4"}),i("h4",Co,l(a(c)("projects.user_stories.empty.title")),1),i("p",So,l(p.value||_.value.length>0?a(c)("projects.user_stories.empty.filtered"):a(c)("projects.user_stories.empty.description")),1),a(F)&&r.requirementId&&!p.value&&_.value.length===0?(n(),g(R,{key:0,color:"primary",onClick:U,"prepend-icon":"tabler-plus"},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.create")),1)]),_:1})):C("",!0)])):(n(),g(le,{key:2},{default:t(()=>[(n(!0),v(Z,null,se(a(H),M=>(n(),g(A,{key:M.id,cols:"12",md:"6"},{default:t(()=>[e(Q,{class:"user-story-card h-100 d-flex flex-column",onClick:b=>(T=>{y.value=T,x.value=!0})(M),border:"",hover:""},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(xe,{color:"primary",variant:"tonal",size:"42"},{default:t(()=>[e(k,{icon:"tabler-user-check"})]),_:1})]),append:t(()=>[e(J,{color:a(fe)(M.status),size:"small",label:""},{default:t(()=>[d(l(M.status),1)]),_:2},1032,["color"])]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(a(c)("projects.user_stories.fields.role"))+" "+l(M.role),1)]),_:2},1024)]),_:2},1024),e(G,{class:"d-flex flex-column"},{default:t(()=>{return[i("p",Uo,[i("span",Do,l(a(c)("projects.user_stories.fields.action"))+":",1),d(" "+l(M.action),1)]),i("p",zo,[i("span",Io,l(a(c)("projects.user_stories.fields.benefit"))+":",1),d(" "+l(M.benefit),1)]),M.acceptance_criteria&&M.acceptance_criteria.length>0?(n(),v("div",Po,[i("div",Mo,l(a(c)("projects.user_stories.fields.acceptance_criteria"))+":",1),i("ul",Bo,[(n(!0),v(Z,null,se(M.acceptance_criteria.slice(0,2),(T,z)=>(n(),v("li",{key:z},l(T),1))),128)),M.acceptance_criteria.length>2?(n(),v("li",$o,l(a(c)("projects.user_stories.and_more",{count:M.acceptance_criteria.length-2})),1)):C("",!0)])])):C("",!0),e(ee),i("div",Fo,[i("div",Lo,[e(k,{size:"16",icon:"tabler-calendar",class:"me-1"}),i("span",Ro,l((b=M.updated_at,b?(b=parseInt(b),new Date(b).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})):"")),1)]),i("div",Oo,[e(k,{size:"16",icon:"tabler-history",class:"me-1"}),i("span",Ao,"v"+l(M.version_number),1)])])];var b}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),y.value?(n(),g(yo,{key:3,modelValue:x.value,"onUpdate:modelValue":h[2]||(h[2]=M=>x.value=M),"user-story":y.value,onDelete:h[3]||(h[3]=M=>$.value=!0),onUpdate:O,onRegenerate:re,"is-admin":a(B),"has-manager-permission":a(N),"has-moderator-permission":a(F)},null,8,["modelValue","user-story","is-admin","has-manager-permission","has-moderator-permission"])):C("",!0),e(wo,{modelValue:w.value,"onUpdate:modelValue":h[4]||(h[4]=M=>w.value=M),onSubmit:E},null,8,["modelValue"]),e(q,{isDialogVisible:$.value,"onUpdate:isDialogVisible":h[5]||(h[5]=M=>$.value=M),confirmationMsg:a(c)("projects.user_stories.delete_confirm.message"),onConfirm:j},null,8,["isDialogVisible","confirmationMsg"]),e(ye,{modelValue:I.value.show,"onUpdate:modelValue":h[7]||(h[7]=M=>I.value.show=M),color:I.value.color,timeout:5e3},{actions:t(()=>[e(m,{onClick:h[6]||(h[6]=M=>I.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l(I.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},[["__scopeId","data-v-c476a8ce"]]),No={key:0,class:"text-h5"},Ho={class:"text-h5"},Eo={key:0},Ko={class:"text-subtitle-1 font-weight-medium mb-2"},Yo={class:"bg-grey-lighten-5 rounded pa-3"},Jo={class:"text-medium-emphasis text-caption mb-2"},Go={key:1},Zo={key:0,class:"pa-5"},Qo={class:"d-flex justify-center my-8"},Wo={class:"d-flex align-center justify-center text-medium-emphasis"},Xo={class:"text-caption me-4"},ei={class:"text-caption"},ti={key:1,class:"diagram-content pa-0"},ai={class:"diagram-metadata d-flex align-center px-6 py-3"},li={key:0,class:"ms-2"},ri={class:"text-medium-emphasis d-flex align-center"},si={class:"text-caption me-4"},oi={class:"text-caption"},ii={key:2,class:"d-flex flex-column justify-center align-center pa-6",style:{height:"400px"}},ni={class:"text-h6 mb-2"},ci={class:"text-medium-emphasis text-center"},ui=be({__name:"UmlDiagramDetailsDialog",props:{modelValue:{type:Boolean,default:!1},diagram:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},hasModeratorPermission:{type:Boolean,default:!1}},emits:["update:modelValue","delete","regenerate"],setup(r,{emit:u}){const o=r,s=K({get:()=>o.modelValue,set:U=>u("update:modelValue",U)}),f=et(),c=S(!1),p=S(!1),_=S({...o.diagram}),y=S(!1),x=S({show:!1,text:"",color:"success"}),{t:w}=ce(),$=[{title:w("projects.status.draft"),value:"draft"},{title:w("projects.status.active"),value:"active"},{title:w("projects.status.archived"),value:"archived"},{title:w("projects.status.completed"),value:"completed"}],P=U=>U?(U=parseInt(U),new Date(U).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",I=()=>{c.value=!c.value},B=()=>{p.value&&(_.value={...o.diagram}),p.value=!p.value},N=async()=>{y.value=!0;try{const{data:U,error:E}=await f.updateDiagram(o.diagram.id,_.value);U&&!E?(H(w("projects.uml_diagrams.notifications.updated")),Object.assign(o.diagram,U),p.value=!1):H(w("projects.uml_diagrams.notifications.update_failed"),"error")}catch(U){H(w("projects.uml_diagrams.notifications.update_failed")+": "+U.message,"error")}finally{y.value=!1}},F=()=>{u("delete")},D=async()=>{y.value=!0;try{const{data:U,error:E}=await f.regenerateDiagram(o.diagram.id);U&&!E?(H(w("projects.uml_diagrams.notifications.regeneration_started")),setTimeout(()=>{u("regenerate")},3e3)):H(w("projects.uml_diagrams.notifications.regeneration_failed"),"error")}catch(U){H(w("projects.uml_diagrams.notifications.regeneration_failed")+": "+U.message,"error")}finally{y.value=!1}},H=(U,E="success")=>{x.value={show:!0,text:U,color:E}};return ke(()=>o.diagram,U=>{_.value={...U}},{deep:!0}),(U,E)=>{const O=ve("IconBtn");return n(),g(ge,{modelValue:a(s),"onUpdate:modelValue":E[7]||(E[7]=j=>we(s)?s.value=j:null),fullscreen:c.value,"max-width":c.value?"100%":"900",scrollable:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{class:"d-flex py-3 px-5"},{default:t(()=>[p.value?(n(),v("h5",No,l(a(w)("projects.uml_diagrams.actions.edit")),1)):(n(),v(Z,{key:1},[i("h5",Ho,l(r.diagram.name),1),e(J,{class:"ms-2",color:"secondary",size:"small",label:""},{default:t(()=>[d(l(a(w)(`projects.uml_diagrams.types.${r.diagram.diagram_type}`)),1)]),_:1})],64)),e(ee),e(R,{icon:"",variant:"text",onClick:I},{default:t(()=>[e(k,{icon:c.value?"tabler-minimize":"tabler-maximize"},null,8,["icon"])]),_:1}),e(O,{onClick:E[0]||(E[0]=j=>s.value=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),_:1}),e(X),e(G,{class:Ze({"pa-0":!p.value&&r.diagram.content,"pa-6":p.value||!r.diagram.content}),style:Se({height:c.value?"calc(100vh - 120px)":"70vh",maxHeight:"800px"})},{default:t(()=>[p.value?(n(),v("div",Eo,[e(Ve,{onSubmit:je(N,["prevent"])},{default:t(()=>[e(le,{class:"mt-3"},{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e(oe,{modelValue:_.value.name,"onUpdate:modelValue":E[1]||(E[1]=j=>_.value.name=j),label:a(w)("projects.uml_diagrams.name"),required:"",rules:[j=>!!j||a(w)("projects.uml_diagrams.validation.name_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(A,{cols:"12",md:"6"},{default:t(()=>[e(ne,{modelValue:_.value.status,"onUpdate:modelValue":E[2]||(E[2]=j=>_.value.status=j),label:a(w)("projects.uml_diagrams.status.title"),items:$,required:""},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[e(he,{modelValue:_.value.notes,"onUpdate:modelValue":E[3]||(E[3]=j=>_.value.notes=j),label:a(w)("projects.uml_diagrams.notes"),rows:"4"},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12"},{default:t(()=>[i("div",Ko,l(a(w)("projects.uml_diagrams.content")),1),i("div",Yo,[i("div",Jo,l(a(w)("projects.uml_diagrams.content_hint")),1),e(he,{modelValue:_.value.content,"onUpdate:modelValue":E[4]||(E[4]=j=>_.value.content=j),rows:"15",monospace:"","hide-details":""},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),v("div",Go,[r.diagram.generation_status==="in_progress"?(n(),v("div",Zo,[e($e,{color:"info",variant:"tonal",icon:"tabler-refresh"},{default:t(()=>[e(ht,null,{default:t(()=>[d(l(a(w)("projects.uml_diagrams.status.generating")),1)]),_:1}),i("p",null,l(a(w)("projects.uml_diagrams.status.generating_description")),1)]),_:1}),i("div",Qo,[e(me,{indeterminate:"",color:"primary",size:"64"})]),i("div",Wo,[e(k,{size:"18",icon:"tabler-calendar",class:"me-1"}),i("span",Xo,l(a(w)("projects.details.updated_at"))+": "+l(P(r.diagram.updated_at)),1),e(k,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),i("span",ei,l(a(w)("projects.details.created_at"))+": "+l(P(r.diagram.created_at)),1)])])):r.diagram.content?(n(),v("div",ti,[i("div",ai,[e(J,{color:a(fe)(r.diagram.status),size:"small",label:"",class:"me-2"},{default:t(()=>[d(l(a(w)(`projects.status.${r.diagram.status}`)),1)]),_:1},8,["color"]),r.diagram.notes?(n(),v("div",li,[e(Bt,null,{activator:t(({props:j})=>[e(k,vt({icon:"tabler-info-circle",size:"18",color:"info"},j),null,16)]),default:t(()=>[i("span",null,l(r.diagram.notes),1)]),_:1})])):C("",!0),e(ee),i("div",ri,[e(k,{size:"18",icon:"tabler-calendar",class:"me-1"}),i("span",si,l(a(w)("projects.details.updated_at"))+": "+l(P(r.diagram.updated_at)),1),e(k,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),i("span",oi,l(a(w)("projects.details.created_at"))+": "+l(P(r.diagram.created_at)),1)])]),e(X),i("div",{class:"diagram-svg-container pa-4 d-flex justify-center align-center",style:Se({height:c.value?"calc(100vh - 180px)":"calc(70vh - 110px)",overflow:"auto"})},[r.diagram.content?(n(),g(_t,{key:0,src:a(ft)(r.diagram.content),class:"diagram-svg",alt:"Generated Diagram"},null,8,["src"])):C("",!0)],4)])):(n(),v("div",ii,[e(k,{icon:"tabler-chart-dots-2",size:"64",color:"secondary",class:"mb-4"}),i("h4",ni,l(a(w)("projects.uml_diagrams.status.no_content.title")),1),i("p",ci,l(a(w)("projects.uml_diagrams.status.no_content.description")),1)]))]))]),_:1},8,["class","style"]),e(X),e(ue,{class:"pa-4"},{default:t(()=>[p.value?(n(),v(Z,{key:0},[e(R,{color:"secondary",variant:"tonal",onClick:B,disabled:y.value},{default:t(()=>[d(l(a(w)("projects.actions.cancel")),1)]),_:1},8,["disabled"]),e(ee),e(R,{color:"primary",onClick:N,loading:y.value},{default:t(()=>[d(l(a(w)("projects.actions.save")),1)]),_:1},8,["loading"])],64)):(n(),v(Z,{key:1},[r.isAdmin?(n(),g(R,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:F},{default:t(()=>[d(l(a(w)("projects.uml_diagrams.actions.delete")),1)]),_:1})):C("",!0),r.hasModeratorPermission?(n(),g(R,{key:1,color:"info",variant:"tonal","prepend-icon":"tabler-refresh",class:"ms-2",onClick:D,loading:y.value},{default:t(()=>[d(l(a(w)("projects.uml_diagrams.actions.regenerate")),1)]),_:1},8,["loading"])):C("",!0),e(ee),r.hasModeratorPermission?(n(),g(R,{key:2,color:"primary","prepend-icon":"tabler-edit",onClick:B},{default:t(()=>[d(l(a(w)("projects.uml_diagrams.actions.edit")),1)]),_:1})):C("",!0)],64))]),_:1})]),_:1}),e(ye,{modelValue:x.value.show,"onUpdate:modelValue":E[6]||(E[6]=j=>x.value.show=j),color:x.value.color,timeout:5e3},{actions:t(()=>[e(O,{onClick:E[5]||(E[5]=j=>x.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l(x.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue","fullscreen","max-width"])}}},[["__scopeId","data-v-6da39191"]]),di={key:0,class:"d-flex justify-center align-center",style:{height:"300px"}},pi={key:1,class:"text-center pa-4"},mi={class:"text-h6 mb-2"},vi={class:"text-body-1 text-medium-emphasis mb-6"},_i={class:"mb-3 d-flex align-center"},fi={class:"diagram-preview mb-3"},hi={class:"overflow-hidden position-relative rounded bg-grey-lighten-4",style:{height:"150px"}},gi={class:"d-flex justify-center align-center h-100"},yi={key:0,class:"text-center pa-2"},bi={class:"text-caption"},ji={key:1,class:"diagram-thumbnail pa-2"},xi={key:2,class:"text-center"},ki={class:"text-caption mt-2"},wi={class:"preview-overlay d-flex justify-center align-center"},Vi={class:"d-flex align-center justify-space-between"},qi={class:"d-flex align-center"},Ci={class:"text-caption"},Si={class:"text-body-1 mb-4"},Ui=be({__name:"UmlDiagramList",props:{projectId:{type:String,required:!0},diagrams:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(r,{emit:u}){const o=r,s=et(),f=Ue(),{t:c}=ce(),p=S(""),_=S("all"),y=S(null),x=S(!1),w=S(!1),$=S(!1),P=S(!1),I=S({show:!1,text:"",color:"success"}),B=K(()=>f.is_admin()),N=K(()=>f.userData.role>=2),F=K(()=>f.userData.role>=3),D=[{title:c("projects.uml_diagrams.types.all"),value:"all"},{title:c("projects.uml_diagrams.types.class"),value:"class"},{title:c("projects.uml_diagrams.types.sequence"),value:"sequence"},{title:c("projects.uml_diagrams.types.activity"),value:"activity"},{title:c("projects.uml_diagrams.types.usecase"),value:"use_case"},{title:c("projects.uml_diagrams.types.state"),value:"state"},{title:c("projects.uml_diagrams.types.component"),value:"component"},{title:c("projects.uml_diagrams.types.deployment"),value:"deployment"},{title:c("projects.uml_diagrams.types.er"),value:"er"}],H=S("class"),U=K(()=>o.diagrams.filter(h=>{const q=!p.value||h.name.toLowerCase().includes(p.value.toLowerCase())||h.diagram_type.toLowerCase().includes(p.value.toLowerCase()),m=_.value==="all"||h.diagram_type.toLowerCase()===_.value.toLowerCase();return q&&m})),E=()=>{H.value="class",$.value=!0},O=async()=>{$.value=!1,P.value=!0;try{const{data:h,error:q}=await s.generateDiagrams(o.projectId,H.value);h&&!q?(re(c("projects.uml_diagrams.notifications.generation_started")),setTimeout(()=>{u("refresh")},3e3)):re(c("projects.uml_diagrams.notifications.generation_failed"),"error")}catch(h){re(c("projects.uml_diagrams.notifications.generation_failed")+": "+h.message,"error")}finally{P.value=!1}},j=async()=>{if(y.value){P.value=!0,w.value=!1;try{const{success:h,error:q}=await s.deleteDiagram(y.value.id);h&&!q?(re(c("projects.uml_diagrams.notifications.delete_success")),u("refresh"),x.value=!1):re(c("projects.uml_diagrams.notifications.delete_failed"),"error")}catch(h){re(c("projects.uml_diagrams.notifications.delete_failed")+": "+h.message,"error")}finally{P.value=!1}}},re=(h,q="success")=>{I.value={show:!0,text:h,color:q}},L=h=>{switch(h.toLowerCase()){case"all":default:return"tabler-chart-dots";case"class":return"tabler-box";case"sequence":return"tabler-arrow-right-square";case"activity":return"tabler-activity";case"usecase":return"tabler-user-check";case"state":return"tabler-circle-check";case"component":return"tabler-puzzle";case"deployment":return"tabler-server";case"er":return"tabler-database"}},V=h=>{switch(h.toLowerCase()){case"all":return c("projects.uml_diagrams.types.all");case"class":return c("projects.uml_diagrams.types.class");case"sequence":return c("projects.uml_diagrams.types.sequence");case"activity":return c("projects.uml_diagrams.types.activity");case"usecase":return c("projects.uml_diagrams.types.usecase");case"state":return c("projects.uml_diagrams.types.state");case"component":return c("projects.uml_diagrams.types.component");case"deployment":return c("projects.uml_diagrams.types.deployment");case"er":return c("projects.uml_diagrams.types.er");default:return h.charAt(0).toUpperCase()+h.slice(1)+" "+c("projects.uml_diagrams.types.diagram")}};return Be(()=>{!o.projectId||o.diagrams.length||o.loading||s.fetchDiagrams(o.projectId).then(({data:h})=>{h&&u("refresh")})}),(h,q)=>{const m=Fe,M=ve("IconBtn");return n(),g(G,{class:"pa-6"},{default:t(()=>[e(le,null,{default:t(()=>[e(A,{cols:"12",md:"4"},{default:t(()=>[e(oe,{modelValue:p.value,"onUpdate:modelValue":q[0]||(q[0]=b=>p.value=b),density:"compact",placeholder:a(c)("projects.uml_diagrams.actions.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(A,{cols:"12",md:"4"},{default:t(()=>[e(ne,{modelValue:_.value,"onUpdate:modelValue":q[1]||(q[1]=b=>_.value=b),items:D,density:"compact","hide-details":"",label:a(c)("projects.uml_diagrams.type"),variant:"outlined"},null,8,["modelValue","label"])]),_:1}),e(A,{cols:"12",md:"4",class:"d-flex align-center"},{default:t(()=>[a(F)?(n(),g(R,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:E,loading:P.value,block:""},{default:t(()=>[d(l(a(c)("projects.uml_diagrams.actions.generate")),1)]),_:1},8,["loading"])):C("",!0)]),_:1})]),_:1}),e(X,{class:"my-5"}),r.loading?(n(),v("div",di,[e(me,{indeterminate:"",color:"primary"})])):a(U).length===0?(n(),v("div",pi,[e(k,{icon:"tabler-chart-dots",size:"64",color:"secondary",class:"mb-4"}),i("h4",mi,l(a(c)("projects.uml_diagrams.empty.title")),1),i("p",vi,l(p.value||_.value!=="all"?a(c)("projects.uml_diagrams.empty.filtered"):a(c)("projects.uml_diagrams.empty.description")),1),a(F)&&!p.value&&_.value==="all"?(n(),g(R,{key:0,color:"primary",onClick:E,"prepend-icon":"tabler-plus"},{default:t(()=>[d(l(a(c)("projects.uml_diagrams.actions.generate")),1)]),_:1})):C("",!0)])):(n(),g(le,{key:2},{default:t(()=>[(n(!0),v(Z,null,se(a(U),b=>(n(),g(A,{key:b.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(Q,{class:"diagram-card h-100",onClick:T=>(z=>{y.value=z,x.value=!0})(b),border:"",hover:""},{default:t(()=>[e(ie,null,{prepend:t(()=>[e(xe,{color:"primary",variant:"tonal",size:"42"},{default:t(()=>[e(k,{icon:L(b.diagram_type)},null,8,["icon"])]),_:2},1024)]),append:t(()=>[e(J,{color:a(fe)(b.status),size:"small",label:""},{default:t(()=>[d(l(b.status),1)]),_:2},1032,["color"])]),default:t(()=>[e(ae,null,{default:t(()=>[d(l(b.name),1)]),_:2},1024)]),_:2},1024),e(G,null,{default:t(()=>{return[i("div",_i,[e(J,{color:"secondary",size:"small",label:"",class:"me-2"},{default:t(()=>[d(l(V(b.diagram_type)),1)]),_:2},1024)]),i("div",fi,[i("div",hi,[i("div",gi,[b.generation_status==="in_progress"?(n(),v("div",yi,[e(me,{indeterminate:"",color:"primary",size:"40",class:"mb-2"}),i("div",bi,l(a(c)("projects.uml_diagrams.status.generating")),1)])):b.content?(n(),v("div",ji,[b.content?(n(),g(_t,{key:0,src:a(ft)(b.content),class:"diagram-svg",alt:a(c)("projects.uml_diagrams.title")},null,8,["src","alt"])):C("",!0)])):(n(),v("div",xi,[e(k,{icon:L(b.diagram_type),size:"48",color:"secondary"},null,8,["icon"]),i("div",ki,l(a(c)("projects.uml_diagrams.status.no_content.title")),1)]))]),i("div",wi,[e(R,{color:"primary",variant:"elevated",size:"small","prepend-icon":"tabler-eye"},{default:t(()=>[d(l(a(c)("projects.uml_diagrams.actions.view")),1)]),_:1})])])]),i("div",Vi,[i("div",qi,[e(k,{size:"16",icon:"tabler-calendar",class:"me-1"}),i("span",Ci,l((T=b.created_at,T?(T=parseInt(T),new Date(T).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})):"")),1)])])];var T}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),y.value?(n(),g(ui,{key:3,modelValue:x.value,"onUpdate:modelValue":q[2]||(q[2]=b=>x.value=b),diagram:y.value,onDelete:q[3]||(q[3]=b=>w.value=!0),"is-admin":a(B),"has-manager-permission":a(N),"has-moderator-permission":a(F)},null,8,["modelValue","diagram","is-admin","has-manager-permission","has-moderator-permission"])):C("",!0),e(ge,{modelValue:$.value,"onUpdate:modelValue":q[6]||(q[6]=b=>$.value=b),"max-width":"600",persistent:""},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,{class:"pt-5 pb-2"},{default:t(()=>[d(l(a(c)("projects.uml_diagrams.generation.title")),1)]),_:1}),e(G,null,{default:t(()=>[i("p",Si,l(a(c)("projects.uml_diagrams.generation.description")),1),e(ne,{modelValue:H.value,"onUpdate:modelValue":q[4]||(q[4]=b=>H.value=b),items:D,label:a(c)("projects.uml_diagrams.type")},null,8,["modelValue","label"])]),_:1}),e(ue,null,{default:t(()=>[e(R,{color:"secondary",variant:"tonal",onClick:q[5]||(q[5]=b=>$.value=!1)},{default:t(()=>[d(l(a(c)("projects.user_stories.actions.cancel")),1)]),_:1}),e(ee),e(R,{color:"primary",onClick:O},{default:t(()=>[d(l(a(c)("projects.uml_diagrams.actions.generate")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(m,{isDialogVisible:w.value,"onUpdate:isDialogVisible":q[7]||(q[7]=b=>w.value=b),confirmationMsg:a(c)("projects.uml_diagrams.delete_confirm.message"),onConfirm:j},null,8,["isDialogVisible","confirmationMsg"]),e(ye,{modelValue:I.value.show,"onUpdate:modelValue":q[9]||(q[9]=b=>I.value.show=b),color:I.value.color,timeout:5e3},{actions:t(()=>[e(M,{onClick:q[8]||(q[8]=b=>I.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l(I.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},[["__scopeId","data-v-72966d03"]]),Di={key:2,class:"d-flex justify-center align-center",style:{"min-height":"200px"}},zi={__name:"ProjectExportsList",props:{projectId:{type:String,required:!0},exports:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(r,{emit:u}){const{t:o}=ce(),s=f=>{switch(f){case"active":return"success";case"pending":return"warning";case"failed":return"error";default:return"grey"}};return(f,c)=>(n(),g(Q,null,{default:t(()=>[e(G,null,{default:t(()=>[!r.loading&&r.exports.length>0?(n(),g(Te,{key:0},{default:t(()=>[i("thead",null,[i("tr",null,[i("th",null,l(a(o)("projects.exports.table.template")),1),i("th",null,l(a(o)("projects.exports.table.format")),1),i("th",null,l(a(o)("projects.exports.table.status")),1),i("th",null,l(a(o)("projects.exports.table.created_by")),1),i("th",null,l(a(o)("projects.exports.table.created_at")),1),i("th",null,l(a(o)("projects.exports.table.actions")),1)])]),i("tbody",null,[(n(!0),v(Z,null,se(r.exports,p=>{return n(),v("tr",{key:p.id},[i("td",null,l(p.template.name),1),i("td",null,l(p.fmt.toUpperCase()),1),i("td",null,[e(J,{color:s(p.status),size:"small"},{default:t(()=>[d(l(a(o)(`projects.exports.status.${p.status}`)),1)]),_:2},1032,["color"])]),i("td",null,l(p.created_by.username),1),i("td",null,l((_=p.created_at,new Date(parseInt(_)).toLocaleString())),1),i("td",null,[p.url?(n(),g(R,{key:0,icon:"",variant:"text",color:"primary",onClick:y=>(x=>{x.url&&window.open(x.url,"_blank")})(p)},{default:t(()=>[e(k,{icon:"tabler-download"})]),_:2},1032,["onClick"])):C("",!0)])]);var _}),128))])]),_:1})):r.loading||r.exports.length!==0?(n(),v("div",Di,[e(me,{indeterminate:"",color:"primary",size:"64"})])):(n(),g($e,{key:1,type:"info",variant:"tonal",class:"mt-4"},{default:t(()=>[d(l(a(o)("projects.exports.empty")),1)]),_:1}))]),_:1})]),_:1}))}},Ii={class:"text-center"},Pi={class:"d-flex flex-wrap justify-space-between align-center"},Mi={class:"d-flex align-center"},Bi={class:"text-h3"},$i={class:"d-flex align-center mt-3 mt-sm-0"},Fi={__name:"[id]",setup(r){const u=Dt(),o=zt(),s=It();Xe(),et();const f=Ue(),{t:c}=ce(),p=S(!0),_=S(null),y=S("0"),x=S(!1),w=S(!1),$=S(!1),P=S({show:!1,text:"",color:"success"}),I=K(()=>u.params.id),B=K(()=>s.currentProject),N=K(()=>f.is_admin()),F=K(()=>f.userData.role>=2),D=K(()=>f.userData.role>=3),H=S(null),U=S(!1),E=[{title:"Markdown",value:"md",icon:"tabler-markdown"},{title:"PDF",value:"pdf",icon:"tabler-file-text"},{title:"HTML",value:"html",icon:"tabler-code"}],O=async()=>{p.value=!0,_.value=null;try{const{data:T,error:z}=await s.fetchProjectById(I.value);z&&(_.value=z,j("projects.errors.loading_failed"))}catch(T){_.value=T.message||"Failed to load project details",j("projects.errors.loading_failed")}finally{p.value=!1}},j=(T,z="success")=>{P.value={show:!0,text:c(T),color:z}},re=()=>{x.value=!0},L=async(T=!1)=>{if(T){w.value=!1,$.value=!0;try{const{success:z,error:te}=await s.deleteProject(I.value);z&&!te?(j("projects.notifications.deleted"),o.push({name:"projects"})):j("projects.notifications.error")}catch{j("projects.errors.delete_failed","error")}finally{$.value=!1}}},V=async T=>{$.value=!0;try{const{data:z,error:te}=await s.updateProject(I.value,T);j(z&&!te?"projects.notifications.updated":"projects.notifications.error")}catch{j("projects.errors.update_failed","error")}finally{$.value=!1}},h=async()=>{setTimeout(()=>{O()},9e3)},q=async()=>{$.value=!0;try{const{data:T,error:z}=await s.generateRequirements(I.value);T&&!z?(j("projects.notifications.requirements_generation_started"),h()):j("projects.notifications.requirements_generation_failed","error")}catch{j("projects.notifications.requirements_generation_failed","error")}finally{$.value=!1}},m=async()=>{$.value=!0;try{const{data:T,error:z}=await s.generatePlan(I.value);T&&!z?(j("projects.notifications.plan_generation_started"),h()):j("projects.notifications.plan_generation_failed","error")}catch{j("projects.notifications.plan_generation_failed","error")}finally{$.value=!1}},M=async()=>{$.value=!0;try{const{data:T,error:z}=await s.generateMockups(I.value);T&&!z?(j("projects.notifications.mockups_generation_started"),h()):j("projects.notifications.mockups_generation_failed","error")}catch{j("projects.notifications.mockups_generation_failed","error")}finally{$.value=!1}},b=T=>{H.value=T,y.value="2"};return Be(()=>{O()}),(T,z)=>{const te=Fe,Ce=ve("IconBtn");return n(),g(Mt,{fluid:""},{default:t(()=>[p.value&&!a(B)?(n(),g(le,{key:0},{default:t(()=>[e(A,{cols:"12",class:"d-flex justify-center align-center",style:{"min-height":"400px"}},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"64"})]),_:1})]),_:1})):_.value&&!a(B)?(n(),g(le,{key:1},{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e($e,{color:"error",variant:"tonal",title:a(c)("projects.errors.loading_failed"),text:a(c)("projects.errors.loading_failed"),class:"mb-4"},null,8,["title","text"]),i("div",Ii,[e(R,{color:"primary",onClick:O},{default:t(()=>[d(l(T.$t("projects.actions.retry")),1)]),_:1}),e(R,{color:"secondary",variant:"outlined",class:"ms-2",to:{name:"projects"}},{default:t(()=>[d(l(T.$t("projects.actions.back_to_projects")),1)]),_:1})])]),_:1})]),_:1})):a(B)?(n(),v(Z,{key:2},[e(le,null,{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[i("div",Pi,[i("div",Mi,[e(R,{icon:"",variant:"text",class:"me-3",to:{name:"projects"}},{default:t(()=>[e(k,{icon:"tabler-arrow-left"})]),_:1}),i("h3",Bi,l(a(B).name),1)]),i("div",$i,[e(R,{color:"info",variant:"tonal","prepend-icon":"tabler-refresh",class:"me-2",onClick:O,loading:$.value},{default:t(()=>[d(l(T.$t("projects.actions.refresh")),1)]),_:1},8,["loading"]),a(D)?(n(),g($t,{key:0,modelValue:U.value,"onUpdate:modelValue":z[0]||(z[0]=Y=>U.value=Y),location:"top",loading:$.value},{activator:t(({props:Y})=>[e(R,vt(Y,{color:"secondary",variant:"outlined","prepend-icon":"tabler-file-export",class:"me-2"}),{default:t(()=>[d(l(T.$t("projects.actions.export_srs")),1)]),_:2},1040)]),default:t(()=>[e(Re,null,{default:t(()=>[(n(),v(Z,null,se(E,Y=>e(Oe,{key:Y.value,value:Y.value,onClick:_e=>{(async(De="md")=>{$.value=!0;try{const{data:ze,error:qe}=await s.exportSrs(I.value,De);ze&&!qe?(j("projects.notifications.srs_export_started"),y.value="6",h()):j("projects.notifications.srs_export_failed","error")}catch{j("projects.notifications.srs_export_failed","error")}finally{$.value=!1}})(Y.value),U.value=!1}},{prepend:t(()=>[e(k,{icon:Y.icon},null,8,["icon"])]),default:t(()=>[e(Ae,null,{default:t(()=>[d(l(Y.title),1)]),_:2},1024)]),_:2},1032,["value","onClick"])),64))]),_:1})]),_:1},8,["modelValue","loading"])):C("",!0),a(F)?(n(),g(R,{key:1,color:"primary","prepend-icon":"tabler-edit",class:"me-2",onClick:re,loading:$.value},{default:t(()=>[d(l(T.$t("projects.actions.edit")),1)]),_:1},8,["loading"])):C("",!0),a(N)?(n(),g(R,{key:2,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:z[1]||(z[1]=Y=>w.value=!0),loading:$.value},{default:t(()=>[d(l(T.$t("projects.actions.delete")),1)]),_:1},8,["loading"])):C("",!0)])])]),_:1})]),_:1}),e(le,null,{default:t(()=>[e(A,{cols:"12"},{default:t(()=>[e(Q,null,{default:t(()=>[e(Qe,{modelValue:y.value,"onUpdate:modelValue":z[2]||(z[2]=Y=>y.value=Y),"bg-color":"primary",grow:"","slider-color":"white"},{default:t(()=>[e(de,{value:"0",color:"white"},{default:t(()=>[e(k,{size:"18",icon:"tabler-info-circle",start:""}),d(" "+l(T.$t("projects.tabs.overview")),1)]),_:1}),e(de,{value:"1",color:"white"},{default:t(()=>{var Y;return[e(k,{size:"18",icon:"tabler-list",start:""}),d(" "+l(T.$t("projects.tabs.requirements"))+" ",1),(Y=a(B).requirements)!=null&&Y.length?(n(),g(J,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>[d(l(a(B).requirements.length),1)]),_:1})):C("",!0)]}),_:1}),e(de,{value:"2",color:"white"},{default:t(()=>{var Y;return[e(k,{size:"18",icon:"tabler-user-check",start:""}),d(" "+l(T.$t("projects.tabs.user_stories"))+" ",1),(Y=a(B).user_stories)!=null&&Y.length?(n(),g(J,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>{var _e;return[d(l(((_e=a(B).user_stories)==null?void 0:_e.length)||0),1)]}),_:1})):C("",!0)]}),_:1}),e(de,{value:"3",color:"white"},{default:t(()=>{var Y;return[e(k,{size:"18",icon:"tabler-layout-kanban",start:""}),d(" "+l(T.$t("projects.tabs.mockups"))+" ",1),(Y=a(B).mockups)!=null&&Y.length?(n(),g(J,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>[d(l(a(B).mockups.length),1)]),_:1})):C("",!0)]}),_:1}),e(de,{value:"4",color:"white"},{default:t(()=>{var Y;return[e(k,{size:"18",icon:"tabler-chart-dots",start:""}),d(" "+l(T.$t("projects.tabs.uml_diagrams"))+" ",1),(Y=a(B).uml_diagrams)!=null&&Y.length?(n(),g(J,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>{var _e;return[d(l(((_e=a(B).uml_diagrams)==null?void 0:_e.length)||0),1)]}),_:1})):C("",!0)]}),_:1}),e(de,{value:"5",color:"white"},{default:t(()=>[e(k,{size:"18",icon:"tabler-chart-dots",start:""}),d(" "+l(T.$t("projects.tabs.development_plan")),1)]),_:1}),e(de,{value:"6",color:"white"},{default:t(()=>{var Y;return[e(k,{size:"18",icon:"tabler-file-export",start:""}),d(" "+l(T.$t("projects.tabs.exports"))+" ",1),(Y=a(B).srs_exports)!=null&&Y.length?(n(),g(J,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>{var _e;return[d(l(((_e=a(B).srs_exports)==null?void 0:_e.length)||0),1)]}),_:1})):C("",!0)]}),_:1})]),_:1},8,["modelValue"]),e(X),e(We,{modelValue:y.value,"onUpdate:modelValue":z[5]||(z[5]=Y=>y.value=Y)},{default:t(()=>[e(pe,{value:"0"},{default:t(()=>[e(Da,{project:a(B),loading:p.value},null,8,["project","loading"])]),_:1}),e(pe,{value:"1"},{default:t(()=>[e(ue,{class:"pt-3 px-6"},{default:t(()=>[e(ee),a(D)?(n(),g(R,{key:0,color:"primary","prepend-icon":"tabler-refresh",onClick:q,loading:$.value},{default:t(()=>[d(l(a(c)("projects.requirements.actions.generate")),1)]),_:1},8,["loading"])):C("",!0)]),_:1}),e(Bl,{"project-id":a(I),requirements:a(B).requirements||[],loading:p.value,onRefresh:O,onViewUserStories:b},null,8,["project-id","requirements","loading"])]),_:1}),e(pe,{value:"2"},{default:t(()=>{var Y,_e;return[e(ue,{class:"pt-3 px-6"},{default:t(()=>[H.value?(n(),g(R,{key:0,color:"secondary",variant:"tonal","prepend-icon":"tabler-arrow-left",onClick:z[3]||(z[3]=De=>H.value=null)},{default:t(()=>[d(l(T.$t("projects.actions.back_to_all_user_stories")),1)]),_:1})):C("",!0),e(ee),a(D)?(n(),g(R,{key:1,color:"primary","prepend-icon":"tabler-refresh",onClick:z[4]||(z[4]=De=>(async(ze=null)=>{$.value=!0;try{let qe;if(ze){const{data:Ke,error:Ye}=await s.generateUserStories(I.value,ze);qe={data:Ke,error:Ye}}else{const{data:Ke,error:Ye}=await s.generateUserStories(I.value);qe={data:Ke,error:Ye}}qe.data&&!qe.error?(j("projects.notifications.user_stories_generation_started"),h()):j("projects.notifications.user_stories_generation_failed","error")}catch{j("projects.notifications.user_stories_generation_failed","error")}finally{$.value=!1}})(H.value?H.value.id:null)),loading:$.value},{default:t(()=>[d(l(T.$t(H.value?"projects.actions.generate_user_stories_for_requirement":"projects.actions.generate_all_user_stories")),1)]),_:1},8,["loading"])):C("",!0)]),_:1}),e(To,{"project-id":a(I),"requirement-id":H.value?H.value.id:null,"user-stories":H.value?((_e=(Y=a(B).requirements)==null?void 0:Y.find(De=>De.id===H.value.id))==null?void 0:_e.user_stories)||[]:a(B).user_stories||[],loading:p.value,onRefresh:O},null,8,["project-id","requirement-id","user-stories","loading"])]}),_:1}),e(pe,{value:"3"},{default:t(()=>[e(ue,{class:"pt-3 px-6"},{default:t(()=>[e(ee),a(D)?(n(),g(R,{key:0,color:"primary","prepend-icon":"tabler-refresh",onClick:M,loading:$.value},{default:t(()=>[d(l(a(c)("projects.mockups.actions.generate")),1)]),_:1},8,["loading"])):C("",!0)]),_:1}),e(Cr,{"project-id":a(I),mockups:a(B).mockups||[],loading:p.value,onRefresh:O},null,8,["project-id","mockups","loading"])]),_:1}),e(pe,{value:"4"},{default:t(()=>[e(Ui,{"project-id":a(I),diagrams:a(B).uml_diagrams||[],loading:p.value,onRefresh:O},null,8,["project-id","diagrams","loading"])]),_:1}),e(pe,{value:"5"},{default:t(()=>[e(ue,{class:"pt-3 px-6"},{default:t(()=>[e(ee),a(F)?(n(),g(R,{key:0,color:"primary","prepend-icon":"tabler-refresh",onClick:m,loading:$.value},{default:t(()=>[d(l(T.$t("projects.development_plan.actions.generate")),1)]),_:1},8,["loading"])):C("",!0)]),_:1}),e(ws,{"project-id":a(I),"development-plan":a(B).development_plan,loading:p.value,onRefresh:O},null,8,["project-id","development-plan","loading"])]),_:1}),e(pe,{value:"6"},{default:t(()=>[e(zi,{"project-id":a(I),exports:a(B).srs_exports||[],loading:p.value,onRefresh:O},null,8,["project-id","exports","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})],64)):C("",!0),a(B)?(n(),g(Pt,{key:3,modelValue:x.value,"onUpdate:modelValue":z[6]||(z[6]=Y=>x.value=Y),"edit-mode":"","project-data":a(B),onSubmit:V},null,8,["modelValue","project-data"])):C("",!0),e(te,{isDialogVisible:w.value,"onUpdate:isDialogVisible":z[7]||(z[7]=Y=>w.value=Y),confirmationMsg:a(c)("projects.delete_confirm.message"),onConfirm:L},null,8,["isDialogVisible","confirmationMsg"]),e(ye,{modelValue:P.value.show,"onUpdate:modelValue":z[9]||(z[9]=Y=>P.value.show=Y),color:P.value.color,timeout:5e3},{actions:t(()=>[e(Ce,{onClick:z[8]||(z[8]=Y=>P.value.show=!1)},{default:t(()=>[e(k,{icon:"tabler-x"})]),_:1})]),default:t(()=>[d(l(P.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}};typeof at=="function"&&at(Fi);export{Fi as default};
