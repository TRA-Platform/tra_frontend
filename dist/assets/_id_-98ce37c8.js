import{L as Je,N as Ke,b4 as dt,R as at,S as mt,W as pt,b5 as vt,a9 as Ze,p as e,G as Ae,a8 as St,Z as Fe,E as Y,ac as ft,Q as _t,b6 as gt,O as yt,b7 as Ut,Y as ct,a1 as zt,$ as It,ap as q,b8 as Dt,b9 as $t,ba as Mt,k as j,I as ve,o as n,b as h,y as t,aI as te,aY as Z,C as $,m as o,A as l,b1 as pe,D as u,aV as Oe,bb as ie,aD as Ue,aB as he,aJ as fe,bc as Pt,aL as ze,aK as se,q as a,bd as Le,aj as k,c as v,F as ae,a as de,at as Re,H as Ce,a$ as Ne,r as ke,ah as me,s as lt,aZ as we,aX as Ve,ar as De,b3 as Ee,w as Be,be as Bt,aG as Rt,aH as Lt,bf as ht,aa as bt,bg as At,J as Ft,b0 as Ot,t as Nt}from"./index-5df66acf.js";import{V as be}from"./VDialog-01ed7732.js";import{a as qe,u as Et,_ as Wt,V as Tt}from"./ProjectCreateDialog-00460841.js";import{V as oe,a as L}from"./VRow-5d460fef.js";import{V as ne}from"./VDivider-e3a9082b.js";import{V as K}from"./VChip-23414d09.js";import{g as je,a as tt,b as jt}from"./formatters-36754ae5.js";import{V as le}from"./VSpacer-6270099a.js";import{V as Se}from"./VForm-f85999e5.js";import{b as ce}from"./VTextField-7c270f59.js";import{V as _e}from"./VSelect-28c34264.js";import{b as rt,c as ge,V as xe,a as kt}from"./VTabs-82da6e39.js";import{V as st,a as ye}from"./VSlideGroup-b7be1509.js";import{V as Ge,a as Xe,b as He}from"./VList-4ec67c31.js";import{V as Gt}from"./VTooltip-2e1eef69.js";import{b as ut}from"./route-block-83d24a4e.js";import{V as Xt}from"./VMenu-b0ba002b.js";import"./index-731cfb7e.js";import"./VCheckboxBtn-2106bebb.js";import"./ssrBoot-c93ce1cd.js";const Pe=Je()({name:"VTable",props:{fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...Ke(),...dt(),...at(),...mt()},setup(s,c){let{slots:i}=c;const{themeClasses:r}=pt(s),{densityClasses:f}=vt(s);return Ze(()=>e(s.tag,{class:["v-table",{"v-table--fixed-height":!!s.height,"v-table--fixed-header":s.fixedHeader,"v-table--fixed-footer":s.fixedFooter,"v-table--has-top":!!i.top,"v-table--has-bottom":!!i.bottom,"v-table--hover":s.hover},r.value,f.value,s.class],style:s.style},{default:()=>{var d,m,b;return[(d=i.top)==null?void 0:d.call(i),i.default?e("div",{class:"v-table__wrapper",style:{height:Ae(s.height)}},[e("table",null,[i.default()])]):(m=i.wrapper)==null?void 0:m.call(i),(b=i.bottom)==null?void 0:b.call(i)]}})),{}}}),xt=Je()({name:"VTimeline",props:{align:{type:String,default:"center",validator:s=>["center","start"].includes(s)},direction:{type:String,default:"vertical",validator:s=>["vertical","horizontal"].includes(s)},justify:{type:String,default:"auto",validator:s=>["auto","center"].includes(s)},side:{type:String,validator:s=>s==null||["start","end"].includes(s)},lineInset:{type:[String,Number],default:0},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:s=>["start","end","both"].includes(s)},...Ke(),...dt(),...at(),...mt()},setup(s,c){let{slots:i}=c;const{themeClasses:r}=pt(s),{densityClasses:f}=vt(s);St({VTimelineDivider:{lineColor:Fe(s,"lineColor")},VTimelineItem:{density:Fe(s,"density"),lineInset:Fe(s,"lineInset")}});const d=Y(()=>{const b=s.side?s.side:s.density!=="default"?"end":null;return b&&`v-timeline--side-${b}`}),m=Y(()=>{const b=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(s.truncateLine){case"both":return b;case"start":return b[0];case"end":return b[1];default:return null}});return Ze(()=>e(s.tag,{class:["v-timeline",`v-timeline--${s.direction}`,`v-timeline--align-${s.align}`,`v-timeline--justify-${s.justify}`,m.value,{"v-timeline--inset-line":!!s.lineInset},r.value,f.value,d.value,s.class],style:[{"--v-timeline-line-thickness":Ae(s.lineThickness)},s.style]},i)),{}}}),Ht=Je()({name:"VTimelineDivider",props:{dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:ft,iconColor:String,lineColor:String,...Ke(),..._t(),...gt(),...yt()},setup(s,c){let{slots:i}=c;const{sizeClasses:r,sizeStyles:f}=Ut(s,"v-timeline-divider__dot"),{backgroundColorStyles:d,backgroundColorClasses:m}=ct(Fe(s,"dotColor")),{roundedClasses:b}=zt(s,"v-timeline-divider__dot"),{elevationClasses:V}=It(s),{backgroundColorClasses:S,backgroundColorStyles:C}=ct(Fe(s,"lineColor"));return Ze(()=>e("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":s.fillDot},s.class],style:s.style},[e("div",{class:["v-timeline-divider__before",S.value],style:C.value},null),!s.hideDot&&e("div",{key:"dot",class:["v-timeline-divider__dot",V.value,b.value,r.value],style:f.value},[e("div",{class:["v-timeline-divider__inner-dot",m.value,b.value],style:d.value},[i.default?e(Dt,{key:"icon-defaults",disabled:!s.icon,defaults:{VIcon:{color:s.iconColor,icon:s.icon,size:s.size}}},i.default):e(q,{key:"icon",color:s.iconColor,icon:s.icon,size:s.size},null)])]),e("div",{class:["v-timeline-divider__after",S.value],style:C.value},null)])),{}}}),wt=Je()({name:"VTimelineItem",props:{density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:ft,iconColor:String,lineInset:[Number,String],...Ke(),...$t(),...yt(),..._t(),...gt(),...at()},setup(s,c){let{slots:i}=c;const{dimensionStyles:r}=Mt(s),f=j(0),d=j();return ve(d,m=>{var b;m&&(f.value=((b=m.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:b.getBoundingClientRect().width)??0)},{flush:"post"}),Ze(()=>{var m,b;return e("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":s.fillDot},s.class],style:[{"--v-timeline-dot-size":Ae(f.value),"--v-timeline-line-inset":s.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${Ae(s.lineInset)})`:Ae(0)},s.style]},[e("div",{class:"v-timeline-item__body",style:r.value},[(m=i.default)==null?void 0:m.call(i)]),e(Ht,{ref:d,hideDot:s.hideDot,icon:s.icon,iconColor:s.iconColor,size:s.size,elevation:s.elevation,dotColor:s.dotColor,fillDot:s.fillDot,rounded:s.rounded},{default:i.icon}),s.density!=="compact"&&e("div",{class:"v-timeline-item__opposite"},[!s.hideOpposite&&((b=i.opposite)==null?void 0:b.call(i))])])}),{}}}),Jt=o("span",{class:"text-5xl"},"!",-1),Kt={class:"text-lg font-weight-medium"},We={__name:"ConfirmDialog",props:{confirmationMsg:{type:String,required:!0},isDialogVisible:{type:Boolean,required:!0}},emits:["update:isDialogVisible","confirm"],setup(s,{emit:c}){const i=s,r=m=>{c("update:isDialogVisible",m)},f=()=>{c("confirm",!0),r(!1)},d=()=>{c("confirm",!1),c("update:isDialogVisible",!1)};return(m,b)=>(n(),h(be,{"max-width":"500","model-value":i.isDialogVisible,"onUpdate:modelValue":r},{default:t(()=>[e(te,{class:"text-center px-10 py-6"},{default:t(()=>[e(Z,null,{default:t(()=>[e($,{icon:"",variant:"outlined",color:"warning",class:"mb-4",style:{width:"88px",height:"88px","pointer-events":"none"}},{default:t(()=>[Jt]),_:1}),o("h6",Kt,l(i.confirmationMsg),1)]),_:1}),e(pe,{class:"align-center justify-center gap-2"},{default:t(()=>[e($,{variant:"elevated",onClick:f},{default:t(()=>[u(l(m.$t("confirmation.confirm")),1)]),_:1}),e($,{color:"secondary",variant:"tonal",onClick:d},{default:t(()=>[u(l(m.$t("confirmation.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},ot=Oe({id:"UserStoryStore",state:()=>({userStories:[],currentUserStory:null,loading:!1,error:null}),actions:{async fetchUserStories(s=null){this.loading=!0;try{let c="/service/user-stories/";s&&(c+=`?requirement=${s}`);const i=await ie.get(c);return i.status===200?(this.userStories=i.data,{data:i.data,error:null}):{data:[],error:i.data}}catch(c){return this.error=c.message||"Failed to fetch user stories",{data:[],error:this.error}}finally{this.loading=!1}},async fetchUserStoryById(s){this.loading=!0;try{const c=await ie.get(`/service/user-stories/${s}/`);return c.status===200?(this.currentUserStory=c.data,{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to fetch user story",{data:null,error:this.error}}finally{this.loading=!1}},async createUserStory(s){this.loading=!0;try{const c=await ie.post("/service/user-stories/",s);return c.status===201?(this.userStories.length&&this.userStories.push(c.data),{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to create user story",{data:null,error:this.error}}finally{this.loading=!1}},async updateUserStory(s,c){this.loading=!0;try{const i=await ie.put(`/service/user-stories/${s}/`,c);if(i.status===200){if(this.userStories.length){const r=this.userStories.findIndex(f=>f.id===s);r!==-1&&(this.userStories[r]=i.data)}return this.currentUserStory&&this.currentUserStory.id===s&&(this.currentUserStory=i.data),{data:i.data,error:null}}return{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to update user story",{data:null,error:this.error}}finally{this.loading=!1}},async deleteUserStory(s){this.loading=!0;try{const c=await ie.delete(`/service/user-stories/${s}/`);return c.status===204?(this.userStories.length&&(this.userStories=this.userStories.filter(i=>i.id!==s)),this.currentUserStory&&this.currentUserStory.id===s&&(this.currentUserStory=null),{success:!0,error:null}):{success:!1,error:c.data}}catch(c){return this.error=c.message||"Failed to delete user story",{success:!1,error:this.error}}finally{this.loading=!1}},async regenerateUserStory(s,c=""){this.loading=!0;try{const i=await ie.post(`/service/user-stories/${s}/regenerate/`,{feedback:c});return i.status===202?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to regenerate user story",{data:null,error:this.error}}finally{this.loading=!1}},async createComment(s,c){this.loading=!0;try{const i=await ie.post("/service/user-story-comments/",{user_story:s,text:c.text,status:c.status||"active"});return i.status===201?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to create comment",{data:null,error:this.error}}finally{this.loading=!1}},async deleteComment(s){this.loading=!0;try{const c=await ie.delete(`/service/user-story-comments/${s}/`);return c.status===204?{success:!0,error:null}:{success:!1,error:c.data}}catch(c){return this.error=c.message||"Failed to delete comment",{success:!1,error:this.error}}finally{this.loading=!1}}}}),it=Oe({id:"UmlDiagramStore",state:()=>({diagrams:[],currentDiagram:null,loading:!1,error:null}),actions:{async fetchDiagrams(s=null,c=null){this.loading=!0;try{let i="/service/uml-diagrams/";const r={};s&&(r.project=s),c&&(r.diagram_type=c);const f=await ie.get(i,{params:r});return f.status===200?(this.diagrams=f.data,{data:f.data,error:null}):{data:[],error:f.data}}catch(i){return this.error=i.message||"Failed to fetch UML diagrams",{data:[],error:this.error}}finally{this.loading=!1}},async fetchDiagramById(s){this.loading=!0;try{const c=await ie.get(`/service/uml-diagrams/${s}/`);return c.status===200?(this.currentDiagram=c.data,{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to fetch UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async createDiagram(s){this.loading=!0;try{const c=await ie.post("/service/uml-diagrams/",s);return c.status===201?(this.diagrams.length&&this.diagrams.push(c.data),{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to create UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async updateDiagram(s,c){this.loading=!0;try{const i=await ie.put(`/service/uml-diagrams/${s}/`,c);if(i.status===200){if(this.diagrams.length){const r=this.diagrams.findIndex(f=>f.id===s);r!==-1&&(this.diagrams[r]=i.data)}return this.currentDiagram&&this.currentDiagram.id===s&&(this.currentDiagram=i.data),{data:i.data,error:null}}return{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to update UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async deleteDiagram(s){this.loading=!0;try{const c=await ie.delete(`/service/uml-diagrams/${s}/`);return c.status===204?(this.diagrams.length&&(this.diagrams=this.diagrams.filter(i=>i.id!==s)),this.currentDiagram&&this.currentDiagram.id===s&&(this.currentDiagram=null),{success:!0,error:null}):{success:!1,error:c.data}}catch(c){return this.error=c.message||"Failed to delete UML diagram",{success:!1,error:this.error}}finally{this.loading=!1}},async regenerateDiagram(s){this.loading=!0;try{const c=await ie.post(`/service/uml-diagrams/${s}/regenerate/`);return c.status===202?{data:c.data,error:null}:{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to regenerate UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async generateDiagrams(s,c="class"){this.loading=!0;try{const i=await ie.post(`/service/projects/${s}/generate_uml_diagrams/`,{diagram_type:c});return i.status===202?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to generate UML diagrams",{data:null,error:this.error}}finally{this.loading=!1}}}}),Zt={class:"d-flex flex-column gap-4"},Qt={class:"d-flex flex-column gap-3"},Yt={class:"font-weight-medium mb-1"},ea={class:"d-flex justify-space-between mt-1"},ta={class:"font-weight-medium mb-1"},aa={class:"d-flex justify-space-between mt-1"},la={class:"font-weight-medium mb-1"},ra={class:"d-flex align-center gap-2"},sa={class:"flex-grow-1"},oa={class:"font-weight-medium mb-1"},ia={class:"d-flex justify-space-between mt-1"},na={class:"d-flex flex-column gap-2"},ca={class:"d-flex align-center"},ua={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},da={class:"d-flex align-center"},ma={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},pa={class:"d-flex align-center"},va={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},fa={class:"d-flex align-center"},_a={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},ga={key:0,class:"d-flex align-center"},ya={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},ha={key:1,class:"d-flex align-center"},ba={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},ja={key:2,class:"d-flex align-center"},ka={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},xa={class:"d-flex align-center"},wa=["title"],Va={class:"ms-2"},qa={class:"whitespace-pre-wrap"},Ca={class:"d-flex flex-column gap-4"},Sa={key:0},Ua={class:"text-subtitle-1 font-weight-bold mb-2"},za={class:"whitespace-pre-wrap"},Ia={key:1},Da={class:"text-subtitle-1 font-weight-bold mb-2"},$a={class:"d-flex flex-column gap-4"},Ma={class:"whitespace-pre-wrap mb-4"},Pa={key:0,class:"whitespace-pre-wrap"},Ba={class:"text-subtitle-1 font-weight-bold mb-2"},Ra={class:"whitespace-pre-wrap"},La={class:"whitespace-pre-wrap"},Aa={class:"whitespace-pre-wrap"},Fa=Ue({__name:"ProjectDetailsInfo",props:{project:{type:Object,required:!0},loading:{type:Boolean,default:!1},canManage:{type:Boolean,default:!1}},emits:["update","generate-requirements"],setup(s,{emit:c}){const i=s,{t:r}=he(),f=S=>S?new Date(parseInt(S)).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):r("projects.details.not_set"),d=Y(()=>{switch(i.project.status){case"draft":return"warning";case"active":return"success";case"archived":return"secondary";case"completed":return"info";default:return"primary"}}),m=Y(()=>{switch(i.project.type_of_application){case"website":return"tabler-world-www";case"mobile":return"tabler-device-mobile";case"desktop":return"tabler-device-desktop";case"api":return"tabler-api";default:return"tabler-code"}}),b={en:r("projects.languages.english"),ru:r("projects.languages.russian"),de:r("projects.languages.german")},V=()=>{c("generate-requirements")};return(S,C)=>(n(),h(Z,{class:"pa-6"},{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"6"},{default:t(()=>[o("div",Zt,[s.project.generation_progress?(n(),h(te,{key:0,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,Pt({prepend:t(()=>[e(ze,{color:"info",variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(q,{icon:"tabler-info-circle"})]),_:1})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.generation_status")),1)]),_:1})]),_:2},[s.canManage?{name:"append",fn:t(()=>[e($,{variant:"text",color:"primary",icon:"tabler-refresh",size:"small",onClick:V})]),key:"0"}:void 0]),1024),e(ne),e(Z,null,{default:t(()=>[o("div",Qt,[o("div",null,[o("div",Yt,l(a(r)("projects.details.requirements")),1),e(Le,{"model-value":s.project.generation_progress.requirements.status==="completed"?100:s.project.generation_progress.requirements.status==="in_progress"?50:s.project.generation_progress.requirements.status==="pending"?10:0,color:s.project.generation_progress.requirements.status==="completed"?"success":s.project.generation_progress.requirements.status==="in_progress"?"info":s.project.generation_progress.requirements.status==="failed"?"error":"warning",height:"8",rounded:""},null,8,["model-value","color"]),o("div",ea,[o("small",null,l(a(r)(`projects.details.${s.project.generation_progress.requirements.status}`)),1),o("small",null,l(s.project.requirements?s.project.requirements.length:0)+" "+l(a(r)("projects.details.requirements_count")),1)])]),o("div",null,[o("div",ta,l(a(r)("projects.details.user_stories")),1),e(Le,{"model-value":s.project.generation_progress.user_stories.total>0?s.project.generation_progress.user_stories.completed/s.project.generation_progress.user_stories.total*100:0,color:"info",height:"8",rounded:""},null,8,["model-value"]),o("div",aa,[o("small",null,l(s.project.generation_progress.user_stories.completed)+" "+l(a(r)("projects.details.completed")),1),o("small",null,l(s.project.generation_progress.user_stories.total)+" "+l(a(r)("projects.details.total")),1)])]),o("div",null,[o("div",la,l(a(r)("projects.details.mockups")),1),o("div",ra,[o("div",sa,[e(Le,{"model-value":s.project.mockups&&s.project.mockups.length?s.project.mockups.filter(U=>U.generation_status==="completed"&&!U.needs_regeneration).length/s.project.mockups.length*100:0,color:"success",height:"8",rounded:""},null,8,["model-value"])]),o("div",null,[s.project.mockups&&s.project.mockups.some(U=>U.needs_regeneration||U.generation_status==="in_progress"||U.generation_status==="pending")?(n(),h(K,{key:0,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(s.project.mockups.filter(U=>U.needs_regeneration||U.generation_status==="in_progress"||U.generation_status==="pending").length)+" "+l(a(r)("projects.details.pending")),1)]),_:1})):k("",!0)])])]),o("div",null,[o("div",oa,l(a(r)("projects.details.uml_diagrams")),1),e(Le,{"model-value":s.project.generation_progress.uml_diagrams.total>0?s.project.generation_progress.uml_diagrams.completed/s.project.generation_progress.uml_diagrams.total*100:0,color:"primary",height:"8",rounded:""},null,8,["model-value"]),o("div",ia,[o("small",null,l(s.project.generation_progress.uml_diagrams.completed)+" "+l(a(r)("projects.details.completed")),1),o("small",null,l(s.project.generation_progress.uml_diagrams.total)+" "+l(a(r)("projects.details.total")),1)])])])]),_:1})]),_:1})):k("",!0),e(te,{border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:"primary",variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(q,{icon:a(m)},null,8,["icon"])]),_:1})]),append:t(()=>[e(K,{size:"small",color:a(d),label:""},{default:t(()=>[u(l(a(r)(`projects.status.${s.project.status}`)),1)]),_:1},8,["color"])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.project_overview")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",na,[o("div",ca,[o("span",ua,l(a(r)("projects.details.created_at"))+":",1),o("span",null,l(f(s.project.created_at)),1)]),o("div",da,[o("span",ma,l(a(r)("projects.details.updated_at"))+":",1),o("span",null,l(f(s.project.updated_at)),1)]),o("div",pa,[o("span",va,l(a(r)("projects.details.type"))+":",1),e(K,{size:"small"},{default:t(()=>[u(l(a(r)(`projects.types.${s.project.type_of_application}`)),1)]),_:1})]),o("div",fa,[o("span",_a,l(a(r)("projects.details.language"))+":",1),e(K,{size:"small"},{default:t(()=>{return[u(l((U=s.project.language,b[U]||U)),1)];var U}),_:1})]),s.project.deadline?(n(),v("div",ga,[o("span",ya,l(a(r)("projects.details.deadline"))+":",1),o("span",null,l(f(s.project.deadline)),1)])):k("",!0),s.project.preliminary_budget?(n(),v("div",ha,[o("span",ba,l(a(r)("projects.details.budget"))+":",1),o("span",null,"$"+l(s.project.preliminary_budget),1)])):k("",!0),s.project.color_scheme?(n(),v("div",ja,[o("span",ka,l(a(r)("projects.details.color_scheme"))+":",1),o("div",xa,[(n(!0),v(ae,null,de(s.project.color_scheme.split(","),(U,R)=>(n(),v("div",{key:R,class:"color-swatch rounded me-1",style:Re({backgroundColor:U.trim()}),title:a(r)("projects.details.color")},null,12,wa))),128)),o("span",Va,l(s.project.color_scheme),1)])])):k("",!0)])]),_:1})]),_:1}),s.project.additional_requirements?(n(),h(te,{key:1,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(q,{color:"primary",icon:"tabler-list-details"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.additional_requirements")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",qa,l(s.project.additional_requirements),1)]),_:1})]),_:1})):k("",!0),s.project.technology_stack||s.project.operating_system?(n(),h(te,{key:2,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(q,{color:"primary",icon:"tabler-device-laptop"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.technical_details")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",Ca,[s.project.technology_stack?(n(),v("div",Sa,[o("h6",Ua,l(a(r)("projects.details.technology_stack")),1),o("div",za,l(s.project.technology_stack),1)])):k("",!0),s.project.operating_system?(n(),v("div",Ia,[o("h6",Da,l(a(r)("projects.details.operating_system")),1),o("div",null,l(s.project.operating_system),1)])):k("",!0)])]),_:1})]),_:1})):k("",!0)])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[o("div",$a,[e(te,{border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(q,{color:"primary",icon:"tabler-file-description"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.description")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",Ma,l(s.project.short_description),1),s.project.application_description?(n(),v("div",Pa,[o("h6",Ba,l(a(r)("projects.details.application_description")),1),o("div",null,l(s.project.application_description),1)])):k("",!0)]),_:1})]),_:1}),s.project.target_users?(n(),h(te,{key:0,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(q,{color:"primary",icon:"tabler-users"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.target_users")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",Ra,l(s.project.target_users),1)]),_:1})]),_:1})):k("",!0),s.project.non_functional_requirements?(n(),h(te,{key:1,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(q,{color:"primary",icon:"tabler-chart-bubble"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.non_functional_requirements")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",La,l(s.project.non_functional_requirements),1)]),_:1})]),_:1})):k("",!0),s.project.priority_modules?(n(),h(te,{key:2,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(q,{color:"primary",icon:"tabler-star"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.priority_modules")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",Aa,l(s.project.priority_modules),1)]),_:1})]),_:1})):k("",!0)])]),_:1})]),_:1})]),_:1}))}},[["__scopeId","data-v-64ae6fbd"]]),Vt=Oe({id:"RequirementStore",state:()=>({requirements:[],currentRequirement:null,loading:!1,error:null}),actions:{async fetchRequirements(s=null){this.loading=!0;try{let c="/service/requirements/";s&&(c+=`?project=${s}`);const i=await ie.get(c);return i.status===200?(this.requirements=i.data,{data:i.data,error:null}):{data:[],error:i.data}}catch(c){return this.error=c.message||"Failed to fetch requirements",{data:[],error:this.error}}finally{this.loading=!1}},async fetchRequirementById(s){this.loading=!0;try{const c=await ie.get(`/service/requirements/${s}/`);return c.status===200?(this.currentRequirement=c.data,{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to fetch requirement",{data:null,error:this.error}}finally{this.loading=!1}},async createRequirement(s){this.loading=!0;try{const c=await ie.post("/service/requirements/",s);return c.status===201?(this.requirements.length&&this.requirements.push(c.data),{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to create requirement",{data:null,error:this.error}}finally{this.loading=!1}},async updateRequirement(s,c){this.loading=!0;try{const i=await ie.put(`/service/requirements/${s}/`,c);if(i.status===200){if(this.requirements.length){const r=this.requirements.findIndex(f=>f.id===s);r!==-1&&(this.requirements[r]=i.data)}return this.currentRequirement&&this.currentRequirement.id===s&&(this.currentRequirement=i.data),{data:i.data,error:null}}return{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to update requirement",{data:null,error:this.error}}finally{this.loading=!1}},async deleteRequirement(s){this.loading=!0;try{const c=await ie.delete(`/service/requirements/${s}/`);return c.status===204?(this.requirements.length&&(this.requirements=this.requirements.filter(i=>i.id!==s)),this.currentRequirement&&this.currentRequirement.id===s&&(this.currentRequirement=null),{success:!0,error:null}):{success:!1,error:c.data}}catch(c){return this.error=c.message||"Failed to delete requirement",{success:!1,error:this.error}}finally{this.loading=!1}},async createComment(s,c){this.loading=!0;try{const i=await ie.post("/service/requirement-comments/",{requirement:s,text:c.text,status:c.status||"active",responsible_user:c.responsibleUser||null});return i.status===201?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to create comment",{data:null,error:this.error}}finally{this.loading=!1}},async deleteComment(s){this.loading=!0;try{const c=await ie.delete(`/service/requirement-comments/${s}/`);return c.status===204?{success:!0,error:null}:{success:!1,error:c.data}}catch(c){return this.error=c.message||"Failed to delete comment",{success:!1,error:this.error}}finally{this.loading=!1}}}}),Qe=Oe("mockup",()=>{const s=j([]),c=j(!1),i=j(null);return{mockups:s,loading:c,error:i,fetchProjectMockups:async r=>{c.value=!0,i.value=null;try{const f=await ie.get(`/service/projects/${r}/mockups/`);return s.value=f.data,f.data}catch(f){throw i.value="Failed to fetch mockups",console.error(f),f}finally{c.value=!1}},fetchMockupById:async r=>{c.value=!0,i.value=null;try{const f=await ie.get(`/service/mockups/${r}/`),d=s.value.findIndex(m=>m.id===r);return d!==-1&&(s.value[d]=f.data),f}catch(f){throw i.value="Failed to fetch mockup",console.error(f),f}finally{c.value=!1}},regenerateMockup:async(r,f)=>{c.value=!0,i.value=null;try{const d=await ie.post(`/service/mockups/${r}/regenerate/`,f),m=s.value.findIndex(b=>b.id===r);return m!==-1&&(s.value[m]=d.data),d.data}catch(d){throw i.value="Failed to regenerate mockup",console.error(d),d}finally{c.value=!1}},regenerateAllMockups:async r=>{c.value=!0,i.value=null;try{const f=await ie.post(`/service/projects/${r}/regenerate-mockups/`);return s.value=f.data,f.data}catch(f){throw i.value="Failed to regenerate all mockups",console.error(f),f}finally{c.value=!1}},updateMockupById:async(r,f)=>{c.value=!0,i.value=null;try{return await ie.put(`/service/mockups/${r}/`,f)}catch(d){throw i.value="Failed to update mockup",console.error(d),d}finally{c.value=!1}},deleteMockupById:async r=>{c.value=!0,i.value=null;try{return(await ie.delete(`/service/mockups/${r}/`)).status===204}catch(f){throw i.value="Failed to delete mockup",console.error(f),f}finally{c.value=!1}}}}),Oa={key:0,class:"text-h5"},Na={class:"text-h5"},Ea={key:0,class:"ms-2 d-flex align-center"},Wa={class:"text-caption"},Ta={key:0},Ga={key:1},Xa={class:"mockup-metadata d-flex align-center px-6 py-3"},Ha={class:"d-flex align-center"},Ja={class:"text-caption"},Ka={class:"d-flex align-center ms-4"},Za={class:"text-caption"},Qa={key:0,class:"d-flex align-center ms-4"},Ya={class:"text-caption"},el={key:1,class:"d-flex align-center ms-4"},tl={class:"text-caption"},al={class:"mockup-content pa-0"},ll={class:"text-h6 mb-2"},rl={class:"text-body-1 text-medium-emphasis max-width-md text-center"},sl=["srcdoc","title"],ol={key:2,class:"d-flex flex-column justify-center align-center pa-6",style:{height:"400px"}},il={class:"text-h6 mb-2"},nl={class:"text-medium-emphasis text-center"},cl={class:"text-body-1 mb-3"},nt=Ue({__name:"MockupPreviewDialog",props:{modelValue:{type:Boolean,default:!1},mockup:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1}},emits:["update:modelValue","delete","regenerate"],setup(s,{emit:c}){const i=s,{t:r}=he(),f=Y({get:()=>i.modelValue,set:w=>c("update:modelValue",w)}),d=Qe(),m=j(!1),b=j(!1),V=j({...i.mockup}),S=j(!1),C=j(null),U=j(!1),R=j(""),A=j({show:!1,text:"",color:"success"}),I=Y(()=>i.mockup.generation_status==="in_progress"||i.mockup.generation_status==="pending"||i.mockup.needs_regeneration),X=w=>w?(w=parseInt(w),new Date(w).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",T=()=>{m.value=!m.value},N=()=>{b.value&&(V.value={...i.mockup}),b.value=!b.value},Q=async()=>{S.value=!0;try{const{data:w,error:M}=await d.updateMockupById(i.mockup.id,{...V.value,needs_regeneration:!1,generation_status:"completed"});w&&!M?(P(r("projects.mockups.notifications.updated")),Object.assign(i.mockup,w),b.value=!1,f.value=!1):P(r("projects.mockups.notifications.update_failed"),"error")}catch(w){P(r("projects.mockups.notifications.update_error",{error:w.message}),"error")}finally{S.value=!1}},E=()=>{c("delete"),f.value=!1},J=async()=>{U.value=!0},W=async()=>{S.value=!0;try{i.mockup.user_story?await d.regenerateMockup(i.mockup.id,{user_story_id:i.mockup.user_story.id,feedback:R.value}):i.mockup.requirement?await d.regenerateMockup(i.mockup.id,{requirement_id:i.mockup.requirement.id,feedback:R.value}):await d.regenerateMockup(i.mockup.id,{feedback:R.value}),P(r("projects.mockups.notifications.regeneration_started")),U.value=!1,R.value="",f.value=!1,C.value=setInterval(B,5e3)}catch(w){P(r("projects.mockups.notifications.regeneration_error",{error:w.message}),"error")}finally{S.value=!1}},P=(w,M="success")=>{A.value={show:!0,text:w,color:M}},B=()=>{I.value&&f.value&&d.fetchMockupById(i.mockup.id).then(({data:w})=>{w&&Object.assign(i.mockup,w)})};return ve(()=>i.mockup,w=>{V.value={...w}},{deep:!0}),Ce(()=>{C.value=setInterval(B,5e3)}),Ne(()=>{C.value&&clearInterval(C.value)}),(w,M)=>{const D=ke("IconBtn");return n(),h(be,{modelValue:a(f),"onUpdate:modelValue":M[9]||(M[9]=F=>De(f)?f.value=F:null),fullscreen:m.value,"max-width":m.value?"100%":"900",scrollable:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex py-3 px-5"},{default:t(()=>[b.value?(n(),v("h5",Oa,l(a(r)("projects.mockups.actions.edit")),1)):(n(),v(ae,{key:1},[o("h5",Na,l(s.mockup.name),1),e(K,{color:a(je)(s.mockup.status),size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${s.mockup.status}`)),1)]),_:1},8,["color"]),a(I)?(n(),v("div",Ea,[e(me,{indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"}),o("span",Wa,l(s.mockup.generation_status==="in_progress"?a(r)("projects.mockups.status.generating"):a(r)("projects.mockups.status.pending")),1)])):k("",!0)],64)),e(le),e($,{icon:"",variant:"text",onClick:T},{default:t(()=>[e(q,{icon:m.value?"tabler-minimize":"tabler-maximize"},null,8,["icon"])]),_:1}),e(D,{onClick:M[0]||(M[0]=F=>f.value=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),_:1}),e(ne),e(Z,{class:lt({"pa-0":!b.value&&s.mockup.html_content,"pa-6":b.value||!s.mockup.html_content}),style:Re({height:m.value?"calc(100vh - 120px)":"70vh",maxHeight:"800px"})},{default:t(()=>[b.value?(n(),v("div",Ta,[e(Se,{onSubmit:we(Q,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:V.value.name,"onUpdate:modelValue":M[1]||(M[1]=F=>V.value.name=F),label:a(r)("projects.mockups.name"),required:"",rules:[F=>!!F||a(r)("projects.mockups.validation.name_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:V.value.status,"onUpdate:modelValue":M[2]||(M[2]=F=>V.value.status=F),label:a(r)("projects.details.status"),items:[{title:a(r)("projects.status.draft"),value:"draft"},{title:a(r)("projects.status.active"),value:"active"},{title:a(r)("projects.status.archived"),value:"archived"},{title:a(r)("projects.status.completed"),value:"completed"}],required:""},null,8,["modelValue","label","items"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:V.value.html_content,"onUpdate:modelValue":M[3]||(M[3]=F=>V.value.html_content=F),label:a(r)("projects.mockups.html_content"),rows:"15",rules:[F=>!!F||a(r)("projects.mockups.validation.html_required")],monospace:""},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),v("div",Ga,[o("div",Xa,[o("div",Ha,[e(q,{icon:"tabler-calendar",class:"me-2",size:"18"}),o("span",Ja,l(a(r)("projects.details.created_at"))+": "+l(X(s.mockup.created_at)),1)]),o("div",Ka,[e(q,{icon:"tabler-calendar-event",class:"me-2",size:"18"}),o("span",Za,l(a(r)("projects.details.updated_at"))+": "+l(X(s.mockup.updated_at)),1)]),s.mockup.requirement?(n(),v("div",Qa,[e(q,{icon:"tabler-file-check",class:"me-2",size:"18"}),o("span",Ya,l(a(r)("projects.details.requirement"))+": "+l(s.mockup.requirement_name),1)])):k("",!0),s.mockup.user_story?(n(),v("div",el,[e(q,{icon:"tabler-user-check",class:"me-2",size:"18"}),o("span",tl,l(a(r)("projects.details.user_story"))+": "+l(s.mockup.user_story_name),1)])):k("",!0)]),e(ne),o("div",al,[a(I)?(n(),v("div",{key:0,class:"d-flex flex-column justify-center align-center",style:Re({height:m.value?"calc(100vh - 180px)":"calc(70vh - 110px)"})},[e(me,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),o("h4",ll,l(s.mockup.generation_status==="in_progress"?a(r)("projects.mockups.status.generating"):a(r)("projects.mockups.status.preparing")),1),o("p",rl,l(s.mockup.generation_status==="in_progress"?a(r)("projects.mockups.status.generating_description"):a(r)("projects.mockups.status.preparing_description")),1)],4)):s.mockup.html_content?(n(),v("iframe",{key:1,srcdoc:s.mockup.html_content,class:"mockup-iframe",style:Re([{width:"100%",border:"none"},{height:m.value?"calc(100vh - 180px)":"calc(70vh - 110px)"}]),sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",title:a(r)("projects.mockups.preview")},null,12,sl)):(n(),v("div",ol,[e(q,{icon:"tabler-code-off",size:"64",color:"secondary",class:"mb-4"}),o("h4",il,l(a(r)("projects.mockups.no_content.title")),1),o("p",nl,l(a(r)("projects.mockups.no_content.description")),1)]))])]))]),_:1},8,["class","style"]),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[b.value?(n(),v(ae,{key:0},[e($,{color:"secondary",variant:"tonal",onClick:N,disabled:S.value},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1},8,["disabled"]),e(le),e($,{color:"primary",onClick:Q,loading:S.value},{default:t(()=>[u(l(a(r)("projects.actions.save")),1)]),_:1},8,["loading"])],64)):(n(),v(ae,{key:1},[s.isAdmin?(n(),h($,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:E},{default:t(()=>[u(l(a(r)("projects.actions.delete")),1)]),_:1})):k("",!0),s.hasManagerPermission?(n(),h($,{key:1,color:"warning",variant:"tonal","prepend-icon":"tabler-refresh",onClick:J,loading:a(I)||S.value,disabled:a(I),class:"ms-2"},{default:t(()=>[u(l(a(r)("projects.mockups.actions.regenerate")),1)]),_:1},8,["loading","disabled"])):k("",!0),e(le),s.hasManagerPermission?(n(),h($,{key:2,class:"ms-2",color:"primary",variant:"tonal","prepend-icon":"tabler-code",onClick:N},{default:t(()=>[u(l(a(r)("projects.mockups.actions.edit")),1)]),_:1})):k("",!0)],64))]),_:1})]),_:1}),e(be,{modelValue:U.value,"onUpdate:modelValue":M[6]||(M[6]=F=>U.value=F),"max-width":"600",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"pt-3 pb-0"},{default:t(()=>[u(l(a(r)("projects.mockups.regeneration.title")),1)]),_:1}),e(Z,null,{default:t(()=>[o("p",cl,l(a(r)("projects.mockups.regeneration.description")),1),e(qe,{autofocus:"",modelValue:R.value,"onUpdate:modelValue":M[4]||(M[4]=F=>R.value=F),label:a(r)("projects.mockups.fields.feedback"),hint:a(r)("projects.mockups.placeholders.feedback"),"aria-placeholder":"t('projects.mockups.placeholders.feedback')",rows:"4",counter:""},null,8,["modelValue","label","hint"])]),_:1}),e(pe,null,{default:t(()=>[e($,{color:"secondary",variant:"tonal",onClick:M[5]||(M[5]=F=>U.value=!1)},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1}),e(le),e($,{color:"primary",onClick:W,loading:S.value},{default:t(()=>[u(l(a(r)("projects.mockups.actions.regenerate")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ve,{modelValue:A.value.show,"onUpdate:modelValue":M[8]||(M[8]=F=>A.value.show=F),color:A.value.color,timeout:5e3},{actions:t(()=>[e(D,{onClick:M[7]||(M[7]=F=>A.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(A.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue","fullscreen","max-width"])}}},[["__scopeId","data-v-e7f2b0d9"]]),ul={key:0,class:"text-h5"},dl={key:1,class:"text-h5"},ml={key:0},pl={key:1},vl={class:"d-flex align-center mb-5"},fl={class:"d-flex align-center"},_l={class:"text-medium-emphasis d-flex align-center"},gl={class:"text-caption me-4"},yl={class:"text-caption"},hl={class:"text-h4 mb-4"},bl={class:"text-body-1 whitespace-pre-wrap"},jl={key:0,class:"text-center pa-6"},kl={class:"text-h6 mb-2"},xl={class:"text-medium-emphasis mb-4"},wl={key:1},Vl={class:"d-flex justify-space-between align-center mb-4"},ql={class:"text-h5"},Cl={class:"mb-2"},Sl={key:0,class:"mt-3"},Ul={class:"text-subtitle-2"},zl={class:"pl-4"},Il={key:0},Dl={key:0,class:"text-center mt-4"},$l={key:0,class:"text-center pa-6"},Ml={class:"text-h6 mb-2"},Pl={class:"text-medium-emphasis"},Bl={key:1},Rl={class:"d-flex align-center"},Ll={class:"mockup-preview mb-3"},Al={class:"overflow-hidden position-relative rounded bg-grey-lighten-4",style:{height:"150px"}},Fl={key:0,class:"d-flex justify-center align-center h-100"},Ol={class:"text-center"},Nl={class:"text-caption"},El={key:1,class:"html-preview"},Wl={key:2,class:"d-flex justify-center align-center h-100"},Tl={class:"preview-overlay d-flex justify-center align-center"},Gl={key:0,class:"mb-2"},Xl={class:"d-flex align-center justify-space-between"},Hl={class:"d-flex align-center"},Jl={class:"text-caption"},Kl={key:0,class:"text-center pa-6"},Zl={class:"text-h6 mb-2"},Ql={class:"text-medium-emphasis"},Yl={key:1},er={class:"text-caption"},tr={class:"text-caption text-medium-emphasis"},ar={class:"d-flex align-center mb-2"},lr={class:"text-caption"},rr={class:"text-body-2 whitespace-pre-wrap"},sr={class:"d-flex justify-end mt-2"},or={key:1,class:"text-center pa-6"},ir={class:"text-h6 mb-2"},nr={class:"text-medium-emphasis"},cr={key:2},ur={class:"d-flex align-center"},dr={class:"d-flex align-center"},mr={class:"text-caption text-medium-emphasis ml-2"},pr={class:"comment-text mt-2 whitespace-pre-wrap"},vr=Ue({__name:"RequirementDetailsDialog",props:{modelValue:{type:Boolean,default:!1},requirement:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},hasModeratorPermission:{type:Boolean,default:!1}},emits:["update:modelValue","update","delete","view-user-stories"],setup(s,{emit:c}){const i=s,{t:r}=he(),f=Y({get:()=>i.modelValue,set:ee=>c("update:modelValue",ee)}),d=Vt(),m=Qe(),b=j(0),V=j(!1),S=j({...i.requirement}),C=j(""),U=j(!1),R=j({show:!1,text:"",color:"success"}),A=j(null),I=j(!1),X=j(null),T=[{title:r("projects.categories.functional"),value:"functional"},{title:r("projects.categories.nonfunctional"),value:"nonfunctional"},{title:r("projects.categories.uiux"),value:"uiux"},{title:r("projects.categories.other"),value:"other"}],N=[{title:r("projects.status.draft"),value:"draft"},{title:r("projects.status.active"),value:"active"},{title:r("projects.status.archived"),value:"archived"},{title:r("projects.status.completed"),value:"completed"}],Q=[{title:r("projects.requirements.types.feature"),value:"feature"},{title:r("projects.requirements.types.constraint"),value:"constraint"},{title:r("projects.requirements.types.quality"),value:"quality"},{title:r("projects.requirements.types.interface"),value:"interface"},{title:r("projects.requirements.types.security"),value:"security"},{title:r("projects.requirements.types.performance"),value:"performance"},{title:r("projects.requirements.types.other"),value:"other"}],E=Y(()=>i.requirement.history||[]),J=Y(()=>i.requirement.comments||[]),W=Y(()=>i.requirement.user_stories||[]),P=Y(()=>i.requirement.mockups||[]),B=ee=>ee?(ee=parseInt(ee),new Date(ee).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",w=()=>{V.value&&(S.value={...i.requirement}),V.value=!V.value,b.value="0"},M=()=>{f.value&&!V.value&&d.fetchRequirementById(i.requirement.id).then(({data:ee})=>{ee&&Object.assign(i.requirement,ee)})};Ce(()=>{X.value=setInterval(M,5e3)}),Ne(()=>{X.value&&clearInterval(X.value)});const D=()=>{c("update",S.value),V.value=!1,f.value=!1},F=()=>{c("delete"),f.value=!1},z=()=>{c("view-user-stories",i.requirement),f.value=!1},x=async()=>{if(C.value.trim()){U.value=!0;try{const{data:ee,error:O}=await d.createComment(i.requirement.id,{text:C.value,status:"active"});if(ee&&!O){_(r("projects.requirements.notifications.comment_added")),C.value="";const{data:y}=await d.fetchRequirementById(i.requirement.id);y&&Object.assign(i.requirement,y)}else _(r("projects.requirements.notifications.comment_add_failed"),"error")}catch(ee){_(r("projects.requirements.notifications.comment_add_failed")+": "+ee.message,"error")}finally{U.value=!1}}},_=(ee,O="success")=>{R.value={show:!0,text:ee,color:O}};return ve(()=>i.requirement,ee=>{S.value={...ee}},{deep:!0}),(ee,O)=>{const y=ke("IconBtn");return n(),h(be,{modelValue:a(f),"onUpdate:modelValue":O[12]||(O[12]=p=>De(f)?f.value=p:null),"max-width":"900",scrollable:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex pt-5 px-5"},{default:t(()=>[V.value?(n(),v("h5",ul,l(a(r)("projects.requirements.actions.edit")),1)):(n(),v("h5",dl,l(a(r)("projects.requirements.actions.view_details")),1)),e(le),e(y,{onClick:O[0]||(O[0]=p=>f.value=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),_:1}),e(Z,{class:"pb-0"},{default:t(()=>[e(rt,{modelValue:b.value,"onUpdate:modelValue":O[1]||(O[1]=p=>b.value=p),"slider-color":"primary","align-tabs":"start"},{default:t(()=>[e(ge,{value:"0"},{default:t(()=>[e(q,{size:"18",icon:"tabler-info-circle",start:""}),u(" "+l(a(r)("projects.requirements.tabs.details")),1)]),_:1}),e(ge,{value:"1"},{default:t(()=>[e(q,{size:"18",icon:"tabler-user-check",start:""}),u(" "+l(a(r)("projects.requirements.tabs.user_stories"))+" ",1),a(W).length?(n(),h(K,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(W).length),1)]),_:1})):k("",!0)]),_:1}),e(ge,{value:"2"},{default:t(()=>[e(q,{size:"18",icon:"tabler-photo",start:""}),u(" "+l(a(r)("projects.requirements.tabs.mockups"))+" ",1),a(P).length?(n(),h(K,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(P).length),1)]),_:1})):k("",!0)]),_:1}),e(ge,{value:"3"},{default:t(()=>[e(q,{size:"18",icon:"tabler-history",start:""}),u(" "+l(a(r)("projects.requirements.tabs.history"))+" ",1),a(E).length?(n(),h(K,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(E).length),1)]),_:1})):k("",!0)]),_:1}),e(ge,{value:"4"},{default:t(()=>[e(q,{size:"18",icon:"tabler-messages",start:""}),u(" "+l(a(r)("projects.requirements.tabs.comments"))+" ",1),a(J).length?(n(),h(K,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(J).length),1)]),_:1})):k("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ne),e(Z,{class:"pa-6",style:{"min-height":"400px","max-height":"70vh"}},{default:t(()=>[e(st,{modelValue:b.value,"onUpdate:modelValue":O[8]||(O[8]=p=>b.value=p),class:"mt-5"},{default:t(()=>[e(ye,{value:"0"},{default:t(()=>[V.value?(n(),v("div",ml,[e(Se,{onSubmit:we(D,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:S.value.title,"onUpdate:modelValue":O[2]||(O[2]=p=>S.value.title=p),label:a(r)("projects.requirements.title"),required:"",rules:[p=>!!p||a(r)("validation.required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:S.value.category,"onUpdate:modelValue":O[3]||(O[3]=p=>S.value.category=p),label:a(r)("projects.requirements.category"),items:T,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:S.value.requirement_type,"onUpdate:modelValue":O[4]||(O[4]=p=>S.value.requirement_type=p),label:a(r)("projects.requirements.type"),items:Q,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:S.value.status,"onUpdate:modelValue":O[5]||(O[5]=p=>S.value.status=p),label:a(r)("projects.requirements.status"),items:N,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:S.value.description,"onUpdate:modelValue":O[6]||(O[6]=p=>S.value.description=p),label:a(r)("projects.requirements.description"),required:"",rows:"8",rules:[p=>!!p||a(r)("validation.required")]},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),v("div",pl,[o("div",vl,[e(K,{color:a(tt)(s.requirement.category),size:"small",label:"",class:"me-2"},{default:t(()=>[u(l(a(r)(`projects.categories.${s.requirement.category}`)),1)]),_:1},8,["color"]),e(K,{color:a(je)(s.requirement.status),size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${s.requirement.status}`)),1)]),_:1},8,["color"]),e(K,{color:"secondary",size:"small",label:"",class:"ms-2"},{default:t(()=>[u(" v"+l(s.requirement.version_number),1)]),_:1}),s.requirement.requirement_type?(n(),h(K,{key:0,color:"info",size:"small",label:"",class:"ms-2"},{default:t(()=>[u(l(a(r)(`projects.requirements.types.${s.requirement.requirement_type}`)),1)]),_:1})):k("",!0),e(le)]),o("div",fl,[o("div",_l,[e(q,{size:"18",icon:"tabler-calendar",class:"me-1"}),o("span",gl,l(a(r)("projects.details.updated_at"))+": "+l(B(s.requirement.updated_at)),1),e(q,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),o("span",yl,l(a(r)("projects.details.created_at"))+": "+l(B(s.requirement.created_at)),1)])]),o("h4",hl,l(s.requirement.title),1),o("div",bl,l(s.requirement.description),1)]))]),_:1}),e(ye,{value:"1"},{default:t(()=>[a(W).length===0?(n(),v("div",jl,[e(q,{icon:"tabler-user-check",size:"64",color:"secondary",class:"mb-3"}),o("h4",kl,l(a(r)("projects.requirements.user_stories.empty.title")),1),o("p",xl,l(a(r)("projects.requirements.user_stories.empty.description")),1),e($,{color:"primary",onClick:z},{default:t(()=>[u(l(a(r)("projects.requirements.actions.generate_user_stories")),1)]),_:1})])):(n(),v("div",wl,[o("div",Vl,[o("h5",ql,l(a(r)("projects.requirements.user_stories.title")),1),e($,{color:"primary",variant:"tonal",onClick:z},{default:t(()=>[u(l(a(r)("projects.requirements.actions.view_all_stories")),1)]),_:1})]),(n(!0),v(ae,null,de(a(W).slice(0,3),(p,G)=>(n(),h(te,{key:p.id,class:"mb-4",border:""},{default:t(()=>[e(fe,null,{append:t(()=>[e(K,{color:a(je)(p.status),size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${p.status}`)),1)]),_:2},1032,["color"])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.requirements.user_stories.as_a",{role:p.role})),1)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>[o("p",Cl,[o("strong",null,l(a(r)("projects.requirements.user_stories.i_want_to"))+":",1),u(" "+l(p.action),1)]),o("p",null,[o("strong",null,l(a(r)("projects.requirements.user_stories.so_that"))+":",1),u(" "+l(p.benefit),1)]),p.acceptance_criteria&&p.acceptance_criteria.length>0?(n(),v("div",Sl,[o("div",Ul,l(a(r)("projects.requirements.user_stories.acceptance_criteria"))+":",1),o("ul",zl,[(n(!0),v(ae,null,de(p.acceptance_criteria.slice(0,2),(g,re)=>(n(),v("li",{key:re},l(g),1))),128)),p.acceptance_criteria.length>2?(n(),v("li",Il,l(a(r)("projects.requirements.user_stories.and_more",{count:p.acceptance_criteria.length-2})),1)):k("",!0)])])):k("",!0)]),_:2},1024)]),_:2},1024))),128)),a(W).length>3?(n(),v("div",Dl,[e($,{color:"primary",variant:"tonal",onClick:z},{default:t(()=>[u(l(a(r)("projects.requirements.actions.view_all_stories_count",{count:a(W).length})),1)]),_:1})])):k("",!0)]))]),_:1}),e(ye,{value:"2"},{default:t(()=>[a(P).length===0?(n(),v("div",$l,[e(q,{icon:"tabler-photo-off",size:"64",color:"secondary",class:"mb-3"}),o("h4",Ml,l(a(r)("projects.requirements.mockups.empty.title")),1),o("p",Pl,l(a(r)("projects.requirements.mockups.empty.description")),1)])):(n(),v("div",Bl,[e(oe,null,{default:t(()=>[(n(!0),v(ae,null,de(a(P),p=>(n(),h(L,{key:p.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(te,{class:"mockup-card h-100",onClick:G=>(async g=>{const{data:re}=await m.fetchMockupById(g.id);A.value=re||g,I.value=!0})(p),border:"",hover:""},{default:t(()=>[e(fe,null,{append:t(()=>[o("div",Rl,[p.generation_status==="in_progress"||p.generation_status==="pending"||p.needs_regeneration?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):k("",!0),e(K,{color:a(je)(p.status),size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${p.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(p.name),1)]),_:2},1024)]),_:2},1024),e(ne),e(Z,null,{default:t(()=>[o("div",Ll,[o("div",Al,[p.generation_status==="in_progress"||p.generation_status==="pending"?(n(),v("div",Fl,[o("div",Ol,[e(me,{indeterminate:"",color:"primary",size:"40",class:"mb-2"}),o("div",Nl,l(a(r)("projects.mockups.status.generating")),1)])])):p.image?(n(),v("div",El,[e(Ee,{src:p.image,alt:p.name},null,8,["src","alt"])])):(n(),v("div",Wl,[e(q,{icon:"tabler-file-code",size:"48",color:"secondary"})])),o("div",Tl,[e($,{color:"primary",variant:"elevated",size:"small","prepend-icon":"tabler-eye",disabled:p.generation_status==="in_progress"||p.generation_status==="pending"},{default:t(()=>[u(l(a(r)("projects.mockups.actions.preview")),1)]),_:2},1032,["disabled"])])])]),p.needs_regeneration?(n(),v("div",Gl,[e(K,{color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(r)("projects.mockups.status.regenerating")),1)]),_:1})])):k("",!0),o("div",Xl,[o("div",Hl,[e(q,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",Jl,l(B(p.created_at)),1)])])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]))]),_:1}),e(ye,{value:"3"},{default:t(()=>[a(E).length===0?(n(),v("div",Kl,[e(q,{icon:"tabler-history",size:"64",color:"secondary",class:"mb-3"}),o("h4",Zl,l(a(r)("projects.requirements.history.empty.title")),1),o("p",Ql,l(a(r)("projects.requirements.history.empty.description")),1)])):(n(),v("div",Yl,[e(xt,{density:"compact",align:"start"},{default:t(()=>[(n(!0),v(ae,null,de(a(E),(p,G)=>(n(),h(wt,{key:G,"dot-color":"primary",size:"small"},{opposite:t(()=>[o("div",er,l(B(p.changed_at)),1),o("div",tr,"v"+l(p.version_number),1)]),default:t(()=>[e(te,{border:""},{default:t(()=>[e(fe,null,{append:t(()=>[e(K,{color:a(je)(p.status),size:"small",label:"",class:"ms-2"},{default:t(()=>[u(l(a(r)(`projects.status.${p.status}`)),1)]),_:2},1032,["color"])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(p.title),1)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>[o("div",ar,[e(K,{color:a(tt)(p.category),size:"small",label:"",class:"me-2"},{default:t(()=>[u(l(a(r)(`projects.categories.${p.category}`)),1)]),_:2},1032,["color"]),o("span",lr,l(a(r)("projects.requirements.history.changed_by"))+": "+l(p.changed_by?p.changed_by.username:a(r)("projects.requirements.history.unknown")),1)]),o("div",rr,l(p.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1}),e(ye,{value:"4"},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:C.value,"onUpdate:modelValue":O[7]||(O[7]=p=>C.value=p),label:a(r)("projects.requirements.comments.add"),rows:"3",counter:"",disabled:U.value},null,8,["modelValue","label","disabled"]),o("div",sr,[e($,{color:"primary",size:"small",loading:U.value,disabled:!C.value.trim(),onClick:x},{default:t(()=>[u(l(a(r)("projects.requirements.comments.add_button")),1)]),_:1},8,["loading","disabled"])])]),_:1}),e(L,{cols:"12"},{default:t(()=>[a(J).length?(n(),h(ne,{key:0,class:"mb-4"})):k("",!0),a(J).length===0?(n(),v("div",or,[e(q,{icon:"tabler-messages",size:"64",color:"secondary",class:"mb-3"}),o("h4",ir,l(a(r)("projects.requirements.comments.empty.title")),1),o("p",nr,l(a(r)("projects.requirements.comments.empty.description")),1)])):(n(),v("div",cr,[(n(!0),v(ae,null,de(a(J),p=>(n(),v("div",{key:p.id,class:"comment-item mb-4"},[e(te,{border:""},{default:t(()=>[e(Z,{class:"py-2"},{default:t(()=>[o("div",ur,[e(ze,{color:"primary",variant:"tonal",size:"36",class:"me-3"},{default:t(()=>[e(q,{icon:"tabler-user"})]),_:1}),o("div",null,[o("div",dr,[o("strong",null,l(p.user?p.user.username:a(r)("projects.requirements.comments.unknown_user")),1),o("div",mr,l(B(p.created_at)),1)])]),e(le),s.isAdmin||s.hasManagerPermission?(n(),h(y,{key:0,size:"small",color:"error",variant:"text",onClick:G=>(async g=>{U.value=!0;try{const{success:re,error:H}=await d.deleteComment(g);if(re&&!H){_(r("projects.requirements.notifications.comment_deleted"));const{data:ue}=await d.fetchRequirementById(i.requirement.id);ue&&Object.assign(i.requirement,ue)}else _(r("projects.requirements.notifications.comment_delete_failed"),"error")}catch(re){_(r("projects.requirements.notifications.comment_delete_failed")+": "+re.message,"error")}finally{U.value=!1}})(p.id),disabled:U.value},{default:t(()=>[e(q,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick","disabled"])):k("",!0)]),o("div",pr,l(p.text),1)]),_:2},1024)]),_:2},1024)]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[V.value?(n(),v(ae,{key:0},[e($,{color:"secondary",variant:"tonal",onClick:w},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1}),e(le),e($,{color:"primary",onClick:D},{default:t(()=>[u(l(a(r)("projects.actions.save")),1)]),_:1})],64)):(n(),v(ae,{key:1},[s.isAdmin?(n(),h($,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:F},{default:t(()=>[u(l(a(r)("projects.requirements.actions.delete")),1)]),_:1})):k("",!0),s.hasModeratorPermission&&a(W).length===0?(n(),h($,{key:1,color:"info",variant:"tonal","prepend-icon":"tabler-user-check",class:"ms-2",onClick:z},{default:t(()=>[u(l(a(r)("projects.requirements.actions.generate_user_stories")),1)]),_:1})):k("",!0),e(le),s.hasModeratorPermission?(n(),h($,{key:2,color:"primary","prepend-icon":"tabler-edit",onClick:w},{default:t(()=>[u(l(a(r)("projects.requirements.actions.edit")),1)]),_:1})):k("",!0)],64))]),_:1})]),_:1}),e(Ve,{modelValue:R.value.show,"onUpdate:modelValue":O[10]||(O[10]=p=>R.value.show=p),color:R.value.color,timeout:5e3},{actions:t(()=>[e(y,{onClick:O[9]||(O[9]=p=>R.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(R.value.text)+" ",1)]),_:1},8,["modelValue","color"]),A.value?(n(),h(nt,{key:0,modelValue:I.value,"onUpdate:modelValue":O[11]||(O[11]=p=>I.value=p),mockup:A.value,"is-admin":s.isAdmin,"has-manager-permission":s.hasManagerPermission},null,8,["modelValue","mockup","is-admin","has-manager-permission"])):k("",!0)]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-698b32b4"]]),fr={class:"text-h5"},_r={__name:"RequirementCreateDialog",props:{modelValue:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},requirementData:{type:Object,default:()=>({})}},emits:["update:modelValue","submit"],setup(s,{emit:c}){const i=s,{t:r}=he(),f=Y({get:()=>i.modelValue,set:I=>c("update:modelValue",I)}),d=j({title:i.editMode&&i.requirementData?i.requirementData.title:"",description:i.editMode&&i.requirementData?i.requirementData.description:"",category:i.editMode&&i.requirementData?i.requirementData.category:"functional",status:i.editMode&&i.requirementData?i.requirementData.status:"draft"}),m=[I=>!!I||r("validation.required"),I=>I.length<=255||r("projects.requirements.validation.title_length")],b=[I=>!!I||r("validation.required")],V=[{title:r("projects.categories.functional"),value:"functional"},{title:r("projects.categories.nonfunctional"),value:"nonfunctional"},{title:r("projects.categories.uiux"),value:"uiux"},{title:r("projects.categories.other"),value:"other"}],S=[{title:r("projects.status.draft"),value:"draft"},{title:r("projects.status.active"),value:"active"},{title:r("projects.status.archived"),value:"archived"},{title:r("projects.status.completed"),value:"completed"}],C=j(null),U=()=>{d.value={title:"",description:"",category:"functional",status:"draft"},C.value&&C.value.resetValidation()},R=()=>{f.value=!1,U()},A=async()=>{const{valid:I}=await C.value.validate();I&&(c("submit",d.value),f.value=!1,U())};return ve(f,I=>{I||U()}),(I,X)=>{const T=ke("IconBtn");return n(),h(be,{modelValue:a(f),"onUpdate:modelValue":X[4]||(X[4]=N=>De(f)?f.value=N:null),"max-width":"700",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex pt-5 px-5"},{default:t(()=>[o("h5",fr,l(i.editMode?a(r)("projects.requirements.actions.edit"):a(r)("projects.requirements.actions.add")),1),e(le),e(T,{onClick:R},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),_:1}),e(Z,{class:"px-5 pt-4"},{default:t(()=>[e(Se,{ref_key:"formRef",ref:C,onSubmit:we(A,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:d.value.title,"onUpdate:modelValue":X[0]||(X[0]=N=>d.value.title=N),label:a(r)("projects.requirements.title"),rules:m,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:d.value.category,"onUpdate:modelValue":X[1]||(X[1]=N=>d.value.category=N),label:a(r)("projects.requirements.category"),items:V,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:d.value.status,"onUpdate:modelValue":X[2]||(X[2]=N=>d.value.status=N),label:a(r)("projects.requirements.status"),items:S,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:d.value.description,"onUpdate:modelValue":X[3]||(X[3]=N=>d.value.description=N),label:a(r)("projects.requirements.description"),rules:b,required:"",rows:"6"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[e($,{variant:"tonal",color:"secondary",onClick:R},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1}),e(le),e($,{color:"primary",onClick:A},{default:t(()=>[u(l(i.editMode?a(r)("projects.actions.update"):a(r)("projects.actions.create")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}};function Te(s){return{all:s=s||new Map,on:function(c,i){var r=s.get(c);r?r.push(i):s.set(c,[i])},off:function(c,i){var r=s.get(c);r&&(i?r.splice(r.indexOf(i)>>>0,1):s.set(c,[]))},emit:function(c,i){var r=s.get(c);r&&r.slice().map(function(f){f(i)}),(r=s.get("*"))&&r.slice().map(function(f){f(c,i)})}}}const gr={key:0,class:"mb-4"},yr={key:1,class:"d-flex justify-center align-center",style:{height:"300px"}},hr={key:2,class:"text-center pa-4"},br={class:"text-h6 mb-2"},jr={class:"text-body-1 text-medium-emphasis mb-6"},kr={class:"d-flex align-center"},xr={class:"text-body-2 mb-3"},wr={class:"d-flex align-center justify-space-between mb-2"},Vr={class:"d-flex align-center"},qr={class:"text-caption text-capitalize"},Cr={class:"d-flex align-center"},Sr={class:"text-caption"},Ur={class:"d-flex align-center"},zr={class:"text-caption"},Ir={key:0,class:"mt-3"},Dr={__name:"ProjectRequirementsList",props:{projectId:{type:String,required:!0},requirements:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh","view-user-stories"],setup(s,{emit:c}){const i=s,{t:r}=he(),f=Vt(),d=Be(),m=j(""),b=j([]),V=j(["draft","active","completed"]),S=j(null),C=j(!1),U=j(!1),R=j(!1),A=j(!1),I=j({show:!1,text:"",color:"success"}),X=Y(()=>d.is_admin()),T=j(!1),N=j(!1),Q=j(!1),E=async()=>{T.value=await d.hasProjectRoleAtLeast(i.projectId,"MANAGER"),N.value=await d.hasProjectRoleAtLeast(i.projectId,"ADMIN"),Q.value=await d.hasProjectWriteAccess(i.projectId)},J=Y(()=>i.requirements.some(O=>O.user_stories&&O.user_stories.some(y=>y.generation_status==="in_progress"||y.generation_status==="pending")||O.mockups&&O.mockups.some(y=>y.generation_status==="in_progress"||y.generation_status==="pending"||y.needs_regeneration))),W=[{title:r("projects.categories.functional"),value:"functional"},{title:r("projects.categories.nonfunctional"),value:"nonfunctional"},{title:r("projects.categories.uiux"),value:"uiux"},{title:r("projects.categories.other"),value:"other"}],P=[{title:r("projects.status.draft"),value:"draft"},{title:r("projects.status.active"),value:"active"},{title:r("projects.status.archived"),value:"archived"},{title:r("projects.status.completed"),value:"completed"}],B=Y(()=>i.requirements.filter(O=>{const y=!m.value||O.title.toLowerCase().includes(m.value.toLowerCase())||O.description.toLowerCase().includes(m.value.toLowerCase()),p=b.value.length===0||b.value.includes(O.category),G=V.value.includes(O.status);return y&&p&&G})),w=Te(),M=()=>{U.value=!0},D=async O=>{A.value=!0;try{const{data:y,error:p}=await f.createRequirement({...O,project:i.projectId});y&&!p?(_("projects.requirements.notifications.created"),c("refresh")):_("projects.requirements.notifications.create_failed","error")}catch{_("projects.requirements.notifications.create_failed","error")}finally{A.value=!1}},F=async O=>{A.value=!0;try{const{data:y,error:p}=await f.updateRequirement(S.value.id,O);y&&!p?(_("projects.requirements.notifications.updated"),c("refresh")):_("projects.requirements.notifications.update_failed","error")}catch{_("projects.requirements.notifications.update_failed","error")}finally{A.value=!1}},z=async()=>{if(S.value){A.value=!0,R.value=!1;try{const{success:O,error:y}=await f.deleteRequirement(S.value.id);O&&!y?(_("projects.requirements.notifications.deleted"),c("refresh"),C.value=!1):_("projects.requirements.notifications.delete_failed","error")}catch{_("projects.requirements.notifications.delete_failed","error")}finally{A.value=!1}}},x=O=>{c("view-user-stories",O)},_=(O,y="success")=>{I.value={show:!0,text:r(O),color:y}},ee=(O,y=120)=>!O||O.length<=y?O:O.substring(0,y)+"...";return Ce(()=>{E(),w.on("project-refresh",()=>{f.fetchRequirements(i.projectId,{silent:!0}).then(({data:O})=>{O&&c("refresh")})})}),ve(C,O=>{O?w.on("project-refresh",async()=>{if(S.value){const{data:y}=await f.fetchRequirementById(S.value.id);y&&(S.value=y)}}):w.off("project-refresh")}),ve(()=>i.projectId,()=>{E()}),(O,y)=>{const p=We,G=ke("IconBtn");return n(),h(Z,{class:"pa-6"},{default:t(()=>[a(J)?(n(),v("div",gr,[e(xe,{type:"info",variant:"tonal",border:"start",class:"d-flex align-center"},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"24",class:"me-3"}),o("span",null,l(a(r)("projects.requirements.actions.generate_user_stories")),1)]),_:1})])):k("",!0),e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"4"},{default:t(()=>[e(ce,{modelValue:m.value,"onUpdate:modelValue":y[0]||(y[0]=g=>m.value=g),density:"compact",placeholder:a(r)("projects.requirements.actions.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(L,{cols:"12",md:"3"},{default:t(()=>[e(_e,{modelValue:b.value,"onUpdate:modelValue":y[1]||(y[1]=g=>b.value=g),items:W,density:"compact","hide-details":"",label:a(r)("projects.requirements.actions.category"),variant:"outlined",multiple:"",chips:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"3"},{default:t(()=>[e(_e,{modelValue:V.value,"onUpdate:modelValue":y[2]||(y[2]=g=>V.value=g),items:P,density:"compact","hide-details":"",label:a(r)("projects.requirements.actions.status"),variant:"outlined",multiple:"",chips:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[N.value?(n(),h($,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:M,loading:A.value,block:""},{default:t(()=>[u(l(a(r)("projects.requirements.actions.add")),1)]),_:1},8,["loading"])):k("",!0)]),_:1})]),_:1}),e(ne,{class:"my-5"}),s.loading?(n(),v("div",yr,[e(me,{indeterminate:"",color:"primary"})])):a(B).length===0?(n(),v("div",hr,[e(q,{icon:"tabler-file-search",size:"64",color:"secondary",class:"mb-4"}),o("h4",br,l(a(r)("projects.requirements.empty.title")),1),o("p",jr,l(m.value||b.value.length>0||V.value.length>0?a(r)("projects.requirements.empty.filtered"):a(r)("projects.requirements.empty.no_requirements")),1),N.value&&!m.value&&b.value.length===0&&V.value.length===0?(n(),h($,{key:0,color:"primary",onClick:M,"prepend-icon":"tabler-plus"},{default:t(()=>[u(l(a(r)("projects.requirements.actions.add_requirement")),1)]),_:1})):k("",!0)])):(n(),h(oe,{key:3},{default:t(()=>[(n(!0),v(ae,null,de(a(B),g=>(n(),h(L,{key:g.id,cols:"12"},{default:t(()=>[e(te,{class:"requirement-card",onClick:re=>(async H=>{const{data:ue}=await f.fetchRequirementById(H.id);S.value=ue||H,C.value=!0})(g),border:"",hover:""},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:a(tt)(g.category),variant:"tonal",size:"42"},{default:t(()=>[g.category==="functional"?(n(),h(q,{key:0,icon:"tabler-function"})):g.category==="nonfunctional"?(n(),h(q,{key:1,icon:"tabler-chart-bar"})):g.category==="uiux"?(n(),h(q,{key:2,icon:"tabler-palette"})):(n(),h(q,{key:3,icon:"tabler-file-description"}))]),_:2},1032,["color"])]),append:t(()=>[o("div",kr,[g.user_stories&&g.user_stories.some(re=>re.generation_status==="in_progress"||re.generation_status==="pending")||g.mockups&&g.mockups.some(re=>re.generation_status==="in_progress"||re.generation_status==="pending"||re.needs_regeneration)?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):k("",!0),g.user_stories&&g.user_stories.some(re=>re.generation_status==="pending")||g.mockups&&g.mockups.some(re=>re.generation_status==="pending"||re.needs_regeneration)?(n(),h(K,{key:1,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(r)("projects.requirements.actions.generate_user_stories")),1)]),_:1})):k("",!0),e(K,{color:a(je)(g.status),size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${g.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(g.handle)+" "+l(g.title),1)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>{return[o("p",xr,l(ee(g.description)),1),o("div",wr,[o("div",Vr,[e(q,{size:"16",icon:"tabler-tag",class:"me-1"}),o("span",qr,l(a(r)(`projects.categories.${g.category}`)),1)]),o("div",Cr,[e(q,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",Sr,l((re=g.updated_at,re?(re=parseInt(re),new Date(re).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"")),1)]),o("div",Ur,[e(q,{size:"16",icon:"tabler-history",class:"me-1"}),o("span",zr,"v"+l(g.version_number),1)])]),g.user_stories&&g.user_stories.length>0?(n(),v("div",Ir,[e($,{size:"small",variant:"tonal",color:"primary","prepend-icon":"tabler-user-check",onClick:we(H=>x(g),["stop"])},{default:t(()=>[u(l(g.user_stories.length)+" "+l(a(r)(g.user_stories.length===1?"projects.requirements.user_stories.single":"projects.requirements.user_stories.multiple")),1)]),_:2},1032,["onClick"])])):k("",!0)];var re}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),S.value?(n(),h(vr,{key:4,modelValue:C.value,"onUpdate:modelValue":y[3]||(y[3]=g=>C.value=g),requirement:S.value,onDelete:y[4]||(y[4]=g=>R.value=!0),onUpdate:F,onViewUserStories:x,"is-admin":a(X),"has-manager-permission":T.value,"has-moderator-permission":N.value},null,8,["modelValue","requirement","is-admin","has-manager-permission","has-moderator-permission"])):k("",!0),e(_r,{modelValue:U.value,"onUpdate:modelValue":y[5]||(y[5]=g=>U.value=g),onSubmit:D},null,8,["modelValue"]),e(p,{isDialogVisible:R.value,"onUpdate:isDialogVisible":y[6]||(y[6]=g=>R.value=g),confirmationMsg:a(r)("projects.requirements.delete_confirm.message"),onConfirm:z},null,8,["isDialogVisible","confirmationMsg"]),e(Ve,{modelValue:I.value.show,"onUpdate:modelValue":y[8]||(y[8]=g=>I.value.show=g),color:I.value.color,timeout:5e3},{actions:t(()=>[e(G,{onClick:y[7]||(y[7]=g=>I.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(I.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},$r=Ue(Dr,[["__scopeId","data-v-3c8f88b7"]]),Mr={key:0,class:"mb-4"},Pr={class:"d-flex align-center"},Br={key:1,class:"d-flex justify-center align-center",style:{height:"300px"}},Rr={key:2,class:"text-center pa-4"},Lr={class:"text-h6 mb-2"},Ar={class:"text-body-1 text-medium-emphasis mb-6"},Fr={class:"d-flex align-center"},Or={class:"mockup-preview mb-3"},Nr={class:"overflow-hidden position-relative rounded bg-grey-lighten-4",style:{height:"150px"}},Er={key:0,class:"d-flex justify-center align-center h-100"},Wr={class:"text-center"},Tr={class:"text-caption"},Gr={key:1,class:"html-preview"},Xr={key:2,class:"d-flex justify-center align-center h-100"},Hr={class:"preview-overlay d-flex justify-center align-center"},Jr={key:0,class:"mb-2"},Kr={key:1,class:"mb-2"},Zr={class:"text-caption font-weight-medium"},Qr={key:2,class:"mb-2"},Yr={class:"text-caption font-weight-medium"},es={class:"d-flex align-center justify-space-between"},ts={class:"d-flex align-center"},as={class:"text-caption"},ls={__name:"ProjectMockupsList",props:{projectId:{type:String,required:!0},mockups:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(s,{emit:c}){const i=s,r=Qe(),f=Be(),{t:d}=he(),m=j(""),b=j(null),V=j(!1),S=j(!1),C=j(!1);j(null);const U=j({show:!1,text:"",color:"success"}),R=Y(()=>f.is_admin()),A=j(!1),I=j(!1),X=async()=>{A.value=await f.hasProjectRoleAtLeast(i.projectId,"MANAGER"),I.value=await f.hasProjectRoleAtLeast(i.projectId,"ADMIN")},T=Y(()=>i.mockups.filter(P=>P.needs_regeneration||P.generation_status==="in_progress"||P.generation_status==="pending").length),N=Y(()=>i.mockups.filter(P=>!m.value||P.name.toLowerCase().includes(m.value.toLowerCase())||P.requirement&&P.requirement.toLowerCase().includes(m.value.toLowerCase()))),Q=Te(),E=async()=>{if(b.value){C.value=!0,S.value=!1;try{const{success:P,error:B}=await r.deleteMockupById(b.value.id);P&&!B?(J(d("projects.mockups.notifications.deleted")),c("refresh"),V.value=!1):J(d("projects.mockups.notifications.delete_failed"),"error")}catch(P){J(d("projects.mockups.notifications.delete_failed")+": "+P.message,"error")}finally{C.value=!1}}},J=(P,B="success")=>{U.value={show:!0,text:P,color:B}},W=Y(()=>i.mockups.some(P=>P.generation_status==="in_progress"||P.generation_status==="pending"||P.needs_regeneration));return Ce(()=>{X(),Q.on("project-refresh",()=>{r.fetchProjectMockups(i.projectId).then(({data:P})=>{P&&c("refresh")})})}),ve(V,P=>{P?Q.on("project-refresh",async()=>{if(b.value){const{data:B}=await r.fetchMockupById(b.value.id);B&&(b.value=B)}}):Q.off("project-refresh")}),ve(()=>i.projectId,()=>{X()}),(P,B)=>{const w=We,M=ke("IconBtn");return n(),h(Z,{class:"pa-6"},{default:t(()=>[a(W)?(n(),v("div",Mr,[e(xe,{type:"info",variant:"tonal",border:"start",class:"d-flex align-center"},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"24",class:"me-3"}),o("span",null,l(a(d)("projects.mockups.status.generating")),1)]),_:1})])):k("",!0),e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"6"},{default:t(()=>[e(ce,{modelValue:m.value,"onUpdate:modelValue":B[0]||(B[0]=D=>m.value=D),density:"compact",placeholder:a(d)("projects.mockups.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(L,{cols:"12",md:"6",class:"d-flex align-center"},{default:t(()=>[a(T)>0?(n(),h(xe,{key:0,type:"info",variant:"tonal",density:"compact",class:"mb-0 flex-grow-1 me-2"},{default:t(()=>[o("div",Pr,[e(me,{indeterminate:"",color:"info",size:"16",width:"2",class:"me-2"}),o("span",null,l(a(T))+" "+l(a(d)("projects.mockups.status.pending_count")),1)])]),_:1})):k("",!0)]),_:1})]),_:1}),e(ne,{class:"my-5"}),s.loading?(n(),v("div",Br,[e(me,{indeterminate:"",color:"primary"})])):a(N).length===0?(n(),v("div",Rr,[e(q,{icon:"tabler-photo-off",size:"64",color:"secondary",class:"mb-4"}),o("h4",Lr,l(a(d)("projects.mockups.empty.title")),1),o("p",Ar,l(m.value?a(d)("projects.mockups.empty.filtered"):a(d)("projects.mockups.empty.description")),1)])):(n(),h(oe,{key:3},{default:t(()=>[(n(!0),v(ae,null,de(a(N),D=>(n(),h(L,{key:D.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(te,{class:"mockup-card h-100",onClick:F=>(async z=>{const{data:x}=await r.fetchMockupById(z.id);b.value=x||z,V.value=!0})(D),border:"",hover:""},{default:t(()=>[e(fe,null,{append:t(()=>[o("div",Fr,[D.generation_status==="in_progress"||D.generation_status==="pending"||D.needs_regeneration?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):k("",!0),D.generation_status==="pending"||D.needs_regeneration?(n(),h(K,{key:1,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(d)("projects.mockups.status.generating")),1)]),_:1})):k("",!0),e(K,{color:a(je)(D.status),size:"small",label:""},{default:t(()=>[u(l(a(d)(`projects.status.${D.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(D.name),1)]),_:2},1024)]),_:2},1024),e(ne),e(Z,null,{default:t(()=>{return[o("div",Or,[o("div",Nr,[D.generation_status==="in_progress"||D.generation_status==="pending"?(n(),v("div",Er,[o("div",Wr,[e(me,{indeterminate:"",color:"primary",size:"40",class:"mb-2"}),o("div",Tr,l(a(d)("projects.mockups.status.generating")),1)])])):D.image?(n(),v("div",Gr,[e(Ee,{src:D.image,alt:D.name},null,8,["src","alt"])])):(n(),v("div",Xr,[e(q,{icon:"tabler-file-code",size:"48",color:"secondary"})])),o("div",Hr,[e($,{color:"primary",variant:"elevated",size:"small","prepend-icon":"tabler-eye",disabled:D.generation_status==="in_progress"||D.generation_status==="pending"},{default:t(()=>[u(l(a(d)("projects.mockups.actions.preview")),1)]),_:2},1032,["disabled"])])])]),D.needs_regeneration?(n(),v("div",Jr,[e(K,{color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(d)("projects.mockups.status.regenerating")),1)]),_:1})])):k("",!0),D.requirement?(n(),v("div",Kr,[o("span",Zr,l(a(d)("projects.details.requirement"))+": ",1),e(K,{size:"x-small",color:"primary",class:"ms-1"},{default:t(()=>[u(l(D.requirement_name),1)]),_:2},1024)])):k("",!0),D.user_story?(n(),v("div",Qr,[o("span",Yr,l(a(d)("projects.details.user_story"))+": ",1),e(K,{size:"x-small",color:"primary",class:"ms-1"},{default:t(()=>[u(l(D.user_story_name),1)]),_:2},1024)])):k("",!0),o("div",es,[o("div",ts,[e(q,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",as,l((F=D.created_at,F?new Date(parseInt(F)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"")),1)])])];var F}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),b.value?(n(),h(nt,{key:4,modelValue:V.value,"onUpdate:modelValue":B[1]||(B[1]=D=>V.value=D),mockup:b.value,onDelete:B[2]||(B[2]=D=>S.value=!0),"is-admin":a(R),"has-manager-permission":A.value},null,8,["modelValue","mockup","is-admin","has-manager-permission"])):k("",!0),e(w,{isDialogVisible:S.value,"onUpdate:isDialogVisible":B[3]||(B[3]=D=>S.value=D),confirmationMsg:a(d)("projects.mockups.delete_confirm.message"),onConfirm:E},null,8,["isDialogVisible","confirmationMsg"]),e(Ve,{modelValue:U.value.show,"onUpdate:modelValue":B[5]||(B[5]=D=>U.value.show=D),color:U.value.color,timeout:5e3},{actions:t(()=>[e(M,{onClick:B[4]||(B[4]=D=>U.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(U.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},rs=Ue(ls,[["__scopeId","data-v-aa91b02c"]]),qt=Oe({id:"DevelopmentPlanStore",state:()=>({plans:[],currentPlan:null,loading:!1,error:null}),actions:{async fetchDevelopmentPlans(s=null){this.loading=!0;try{let c="/service/development-plans/";s&&(c+=`?project=${s}`);const i=await ie.get(c);return i.status===200?(this.plans=i.data,{data:i.data,error:null}):{data:[],error:i.data}}catch(c){return this.error=c.message||"Failed to fetch development plans",{data:[],error:this.error}}finally{this.loading=!1}},async fetchDevelopmentPlanById(s){this.loading=!0;try{const c=await ie.get(`/service/development-plans/${s}/`);return c.status===200?(this.currentPlan=c.data,{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to fetch development plan",{data:null,error:this.error}}finally{this.loading=!1}},async createDevelopmentPlan(s){this.loading=!0;try{const c=await ie.post("/service/development-plans/",{project:s,status:"draft"});return c.status===201?{data:c.data,error:null}:{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to create development plan",{data:null,error:this.error}}finally{this.loading=!1}},async updateDevelopmentPlan(s,c){this.loading=!0;try{const i=await ie.put(`/service/development-plans/${s}/`,c);return i.status===200?(this.currentPlan&&this.currentPlan.id===s&&(this.currentPlan=i.data),{data:i.data,error:null}):{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to update development plan",{data:null,error:this.error}}finally{this.loading=!1}},async createPlanVersion(s,c){this.loading=!0;try{const i=await ie.post(`/service/development-plans/${s}/new_version/`,c);return i.status===201?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to create plan version",{data:null,error:this.error}}finally{this.loading=!1}},async fetchPlanVersionById(s){this.loading=!0;try{const c=await ie.get(`/service/development-plan-versions/${s}/`);return c.status===200?{data:c.data,error:null}:{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to fetch plan version",{data:null,error:this.error}}finally{this.loading=!1}},async updatePlanVersion(s,c){this.loading=!0;try{const i=await ie.put(`/service/development-plan-versions/${s}/`,c);return i.status===200?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to update plan version",{data:null,error:this.error}}finally{this.loading=!1}},async setCurrentPlanVersion(s,c,i){this.loading=!0;try{const r=await this.fetchDevelopmentPlanById(s);if(!r.data)return{data:null,error:"Plan not found"};const f=await this.fetchPlanVersionById(c);return f.data?await this.updateDevelopmentPlan(s,{current_version_number:f.data.version_number,status:r.data.status,project:i}):{data:null,error:"Version not found"}}catch(r){return this.error=r.message||"Failed to set current plan version",{data:null,error:this.error}}finally{this.loading=!1}}}}),Ct=s=>(Rt("data-v-a1b84d78"),s=s(),Lt(),s),ss={key:0,class:"text-h5"},os={key:1,class:"text-h5"},is={key:0},ns={class:"text-left",style:{"min-width":"200px"}},cs={class:"text-right",style:{"min-width":"120px"}},us={class:"text-right",style:{"min-width":"120px"}},ds={class:"text-right",style:{"min-width":"120px"}},ms=Ct(()=>o("th",{class:"text-right",style:{width:"50px"}},null,-1)),ps={class:"text-right"},vs={colspan:"3",class:"text-right font-weight-bold"},fs={class:"text-right font-weight-bold"},_s=Ct(()=>o("td",null,null,-1)),gs={key:1},ys={class:"d-flex flex-wrap justify-space-between mb-4"},hs={class:"d-flex align-center"},bs={class:"d-flex align-center"},js={class:"text-caption"},ks={key:0,class:"text-caption ms-3"},xs={class:"text-h4 font-weight-bold"},ws={class:"text-caption text-medium-emphasis text-right"},Vs={class:"text-left",style:{"min-width":"200px"}},qs={class:"text-right",style:{"min-width":"120px"}},Cs={class:"text-right",style:{"min-width":"120px"}},Ss={class:"text-right",style:{"min-width":"120px"}},Us={class:"text-right"},zs={class:"text-right"},Is={class:"text-right"},Ds={key:0},$s={colspan:"4",class:"text-center"},Ms={class:"text-body-1 whitespace-pre-wrap"},Ps=Ue({__name:"PlanVersionDialog",props:{modelValue:{type:Boolean,default:!1},version:{type:Object,required:!0},isCurrent:{type:Boolean,default:!1},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},planId:{type:String,default:null},projectId:{type:String,default:null},preliminaryBudget:{type:Number,default:0}},emits:["update:modelValue","refresh"],setup(s,{emit:c}){const i=s,{t:r}=he(),f=Y({get:()=>i.modelValue,set:B=>c("update:modelValue",B)}),d=qt(),m=j(!1),b=j({...i.version}),V=j([]),S=j(!1),C=j({show:!1,text:"",color:"success"}),U=j(null),R=Y(()=>V.value.reduce((B,w)=>B+w.cost,0)),A=Y(()=>i.preliminaryBudget>0&&R.value>i.preliminaryBudget),I=B=>B||B===0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(B):"-",X=()=>{m.value&&(b.value={...i.version},V.value=W(i.version.roles_and_hours)),m.value=!m.value},T=()=>{f.value&&d.fetchPlanVersionById(i.version.id).then(({data:B})=>{B&&(Object.assign(i.version,B),m.value||(V.value=W(B.roles_and_hours)))})};Ce(()=>{V.value=W(i.version.roles_and_hours),U.value=setInterval(T,5e3)}),Ne(()=>{U.value&&clearInterval(U.value)});const N=()=>{V.value.push({role:"",hours:0,cost:0})},Q=B=>{B.cost=B.hours*(B.rate||30)},E=async()=>{S.value=!0;try{const B={...b.value,roles_and_hours:JSON.stringify(V.value),estimated_cost:R.value},{data:w,error:M}=await d.updatePlanVersion(i.version.id,B);w&&!M?(P(r("projects.development_plan.notifications.version_updated")),Object.assign(i.version,w),m.value=!1,f.value=!1,c("refresh")):P(r("projects.development_plan.notifications.version_update_failed"),"error")}catch(B){P(r("projects.development_plan.notifications.version_update_failed")+": "+B.message,"error")}finally{S.value=!1}},J=async()=>{if(i.planId){S.value=!0;try{const{data:B,error:w}=await d.setCurrentPlanVersion(i.planId,i.version.id,i.projectId);B&&!w?(P(r("projects.development_plan.notifications.set_current_success")),f.value=!1,c("refresh")):P(r("projects.development_plan.notifications.set_current_failed"),"error")}catch(B){P(r("projects.development_plan.notifications.set_current_failed")+": "+B.message,"error")}finally{S.value=!1}}},W=B=>{if(!B)return[];try{return typeof B=="string"?JSON.parse(B):B}catch(w){return console.error("Error parsing roles and hours:",w),[]}},P=(B,w="success")=>{C.value={show:!0,text:B,color:w}};return ve(()=>i.version,B=>{b.value={...B},V.value=W(B.roles_and_hours)},{deep:!0}),(B,w)=>{const M=ke("IconBtn");return n(),h(be,{modelValue:a(f),"onUpdate:modelValue":w[6]||(w[6]=D=>De(f)?f.value=D:null),"max-width":"900",scrollable:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex py-3 px-5"},{default:t(()=>[m.value?(n(),v("h5",ss,l(a(r)("projects.development_plan.actions.edit")),1)):(n(),v("h5",os,[u(l(a(r)("projects.development_plan.version.version"))+" "+l(s.version.version_number)+" ",1),s.isCurrent?(n(),h(K,{key:0,color:"primary",size:"small",label:"",class:"ms-2"},{default:t(()=>[u(l(a(r)("projects.development_plan.version.current")),1)]),_:1})):k("",!0)])),e(le),e(M,{onClick:w[0]||(w[0]=D=>f.value=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),_:1}),e(ne),e(Z,{class:"pa-6"},{default:t(()=>[m.value?(n(),v("div",is,[e(Se,{onSubmit:we(E,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12",md:"4"},{default:t(()=>[e(ce,{modelValue:b.value.estimated_cost,"onUpdate:modelValue":w[1]||(w[1]=D=>b.value.estimated_cost=D),modelModifiers:{number:!0},label:a(r)("projects.development_plan.estimated_cost"),type:"number",required:"",disabled:"","model-value":a(R)},null,8,["modelValue","label","model-value"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:b.value.status,"onUpdate:modelValue":w[2]||(w[2]=D=>b.value.status=D),label:a(r)("projects.details.status"),items:[{title:a(r)("projects.status.draft"),value:"draft"},{title:a(r)("projects.status.active"),value:"active"},{title:a(r)("projects.status.archived"),value:"archived"},{title:a(r)("projects.status.completed"),value:"completed"}],required:""},null,8,["modelValue","label","items"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(te,{variant:"outlined"},{default:t(()=>[e(se,{class:"d-flex align-center"},{default:t(()=>[u(l(a(r)("projects.development_plan.version.roles_hours_breakdown"))+" ",1),e(le),e($,{color:"primary",variant:"tonal",size:"small","prepend-icon":"tabler-plus",onClick:N},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.add_role")),1)]),_:1})]),_:1}),e(Z,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(Pe,null,{default:t(()=>[o("thead",null,[o("tr",null,[o("th",ns,l(a(r)("projects.development_plan.version.role")),1),o("th",cs,l(a(r)("projects.development_plan.version.hours")),1),o("th",us,l(a(r)("projects.development_plan.version.rate")),1),o("th",ds,l(a(r)("projects.development_plan.version.cost")),1),ms])]),o("tbody",null,[(n(!0),v(ae,null,de(V.value,(D,F)=>(n(),v("tr",{key:F},[o("td",null,[e(ce,{modelValue:D.role,"onUpdate:modelValue":z=>D.role=z,density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[e(ce,{modelValue:D.hours,"onUpdate:modelValue":[z=>D.hours=z,z=>Q(D)],modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[e(ce,{modelValue:D.rate,"onUpdate:modelValue":[z=>D.rate=z,z=>Q(D)],modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right","model-value":D.rate||30},null,8,["modelValue","onUpdate:modelValue","model-value"])]),o("td",null,[e(ce,{modelValue:D.cost,"onUpdate:modelValue":z=>D.cost=z,modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),o("td",ps,[e($,{icon:"",variant:"text",color:"error",size:"small",onClick:z=>(x=>{V.value.splice(x,1)})(F)},{default:t(()=>[e(q,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128))]),o("tfoot",null,[o("tr",null,[o("td",vs,l(a(r)("projects.development_plan.version.total"))+": ",1),o("td",fs,l(a(R).toLocaleString("en-US",{style:"currency",currency:"USD"})),1),_s])])]),_:1})]),_:1}),e(L,{cols:"12"},{default:t(()=>[a(A)?(n(),h(xe,{key:0,type:"warning",variant:"tonal",class:"mt-4"},{default:t(()=>[u(l(a(r)("projects.development_plan.validation.over_budget",{total:a(R).toLocaleString("en-US",{style:"currency",currency:"USD"}),budget:s.preliminaryBudget.toLocaleString("en-US",{style:"currency",currency:"USD"})})),1)]),_:1})):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:b.value.notes,"onUpdate:modelValue":w[3]||(w[3]=D=>b.value.notes=D),label:a(r)("projects.development_plan.notes"),rows:"4"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),v("div",gs,[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>{return[o("div",ys,[o("div",hs,[e(K,{color:a(je)(s.version.status),size:"small",label:""},{default:t(()=>[u(l(Bt(s.version.status)),1)]),_:1},8,["color"])]),o("div",bs,[o("span",js,l(a(r)("projects.development_plan.version.created"))+": "+l((D=s.version.created_at,D?new Date(parseInt(D)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"")),1),s.version.created_by?(n(),v("span",ks,l(a(r)("projects.development_plan.version.created_by"))+": "+l(s.version.created_by.username),1)):k("",!0)]),o("div",null,[o("h4",xs,l(I(s.version.estimated_cost)),1),o("div",ws,l(a(r)("projects.development_plan.version.estimated_total_cost")),1)])])];var D}),_:1}),e(L,{cols:"12"},{default:t(()=>[a(A)?(n(),h(xe,{key:0,type:"warning",variant:"tonal",class:"mt-4"},{default:t(()=>[u(l(a(r)("projects.development_plan.validation.over_budget",{total:a(R).toLocaleString("en-US",{style:"currency",currency:"USD"}),budget:s.preliminaryBudget.toLocaleString("en-US",{style:"currency",currency:"USD"})})),1)]),_:1})):k("",!0)]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(te,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.development_plan.version.roles_hours_breakdown")),1)]),_:1}),e(Z,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(Pe,null,{default:t(()=>[o("thead",null,[o("tr",null,[o("th",Vs,l(a(r)("projects.development_plan.version.role")),1),o("th",qs,l(a(r)("projects.development_plan.version.hours")),1),o("th",Cs,l(a(r)("projects.development_plan.version.rate")),1),o("th",Ss,l(a(r)("projects.development_plan.version.cost")),1)])]),o("tbody",null,[(n(!0),v(ae,null,de(V.value,(D,F)=>(n(),v("tr",{key:F},[o("td",null,l(D.role),1),o("td",Us,l(D.hours),1),o("td",zs,l(D.rate||30),1),o("td",Is,l(I(D.cost)),1)]))),128)),V.value.length===0?(n(),v("tr",Ds,[o("td",$s,l(a(r)("projects.development_plan.version.no_roles")),1)])):k("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s.version.notes?(n(),h(L,{key:0,cols:"12"},{default:t(()=>[e(te,{variant:"outlined"},{default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.development_plan.notes")),1)]),_:1}),e(Z,null,{default:t(()=>[o("div",Ms,l(s.version.notes),1)]),_:1})]),_:1})]),_:1})):k("",!0)]),_:1})]))]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[m.value?(n(),v(ae,{key:0},[e($,{color:"secondary",variant:"tonal",onClick:X,disabled:S.value},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1},8,["disabled"]),e(le),e($,{color:"primary",onClick:E,loading:S.value},{default:t(()=>[u(l(a(r)("projects.actions.save")),1)]),_:1},8,["loading"])],64)):(n(),v(ae,{key:1},[!s.isCurrent&&s.hasManagerPermission?(n(),h($,{key:0,color:"primary",variant:"tonal",onClick:J,loading:S.value,"prepend-icon":"tabler-check"},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.set_current")),1)]),_:1},8,["loading"])):k("",!0),e(le),s.hasManagerPermission?(n(),h($,{key:1,color:"primary","prepend-icon":"tabler-edit",onClick:X},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.edit")),1)]),_:1})):k("",!0)],64))]),_:1})]),_:1}),e(Ve,{modelValue:C.value.show,"onUpdate:modelValue":w[5]||(w[5]=D=>C.value.show=D),color:C.value.color,timeout:5e3},{actions:t(()=>[e(M,{onClick:w[4]||(w[4]=D=>C.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(C.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-a1b84d78"]]),Bs={class:"text-h5"},Rs={class:"text-subtitle-1 mb-4"},Ls={class:"text-left",style:{"min-width":"200px"}},As={class:"text-right",style:{"min-width":"120px"}},Fs={class:"text-right",style:{"min-width":"120px"}},Os={class:"text-right",style:{"min-width":"120px"}},Ns=o("th",{class:"text-right",style:{width:"50px"}},null,-1),Es={class:"text-right"},Ws={colspan:"3",class:"text-right font-weight-bold"},Ts={class:"text-right font-weight-bold"},Gs=o("td",null,null,-1),Xs={__name:"PlanVersionCreateDialog",props:{modelValue:{type:Boolean,default:!1},planId:{type:String,required:!0},projectId:{type:String,required:!0},currentVersionNumber:{type:Number,default:0},preliminaryBudget:{type:Number,default:0}},emits:["update:modelValue","submit"],setup(s,{emit:c}){const i=s,{t:r}=he(),f=Y({get:()=>i.modelValue,set:T=>c("update:modelValue",T)}),d=j([{role:"Product Manager",hours:60,cost:1800},{role:"System Analyst",hours:40,cost:1e3},{role:"UX/UI Designer",hours:90,cost:2250},{role:"Flutter Developer (Middle)",hours:240,cost:4800},{role:"Backend Developer",hours:120,cost:2400},{role:"QA Engineer",hours:80,cost:1440},{role:"DevOps/Deployment Specialist",hours:20,cost:400},{role:"Support/Documentation Specialist",hours:16,cost:320}]),m=j({estimated_cost:1e4,notes:"",status:"draft"}),b=Y(()=>d.value.reduce((T,N)=>T+N.cost,0)),V=Y(()=>i.preliminaryBudget>0&&b.value>i.preliminaryBudget),S=[T=>!!T||r("projects.development_plan.validation.estimated_cost_required"),T=>!isNaN(parseFloat(T))||r("projects.development_plan.validation.estimated_cost_number")],C=j(null),U=()=>{d.value=[{role:"Product Manager",hours:60,cost:1800},{role:"System Analyst",hours:40,cost:1e3},{role:"UX/UI Designer",hours:90,cost:2250},{role:"Flutter Developer (Middle)",hours:240,cost:4800},{role:"Backend Developer",hours:120,cost:2400},{role:"QA Engineer",hours:80,cost:1440},{role:"DevOps/Deployment Specialist",hours:20,cost:400},{role:"Support/Documentation Specialist",hours:16,cost:320}],m.value={estimated_cost:1e4,notes:"",status:"draft"},C.value&&C.value.resetValidation()},R=()=>{f.value=!1,U()},A=()=>{d.value.push({role:"",hours:0,cost:0})},I=T=>{T.cost=T.hours*(T.rate||30)},X=async()=>{const{valid:T}=await C.value.validate();if(T){const N={...m.value,roles_and_hours:JSON.stringify(d.value),estimated_cost:b.value};c("submit",N),f.value=!1,U()}};return ve(f,T=>{T||U()}),(T,N)=>{const Q=ke("IconBtn");return n(),h(be,{modelValue:a(f),"onUpdate:modelValue":N[3]||(N[3]=E=>De(f)?f.value=E:null),"max-width":"900",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex pt-5 px-5"},{default:t(()=>[o("h5",Bs,l(a(r)("projects.development_plan.actions.new_version")),1),e(le),e(Q,{onClick:R},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),_:1}),e(Z,{class:"px-5 pt-4"},{default:t(()=>[o("p",Rs,l(a(r)("projects.development_plan.creating_version",{version:s.currentVersionNumber+1})),1),e(Se,{ref_key:"formRef",ref:C,onSubmit:we(X,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12",md:"6"},{default:t(()=>[e(ce,{modelValue:m.value.estimated_cost,"onUpdate:modelValue":N[0]||(N[0]=E=>m.value.estimated_cost=E),modelModifiers:{number:!0},label:a(r)("projects.development_plan.estimated_cost"),type:"number",rules:S,required:"",disabled:"","model-value":a(b)},null,8,["modelValue","label","model-value"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:m.value.status,"onUpdate:modelValue":N[1]||(N[1]=E=>m.value.status=E),label:a(r)("projects.details.status"),items:[{title:a(r)("projects.status.draft"),value:"draft"},{title:a(r)("projects.status.active"),value:"active"},{title:a(r)("projects.status.archived"),value:"archived"},{title:a(r)("projects.status.completed"),value:"completed"}],required:""},null,8,["modelValue","label","items"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(te,{variant:"outlined"},{default:t(()=>[e(se,{class:"d-flex align-center"},{default:t(()=>[u(l(a(r)("projects.development_plan.version.roles_hours_breakdown"))+" ",1),e(le),e($,{color:"primary",variant:"tonal",size:"small","prepend-icon":"tabler-plus",onClick:A},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.add_role")),1)]),_:1})]),_:1}),e(Z,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(Pe,null,{default:t(()=>[o("thead",null,[o("tr",null,[o("th",Ls,l(a(r)("projects.development_plan.version.role")),1),o("th",As,l(a(r)("projects.development_plan.version.hours")),1),o("th",Fs,l(a(r)("projects.development_plan.version.rate")),1),o("th",Os,l(a(r)("projects.development_plan.version.cost")),1),Ns])]),o("tbody",null,[(n(!0),v(ae,null,de(d.value,(E,J)=>(n(),v("tr",{key:J},[o("td",null,[e(ce,{modelValue:E.role,"onUpdate:modelValue":W=>E.role=W,density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[e(ce,{modelValue:E.hours,"onUpdate:modelValue":[W=>E.hours=W,W=>I(E)],modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[e(ce,{modelValue:E.rate,"onUpdate:modelValue":[W=>E.rate=W,W=>I(E)],modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right","model-value":E.rate||30},null,8,["modelValue","onUpdate:modelValue","model-value"])]),o("td",null,[e(ce,{modelValue:E.cost,"onUpdate:modelValue":W=>E.cost=W,modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),o("td",Es,[e($,{icon:"",variant:"text",color:"error",size:"small",onClick:W=>(P=>{d.value.splice(P,1)})(J)},{default:t(()=>[e(q,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128))]),o("tfoot",null,[o("tr",null,[o("td",Ws,l(a(r)("projects.development_plan.version.total"))+": ",1),o("td",Ts,l(a(b).toLocaleString("en-US",{style:"currency",currency:"USD"})),1),Gs])])]),_:1})]),_:1}),e(L,{cols:"12"},{default:t(()=>[a(V)?(n(),h(xe,{key:0,type:"warning",variant:"tonal",class:"mt-4"},{default:t(()=>[u(l(a(r)("projects.development_plan.validation.over_budget",{total:a(b).toLocaleString("en-US",{style:"currency",currency:"USD"}),budget:s.preliminaryBudget.toLocaleString("en-US",{style:"currency",currency:"USD"})})),1)]),_:1})):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:m.value.notes,"onUpdate:modelValue":N[2]||(N[2]=E=>m.value.notes=E),label:a(r)("projects.development_plan.notes"),rows:"4"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[e($,{variant:"tonal",color:"secondary",onClick:R},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1}),e(le),e($,{color:"primary",onClick:X},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.create_version")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Hs={key:0,class:"d-flex justify-center align-center",style:{height:"300px"}},Js={key:1,class:"text-center pa-6"},Ks={class:"text-h6 mb-2"},Zs={class:"text-body-1 text-medium-emphasis mb-6"},Qs={key:2},Ys={class:"d-flex flex-column"},eo={class:"text-h6 mb-2"},to={class:"text-h4 font-weight-bold"},ao={class:"text-caption text-medium-emphasis"},lo={class:"text-h6 mb-3"},ro={class:"text-right"},so={class:"text-right"},oo={class:"text-right"},io={class:"text-right"},no={class:"d-flex align-center justify-space-between mb-4"},co={class:"text-h5"},uo={class:"text-right"},mo={class:"text-right"},po=["onClick"],vo={class:"d-flex align-center"},fo={class:"font-weight-medium"},_o={class:"text-right"},go={class:"text-right"},yo={key:1,class:"text-center pa-4"},ho={class:"text-medium-emphasis"},bo={key:2,class:"text-center pa-4"},jo={class:"text-medium-emphasis"},ko={__name:"ProjectDevelopmentPlan",props:{projectId:{type:String,required:!0},developmentPlan:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1},preliminaryBudget:{type:Number,default:0}},emits:["refresh"],setup(s,{emit:c}){const i=s,{t:r}=he(),f=qt(),d=Be(),m=j(null),b=j(!1),V=j(!1),S=j(!1),C=j({show:!1,text:"",color:"success"}),U=Y(()=>d.is_admin()),R=j(!1),A=async()=>{R.value=await d.hasProjectRoleAtLeast(i.projectId,"MANAGER")},I=Y(()=>i.developmentPlan&&i.developmentPlan.id),X=Y(()=>I.value&&i.developmentPlan.versions?[...i.developmentPlan.versions].sort((w,M)=>M.version_number-w.version_number):[]),T=Y(()=>I.value?X.value.find(w=>w.version_number===i.developmentPlan.current_version_number):null),N=w=>w?new Date(parseInt(w)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",Q=w=>w||w===0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(w):"-",E=w=>{m.value=w,b.value=!0},J=()=>{V.value=!0},W=async w=>{S.value=!0;try{const{data:M,error:D}=await f.createPlanVersion(i.developmentPlan.id,w);M&&!D?(P(r("projects.development_plan.notifications.version_created")),c("refresh")):P(r("projects.development_plan.notifications.version_create_failed"),"error")}catch(M){P(r("projects.development_plan.notifications.version_create_failed")+": "+M.message,"error")}finally{S.value=!1,V.value=!1}},P=(w,M="success")=>{C.value={show:!0,text:w,color:M}},B=w=>{if(!w)return[];try{return typeof w=="string"?JSON.parse(w):w}catch(M){return console.error("Error parsing roles and hours:",M),[]}};return A(),ve(()=>i.projectId,()=>{A()}),(w,M)=>{const D=ke("IconBtn");return n(),h(Z,{class:"pa-6"},{default:t(()=>[s.loading?(n(),v("div",Hs,[e(me,{indeterminate:"",color:"primary"})])):a(I)?(n(),v("div",Qs,[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(te,{border:"",class:"mb-4"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:"primary",variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(q,{icon:"tabler-calendar-stats"})]),_:1})]),append:t(()=>[e(K,{color:"primary",size:"small",label:"",class:"me-2"},{default:t(()=>[u(" v"+l(s.developmentPlan.current_version_number),1)]),_:1}),e(K,{color:s.developmentPlan.status==="active"?"success":"warning",size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${s.developmentPlan.status}`)),1)]),_:1},8,["color"])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.development_plan.current_plan")),1)]),_:1})]),_:1}),e(ne),a(T)?(n(),h(Z,{key:0},{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"4"},{default:t(()=>[o("div",Ys,[o("div",eo,l(a(r)("projects.development_plan.estimated_cost")),1),o("div",to,l(Q(a(T).estimated_cost)),1),o("div",ao,l(a(r)("projects.development_plan.version.created"))+": "+l(N(a(T).created_at)),1)])]),_:1}),e(L,{cols:"12",md:"8"},{default:t(()=>[o("div",lo,l(a(r)("projects.development_plan.version.roles_hours_breakdown")),1),e(Pe,{density:"compact"},{default:t(()=>[o("thead",null,[o("tr",null,[o("th",null,l(a(r)("projects.development_plan.version.role")),1),o("th",ro,l(a(r)("projects.development_plan.version.hours")),1),o("th",so,l(a(r)("projects.development_plan.version.cost")),1)])]),o("tbody",null,[(n(!0),v(ae,null,de(B(a(T).roles_and_hours),(F,z)=>(n(),v("tr",{key:z},[o("td",null,l(F.role),1),o("td",oo,l(F.hours),1),o("td",io,l(Q(F.cost)),1)]))),128))])]),_:1}),e($,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:M[0]||(M[0]=F=>E(a(T)))},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.view_details")),1)]),_:1})]),_:1})]),_:1})]),_:1})):k("",!0)]),_:1})]),_:1}),e(L,{cols:"12"},{default:t(()=>[o("div",no,[o("h5",co,l(a(r)("projects.development_plan.version_history")),1),R.value?(n(),h($,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:J,disabled:S.value},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.new_version")),1)]),_:1},8,["disabled"])):k("",!0)]),a(X).length>1?(n(),h(Pe,{key:0},{default:t(()=>[o("thead",null,[o("tr",null,[o("th",null,l(a(r)("projects.development_plan.version.version")),1),o("th",null,l(a(r)("projects.development_plan.version.created")),1),o("th",null,l(a(r)("projects.details.status")),1),o("th",uo,l(a(r)("projects.development_plan.estimated_cost")),1),o("th",mo,l(a(r)("projects.actions.title")),1)])]),o("tbody",null,[(n(!0),v(ae,null,de(a(X),F=>(n(),v("tr",{key:F.id,class:lt({"bg-primary-lighten-5":F.version_number===s.developmentPlan.current_version_number}),style:{cursor:"pointer"},onClick:z=>E(F)},[o("td",null,[o("div",vo,[o("span",fo,"v"+l(F.version_number),1),F.version_number===s.developmentPlan.current_version_number?(n(),h(K,{key:0,color:"primary",size:"x-small",label:"",class:"ms-2"},{default:t(()=>[u(l(a(r)("projects.development_plan.version.current")),1)]),_:1})):k("",!0)])]),o("td",null,l(N(F.created_at)),1),o("td",null,[e(K,{color:F.status==="active"?"success":"warning",size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${F.status}`)),1)]),_:2},1032,["color"])]),o("td",_o,l(Q(F.estimated_cost)),1),o("td",go,[e($,{icon:"",variant:"text",size:"small",color:"primary",onClick:we(z=>E(F),["stop"])},{default:t(()=>[e(q,{icon:"tabler-eye"})]),_:2},1032,["onClick"])])],10,po))),128))])]),_:1})):a(X).length===1?(n(),v("div",yo,[o("p",ho,l(a(r)("projects.development_plan.version.only_one_version")),1)])):(n(),v("div",bo,[o("p",jo,l(a(r)("projects.development_plan.version.no_versions")),1)]))]),_:1})]),_:1})])):(n(),v("div",Js,[e(q,{icon:"tabler-calendar-time",size:"64",color:"secondary",class:"mb-4"}),o("h4",Ks,l(a(r)("projects.development_plan.empty.title")),1),o("p",Zs,l(a(r)("projects.development_plan.empty.description")),1),R.value?(n(),h($,{key:0,color:"primary",onClick:J,loading:S.value},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.create_plan")),1)]),_:1},8,["loading"])):k("",!0)])),m.value?(n(),h(Ps,{key:3,modelValue:b.value,"onUpdate:modelValue":M[1]||(M[1]=F=>b.value=F),version:m.value,"is-current":m.value&&s.developmentPlan&&m.value.version_number===s.developmentPlan.current_version_number,"is-admin":a(U),"has-manager-permission":R.value,"plan-id":s.developmentPlan?s.developmentPlan.id:null,"preliminary-budget":s.preliminaryBudget,"project-id":s.developmentPlan?s.developmentPlan.project:null,onRefresh:M[2]||(M[2]=F=>c("refresh"))},null,8,["modelValue","version","is-current","is-admin","has-manager-permission","plan-id","preliminary-budget","project-id"])):k("",!0),e(Xs,{modelValue:V.value,"onUpdate:modelValue":M[3]||(M[3]=F=>V.value=F),"plan-id":s.developmentPlan?s.developmentPlan.id:null,"current-version-number":s.developmentPlan?s.developmentPlan.current_version_number:0,"preliminary-budget":s.preliminaryBudget,"project-id":s.developmentPlan?s.developmentPlan.project:null,onSubmit:W},null,8,["modelValue","plan-id","current-version-number","preliminary-budget","project-id"]),e(Ve,{modelValue:C.value.show,"onUpdate:modelValue":M[5]||(M[5]=F=>C.value.show=F),color:C.value.color,timeout:5e3},{actions:t(()=>[e(D,{onClick:M[4]||(M[4]=F=>C.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(C.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},xo={key:0,class:"text-h5"},wo={key:1,class:"text-h5"},Vo={key:0},qo={class:"align-center justify-space-between mb-3"},Co={class:"text-subtitle-1 font-weight-medium"},So={key:1,class:"text-medium-emphasis text-center pa-4 rounded bg-grey-lighten-5"},Uo={key:1},zo={class:"d-flex align-center mb-5"},Io={class:"d-flex align-center"},Do={class:"text-medium-emphasis d-flex align-center"},$o={class:"text-caption me-4"},Mo={class:"text-caption"},Po={class:"user-story-format mb-6"},Bo={class:"text-h5 mb-4"},Ro={class:"text-primary"},Lo={class:"text-h5 mb-4"},Ao={class:"text-primary"},Fo={class:"text-h5 mb-4"},Oo={class:"text-primary"},No={key:0},Eo={class:"text-h6 mb-3"},Wo={key:1,class:"text-medium-emphasis text-center pa-4"},To={key:2,class:"mt-6"},Go={key:0,class:"text-center pa-6"},Xo={class:"text-h6 mb-2"},Ho={class:"text-medium-emphasis"},Jo={key:1},Ko={class:"d-flex align-center"},Zo={class:"mockup-preview mb-3"},Qo={class:"overflow-hidden position-relative rounded bg-grey-lighten-4",style:{height:"150px"}},Yo={key:0,class:"d-flex justify-center align-center h-100"},ei={class:"text-center"},ti={class:"text-caption"},ai={key:1,class:"html-preview"},li={key:2,class:"d-flex justify-center align-center h-100"},ri={class:"preview-overlay d-flex justify-center align-center"},si={key:0,class:"mb-2"},oi={class:"d-flex align-center justify-space-between"},ii={class:"d-flex align-center"},ni={class:"text-caption"},ci={key:0,class:"text-center pa-6"},ui={class:"text-h6 mb-2"},di={class:"text-medium-emphasis"},mi={key:1},pi={class:"text-caption"},vi={class:"text-caption text-medium-emphasis"},fi={class:"text-primary"},_i={class:"mb-2"},gi={class:"text-primary"},yi={class:"mb-4"},hi={class:"text-primary"},bi={key:0},ji={class:"text-subtitle-2 font-weight-medium mb-2"},ki={class:"ms-3"},xi={class:"text-caption mt-3"},wi={class:"d-flex justify-end mt-2"},Vi={key:1,class:"text-center pa-6"},qi={class:"text-h6 mb-2"},Ci={class:"text-medium-emphasis"},Si={key:2},Ui={class:"d-flex align-center"},zi={class:"d-flex align-center"},Ii={class:"text-caption text-medium-emphasis ml-2"},Di={class:"comment-text mt-2 whitespace-pre-wrap"},$i={class:"text-body-1 mb-3"},Mi=Ue({__name:"UserStoryDetailsDialog",props:{modelValue:{type:Boolean,default:!1},userStory:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},hasModeratorPermission:{type:Boolean,default:!1}},emits:["update:modelValue","update","delete","regenerate"],setup(s,{emit:c}){const i=s,r=Y({get:()=>i.modelValue,set:y=>c("update:modelValue",y)}),f=ot(),d=Qe(),{t:m}=he(),b=j(0),V=j(!1),S=j({...i.userStory}),C=j(""),U=j(""),R=j(""),A=j(!1),I=j(!1),X=j(null),T=j(!1),N=j({show:!1,text:"",color:"success"}),Q=j(null),E=[{title:m("projects.status.draft"),value:"draft"},{title:m("projects.status.active"),value:"active"},{title:m("projects.status.archived"),value:"archived"},{title:m("projects.status.completed"),value:"completed"}],J=Y(()=>i.userStory.history||[]),W=Y(()=>i.userStory.comments||[]),P=Y(()=>i.userStory.mockups||[]),B=y=>y?(y=parseInt(y),new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",w=()=>{V.value&&(S.value={...i.userStory},C.value=""),V.value=!V.value,b.value="0"},M=()=>{C.value.trim()&&(S.value.acceptance_criteria||(S.value.acceptance_criteria=[]),S.value.acceptance_criteria.push(C.value.trim()),C.value="")},D=()=>{r.value&&!V.value&&f.fetchUserStoryById(i.userStory.id).then(({data:y})=>{y&&Object.assign(i.userStory,y)})};Ce(()=>{Q.value=setInterval(D,5e3)}),Ne(()=>{Q.value&&clearInterval(Q.value)});const F=()=>{c("update",S.value),V.value=!1,r.value=!1},z=()=>{c("delete"),r.value=!1},x=()=>{R.value="",A.value=!0},_=()=>{c("regenerate",R.value),A.value=!1,r.value=!1},ee=async()=>{if(U.value.trim()){I.value=!0;try{const{data:y,error:p}=await f.createComment(i.userStory.id,{text:U.value,status:"active"});if(y&&!p){O("Comment added successfully"),U.value="";const{data:G}=await f.fetchUserStoryById(i.userStory.id);G&&Object.assign(i.userStory,G)}else O("Failed to add comment","error")}catch(y){O("Failed to add comment: "+y.message,"error")}finally{I.value=!1}}},O=(y,p="success")=>{N.value={show:!0,text:y,color:p}};return ve(()=>i.userStory,y=>{S.value={...y}},{deep:!0}),(y,p)=>{const G=ke("IconBtn");return n(),h(be,{modelValue:a(r),"onUpdate:modelValue":p[15]||(p[15]=g=>De(r)?r.value=g:null),"max-width":"900",scrollable:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex pt-5 px-5"},{default:t(()=>[V.value?(n(),v("h5",xo,l(a(m)("projects.user_stories.title.edit")),1)):(n(),v("h5",wo,l(a(m)("projects.user_stories.title.details")),1)),e(le),e(G,{onClick:p[0]||(p[0]=g=>r.value=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),_:1}),e(Z,{class:"pb-0"},{default:t(()=>[e(rt,{modelValue:b.value,"onUpdate:modelValue":p[1]||(p[1]=g=>b.value=g),"slider-color":"primary","align-tabs":"start"},{default:t(()=>[e(ge,{value:"0"},{default:t(()=>[e(q,{size:"18",icon:"tabler-user-check",start:""}),u(" "+l(a(m)("projects.requirements.tabs.details")),1)]),_:1}),e(ge,{value:"1"},{default:t(()=>[e(q,{size:"18",icon:"tabler-photo",start:""}),u(" "+l(a(m)("projects.requirements.tabs.mockups"))+" ",1),a(P).length?(n(),h(K,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(P).length),1)]),_:1})):k("",!0)]),_:1}),e(ge,{value:"2"},{default:t(()=>[e(q,{size:"18",icon:"tabler-history",start:""}),u(" "+l(a(m)("projects.requirements.tabs.history"))+" ",1),a(J).length?(n(),h(K,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(J).length),1)]),_:1})):k("",!0)]),_:1}),e(ge,{value:"3"},{default:t(()=>[e(q,{size:"18",icon:"tabler-messages",start:""}),u(" "+l(a(m)("projects.requirements.tabs.comments"))+" ",1),a(W).length?(n(),h(K,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(W).length),1)]),_:1})):k("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ne),e(Z,{class:"pa-6",style:{"min-height":"400px","max-height":"70vh"}},{default:t(()=>[e(st,{modelValue:b.value,"onUpdate:modelValue":p[8]||(p[8]=g=>b.value=g),class:"mt-5"},{default:t(()=>[e(ye,{value:"0"},{default:t(()=>[V.value?(n(),v("div",Vo,[e(Se,{onSubmit:we(F,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:S.value.role,"onUpdate:modelValue":p[2]||(p[2]=g=>S.value.role=g),label:a(m)("projects.user_stories.fields.role"),required:"",rules:[g=>!!g||a(m)("projects.user_stories.validation.role_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:S.value.action,"onUpdate:modelValue":p[3]||(p[3]=g=>S.value.action=g),label:a(m)("projects.user_stories.fields.action"),required:"",rules:[g=>!!g||a(m)("projects.user_stories.validation.action_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:S.value.benefit,"onUpdate:modelValue":p[4]||(p[4]=g=>S.value.benefit=g),label:a(m)("projects.user_stories.fields.benefit"),required:"",rules:[g=>!!g||a(m)("projects.user_stories.validation.benefit_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:S.value.status,"onUpdate:modelValue":p[5]||(p[5]=g=>S.value.status=g),label:a(m)("projects.user_stories.fields.status"),items:E,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[o("div",qo,[o("div",Co,l(a(m)("projects.user_stories.fields.acceptance_criteria")),1),e(oe,{class:"w-100"},{default:t(()=>[e(L,{cols:"10",sm:"8"},{default:t(()=>[e(ce,{modelValue:C.value,"onUpdate:modelValue":p[6]||(p[6]=g=>C.value=g),placeholder:a(m)("projects.user_stories.fields.add_criterion"),density:"compact","hide-details":"",class:"me-2",onKeyup:ht(M,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1}),e(L,{cols:"2",sm:"4"},{default:t(()=>[e($,{color:"primary",size:"small",disabled:!C.value.trim(),onClick:M},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.add")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),S.value.acceptance_criteria&&S.value.acceptance_criteria.length>0?(n(),h(Ge,{key:0},{default:t(()=>[(n(!0),v(ae,null,de(S.value.acceptance_criteria,(g,re)=>(n(),h(Xe,{key:re},{prepend:t(()=>[e(q,{icon:"tabler-check",color:"success"})]),append:t(()=>[e(G,{color:"error",variant:"text",size:"small",onClick:H=>(ue=>{S.value.acceptance_criteria.splice(ue,1)})(re)},{default:t(()=>[e(q,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick"])]),default:t(()=>[e(He,null,{default:t(()=>[u(l(g),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),v("div",So,l(a(m)("projects.user_stories.empty.acceptance_criteria.description")),1))]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),v("div",Uo,[o("div",zo,[e(K,{color:a(je)(s.userStory.status),size:"small",label:"",class:"me-2"},{default:t(()=>[u(l(a(m)(`projects.status.${s.userStory.status}`)),1)]),_:1},8,["color"]),e(K,{color:"secondary",size:"small",label:"",class:"ms-2"},{default:t(()=>[u(" v"+l(s.userStory.version_number),1)]),_:1})]),o("div",Io,[o("div",Do,[e(q,{size:"18",icon:"tabler-calendar",class:"me-1"}),o("span",$o,l(a(m)("projects.details.updated_at"))+": "+l(B(s.userStory.updated_at)),1),e(q,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),o("span",Mo,l(a(m)("projects.details.created_at"))+": "+l(B(s.userStory.created_at)),1)])]),o("div",Po,[o("div",Bo,[o("span",Ro,l(a(m)("projects.user_stories.fields.role")),1),u(" "+l(s.userStory.role)+", ",1)]),o("div",Lo,[o("span",Ao,l(a(m)("projects.user_stories.fields.action")),1),u(" "+l(s.userStory.action)+", ",1)]),o("div",Fo,[o("span",Oo,l(a(m)("projects.user_stories.fields.benefit")),1),u(" "+l(s.userStory.benefit)+". ",1)])]),e(ne,{class:"mb-4"}),s.userStory.acceptance_criteria&&s.userStory.acceptance_criteria.length>0?(n(),v("div",No,[o("div",Eo,l(a(m)("projects.user_stories.fields.acceptance_criteria")),1),e(Ge,null,{default:t(()=>[(n(!0),v(ae,null,de(s.userStory.acceptance_criteria,(g,re)=>(n(),h(Xe,{key:re,class:"px-0"},{prepend:t(()=>[e(q,{icon:"tabler-check",color:"success",class:"me-2"})]),default:t(()=>[e(He,null,{default:t(()=>[u(l(g),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):(n(),v("div",Wo,l(a(m)("projects.user_stories.empty.acceptance_criteria.description")),1)),s.userStory.generation_status==="in_progress"?(n(),v("div",To,[e(xe,{color:"info",variant:"tonal",icon:"tabler-refresh"},{default:t(()=>[e(kt,null,{default:t(()=>[u(l(a(m)("projects.user_stories.regeneration.title")),1)]),_:1}),o("p",null,l(a(m)("projects.user_stories.regeneration.description")),1)]),_:1})])):k("",!0)]))]),_:1}),e(ye,{value:"1"},{default:t(()=>[a(P).length===0?(n(),v("div",Go,[e(q,{icon:"tabler-photo-off",size:"64",color:"secondary",class:"mb-3"}),o("h4",Xo,l(a(m)("projects.user_stories.mockups.empty.title")),1),o("p",Ho,l(a(m)("projects.user_stories.mockups.empty.description")),1)])):(n(),v("div",Jo,[e(oe,null,{default:t(()=>[(n(!0),v(ae,null,de(a(P),g=>(n(),h(L,{key:g.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(te,{class:"mockup-card h-100",onClick:re=>{X.value=g,T.value=!0},border:"",hover:""},{default:t(()=>[e(fe,null,{append:t(()=>[o("div",Ko,[g.generation_status==="in_progress"||g.generation_status==="pending"||g.needs_regeneration?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):k("",!0),e(K,{color:a(je)(g.status),size:"small",label:""},{default:t(()=>[u(l(a(m)(`projects.status.${g.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(g.name),1)]),_:2},1024)]),_:2},1024),e(ne),e(Z,null,{default:t(()=>[o("div",Zo,[o("div",Qo,[g.generation_status==="in_progress"||g.generation_status==="pending"?(n(),v("div",Yo,[o("div",ei,[e(me,{indeterminate:"",color:"primary",size:"40",class:"mb-2"}),o("div",ti,l(a(m)("projects.mockups.status.generating")),1)])])):g.image?(n(),v("div",ai,[e(Ee,{src:g.image,alt:g.name},null,8,["src","alt"])])):(n(),v("div",li,[e(q,{icon:"tabler-file-code",size:"48",color:"secondary"})])),o("div",ri,[e($,{color:"primary",variant:"elevated",size:"small","prepend-icon":"tabler-eye",disabled:g.generation_status==="in_progress"||g.generation_status==="pending",onClick:re=>(async H=>{const{data:ue}=await d.fetchMockupById(H.id);X.value=ue||H,T.value=!0})(g)},{default:t(()=>[u(l(a(m)("projects.mockups.actions.preview")),1)]),_:2},1032,["disabled","onClick"])])])]),g.needs_regeneration?(n(),v("div",si,[e(K,{color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(m)("projects.mockups.status.regenerating")),1)]),_:1})])):k("",!0),o("div",oi,[o("div",ii,[e(q,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",ni,l(B(g.created_at)),1)])])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]))]),_:1}),e(ye,{value:"2"},{default:t(()=>[a(J).length===0?(n(),v("div",ci,[e(q,{icon:"tabler-history",size:"64",color:"secondary",class:"mb-3"}),o("h4",ui,l(a(m)("projects.user_stories.empty.history.title")),1),o("p",di,l(a(m)("projects.user_stories.empty.history.description")),1)])):(n(),v("div",mi,[e(xt,{density:"compact",align:"start"},{default:t(()=>[(n(!0),v(ae,null,de(a(J),(g,re)=>(n(),h(wt,{key:re,"dot-color":"primary",size:"small"},{opposite:t(()=>[o("div",pi,l(B(g.changed_at)),1),o("div",vi,"v"+l(g.version_number),1)]),default:t(()=>[e(te,{border:""},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:"primary",variant:"tonal",size:"36"},{default:t(()=>[e(q,{icon:"tabler-user-check"})]),_:1})]),append:t(()=>[e(K,{color:a(je)(g.status),size:"small",label:"",class:"ms-2"},{default:t(()=>[u(l(a(m)(`projects.status.${g.status}`)),1)]),_:2},1032,["color"])]),default:t(()=>[e(se,null,{default:t(()=>[o("span",fi,l(a(m)("projects.user_stories.fields.role")),1),u(" "+l(g.role),1)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>[o("p",_i,[o("span",gi,l(a(m)("projects.user_stories.fields.action")),1),u(" "+l(g.action),1)]),o("p",yi,[o("span",hi,l(a(m)("projects.user_stories.fields.benefit")),1),u(" "+l(g.benefit),1)]),g.acceptance_criteria&&g.acceptance_criteria.length>0?(n(),v("div",bi,[o("div",ji,l(a(m)("projects.user_stories.fields.acceptance_criteria"))+": ",1),o("ul",ki,[(n(!0),v(ae,null,de(g.acceptance_criteria,(H,ue)=>(n(),v("li",{key:ue},l(H),1))),128))])])):k("",!0),o("div",xi,l(a(m)("projects.requirements.history.changed_by"))+": "+l(g.changed_by?g.changed_by.username:a(m)("projects.requirements.history.unknown")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1}),e(ye,{value:"3"},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:U.value,"onUpdate:modelValue":p[7]||(p[7]=g=>U.value=g),label:a(m)("projects.requirements.comments.add"),rows:"3",counter:"",disabled:I.value},null,8,["modelValue","label","disabled"]),o("div",wi,[e($,{color:"primary",size:"small",loading:I.value,disabled:!U.value.trim(),onClick:ee},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.add_comment")),1)]),_:1},8,["loading","disabled"])])]),_:1}),e(L,{cols:"12"},{default:t(()=>[a(W).length?(n(),h(ne,{key:0,class:"mb-4"})):k("",!0),a(W).length===0?(n(),v("div",Vi,[e(q,{icon:"tabler-messages",size:"64",color:"secondary",class:"mb-3"}),o("h4",qi,l(a(m)("projects.user_stories.empty.comments.title")),1),o("p",Ci,l(a(m)("projects.user_stories.empty.comments.description")),1)])):(n(),v("div",Si,[(n(!0),v(ae,null,de(a(W),g=>(n(),v("div",{key:g.id,class:"comment-item mb-4"},[e(te,{border:""},{default:t(()=>[e(Z,{class:"py-2"},{default:t(()=>[o("div",Ui,[e(ze,{color:"primary",variant:"tonal",size:"36",class:"me-3"},{default:t(()=>[e(q,{icon:"tabler-user"})]),_:1}),o("div",null,[o("div",zi,[o("strong",null,l(g.user?g.user.username:a(m)("projects.requirements.comments.unknown_user")),1),o("div",Ii,l(B(g.created_at)),1)])]),e(le),s.isAdmin||s.hasManagerPermission?(n(),h(G,{key:0,size:"small",color:"error",variant:"text",onClick:re=>(async H=>{I.value=!0;try{const{success:ue,error:$e}=await f.deleteComment(H);if(ue&&!$e){O("Comment deleted successfully");const{data:Ie}=await f.fetchUserStoryById(i.userStory.id);Ie&&Object.assign(i.userStory,Ie)}else O("Failed to delete comment","error")}catch(ue){O("Failed to delete comment: "+ue.message,"error")}finally{I.value=!1}})(g.id),disabled:I.value},{default:t(()=>[e(q,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick","disabled"])):k("",!0)]),o("div",Di,l(g.text),1)]),_:2},1024)]),_:2},1024)]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[V.value?(n(),v(ae,{key:0},[e($,{color:"secondary",variant:"tonal",onClick:w},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.cancel")),1)]),_:1}),e(le),e($,{color:"primary",onClick:F},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.save")),1)]),_:1})],64)):(n(),v(ae,{key:1},[s.isAdmin?(n(),h($,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:z},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.delete")),1)]),_:1})):k("",!0),s.hasModeratorPermission?(n(),h($,{key:1,color:"info",variant:"tonal","prepend-icon":"tabler-refresh",class:"ms-2",onClick:x},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.regenerate")),1)]),_:1})):k("",!0),e(le),s.hasModeratorPermission?(n(),h($,{key:2,color:"primary","prepend-icon":"tabler-edit",onClick:w},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.edit")),1)]),_:1})):k("",!0)],64))]),_:1})]),_:1}),e(be,{modelValue:A.value,"onUpdate:modelValue":p[11]||(p[11]=g=>A.value=g),"max-width":"600",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"pt-3 pb-0"},{default:t(()=>[u(l(a(m)("projects.user_stories.regeneration.title")),1)]),_:1}),e(Z,null,{default:t(()=>[o("p",$i,l(a(m)("projects.user_stories.regeneration.description")),1),e(qe,{autofocus:"",modelValue:R.value,"onUpdate:modelValue":p[9]||(p[9]=g=>R.value=g),label:a(m)("projects.user_stories.fields.feedback"),hint:a(m)("projects.user_stories.placeholders.feedback"),rows:"4",counter:""},null,8,["modelValue","label","hint"])]),_:1}),e(pe,null,{default:t(()=>[e($,{color:"secondary",variant:"tonal",onClick:p[10]||(p[10]=g=>A.value=!1)},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.cancel")),1)]),_:1}),e(le),e($,{color:"primary",onClick:_},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.regenerate")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),X.value?(n(),h(nt,{key:0,modelValue:T.value,"onUpdate:modelValue":p[12]||(p[12]=g=>T.value=g),mockup:X.value,"is-admin":s.isAdmin,"has-manager-permission":s.hasManagerPermission},null,8,["modelValue","mockup","is-admin","has-manager-permission"])):k("",!0),e(Ve,{modelValue:N.value.show,"onUpdate:modelValue":p[14]||(p[14]=g=>N.value.show=g),color:N.value.color,timeout:5e3},{actions:t(()=>[e(G,{onClick:p[13]||(p[13]=g=>N.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(N.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-218a410a"]]),Pi={class:"text-h5"},Bi={class:"text-subtitle-1 font-weight-medium"},Ri={class:"d-flex align-center justify-space-between mb-3"},Li={key:1,class:"text-medium-emphasis text-center pa-4 rounded bg-grey-lighten-5"},Ai={__name:"UserStoryCreateDialog",props:{modelValue:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},userStoryData:{type:Object,default:()=>({})}},emits:["update:modelValue","submit"],setup(s,{emit:c}){const i=s,{t:r}=he(),f=Y({get:()=>i.modelValue,set:T=>c("update:modelValue",T)}),d=j({role:i.editMode&&i.userStoryData?i.userStoryData.role:"",action:i.editMode&&i.userStoryData?i.userStoryData.action:"",benefit:i.editMode&&i.userStoryData?i.userStoryData.benefit:"",acceptance_criteria:i.editMode&&i.userStoryData?[...i.userStoryData.acceptance_criteria]:[],status:i.editMode&&i.userStoryData?i.userStoryData.status:"draft"}),m=j(""),b=j(null),V=[T=>!!T||r("projects.user_stories.validation.role_required")],S=[T=>!!T||r("projects.user_stories.validation.action_required")],C=[T=>!!T||r("projects.user_stories.validation.benefit_required")],U=[{title:r("projects.status.draft"),value:"draft"},{title:r("projects.status.active"),value:"active"},{title:r("projects.status.archived"),value:"archived"},{title:r("projects.status.completed"),value:"completed"}],R=()=>{m.value.trim()&&(d.value.acceptance_criteria||(d.value.acceptance_criteria=[]),d.value.acceptance_criteria.push(m.value.trim()),m.value="")},A=()=>{d.value={role:"",action:"",benefit:"",acceptance_criteria:[],status:"draft"},m.value="",b.value&&b.value.resetValidation()},I=()=>{f.value=!1,A()},X=async()=>{const{valid:T}=await b.value.validate();T&&(c("submit",d.value),f.value=!1,A())};return ve(f,T=>{T||A()}),(T,N)=>{const Q=ke("IconBtn");return n(),h(be,{modelValue:a(f),"onUpdate:modelValue":N[5]||(N[5]=E=>De(f)?f.value=E:null),"max-width":"700",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex pt-5 px-5"},{default:t(()=>[o("h5",Pi,l(i.editMode?a(r)("projects.user_stories.title.edit"):a(r)("projects.user_stories.title.create")),1),e(le),e(Q,{onClick:I},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),_:1}),e(Z,{class:"px-5 pt-4"},{default:t(()=>[e(Se,{ref_key:"formRef",ref:b,onSubmit:we(X,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:d.value.role,"onUpdate:modelValue":N[0]||(N[0]=E=>d.value.role=E),label:a(r)("projects.user_stories.fields.role"),rules:V,placeholder:a(r)("projects.user_stories.placeholders.role"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:d.value.action,"onUpdate:modelValue":N[1]||(N[1]=E=>d.value.action=E),label:a(r)("projects.user_stories.fields.action"),rules:S,placeholder:a(r)("projects.user_stories.placeholders.action"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:d.value.benefit,"onUpdate:modelValue":N[2]||(N[2]=E=>d.value.benefit=E),label:a(r)("projects.user_stories.fields.benefit"),rules:C,placeholder:a(r)("projects.user_stories.placeholders.benefit"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:d.value.status,"onUpdate:modelValue":N[3]||(N[3]=E=>d.value.status=E),label:a(r)("projects.user_stories.fields.status"),items:U,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[o("div",Bi,l(a(r)("projects.user_stories.fields.acceptance_criteria")),1),o("div",Ri,[e(oe,{class:"w-100"},{default:t(()=>[e(L,{cols:"10",sm:"8"},{default:t(()=>[e(ce,{modelValue:m.value,"onUpdate:modelValue":N[4]||(N[4]=E=>m.value=E),placeholder:a(r)("projects.user_stories.fields.add_criterion"),density:"compact","hide-details":"",class:"me-2",onKeyup:ht(R,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1}),e(L,{cols:"2",sm:"4"},{default:t(()=>[e($,{color:"primary",size:"small",disabled:!m.value.trim(),onClick:R},{default:t(()=>[u(l(a(r)("projects.user_stories.actions.add")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),d.value.acceptance_criteria&&d.value.acceptance_criteria.length>0?(n(),h(Ge,{key:0},{default:t(()=>[(n(!0),v(ae,null,de(d.value.acceptance_criteria,(E,J)=>(n(),h(Xe,{key:J},{prepend:t(()=>[e(q,{icon:"tabler-check",color:"success"})]),append:t(()=>[e(Q,{color:"error",variant:"text",size:"small",onClick:W=>(P=>{d.value.acceptance_criteria.splice(P,1)})(J)},{default:t(()=>[e(q,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick"])]),default:t(()=>[e(He,null,{default:t(()=>[u(l(E),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),v("div",Li,l(a(r)("projects.user_stories.empty.acceptance_criteria.description")),1))]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[e($,{variant:"tonal",color:"secondary",onClick:I},{default:t(()=>[u(l(a(r)("projects.user_stories.actions.cancel")),1)]),_:1}),e(le),e($,{color:"primary",onClick:X},{default:t(()=>[u(l(i.editMode?a(r)("projects.user_stories.actions.save"):a(r)("projects.user_stories.actions.create")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Fi={key:0,class:"mb-4"},Oi={key:1,class:"d-flex justify-center align-center",style:{height:"300px"}},Ni={key:2,class:"text-center pa-4"},Ei={class:"text-h6 mb-2"},Wi={class:"text-body-1 text-medium-emphasis mb-6"},Ti={class:"d-flex align-center"},Gi={class:"text-body-1 mb-2"},Xi={class:"font-weight-medium text-primary"},Hi={class:"text-body-1 mb-4"},Ji={class:"font-weight-medium text-primary"},Ki={key:0},Zi={class:"text-subtitle-2 font-weight-medium mb-2 text-primary"},Qi={class:"ml-4"},Yi={key:0},en={class:"d-flex align-center justify-space-between mt-3"},tn={class:"d-flex align-center"},an={class:"text-caption"},ln={class:"d-flex align-center"},rn={class:"text-caption"},sn=Ue({__name:"UserStoriesList",props:{projectId:{type:String,required:!0},requirementId:{type:String,required:!1,default:null},userStories:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(s,{emit:c}){const i=s,r=ot(),f=Be(),{t:d}=he(),m=j(""),b=j(["draft","active","completed"]),V=j(null),S=j(!1),C=j(!1),U=j(!1),R=j(!1),A=j({show:!1,text:"",color:"success"}),I=Te(),X=Y(()=>f.is_admin()),T=j(!1),N=j(!1),Q=j(!1),E=[{title:d("projects.status.draft"),value:"draft"},{title:d("projects.status.active"),value:"active"},{title:d("projects.status.archived"),value:"archived"},{title:d("projects.status.completed"),value:"completed"}],J=Y(()=>i.userStories.filter(x=>{const _=!m.value||x.role.toLowerCase().includes(m.value.toLowerCase())||x.action.toLowerCase().includes(m.value.toLowerCase())||x.benefit.toLowerCase().includes(m.value.toLowerCase()),ee=b.value.includes(x.status);return _&&ee})),W=Y(()=>i.userStories.some(x=>x.generation_status==="in_progress"||x.generation_status==="pending")),P=()=>{C.value=!0},B=async x=>{R.value=!0;try{const{data:_,error:ee}=await r.createUserStory({...x,requirement:i.requirementId});_&&!ee?(F("User story created successfully"),c("refresh")):F("Failed to create user story","error")}catch(_){F("Failed to create user story: "+_.message,"error")}finally{R.value=!1}},w=async x=>{R.value=!0;try{const{data:_,error:ee}=await r.updateUserStory(V.value.id,x);_&&!ee?(F("User story updated successfully"),c("refresh")):F("Failed to update user story","error")}catch(_){F("Failed to update user story: "+_.message,"error")}finally{R.value=!1}},M=async()=>{if(V.value){R.value=!0,U.value=!1;try{const{success:x,error:_}=await r.deleteUserStory(V.value.id);x&&!_?(F("User story deleted successfully"),c("refresh"),S.value=!1):F("Failed to delete user story","error")}catch(x){F("Failed to delete user story: "+x.message,"error")}finally{R.value=!1}}},D=async(x="")=>{if(V.value){R.value=!0;try{const{data:_,error:ee}=await r.regenerateUserStory(V.value.id,x);_&&!ee?(F("User story regeneration started"),setTimeout(()=>{c("refresh")},3e3)):F("Failed to regenerate user story","error")}catch(_){F("Failed to regenerate user story: "+_.message,"error")}finally{R.value=!1}}},F=(x,_="success")=>{A.value={show:!0,text:x,color:_}},z=async()=>{T.value=await f.hasProjectRoleAtLeast(i.projectId,"MANAGER"),N.value=await f.hasProjectRoleAtLeast(i.projectId,"ADMIN"),Q.value=await f.hasProjectWriteAccess(i.projectId)};return Ce(()=>{z(),!i.requirementId||i.userStories.length||i.loading||r.fetchUserStories(i.requirementId).then(({data:x})=>{x&&c("refresh")}),I.on("project-refresh",()=>{r.fetchUserStories(i.requirementId,{silent:!0}).then(({data:x})=>{x&&c("refresh")})})}),ve(S,x=>{x?I.on("project-refresh",async()=>{if(V.value){const{data:_}=await r.fetchUserStoryById(V.value.id);_&&(V.value=_)}}):I.off("project-refresh")}),ve(()=>i.projectId,()=>{z()}),(x,_)=>{const ee=We,O=ke("IconBtn");return n(),h(Z,{class:"pa-6"},{default:t(()=>[a(W)?(n(),v("div",Fi,[e(xe,{type:"info",variant:"tonal",border:"start",class:"d-flex align-center"},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"24",class:"me-3"}),o("span",null,l(a(d)("projects.user_stories.regeneration.title")),1)]),_:1})])):k("",!0),e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"6"},{default:t(()=>[e(ce,{modelValue:m.value,"onUpdate:modelValue":_[0]||(_[0]=y=>m.value=y),density:"compact",placeholder:a(d)("projects.user_stories.actions.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:b.value,"onUpdate:modelValue":_[1]||(_[1]=y=>b.value=y),items:E,density:"compact","hide-details":"",label:a(d)("projects.user_stories.fields.status"),variant:"outlined",multiple:"",chips:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[N.value&&s.requirementId?(n(),h($,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:P,loading:R.value,block:""},{default:t(()=>[u(l(a(d)("projects.user_stories.actions.add")),1)]),_:1},8,["loading"])):k("",!0)]),_:1})]),_:1}),e(ne,{class:"my-5"}),s.loading?(n(),v("div",Oi,[e(me,{indeterminate:"",color:"primary"})])):a(J).length===0?(n(),v("div",Ni,[e(q,{icon:"tabler-notebook",size:"64",color:"secondary",class:"mb-4"}),o("h4",Ei,l(a(d)("projects.user_stories.empty.title")),1),o("p",Wi,l(m.value||b.value.length>0?a(d)("projects.user_stories.empty.filtered"):a(d)("projects.user_stories.empty.description")),1),N.value&&s.requirementId&&!m.value&&b.value.length===0?(n(),h($,{key:0,color:"primary",onClick:P,"prepend-icon":"tabler-plus"},{default:t(()=>[u(l(a(d)("projects.user_stories.actions.create")),1)]),_:1})):k("",!0)])):(n(),h(oe,{key:3},{default:t(()=>[(n(!0),v(ae,null,de(a(J),y=>(n(),h(L,{key:y.id,cols:"12",md:"6"},{default:t(()=>[e(te,{class:"user-story-card h-100 d-flex flex-column",onClick:p=>(async G=>{const{data:g}=await r.fetchUserStoryById(G.id);V.value=g||G,S.value=!0})(y),border:"",hover:""},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:"primary",variant:"tonal",size:"42"},{default:t(()=>[e(q,{icon:"tabler-user-check"})]),_:1})]),append:t(()=>[o("div",Ti,[y.generation_status==="in_progress"||y.generation_status==="pending"?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):k("",!0),y.generation_status==="pending"?(n(),h(K,{key:1,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(d)("projects.user_stories.regeneration.title")),1)]),_:1})):k("",!0),e(K,{color:a(je)(y.status),size:"small",label:""},{default:t(()=>[u(l(x.$t(`projects.status.${y.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(d)("projects.user_stories.fields.role"))+" "+l(y.role),1)]),_:2},1024)]),_:2},1024),e(Z,{class:"d-flex flex-column"},{default:t(()=>{return[o("p",Gi,[o("span",Xi,l(a(d)("projects.user_stories.fields.action"))+":",1),u(" "+l(y.action),1)]),o("p",Hi,[o("span",Ji,l(a(d)("projects.user_stories.fields.benefit"))+":",1),u(" "+l(y.benefit),1)]),y.acceptance_criteria&&y.acceptance_criteria.length>0?(n(),v("div",Ki,[o("div",Zi,l(a(d)("projects.user_stories.fields.acceptance_criteria"))+":",1),o("ul",Qi,[(n(!0),v(ae,null,de(y.acceptance_criteria.slice(0,2),(G,g)=>(n(),v("li",{key:g},l(G),1))),128)),y.acceptance_criteria.length>2?(n(),v("li",Yi,l(a(d)("projects.user_stories.and_more",{count:y.acceptance_criteria.length-2})),1)):k("",!0)])])):k("",!0),e(le),o("div",en,[o("div",tn,[e(q,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",an,l((p=y.updated_at,p?(p=parseInt(p),new Date(p).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})):"")),1)]),o("div",ln,[e(q,{size:"16",icon:"tabler-history",class:"me-1"}),o("span",rn,"v"+l(y.version_number),1)])])];var p}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),V.value?(n(),h(Mi,{key:4,modelValue:S.value,"onUpdate:modelValue":_[2]||(_[2]=y=>S.value=y),"user-story":V.value,onDelete:_[3]||(_[3]=y=>U.value=!0),onUpdate:w,onRegenerate:D,"is-admin":a(X),"has-manager-permission":T.value,"has-moderator-permission":N.value},null,8,["modelValue","user-story","is-admin","has-manager-permission","has-moderator-permission"])):k("",!0),e(Ai,{modelValue:C.value,"onUpdate:modelValue":_[4]||(_[4]=y=>C.value=y),onSubmit:B},null,8,["modelValue"]),e(ee,{isDialogVisible:U.value,"onUpdate:isDialogVisible":_[5]||(_[5]=y=>U.value=y),confirmationMsg:a(d)("projects.user_stories.delete_confirm.message"),onConfirm:M},null,8,["isDialogVisible","confirmationMsg"]),e(Ve,{modelValue:A.value.show,"onUpdate:modelValue":_[7]||(_[7]=y=>A.value.show=y),color:A.value.color,timeout:5e3},{actions:t(()=>[e(O,{onClick:_[6]||(_[6]=y=>A.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(A.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},[["__scopeId","data-v-a1c18f3d"]]),on={key:0,class:"text-h5"},nn={class:"text-h5"},cn={key:0},un={class:"text-subtitle-1 font-weight-medium mb-2"},dn={class:"bg-grey-lighten-5 rounded pa-3"},mn={class:"text-medium-emphasis text-caption mb-2"},pn={key:1},vn={key:0,class:"pa-5"},fn={class:"d-flex justify-center my-8"},_n={class:"d-flex align-center justify-center text-medium-emphasis"},gn={class:"text-caption me-4"},yn={class:"text-caption"},hn={key:1,class:"diagram-content pa-0"},bn={class:"diagram-metadata d-flex align-center px-6 py-3"},jn={key:0,class:"ms-2"},kn={class:"text-medium-emphasis d-flex align-center"},xn={class:"text-caption me-4"},wn={class:"text-caption"},Vn={key:2,class:"d-flex flex-column justify-center align-center pa-6",style:{height:"400px"}},qn={class:"text-h6 mb-2"},Cn={class:"text-medium-emphasis text-center"},Sn=Ue({__name:"UmlDiagramDetailsDialog",props:{modelValue:{type:Boolean,default:!1},diagram:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},hasModeratorPermission:{type:Boolean,default:!1}},emits:["update:modelValue","delete","regenerate"],setup(s,{emit:c}){const i=s,r=Y({get:()=>i.modelValue,set:W=>c("update:modelValue",W)}),f=it(),d=j(!1),m=j(!1),b=j({...i.diagram}),V=j(!1),S=j({show:!1,text:"",color:"success"}),{t:C}=he(),U=[{title:C("projects.status.draft"),value:"draft"},{title:C("projects.status.active"),value:"active"},{title:C("projects.status.archived"),value:"archived"},{title:C("projects.status.completed"),value:"completed"}],R=W=>W?(W=parseInt(W),new Date(W).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",A=()=>{d.value=!d.value},I=()=>{m.value&&(b.value={...i.diagram}),m.value=!m.value},X=j(null),T=()=>{r.value&&f.fetchDiagramById(i.diagram.id).then(({data:W})=>{W&&Object.assign(i.diagram,W)})};Ce(()=>{X.value=setInterval(T,5e3)}),Ne(()=>{X.value&&clearInterval(X.value)});const N=async()=>{V.value=!0;try{const{data:W,error:P}=await f.updateDiagram(i.diagram.id,b.value);W&&!P?(J(C("projects.uml_diagrams.notifications.updated")),Object.assign(i.diagram,W),m.value=!1,r.value=!1):J(C("projects.uml_diagrams.notifications.update_failed"),"error")}catch(W){J(C("projects.uml_diagrams.notifications.update_failed")+": "+W.message,"error")}finally{V.value=!1}},Q=()=>{c("delete"),r.value=!1},E=async()=>{V.value=!0;try{const{data:W,error:P}=await f.regenerateDiagram(i.diagram.id);W&&!P?(J(C("projects.uml_diagrams.notifications.regeneration_started")),r.value=!1,setTimeout(()=>{c("regenerate")},3e3)):J(C("projects.uml_diagrams.notifications.regeneration_failed"),"error")}catch(W){J(C("projects.uml_diagrams.notifications.regeneration_failed")+": "+W.message,"error")}finally{V.value=!1}},J=(W,P="success")=>{S.value={show:!0,text:W,color:P}};return ve(()=>i.diagram,W=>{b.value={...W}},{deep:!0}),(W,P)=>{const B=ke("IconBtn");return n(),h(be,{modelValue:a(r),"onUpdate:modelValue":P[7]||(P[7]=w=>De(r)?r.value=w:null),fullscreen:d.value,"max-width":d.value?"100%":"900",scrollable:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex py-3 px-5"},{default:t(()=>[m.value?(n(),v("h5",on,l(a(C)("projects.uml_diagrams.actions.edit")),1)):(n(),v(ae,{key:1},[o("h5",nn,l(s.diagram.name),1),e(K,{class:"ms-2",color:"secondary",size:"small",label:""},{default:t(()=>[u(l(a(C)(`projects.uml_diagrams.types.${s.diagram.diagram_type}`)),1)]),_:1})],64)),e(le),e($,{icon:"",variant:"text",onClick:A},{default:t(()=>[e(q,{icon:d.value?"tabler-minimize":"tabler-maximize"},null,8,["icon"])]),_:1}),e(B,{onClick:P[0]||(P[0]=w=>r.value=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),_:1}),e(ne),e(Z,{class:lt({"pa-0":!m.value&&s.diagram.content,"pa-6":m.value||!s.diagram.content}),style:Re({height:d.value?"calc(100vh - 120px)":"70vh",maxHeight:"800px"})},{default:t(()=>[m.value?(n(),v("div",cn,[e(Se,{onSubmit:we(N,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:b.value.name,"onUpdate:modelValue":P[1]||(P[1]=w=>b.value.name=w),label:a(C)("projects.uml_diagrams.name"),required:"",rules:[w=>!!w||a(C)("projects.uml_diagrams.validation.name_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:b.value.status,"onUpdate:modelValue":P[2]||(P[2]=w=>b.value.status=w),label:a(C)("projects.uml_diagrams.status.title"),items:U,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:b.value.notes,"onUpdate:modelValue":P[3]||(P[3]=w=>b.value.notes=w),label:a(C)("projects.uml_diagrams.notes"),rows:"4"},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[o("div",un,l(a(C)("projects.uml_diagrams.content")),1),o("div",dn,[o("div",mn,l(a(C)("projects.uml_diagrams.content_hint")),1),e(qe,{modelValue:b.value.content,"onUpdate:modelValue":P[4]||(P[4]=w=>b.value.content=w),rows:"15",monospace:"","hide-details":""},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),v("div",pn,[s.diagram.generation_status==="in_progress"?(n(),v("div",vn,[e(xe,{color:"info",variant:"tonal",icon:"tabler-refresh"},{default:t(()=>[e(kt,null,{default:t(()=>[u(l(a(C)("projects.uml_diagrams.status.generating")),1)]),_:1}),o("p",null,l(a(C)("projects.uml_diagrams.status.generating_description")),1)]),_:1}),o("div",fn,[e(me,{indeterminate:"",color:"primary",size:"64"})]),o("div",_n,[e(q,{size:"18",icon:"tabler-calendar",class:"me-1"}),o("span",gn,l(a(C)("projects.details.updated_at"))+": "+l(R(s.diagram.updated_at)),1),e(q,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),o("span",yn,l(a(C)("projects.details.created_at"))+": "+l(R(s.diagram.created_at)),1)])])):s.diagram.content?(n(),v("div",hn,[o("div",bn,[e(K,{color:a(je)(s.diagram.status),size:"small",label:"",class:"me-2"},{default:t(()=>[u(l(a(C)(`projects.status.${s.diagram.status}`)),1)]),_:1},8,["color"]),s.diagram.notes?(n(),v("div",jn,[e(Gt,null,{activator:t(({props:w})=>[e(q,bt({icon:"tabler-info-circle",size:"18",color:"info"},w),null,16)]),default:t(()=>[o("span",null,l(s.diagram.notes),1)]),_:1})])):k("",!0),e(le),o("div",kn,[e(q,{size:"18",icon:"tabler-calendar",class:"me-1"}),o("span",xn,l(a(C)("projects.details.updated_at"))+": "+l(R(s.diagram.updated_at)),1),e(q,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),o("span",wn,l(a(C)("projects.details.created_at"))+": "+l(R(s.diagram.created_at)),1)])]),e(ne),o("div",{class:"diagram-svg-container pa-4 d-flex justify-center align-center",style:Re({height:d.value?"calc(100vh - 180px)":"calc(70vh - 110px)",overflow:"auto"})},[s.diagram.content?(n(),h(Ee,{key:0,src:a(jt)(s.diagram.content),class:"diagram-svg",alt:"Generated Diagram"},null,8,["src"])):k("",!0)],4)])):(n(),v("div",Vn,[e(q,{icon:"tabler-chart-dots-2",size:"64",color:"secondary",class:"mb-4"}),o("h4",qn,l(a(C)("projects.uml_diagrams.status.no_content.title")),1),o("p",Cn,l(a(C)("projects.uml_diagrams.status.no_content.description")),1)]))]))]),_:1},8,["class","style"]),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[m.value?(n(),v(ae,{key:0},[e($,{color:"secondary",variant:"tonal",onClick:I,disabled:V.value},{default:t(()=>[u(l(a(C)("projects.actions.cancel")),1)]),_:1},8,["disabled"]),e(le),e($,{color:"primary",onClick:N,loading:V.value},{default:t(()=>[u(l(a(C)("projects.actions.save")),1)]),_:1},8,["loading"])],64)):(n(),v(ae,{key:1},[s.isAdmin?(n(),h($,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:Q},{default:t(()=>[u(l(a(C)("projects.uml_diagrams.actions.delete")),1)]),_:1})):k("",!0),s.hasModeratorPermission?(n(),h($,{key:1,color:"info",variant:"tonal","prepend-icon":"tabler-refresh",class:"ms-2",onClick:E,loading:V.value},{default:t(()=>[u(l(a(C)("projects.uml_diagrams.actions.regenerate")),1)]),_:1},8,["loading"])):k("",!0),e(le),s.hasModeratorPermission?(n(),h($,{key:2,color:"primary","prepend-icon":"tabler-edit",onClick:I},{default:t(()=>[u(l(a(C)("projects.uml_diagrams.actions.edit")),1)]),_:1})):k("",!0)],64))]),_:1})]),_:1}),e(Ve,{modelValue:S.value.show,"onUpdate:modelValue":P[6]||(P[6]=w=>S.value.show=w),color:S.value.color,timeout:5e3},{actions:t(()=>[e(B,{onClick:P[5]||(P[5]=w=>S.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(S.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue","fullscreen","max-width"])}}},[["__scopeId","data-v-036dfd63"]]),Un={key:0,class:"mb-4"},zn={key:1,class:"d-flex justify-center align-center",style:{height:"300px"}},In={key:2,class:"text-center pa-4"},Dn={class:"text-h6 mb-2"},$n={class:"text-body-1 text-medium-emphasis mb-6"},Mn={class:"d-flex align-center"},Pn={class:"mb-3 d-flex align-center"},Bn={class:"diagram-preview mb-3"},Rn={class:"overflow-hidden position-relative rounded bg-grey-lighten-4",style:{height:"150px"}},Ln={class:"d-flex justify-center align-center h-100"},An={key:0,class:"text-center pa-2"},Fn={class:"text-caption"},On={key:1,class:"diagram-thumbnail pa-2"},Nn={key:2,class:"text-center"},En={class:"text-caption mt-2"},Wn={class:"preview-overlay d-flex justify-center align-center"},Tn={class:"d-flex align-center justify-space-between"},Gn={class:"d-flex align-center"},Xn={class:"text-caption"},Hn={class:"text-body-1 mb-4"},Jn=Ue({__name:"UmlDiagramList",props:{projectId:{type:String,required:!0},diagrams:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(s,{emit:c}){const i=s,r=it(),f=Be(),{t:d}=he(),m=j(""),b=j("all"),V=j(null),S=j(!1),C=j(!1),U=j(!1),R=j(!1),A=j({show:!1,text:"",color:"success"}),I=Y(()=>f.is_admin()),X=j(!1),T=j(!1),N=async()=>{X.value=await f.hasProjectRoleAtLeast(i.projectId,"MANAGER"),T.value=await f.hasProjectRoleAtLeast(i.projectId,"ADMIN")},Q=[{title:d("projects.uml_diagrams.types.all"),value:"all"},{title:d("projects.uml_diagrams.types.class"),value:"class"},{title:d("projects.uml_diagrams.types.sequence"),value:"sequence"},{title:d("projects.uml_diagrams.types.activity"),value:"activity"},{title:d("projects.uml_diagrams.types.usecase"),value:"use_case"},{title:d("projects.uml_diagrams.types.state"),value:"state"},{title:d("projects.uml_diagrams.types.component"),value:"component"},{title:d("projects.uml_diagrams.types.deployment"),value:"deployment"},{title:d("projects.uml_diagrams.types.er"),value:"er"}],E=j("class"),J=Y(()=>i.diagrams.filter(x=>{const _=!m.value||x.name.toLowerCase().includes(m.value.toLowerCase())||x.diagram_type.toLowerCase().includes(m.value.toLowerCase()),ee=b.value==="all"||x.diagram_type.toLowerCase()===b.value.toLowerCase();return _&&ee})),W=Y(()=>i.diagrams.some(x=>x.generation_status==="in_progress"||x.generation_status==="pending")),P=Te(),B=()=>{E.value="class",U.value=!0},w=async()=>{U.value=!1,R.value=!0;try{const{data:x,error:_}=await r.generateDiagrams(i.projectId,E.value);x&&!_?(D(d("projects.uml_diagrams.notifications.generation_started")),setTimeout(()=>{c("refresh")},3e3)):D(d("projects.uml_diagrams.notifications.generation_failed"),"error")}catch(x){D(d("projects.uml_diagrams.notifications.generation_failed")+": "+x.message,"error")}finally{R.value=!1}},M=async()=>{if(V.value){R.value=!0,C.value=!1;try{const{success:x,error:_}=await r.deleteDiagram(V.value.id);x&&!_?(D(d("projects.uml_diagrams.notifications.delete_success")),c("refresh"),S.value=!1):D(d("projects.uml_diagrams.notifications.delete_failed"),"error")}catch(x){D(d("projects.uml_diagrams.notifications.delete_failed")+": "+x.message,"error")}finally{R.value=!1}}},D=(x,_="success")=>{A.value={show:!0,text:x,color:_}},F=x=>{switch(x.toLowerCase()){case"all":default:return"tabler-chart-dots";case"class":return"tabler-box";case"sequence":return"tabler-arrow-right-square";case"activity":return"tabler-activity";case"usecase":return"tabler-user-check";case"state":return"tabler-circle-check";case"component":return"tabler-puzzle";case"deployment":return"tabler-server";case"er":return"tabler-database"}},z=x=>{switch(x.toLowerCase()){case"all":return d("projects.uml_diagrams.types.all");case"class":return d("projects.uml_diagrams.types.class");case"sequence":return d("projects.uml_diagrams.types.sequence");case"activity":return d("projects.uml_diagrams.types.activity");case"usecase":return d("projects.uml_diagrams.types.usecase");case"state":return d("projects.uml_diagrams.types.state");case"component":return d("projects.uml_diagrams.types.component");case"deployment":return d("projects.uml_diagrams.types.deployment");case"er":return d("projects.uml_diagrams.types.er");default:return x.charAt(0).toUpperCase()+x.slice(1)+" "+d("projects.uml_diagrams.types.diagram")}};return Ce(()=>{N(),P.on("project-refresh",()=>{r.fetchDiagrams(i.projectId,{silent:!0}).then(({data:x})=>{x&&c("refresh")})})}),ve(S,x=>{x?P.on("project-refresh",async()=>{if(V.value){const{data:_}=await r.fetchDiagramById(V.value.id);_&&(V.value=_)}}):P.off("project-refresh")}),ve(()=>i.projectId,()=>{N()}),(x,_)=>{const ee=We,O=ke("IconBtn");return n(),h(Z,{class:"pa-6"},{default:t(()=>[a(W)?(n(),v("div",Un,[e(xe,{type:"info",variant:"tonal",border:"start",class:"d-flex align-center"},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"24",class:"me-3"}),o("span",null,l(a(d)("projects.uml_diagrams.status.generating")),1)]),_:1})])):k("",!0),e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"4"},{default:t(()=>[e(ce,{modelValue:m.value,"onUpdate:modelValue":_[0]||(_[0]=y=>m.value=y),density:"compact",placeholder:a(d)("projects.uml_diagrams.actions.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:b.value,"onUpdate:modelValue":_[1]||(_[1]=y=>b.value=y),items:Q,density:"compact","hide-details":"",label:a(d)("projects.uml_diagrams.type"),variant:"outlined"},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"4",class:"d-flex align-center"},{default:t(()=>[T.value?(n(),h($,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:B,loading:R.value,block:""},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.actions.generate")),1)]),_:1},8,["loading"])):k("",!0)]),_:1})]),_:1}),e(ne,{class:"my-5"}),s.loading?(n(),v("div",zn,[e(me,{indeterminate:"",color:"primary"})])):a(J).length===0?(n(),v("div",In,[e(q,{icon:"tabler-chart-dots",size:"64",color:"secondary",class:"mb-4"}),o("h4",Dn,l(a(d)("projects.uml_diagrams.empty.title")),1),o("p",$n,l(m.value||b.value!=="all"?a(d)("projects.uml_diagrams.empty.filtered"):a(d)("projects.uml_diagrams.empty.description")),1),T.value&&!m.value&&b.value==="all"?(n(),h($,{key:0,color:"primary",onClick:B,"prepend-icon":"tabler-plus"},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.actions.generate")),1)]),_:1})):k("",!0)])):(n(),h(oe,{key:3},{default:t(()=>[(n(!0),v(ae,null,de(a(J),y=>(n(),h(L,{key:y.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(te,{class:"diagram-card h-100",onClick:p=>(async G=>{const{data:g}=await r.fetchDiagramById(G.id);V.value=g||G,S.value=!0})(y),border:"",hover:""},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:"primary",variant:"tonal",size:"42"},{default:t(()=>[e(q,{icon:F(y.diagram_type)},null,8,["icon"])]),_:2},1024)]),append:t(()=>[o("div",Mn,[y.generation_status==="in_progress"||y.generation_status==="pending"?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):k("",!0),y.generation_status==="pending"?(n(),h(K,{key:1,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.status.generating")),1)]),_:1})):k("",!0),e(K,{color:a(je)(y.status),size:"small",label:""},{default:t(()=>[u(l(y.status),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(y.name),1)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>{return[o("div",Pn,[e(K,{color:"secondary",size:"small",label:"",class:"me-2"},{default:t(()=>[u(l(z(y.diagram_type)),1)]),_:2},1024)]),o("div",Bn,[o("div",Rn,[o("div",Ln,[y.generation_status==="in_progress"?(n(),v("div",An,[e(me,{indeterminate:"",color:"primary",size:"40",class:"mb-2"}),o("div",Fn,l(a(d)("projects.uml_diagrams.status.generating")),1)])):y.content?(n(),v("div",On,[y.content?(n(),h(Ee,{key:0,src:a(jt)(y.content),class:"diagram-svg",alt:a(d)("projects.uml_diagrams.title")},null,8,["src","alt"])):k("",!0)])):(n(),v("div",Nn,[e(q,{icon:F(y.diagram_type),size:"48",color:"secondary"},null,8,["icon"]),o("div",En,l(a(d)("projects.uml_diagrams.status.no_content.title")),1)]))]),o("div",Wn,[e($,{color:"primary",variant:"elevated",size:"small","prepend-icon":"tabler-eye"},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.actions.view")),1)]),_:1})])])]),o("div",Tn,[o("div",Gn,[e(q,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",Xn,l((p=y.created_at,p?(p=parseInt(p),new Date(p).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})):"")),1)])])];var p}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),V.value?(n(),h(Sn,{key:4,modelValue:S.value,"onUpdate:modelValue":_[2]||(_[2]=y=>S.value=y),diagram:V.value,onDelete:_[3]||(_[3]=y=>C.value=!0),"is-admin":a(I),"has-manager-permission":X.value,"has-moderator-permission":T.value},null,8,["modelValue","diagram","is-admin","has-manager-permission","has-moderator-permission"])):k("",!0),e(be,{modelValue:U.value,"onUpdate:modelValue":_[6]||(_[6]=y=>U.value=y),"max-width":"600",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"pt-5 pb-2"},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.generation.title")),1)]),_:1}),e(Z,null,{default:t(()=>[o("p",Hn,l(a(d)("projects.uml_diagrams.generation.description")),1),e(_e,{modelValue:E.value,"onUpdate:modelValue":_[4]||(_[4]=y=>E.value=y),items:Q,label:a(d)("projects.uml_diagrams.type")},null,8,["modelValue","label"])]),_:1}),e(pe,null,{default:t(()=>[e($,{color:"secondary",variant:"tonal",onClick:_[5]||(_[5]=y=>U.value=!1)},{default:t(()=>[u(l(a(d)("projects.user_stories.actions.cancel")),1)]),_:1}),e(le),e($,{color:"primary",onClick:w},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.actions.generate")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ee,{isDialogVisible:C.value,"onUpdate:isDialogVisible":_[7]||(_[7]=y=>C.value=y),confirmationMsg:a(d)("projects.uml_diagrams.delete_confirm.message"),onConfirm:M},null,8,["isDialogVisible","confirmationMsg"]),e(Ve,{modelValue:A.value.show,"onUpdate:modelValue":_[9]||(_[9]=y=>A.value.show=y),color:A.value.color,timeout:5e3},{actions:t(()=>[e(O,{onClick:_[8]||(_[8]=y=>A.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(A.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},[["__scopeId","data-v-61af0646"]]),Kn={class:"d-flex justify-space-between align-center mb-4"},Zn={class:"text-h5"},Qn={key:2,class:"d-flex justify-center align-center",style:{"min-height":"200px"}},Yn={__name:"ProjectExportsList",props:{projectId:{type:String,required:!0},exports:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(s,{emit:c}){const{t:i}=he(),r=d=>{switch(d){case"completed":return"success";case"pending":return"warning";case"in_progress":return"info";case"failed":return"error";default:return"grey"}},f=()=>{c("refresh")};return(d,m)=>(n(),h(te,null,{default:t(()=>[e(Z,null,{default:t(()=>[o("div",Kn,[o("h2",Zn,l(a(i)("projects.exports.title")),1),e($,{icon:"",variant:"text",color:"primary",onClick:f,loading:s.loading},{default:t(()=>[e(q,{icon:"tabler-refresh"})]),_:1},8,["loading"])]),!s.loading&&s.exports.length>0?(n(),h(Pe,{key:0},{default:t(()=>[o("thead",null,[o("tr",null,[o("th",null,l(a(i)("projects.exports.table.format")),1),o("th",null,l(a(i)("projects.exports.table.status")),1),o("th",null,l(a(i)("projects.exports.table.created_by")),1),o("th",null,l(a(i)("projects.exports.table.created_at")),1),o("th",null,l(a(i)("projects.exports.table.actions")),1)])]),o("tbody",null,[(n(!0),v(ae,null,de(s.exports,b=>{return n(),v("tr",{key:b.id},[o("td",null,l(b.fmt.toUpperCase()),1),o("td",null,[e(K,{color:r(b.status),size:"small"},{default:t(()=>[u(l(a(i)(`projects.exports.status.${b.status}`))+" ",1),b.status==="in_progress"?(n(),h(q,{key:0,class:"ml-1",icon:"tabler-loader",spin:""})):k("",!0)]),_:2},1032,["color"])]),o("td",null,l(b.created_by.username),1),o("td",null,l((V=b.created_at,new Date(parseInt(V)).toLocaleString())),1),o("td",null,[b.url&&b.status==="completed"?(n(),h($,{key:0,icon:"",variant:"text",color:"primary",onClick:S=>(C=>{C.url&&window.open(C.url,"_blank")})(b)},{default:t(()=>[e(q,{icon:"tabler-download"})]),_:2},1032,["onClick"])):b.status==="in_progress"?(n(),h($,{key:1,disabled:"",icon:"",variant:"text",color:"primary"},{default:t(()=>[e(q,{icon:"tabler-hourglass"})]),_:1})):k("",!0)])]);var V}),128))])]),_:1})):s.loading||s.exports.length!==0?(n(),v("div",Qn,[e(me,{indeterminate:"",color:"primary",size:"64"})])):(n(),h(xe,{key:1,type:"info",variant:"tonal",class:"mt-4"},{default:t(()=>[u(l(a(i)("projects.exports.empty")),1)]),_:1}))]),_:1})]),_:1}))}},ec={key:0},tc={key:0},ac={class:"d-flex gap-2"},lc={__name:"ProjectRoles",props:{projectId:{type:String,required:!0}},emits:["updated"],setup(s,{emit:c}){const i=s,{t:r}=he(),f=At(),d=Be(),m=Y(()=>f.projectRoles[i.projectId]||[]),b=j(!1),V=j(!1),S=j(!1),C=j(!1),U=j(!1),R=j({user_email:"",role:""}),A=j({id:null,username:"",role:""}),I=j(null),X=Y(()=>d.userData.username),T=j(!1),N=[{text:r("projects.roles.role_types.owner"),value:"OWNER"},{text:r("projects.roles.role_types.admin"),value:"ADMIN"},{text:r("projects.roles.role_types.manager"),value:"MANAGER"},{text:r("projects.roles.role_types.member"),value:"MEMBER"},{text:r("projects.roles.role_types.viewer"),value:"VIEWER"}],Q=z=>({OWNER:"purple",ADMIN:"red",MANAGER:"orange",MEMBER:"blue",VIEWER:"green"})[z]||"grey",E=()=>{R.value={user_email:"",role:"VIEWER"},S.value=!0},J=j({show:!1,text:"",color:"error"}),W=z=>{let x="An unexpected error occurred";if(typeof z=="string")x=z;else if(z&&z.detail)x=z.detail;else if(z&&z.user_email)x=`Email error: ${z.user_email}`;else if(z&&z.user)x=`User error: ${z.user}`;else if(z&&z.role)x=`Role error: ${z.role}`;else if(z&&z.non_field_errors)x=z.non_field_errors[0];else if(z&&typeof z=="object"){const _=Object.keys(z)[0];_&&z[_]&&(x=`${_}: ${Array.isArray(z[_])?z[_][0]:z[_]}`)}J.value={show:!0,text:x,color:"error"}},P=(z,x="error")=>{J.value={show:!0,text:z,color:x}},B=async()=>{if(R.value.user_email&&R.value.role){V.value=!0;try{const{data:z,error:x}=await f.addProjectRole(i.projectId,R.value);z&&!x?(P(r("projects.roles.notifications.role_added"),"success"),setTimeout(()=>{S.value=!1,c("updated"),d.clearProjectRoleCache(i.projectId)},1e3)):x&&W(x)}catch(z){W(z.message||"Failed to add member")}finally{V.value=!1}}},w=async()=>{if(A.value.id&&A.value.role){V.value=!0;try{const{data:z,error:x}=await f.updateProjectRole(i.projectId,A.value.id,{role:A.value.role});z&&!x?(P(r("projects.roles.notifications.role_updated"),"success"),setTimeout(()=>{C.value=!1,c("updated"),d.clearProjectRoleCache(i.projectId)},1e3)):x&&W(x)}catch(z){W(z.message||"Failed to update role")}finally{V.value=!1}}},M=async()=>{var z;if((z=I.value)!=null&&z.id){V.value=!0;try{const{success:x,error:_}=await f.deleteProjectRole(i.projectId,I.value.id);x&&!_?(U.value=!1,I.value=null,c("updated"),d.clearProjectRoleCache(i.projectId)):_&&W(_)}catch(x){W(x.message||"Failed to remove member")}finally{V.value=!1}}},D=async()=>{b.value=!0;try{const{data:z,error:x}=await f.fetchProjectRoles(i.projectId);x&&W(x)}catch(z){W(z.message||"Failed to fetch project members")}finally{b.value=!1}},F=async()=>{T.value=await d.hasProjectRoleAtLeast(i.projectId,"MANAGER")};return ve(()=>i.projectId,()=>{i.projectId&&(D(),F())},{immediate:!0}),Ce(async()=>{i.projectId&&(await D(),await F())}),(z,x)=>(n(),h(te,null,{default:t(()=>[e(se,{class:"d-flex justify-space-between align-center"},{default:t(()=>[u(l(z.$t("projects.roles.title"))+" ",1),T.value?(n(),h($,{key:0,color:"primary",size:"small",onClick:E},{default:t(()=>[e(q,{size:"18",start:"",icon:"tabler-plus"}),u(" "+l(z.$t("projects.roles.add_member")),1)]),_:1})):k("",!0)]),_:1}),e(Z,null,{default:t(()=>[a(m)&&a(m).length>0?(n(),h(Pe,{key:0},{default:t(()=>[o("thead",null,[o("tr",null,[o("th",null,l(z.$t("projects.roles.user")),1),o("th",null,l(z.$t("projects.roles.email")),1),o("th",null,l(z.$t("projects.roles.role")),1),T.value?(n(),v("th",ec,l(z.$t("projects.roles.actions")),1)):k("",!0)])]),o("tbody",null,[(n(!0),v(ae,null,de(a(m),_=>(n(),v("tr",{key:_.id},[o("td",null,l(_.first_name)+" "+l(_.last_name),1),o("td",null,l(_.email),1),o("td",null,[T.value&&_.username!==a(X)?(n(),h(K,{key:0,color:Q(_.role),onClick:ee=>(O=>{A.value={id:O.id,username:O.username,role:O.role},C.value=!0})(_),class:"font-weight-medium cursor-pointer"},{default:t(()=>[u(l(z.$t(`projects.roles.role_types.${_.role.toLowerCase()}`)),1)]),_:2},1032,["color","onClick"])):(n(),h(K,{key:1,color:Q(_.role),class:"font-weight-medium"},{default:t(()=>[u(l(z.$t(`projects.roles.role_types.${_.role.toLowerCase()}`)),1)]),_:2},1032,["color"]))]),T.value?(n(),v("td",tc,[o("div",ac,[_.username!==a(X)&&_.role!=="OWNER"?(n(),h($,{key:0,density:"compact",icon:"",variant:"text",disabled:V.value,onClick:ee=>(O=>{I.value=O,U.value=!0})(_)},{default:t(()=>[e(q,{icon:"tabler-trash",size:"20",color:"error"})]),_:2},1032,["disabled","onClick"])):k("",!0)])])):k("",!0)]))),128))])]),_:1})):b.value?k("",!0):(n(),h(xe,{key:1,type:"info",variant:"tonal"},{default:t(()=>[u(l(z.$t("projects.roles.no_members")),1)]),_:1})),b.value?(n(),h(Le,{key:2,indeterminate:""})):k("",!0)]),_:1}),e(be,{modelValue:S.value,"onUpdate:modelValue":x[3]||(x[3]=_=>S.value=_),"max-width":"600px"},{default:t(()=>[e(te,null,{default:t(()=>[e(se,null,{default:t(()=>[u(l(z.$t("projects.roles.add_member")),1)]),_:1}),e(Z,null,{default:t(()=>[e(Se,{ref:"addRoleForm",onSubmit:we(B,["prevent"])},{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:R.value.user_email,"onUpdate:modelValue":x[0]||(x[0]=_=>R.value.user_email=_),label:z.$t("projects.roles.email"),rules:[_=>!!_||z.$t("validation.required"),_=>/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(_)||z.$t("validation.email")],required:""},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(_e,{modelValue:R.value.role,"onUpdate:modelValue":x[1]||(x[1]=_=>R.value.role=_),items:N,"item-title":"text","item-value":"value",label:z.$t("projects.roles.role"),rules:[_=>!!_||z.$t("validation.required")],required:""},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(pe,null,{default:t(()=>[e(le),e($,{color:"error",text:"",onClick:x[2]||(x[2]=_=>S.value=!1)},{default:t(()=>[u(l(z.$t("projects.actions.cancel")),1)]),_:1}),e($,{color:"primary",loading:V.value,disabled:!R.value.user_email||!R.value.role,onClick:B},{default:t(()=>[u(l(z.$t("projects.actions.add")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(be,{modelValue:C.value,"onUpdate:modelValue":x[7]||(x[7]=_=>C.value=_),"max-width":"600px"},{default:t(()=>[e(te,null,{default:t(()=>[e(se,null,{default:t(()=>[u(l(z.$t("projects.roles.edit_role")),1)]),_:1}),e(Z,null,{default:t(()=>[e(Se,{ref:"editRoleForm",onSubmit:we(w,["prevent"])},{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:A.value.username,"onUpdate:modelValue":x[4]||(x[4]=_=>A.value.username=_),label:z.$t("projects.roles.user"),disabled:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(_e,{modelValue:A.value.role,"onUpdate:modelValue":x[5]||(x[5]=_=>A.value.role=_),items:N,"item-title":"text","item-value":"value",label:z.$t("projects.roles.role"),rules:[_=>!!_||z.$t("validation.required")],required:""},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(pe,null,{default:t(()=>[e(le),e($,{color:"error",text:"",onClick:x[6]||(x[6]=_=>C.value=!1)},{default:t(()=>[u(l(z.$t("projects.actions.cancel")),1)]),_:1}),e($,{color:"primary",loading:V.value,disabled:!A.value.role,onClick:w},{default:t(()=>[u(l(z.$t("projects.actions.save")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(be,{modelValue:U.value,"onUpdate:modelValue":x[9]||(x[9]=_=>U.value=_),"max-width":"400px"},{default:t(()=>[e(te,null,{default:t(()=>[e(se,null,{default:t(()=>[u(l(z.$t("projects.roles.delete_role")),1)]),_:1}),e(Z,null,{default:t(()=>{var _,ee;return[u(l(z.$t("projects.roles.delete_confirmation",{user:`${(_=I.value)==null?void 0:_.first_name} ${(ee=I.value)==null?void 0:ee.last_name}`})),1)]}),_:1}),e(pe,null,{default:t(()=>[e(le),e($,{color:"grey",text:"",onClick:x[8]||(x[8]=_=>U.value=!1)},{default:t(()=>[u(l(z.$t("projects.actions.cancel")),1)]),_:1}),e($,{color:"error",loading:V.value,onClick:M},{default:t(()=>[u(l(z.$t("projects.actions.delete")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ve,{modelValue:J.value.show,"onUpdate:modelValue":x[11]||(x[11]=_=>J.value.show=_),color:J.value.color,timeout:5e3},{actions:t(()=>[e($,{icon:"",onClick:x[10]||(x[10]=_=>J.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(J.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},rc={class:"text-center"},sc={class:"d-flex flex-wrap justify-space-between align-center"},oc={class:"d-flex align-center"},ic={class:"text-h3"},nc={__name:"[id]",setup(s){const c=Ot(),i=Nt(),r=Et();ot(),it();const f=Be(),{t:d}=he(),m=j(!0),b=j(null),V=j("0"),S=j(!1),C=j(!1),U=j(!1),R=j({show:!1,text:"",color:"success"}),A=Y(()=>c.params.id),I=Y(()=>r.currentProject);Y(()=>f.is_admin());const X=j(!1),T=j(!1),N=j(!1),Q=j(!1),E=j(null),J=j(!1),W=[{title:"Markdown",value:"md",icon:"tabler-markdown"},{title:"PDF",value:"pdf",icon:"tabler-file-text"},{title:"HTML",value:"html",icon:"tabler-code"}],P=Te(),B=j(null);Y(()=>[{title:d("projects.tabs.info"),icon:"tabler-info-circle",value:"0"},{title:d("projects.tabs.requirements"),icon:"tabler-list-check",value:"1"},{title:d("projects.tabs.user_stories"),icon:"tabler-user-check",value:"2"},{title:d("projects.tabs.mockups"),icon:"tabler-photo",value:"3"},{title:d("projects.tabs.uml_diagrams"),icon:"tabler-chart-dots",value:"4"},{title:d("projects.tabs.development_plan"),icon:"tabler-chart-bar",value:"5"},{title:d("projects.tabs.exports"),icon:"tabler-file-export",value:"6"},{title:d("projects.tabs.roles"),icon:"tabler-users",value:"7"}]);const w=async()=>{I.value||(m.value=!0),b.value=null;try{const{data:p,error:G}=await r.fetchProjectById(A.value);G&&(b.value=G,M("projects.errors.loading_failed"))}catch(p){b.value=p.message||"Failed to load project details",M("projects.errors.loading_failed")}finally{m.value=!1}},M=(p,G="success")=>{R.value={show:!0,text:d(p),color:G}},D=()=>{S.value=!0},F=async(p=!1)=>{if(p){C.value=!1,U.value=!0;try{const{success:G,error:g}=await r.deleteProject(A.value);G&&!g?(M("projects.notifications.deleted"),i.push({name:"projects"})):M("projects.notifications.error")}catch{M("projects.errors.delete_failed","error")}finally{U.value=!1}}},z=async p=>{U.value=!0;try{const{data:G,error:g}=await r.updateProject(A.value,p);M(G&&!g?"projects.notifications.updated":"projects.notifications.error")}catch{M("projects.errors.update_failed","error")}finally{U.value=!1}},x=async()=>{U.value=!0;try{const{data:p,error:G}=await r.generateRequirements(A.value);p&&!G?M("projects.notifications.requirements_generation_started"):M("projects.notifications.requirements_generation_failed","error")}catch{M("projects.notifications.requirements_generation_failed","error")}finally{U.value=!1}},_=async()=>{U.value=!0;try{const{data:p,error:G}=await r.generatePlan(A.value);p&&!G?M("projects.notifications.plan_generation_started"):M("projects.notifications.plan_generation_failed","error")}catch{M("projects.notifications.plan_generation_failed","error")}finally{U.value=!1}},ee=async()=>{U.value=!0;try{const{data:p,error:G}=await r.generateMockups(A.value);p&&!G?M("projects.notifications.mockups_generation_started"):M("projects.notifications.mockups_generation_failed","error")}catch{M("projects.notifications.mockups_generation_failed","error")}finally{U.value=!1}},O=p=>{E.value=p,V.value="2"},y=async()=>{X.value=await f.hasProjectRole(A.value,["OWNER"]),T.value=await f.hasProjectRoleAtLeast(A.value,"MANAGER"),N.value=await f.hasProjectRoleAtLeast(A.value,"ADMIN"),Q.value=await f.hasProjectRoleAtLeast(A.value,"MEMBER")};return Ce(async()=>{await w(),B.value=setInterval(()=>{P.emit("project-refresh"),w()},8e3),await y()}),Ft(()=>{B.value&&(clearInterval(B.value),B.value=null)}),(p,G)=>{const g=We,re=ke("IconBtn");return n(),h(Tt,{fluid:""},{default:t(()=>[m.value&&!a(I)?(n(),h(oe,{key:0},{default:t(()=>[e(L,{cols:"12",class:"d-flex justify-center align-center",style:{"min-height":"400px"}},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"64"})]),_:1})]),_:1})):b.value&&!a(I)?(n(),h(oe,{key:1},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(xe,{color:"error",variant:"tonal",title:a(d)("projects.errors.loading_failed"),text:a(d)("projects.errors.loading_failed"),class:"mb-4"},null,8,["title","text"]),o("div",rc,[e($,{color:"primary",onClick:w},{default:t(()=>[u(l(p.$t("projects.actions.retry")),1)]),_:1}),e($,{color:"secondary",variant:"outlined",class:"ms-2",to:{name:"projects"}},{default:t(()=>[u(l(p.$t("projects.actions.back_to_projects")),1)]),_:1})])]),_:1})]),_:1})):a(I)?(n(),v(ae,{key:2},[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[o("div",sc,[o("div",oc,[e($,{icon:"",variant:"text",class:"me-3",to:{name:"projects"}},{default:t(()=>[e(q,{icon:"tabler-arrow-left"})]),_:1}),o("h3",ic,l(a(I).name),1)]),e(le),e(oe,{class:"d-flex align-center mt-3 mt-sm-0"},{default:t(()=>[e(L,{cols:"6",sm:"3"},{default:t(()=>[e($,{color:"info",variant:"tonal","prepend-icon":"tabler-refresh",class:"w-100 me-2",onClick:w,loading:U.value},{default:t(()=>[u(l(p.$t("projects.actions.refresh")),1)]),_:1},8,["loading"])]),_:1}),Q.value?(n(),h(L,{key:0,cols:"6",sm:"3"},{default:t(()=>[e(Xt,{class:"w-100",modelValue:J.value,"onUpdate:modelValue":G[0]||(G[0]=H=>J.value=H),location:"top",loading:U.value},{activator:t(({props:H})=>[e($,bt(H,{color:"secondary",variant:"outlined","prepend-icon":"tabler-file-export",class:"me-2 w-100"}),{default:t(()=>[u(l(p.$t("projects.actions.export_srs")),1)]),_:2},1040)]),default:t(()=>[e(Ge,null,{default:t(()=>[(n(),v(ae,null,de(W,H=>e(Xe,{key:H.value,value:H.value,onClick:ue=>{(async($e="md")=>{U.value=!0;try{const{data:Ie,error:Me}=await r.exportSrs(A.value,$e);Ie&&!Me?(M("projects.notifications.srs_export_started"),V.value="6"):M("projects.notifications.srs_export_failed","error")}catch{M("projects.notifications.srs_export_failed","error")}finally{U.value=!1}})(H.value),J.value=!1}},{prepend:t(()=>[e(q,{icon:H.icon},null,8,["icon"])]),default:t(()=>[e(He,null,{default:t(()=>[u(l(H.title),1)]),_:2},1024)]),_:2},1032,["value","onClick"])),64))]),_:1})]),_:1},8,["modelValue","loading"])]),_:1})):k("",!0),T.value?(n(),h(L,{key:1,cols:"6",sm:"3"},{default:t(()=>[e($,{color:"primary","prepend-icon":"tabler-edit",class:"me-2 w-100",onClick:D,loading:U.value},{default:t(()=>[u(l(p.$t("projects.actions.edit")),1)]),_:1},8,["loading"])]),_:1})):k("",!0),N.value?(n(),h(L,{key:2,cols:"6",sm:"3"},{default:t(()=>[e($,{class:"w-100",color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:G[1]||(G[1]=H=>C.value=!0),loading:U.value},{default:t(()=>[u(l(p.$t("projects.actions.delete")),1)]),_:1},8,["loading"])]),_:1})):k("",!0)]),_:1})])]),_:1})]),_:1}),e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(te,null,{default:t(()=>[e(rt,{modelValue:V.value,"onUpdate:modelValue":G[2]||(G[2]=H=>V.value=H),"bg-color":"primary",grow:"","slider-color":"white"},{default:t(()=>[e(ge,{value:"0",color:"white"},{default:t(()=>[e(q,{size:"18",icon:"tabler-info-circle",start:""}),u(" "+l(p.$t("projects.tabs.overview")),1)]),_:1}),e(ge,{value:"1",color:"white"},{default:t(()=>{var H;return[e(q,{size:"18",icon:"tabler-list",start:""}),u(" "+l(p.$t("projects.tabs.requirements"))+" ",1),(H=a(I).requirements)!=null&&H.length?(n(),h(K,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>[u(l(a(I).requirements.length),1)]),_:1})):k("",!0)]}),_:1}),e(ge,{value:"2",color:"white"},{default:t(()=>{var H;return[e(q,{size:"18",icon:"tabler-user-check",start:""}),u(" "+l(p.$t("projects.tabs.user_stories"))+" ",1),(H=a(I).user_stories)!=null&&H.length?(n(),h(K,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>{var ue;return[u(l(((ue=a(I).user_stories)==null?void 0:ue.length)||0),1)]}),_:1})):k("",!0)]}),_:1}),e(ge,{value:"3",color:"white"},{default:t(()=>{var H;return[e(q,{size:"18",icon:"tabler-layout-kanban",start:""}),u(" "+l(p.$t("projects.tabs.mockups"))+" ",1),(H=a(I).mockups)!=null&&H.length?(n(),h(K,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>[u(l(a(I).mockups.length),1)]),_:1})):k("",!0)]}),_:1}),e(ge,{value:"4",color:"white"},{default:t(()=>{var H;return[e(q,{size:"18",icon:"tabler-chart-dots",start:""}),u(" "+l(p.$t("projects.tabs.uml_diagrams"))+" ",1),(H=a(I).uml_diagrams)!=null&&H.length?(n(),h(K,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>{var ue;return[u(l(((ue=a(I).uml_diagrams)==null?void 0:ue.length)||0),1)]}),_:1})):k("",!0)]}),_:1}),e(ge,{value:"5",color:"white"},{default:t(()=>[e(q,{size:"18",icon:"tabler-chart-dots",start:""}),u(" "+l(p.$t("projects.tabs.development_plan")),1)]),_:1}),e(ge,{value:"6",color:"white"},{default:t(()=>{var H;return[e(q,{size:"18",icon:"tabler-file-export",start:""}),u(" "+l(p.$t("projects.tabs.exports"))+" ",1),(H=a(I).srs_exports)!=null&&H.length?(n(),h(K,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>{var ue;return[u(l(((ue=a(I).srs_exports)==null?void 0:ue.length)||0),1)]}),_:1})):k("",!0)]}),_:1}),e(ge,{value:"7",color:"white"},{default:t(()=>[e(q,{size:"18",icon:"tabler-users",start:""}),u(" "+l(p.$t("projects.tabs.roles")),1)]),_:1})]),_:1},8,["modelValue"]),e(ne),e(st,{modelValue:V.value,"onUpdate:modelValue":G[6]||(G[6]=H=>V.value=H)},{default:t(()=>[e(ye,{value:"0"},{default:t(()=>[e(Fa,{project:a(I),loading:m.value},null,8,["project","loading"])]),_:1}),e(ye,{value:"1"},{default:t(()=>[e(pe,{class:"pt-3 px-6"},{default:t(()=>[e(le),Q.value?(n(),h($,{key:0,color:"primary","prepend-icon":"tabler-refresh",onClick:x,loading:U.value},{default:t(()=>[u(l(a(d)("projects.requirements.actions.generate")),1)]),_:1},8,["loading"])):k("",!0)]),_:1}),e($r,{"project-id":a(I).id,requirements:a(I).requirements||[],"can-manage":Q.value,onSelected:G[3]||(G[3]=H=>E.value=H),onViewUserStories:O},null,8,["project-id","requirements","can-manage"])]),_:1}),e(ye,{value:"2"},{default:t(()=>{var H,ue;return[e(pe,{class:"pt-3 px-6"},{default:t(()=>[E.value?(n(),h($,{key:0,color:"secondary",variant:"tonal","prepend-icon":"tabler-arrow-left",onClick:G[4]||(G[4]=$e=>E.value=null)},{default:t(()=>[u(l(p.$t("projects.actions.back_to_all_user_stories")),1)]),_:1})):k("",!0),e(le),Q.value?(n(),h($,{key:1,color:"primary","prepend-icon":"tabler-refresh",onClick:G[5]||(G[5]=$e=>(async(Ie=null)=>{U.value=!0;try{let Me;if(Ie){const{data:Ye,error:et}=await r.generateUserStories(A.value,Ie);Me={data:Ye,error:et}}else{const{data:Ye,error:et}=await r.generateUserStories(A.value);Me={data:Ye,error:et}}Me.data&&!Me.error?M("projects.notifications.user_stories_generation_started"):M("projects.notifications.user_stories_generation_failed","error")}catch{M("projects.notifications.user_stories_generation_failed","error")}finally{U.value=!1}})(E.value?E.value.id:null)),loading:U.value},{default:t(()=>[u(l(p.$t(E.value?"projects.actions.generate_user_stories_for_requirement":"projects.actions.generate_all_user_stories")),1)]),_:1},8,["loading"])):k("",!0)]),_:1}),e(sn,{"project-id":a(I).id,"requirement-id":E.value?E.value.id:null,"user-stories":E.value?((ue=(H=a(I).requirements)==null?void 0:H.find($e=>$e.id===E.value.id))==null?void 0:ue.user_stories)||[]:a(I).user_stories||[],"can-manage":Q.value},null,8,["project-id","requirement-id","user-stories","can-manage"])]}),_:1}),e(ye,{value:"3"},{default:t(()=>[e(pe,{class:"pt-3 px-6"},{default:t(()=>[e(le),Q.value?(n(),h($,{key:0,color:"primary","prepend-icon":"tabler-refresh",onClick:ee,loading:U.value},{default:t(()=>[u(l(a(d)("projects.mockups.actions.generate")),1)]),_:1},8,["loading"])):k("",!0)]),_:1}),e(rs,{"project-id":a(I).id,"can-manage":Q.value,mockups:a(I).mockups||[],onRefresh:w},null,8,["project-id","can-manage","mockups"])]),_:1}),e(ye,{value:"4"},{default:t(()=>[e(Jn,{"project-id":a(I).id,diagrams:a(I).uml_diagrams||[],"can-manage":Q.value,onRefresh:w},null,8,["project-id","diagrams","can-manage"])]),_:1}),e(ye,{value:"5"},{default:t(()=>[e(pe,{class:"pt-3 px-6"},{default:t(()=>[e(le),Q.value?(n(),h($,{key:0,color:"primary","prepend-icon":"tabler-refresh",onClick:_,loading:U.value},{default:t(()=>[u(l(p.$t("projects.development_plan.actions.generate")),1)]),_:1},8,["loading"])):k("",!0)]),_:1}),e(ko,{"project-id":a(I).id,"development-plan":a(I).development_plan,"can-manage":Q.value,onRefresh:w},null,8,["project-id","development-plan","can-manage"])]),_:1}),e(ye,{value:"6"},{default:t(()=>[e(Yn,{"project-id":a(I).id,exports:a(I).srs_exports||[],onRefresh:w},null,8,["project-id","exports"])]),_:1}),e(ye,{value:"7"},{default:t(()=>[e(lc,{"project-id":a(I).id,onUpdated:y,onRefresh:w},null,8,["project-id"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})],64)):k("",!0),a(I)?(n(),h(Wt,{key:3,modelValue:S.value,"onUpdate:modelValue":G[7]||(G[7]=H=>S.value=H),"edit-mode":"","project-data":a(I),onSubmit:z},null,8,["modelValue","project-data"])):k("",!0),e(g,{isDialogVisible:C.value,"onUpdate:isDialogVisible":G[8]||(G[8]=H=>C.value=H),confirmationMsg:a(d)("projects.delete_confirm.message"),onConfirm:F},null,8,["isDialogVisible","confirmationMsg"]),e(Ve,{modelValue:R.value.show,"onUpdate:modelValue":G[10]||(G[10]=H=>R.value.show=H),color:R.value.color,timeout:5e3},{actions:t(()=>[e(re,{onClick:G[9]||(G[9]=H=>R.value.show=!1)},{default:t(()=>[e(q,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(R.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}};typeof ut=="function"&&ut(nc);export{nc as default};
