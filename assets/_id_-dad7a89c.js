import{L as Je,N as Ke,b4 as dt,R as at,S as mt,W as pt,b5 as vt,a9 as Ze,p as e,G as Ae,a8 as St,Z as Fe,E as Y,ac as ft,Q as _t,b6 as gt,O as yt,b7 as Ut,Y as ct,a1 as zt,$ as It,ap as V,b8 as Dt,b9 as $t,ba as Mt,k as j,I as ve,o as n,b as h,y as t,aI as te,aY as Z,C as P,m as o,A as l,b1 as pe,D as u,aV as Oe,bb as ie,aD as Ue,aB as he,aJ as fe,bc as Pt,aL as ze,aK as se,q as a,bd as Le,aj as w,c as f,F as ae,a as de,at as Re,H as Ce,a$ as Ne,r as ke,ah as me,s as lt,aZ as we,aX as Ve,ar as De,b3 as Ee,w as Be,be as Bt,aG as Rt,aH as Lt,bf as ht,aa as bt,bg as At,J as Ft,b0 as Ot,t as Nt}from"./index-7d87a8eb.js";import{V as be}from"./VDialog-ad09290c.js";import{a as qe,u as Et,_ as Wt,V as Tt}from"./ProjectCreateDialog-7328f761.js";import{V as oe,a as L}from"./VRow-706c6ac6.js";import{V as ne}from"./VDivider-07ddc991.js";import{V as J}from"./VChip-cd421db0.js";import{g as je,a as tt,b as jt}from"./formatters-672af25a.js";import{V as le}from"./VSpacer-487bffed.js";import{V as Se}from"./VForm-667d3206.js";import{b as ce}from"./VTextField-f5713291.js";import{V as _e}from"./VSelect-91e46f2c.js";import{b as rt,c as ge,V as xe,a as kt}from"./VTabs-9451c5cf.js";import{V as st,a as ye}from"./VSlideGroup-e116af25.js";import{V as Ge,a as Xe,b as He}from"./VList-470d951e.js";import{V as Gt}from"./VTooltip-e95e3385.js";import{b as ut}from"./route-block-83d24a4e.js";import{V as Xt}from"./VMenu-6958a89f.js";import"./index-824e31d9.js";import"./VCheckboxBtn-70bc8575.js";import"./ssrBoot-6c797c8c.js";const Pe=Je()({name:"VTable",props:{fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...Ke(),...dt(),...at(),...mt()},setup(s,c){let{slots:i}=c;const{themeClasses:r}=pt(s),{densityClasses:v}=vt(s);return Ze(()=>e(s.tag,{class:["v-table",{"v-table--fixed-height":!!s.height,"v-table--fixed-header":s.fixedHeader,"v-table--fixed-footer":s.fixedFooter,"v-table--has-top":!!i.top,"v-table--has-bottom":!!i.bottom,"v-table--hover":s.hover},r.value,v.value,s.class],style:s.style},{default:()=>{var d,m,b;return[(d=i.top)==null?void 0:d.call(i),i.default?e("div",{class:"v-table__wrapper",style:{height:Ae(s.height)}},[e("table",null,[i.default()])]):(m=i.wrapper)==null?void 0:m.call(i),(b=i.bottom)==null?void 0:b.call(i)]}})),{}}}),xt=Je()({name:"VTimeline",props:{align:{type:String,default:"center",validator:s=>["center","start"].includes(s)},direction:{type:String,default:"vertical",validator:s=>["vertical","horizontal"].includes(s)},justify:{type:String,default:"auto",validator:s=>["auto","center"].includes(s)},side:{type:String,validator:s=>s==null||["start","end"].includes(s)},lineInset:{type:[String,Number],default:0},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:s=>["start","end","both"].includes(s)},...Ke(),...dt(),...at(),...mt()},setup(s,c){let{slots:i}=c;const{themeClasses:r}=pt(s),{densityClasses:v}=vt(s);St({VTimelineDivider:{lineColor:Fe(s,"lineColor")},VTimelineItem:{density:Fe(s,"density"),lineInset:Fe(s,"lineInset")}});const d=Y(()=>{const b=s.side?s.side:s.density!=="default"?"end":null;return b&&`v-timeline--side-${b}`}),m=Y(()=>{const b=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(s.truncateLine){case"both":return b;case"start":return b[0];case"end":return b[1];default:return null}});return Ze(()=>e(s.tag,{class:["v-timeline",`v-timeline--${s.direction}`,`v-timeline--align-${s.align}`,`v-timeline--justify-${s.justify}`,m.value,{"v-timeline--inset-line":!!s.lineInset},r.value,v.value,d.value,s.class],style:[{"--v-timeline-line-thickness":Ae(s.lineThickness)},s.style]},i)),{}}}),Ht=Je()({name:"VTimelineDivider",props:{dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:ft,iconColor:String,lineColor:String,...Ke(),..._t(),...gt(),...yt()},setup(s,c){let{slots:i}=c;const{sizeClasses:r,sizeStyles:v}=Ut(s,"v-timeline-divider__dot"),{backgroundColorStyles:d,backgroundColorClasses:m}=ct(Fe(s,"dotColor")),{roundedClasses:b}=zt(s,"v-timeline-divider__dot"),{elevationClasses:C}=It(s),{backgroundColorClasses:S,backgroundColorStyles:U}=ct(Fe(s,"lineColor"));return Ze(()=>e("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":s.fillDot},s.class],style:s.style},[e("div",{class:["v-timeline-divider__before",S.value],style:U.value},null),!s.hideDot&&e("div",{key:"dot",class:["v-timeline-divider__dot",C.value,b.value,r.value],style:v.value},[e("div",{class:["v-timeline-divider__inner-dot",m.value,b.value],style:d.value},[i.default?e(Dt,{key:"icon-defaults",disabled:!s.icon,defaults:{VIcon:{color:s.iconColor,icon:s.icon,size:s.size}}},i.default):e(V,{key:"icon",color:s.iconColor,icon:s.icon,size:s.size},null)])]),e("div",{class:["v-timeline-divider__after",S.value],style:U.value},null)])),{}}}),wt=Je()({name:"VTimelineItem",props:{density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:ft,iconColor:String,lineInset:[Number,String],...Ke(),...$t(),...yt(),..._t(),...gt(),...at()},setup(s,c){let{slots:i}=c;const{dimensionStyles:r}=Mt(s),v=j(0),d=j();return ve(d,m=>{var b;m&&(v.value=((b=m.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:b.getBoundingClientRect().width)??0)},{flush:"post"}),Ze(()=>{var m,b;return e("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":s.fillDot},s.class],style:[{"--v-timeline-dot-size":Ae(v.value),"--v-timeline-line-inset":s.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${Ae(s.lineInset)})`:Ae(0)},s.style]},[e("div",{class:"v-timeline-item__body",style:r.value},[(m=i.default)==null?void 0:m.call(i)]),e(Ht,{ref:d,hideDot:s.hideDot,icon:s.icon,iconColor:s.iconColor,size:s.size,elevation:s.elevation,dotColor:s.dotColor,fillDot:s.fillDot,rounded:s.rounded},{default:i.icon}),s.density!=="compact"&&e("div",{class:"v-timeline-item__opposite"},[!s.hideOpposite&&((b=i.opposite)==null?void 0:b.call(i))])])}),{}}}),Jt=o("span",{class:"text-5xl"},"!",-1),Kt={class:"text-lg font-weight-medium"},We={__name:"ConfirmDialog",props:{confirmationMsg:{type:String,required:!0},isDialogVisible:{type:Boolean,required:!0}},emits:["update:isDialogVisible","confirm"],setup(s,{emit:c}){const i=s,r=m=>{c("update:isDialogVisible",m)},v=()=>{c("confirm",!0),r(!1)},d=()=>{c("confirm",!1),c("update:isDialogVisible",!1)};return(m,b)=>(n(),h(be,{"max-width":"500","model-value":i.isDialogVisible,"onUpdate:modelValue":r},{default:t(()=>[e(te,{class:"text-center px-10 py-6"},{default:t(()=>[e(Z,null,{default:t(()=>[e(P,{icon:"",variant:"outlined",color:"warning",class:"mb-4",style:{width:"88px",height:"88px","pointer-events":"none"}},{default:t(()=>[Jt]),_:1}),o("h6",Kt,l(i.confirmationMsg),1)]),_:1}),e(pe,{class:"align-center justify-center gap-2"},{default:t(()=>[e(P,{variant:"elevated",onClick:v},{default:t(()=>[u(l(m.$t("confirmation.confirm")),1)]),_:1}),e(P,{color:"secondary",variant:"tonal",onClick:d},{default:t(()=>[u(l(m.$t("confirmation.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},ot=Oe({id:"UserStoryStore",state:()=>({userStories:[],currentUserStory:null,loading:!1,error:null}),actions:{async fetchUserStories(s=null){this.loading=!0;try{let c="/service/user-stories/";s&&(c+=`?requirement=${s}`);const i=await ie.get(c);return i.status===200?(this.userStories=i.data,{data:i.data,error:null}):{data:[],error:i.data}}catch(c){return this.error=c.message||"Failed to fetch user stories",{data:[],error:this.error}}finally{this.loading=!1}},async fetchUserStoryById(s){this.loading=!0;try{const c=await ie.get(`/service/user-stories/${s}/`);return c.status===200?(this.currentUserStory=c.data,{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to fetch user story",{data:null,error:this.error}}finally{this.loading=!1}},async createUserStory(s){this.loading=!0;try{const c=await ie.post("/service/user-stories/",s);return c.status===201?(this.userStories.length&&this.userStories.push(c.data),{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to create user story",{data:null,error:this.error}}finally{this.loading=!1}},async updateUserStory(s,c){this.loading=!0;try{const i=await ie.put(`/service/user-stories/${s}/`,c);if(i.status===200){if(this.userStories.length){const r=this.userStories.findIndex(v=>v.id===s);r!==-1&&(this.userStories[r]=i.data)}return this.currentUserStory&&this.currentUserStory.id===s&&(this.currentUserStory=i.data),{data:i.data,error:null}}return{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to update user story",{data:null,error:this.error}}finally{this.loading=!1}},async deleteUserStory(s){this.loading=!0;try{const c=await ie.delete(`/service/user-stories/${s}/`);return c.status===204?(this.userStories.length&&(this.userStories=this.userStories.filter(i=>i.id!==s)),this.currentUserStory&&this.currentUserStory.id===s&&(this.currentUserStory=null),{success:!0,error:null}):{success:!1,error:c.data}}catch(c){return this.error=c.message||"Failed to delete user story",{success:!1,error:this.error}}finally{this.loading=!1}},async regenerateUserStory(s,c=""){this.loading=!0;try{const i=await ie.post(`/service/user-stories/${s}/regenerate/`,{feedback:c});return i.status===202?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to regenerate user story",{data:null,error:this.error}}finally{this.loading=!1}},async createComment(s,c){this.loading=!0;try{const i=await ie.post("/service/user-story-comments/",{user_story:s,text:c.text,status:c.status||"active"});return i.status===201?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to create comment",{data:null,error:this.error}}finally{this.loading=!1}},async deleteComment(s){this.loading=!0;try{const c=await ie.delete(`/service/user-story-comments/${s}/`);return c.status===204?{success:!0,error:null}:{success:!1,error:c.data}}catch(c){return this.error=c.message||"Failed to delete comment",{success:!1,error:this.error}}finally{this.loading=!1}}}}),it=Oe({id:"UmlDiagramStore",state:()=>({diagrams:[],currentDiagram:null,loading:!1,error:null}),actions:{async fetchDiagrams(s=null,c=null){this.loading=!0;try{let i="/service/uml-diagrams/";const r={};s&&(r.project=s),c&&(r.diagram_type=c);const v=await ie.get(i,{params:r});return v.status===200?(this.diagrams=v.data,{data:v.data,error:null}):{data:[],error:v.data}}catch(i){return this.error=i.message||"Failed to fetch UML diagrams",{data:[],error:this.error}}finally{this.loading=!1}},async fetchDiagramById(s){this.loading=!0;try{const c=await ie.get(`/service/uml-diagrams/${s}/`);return c.status===200?(this.currentDiagram=c.data,{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to fetch UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async createDiagram(s){this.loading=!0;try{const c=await ie.post("/service/uml-diagrams/",s);return c.status===201?(this.diagrams.length&&this.diagrams.push(c.data),{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to create UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async updateDiagram(s,c){this.loading=!0;try{const i=await ie.put(`/service/uml-diagrams/${s}/`,c);if(i.status===200){if(this.diagrams.length){const r=this.diagrams.findIndex(v=>v.id===s);r!==-1&&(this.diagrams[r]=i.data)}return this.currentDiagram&&this.currentDiagram.id===s&&(this.currentDiagram=i.data),{data:i.data,error:null}}return{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to update UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async deleteDiagram(s){this.loading=!0;try{const c=await ie.delete(`/service/uml-diagrams/${s}/`);return c.status===204?(this.diagrams.length&&(this.diagrams=this.diagrams.filter(i=>i.id!==s)),this.currentDiagram&&this.currentDiagram.id===s&&(this.currentDiagram=null),{success:!0,error:null}):{success:!1,error:c.data}}catch(c){return this.error=c.message||"Failed to delete UML diagram",{success:!1,error:this.error}}finally{this.loading=!1}},async regenerateDiagram(s){this.loading=!0;try{const c=await ie.post(`/service/uml-diagrams/${s}/regenerate/`);return c.status===202?{data:c.data,error:null}:{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to regenerate UML diagram",{data:null,error:this.error}}finally{this.loading=!1}},async generateDiagrams(s,c="class"){this.loading=!0;try{const i=await ie.post(`/service/projects/${s}/generate_uml_diagrams/`,{diagram_type:c});return i.status===202?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to generate UML diagrams",{data:null,error:this.error}}finally{this.loading=!1}}}}),Zt={class:"d-flex flex-column gap-4"},Qt={class:"d-flex flex-column gap-3"},Yt={class:"font-weight-medium mb-1"},ea={class:"d-flex justify-space-between mt-1"},ta={class:"font-weight-medium mb-1"},aa={class:"d-flex justify-space-between mt-1"},la={class:"font-weight-medium mb-1"},ra={class:"d-flex align-center gap-2"},sa={class:"flex-grow-1"},oa={class:"font-weight-medium mb-1"},ia={class:"d-flex justify-space-between mt-1"},na={class:"d-flex flex-column gap-2"},ca={class:"d-flex align-center"},ua={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},da={class:"d-flex align-center"},ma={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},pa={class:"d-flex align-center"},va={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},fa={class:"d-flex align-center"},_a={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},ga={key:0,class:"d-flex align-center"},ya={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},ha={key:1,class:"d-flex align-center"},ba={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},ja={key:2,class:"d-flex align-center"},ka={class:"text-medium-emphasis font-weight-medium me-3",style:{"min-width":"120px"}},xa={class:"d-flex align-center"},wa=["title"],Va={class:"ms-2"},qa={class:"whitespace-pre-wrap"},Ca={class:"d-flex flex-column gap-4"},Sa={key:0},Ua={class:"text-subtitle-1 font-weight-bold mb-2"},za={class:"whitespace-pre-wrap"},Ia={key:1},Da={class:"text-subtitle-1 font-weight-bold mb-2"},$a={class:"d-flex flex-column gap-4"},Ma={class:"whitespace-pre-wrap mb-4"},Pa={key:0,class:"whitespace-pre-wrap"},Ba={class:"text-subtitle-1 font-weight-bold mb-2"},Ra={class:"whitespace-pre-wrap"},La={class:"whitespace-pre-wrap"},Aa={class:"whitespace-pre-wrap"},Fa=Ue({__name:"ProjectDetailsInfo",props:{project:{type:Object,required:!0},loading:{type:Boolean,default:!1},canManage:{type:Boolean,default:!1}},emits:["update","generate-requirements"],setup(s,{emit:c}){const i=s,{t:r}=he(),v=S=>S?new Date(parseInt(S)).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):r("projects.details.not_set"),d=Y(()=>{switch(i.project.status){case"draft":return"warning";case"active":return"success";case"archived":return"secondary";case"completed":return"info";default:return"primary"}}),m=Y(()=>{switch(i.project.type_of_application){case"website":return"tabler-world-www";case"mobile":return"tabler-device-mobile";case"desktop":return"tabler-device-desktop";case"api":return"tabler-api";default:return"tabler-code"}}),b={en:r("projects.languages.english"),ru:r("projects.languages.russian"),de:r("projects.languages.german")},C=()=>{c("generate-requirements")};return(S,U)=>(n(),h(Z,{class:"pa-6"},{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"6"},{default:t(()=>[o("div",Zt,[s.project.generation_progress?(n(),h(te,{key:0,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,Pt({prepend:t(()=>[e(ze,{color:"info",variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(V,{icon:"tabler-info-circle"})]),_:1})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.generation_status")),1)]),_:1})]),_:2},[s.canManage?{name:"append",fn:t(()=>[e(P,{variant:"text",color:"primary",icon:"tabler-refresh",size:"small",onClick:C})]),key:"0"}:void 0]),1024),e(ne),e(Z,null,{default:t(()=>[o("div",Qt,[o("div",null,[o("div",Yt,l(a(r)("projects.details.requirements")),1),e(Le,{"model-value":s.project.generation_progress.requirements.status==="completed"?100:s.project.generation_progress.requirements.status==="in_progress"?50:s.project.generation_progress.requirements.status==="pending"?10:0,color:s.project.generation_progress.requirements.status==="completed"?"success":s.project.generation_progress.requirements.status==="in_progress"?"info":s.project.generation_progress.requirements.status==="failed"?"error":"warning",height:"8",rounded:""},null,8,["model-value","color"]),o("div",ea,[o("small",null,l(a(r)(`projects.details.${s.project.generation_progress.requirements.status}`)),1),o("small",null,l(s.project.requirements?s.project.requirements.length:0)+" "+l(a(r)("projects.details.requirements_count")),1)])]),o("div",null,[o("div",ta,l(a(r)("projects.details.user_stories")),1),e(Le,{"model-value":s.project.generation_progress.user_stories.total>0?s.project.generation_progress.user_stories.completed/s.project.generation_progress.user_stories.total*100:0,color:"info",height:"8",rounded:""},null,8,["model-value"]),o("div",aa,[o("small",null,l(s.project.generation_progress.user_stories.completed)+" "+l(a(r)("projects.details.completed")),1),o("small",null,l(s.project.generation_progress.user_stories.total)+" "+l(a(r)("projects.details.total")),1)])]),o("div",null,[o("div",la,l(a(r)("projects.details.mockups")),1),o("div",ra,[o("div",sa,[e(Le,{"model-value":s.project.mockups&&s.project.mockups.length?s.project.mockups.filter(z=>z.generation_status==="completed"&&!z.needs_regeneration).length/s.project.mockups.length*100:0,color:"success",height:"8",rounded:""},null,8,["model-value"])]),o("div",null,[s.project.mockups&&s.project.mockups.some(z=>z.needs_regeneration||z.generation_status==="in_progress"||z.generation_status==="pending")?(n(),h(J,{key:0,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(s.project.mockups.filter(z=>z.needs_regeneration||z.generation_status==="in_progress"||z.generation_status==="pending").length)+" "+l(a(r)("projects.details.pending")),1)]),_:1})):w("",!0)])])]),o("div",null,[o("div",oa,l(a(r)("projects.details.uml_diagrams")),1),e(Le,{"model-value":s.project.generation_progress.uml_diagrams.total>0?s.project.generation_progress.uml_diagrams.completed/s.project.generation_progress.uml_diagrams.total*100:0,color:"primary",height:"8",rounded:""},null,8,["model-value"]),o("div",ia,[o("small",null,l(s.project.generation_progress.uml_diagrams.completed)+" "+l(a(r)("projects.details.completed")),1),o("small",null,l(s.project.generation_progress.uml_diagrams.total)+" "+l(a(r)("projects.details.total")),1)])])])]),_:1})]),_:1})):w("",!0),e(te,{border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:"primary",variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(V,{icon:a(m)},null,8,["icon"])]),_:1})]),append:t(()=>[e(J,{size:"small",color:a(d),label:""},{default:t(()=>[u(l(a(r)(`projects.status.${s.project.status}`)),1)]),_:1},8,["color"])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.project_overview")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",na,[o("div",ca,[o("span",ua,l(a(r)("projects.details.created_at"))+":",1),o("span",null,l(v(s.project.created_at)),1)]),o("div",da,[o("span",ma,l(a(r)("projects.details.updated_at"))+":",1),o("span",null,l(v(s.project.updated_at)),1)]),o("div",pa,[o("span",va,l(a(r)("projects.details.type"))+":",1),e(J,{size:"small"},{default:t(()=>[u(l(a(r)(`projects.types.${s.project.type_of_application}`)),1)]),_:1})]),o("div",fa,[o("span",_a,l(a(r)("projects.details.language"))+":",1),e(J,{size:"small"},{default:t(()=>{return[u(l((z=s.project.language,b[z]||z)),1)];var z}),_:1})]),s.project.deadline?(n(),f("div",ga,[o("span",ya,l(a(r)("projects.details.deadline"))+":",1),o("span",null,l(v(s.project.deadline)),1)])):w("",!0),s.project.preliminary_budget?(n(),f("div",ha,[o("span",ba,l(a(r)("projects.details.budget"))+":",1),o("span",null,"$"+l(s.project.preliminary_budget),1)])):w("",!0),s.project.color_scheme?(n(),f("div",ja,[o("span",ka,l(a(r)("projects.details.color_scheme"))+":",1),o("div",xa,[(n(!0),f(ae,null,de(s.project.color_scheme.split(","),(z,R)=>(n(),f("div",{key:R,class:"color-swatch rounded me-1",style:Re({backgroundColor:z.trim()}),title:a(r)("projects.details.color")},null,12,wa))),128)),o("span",Va,l(s.project.color_scheme),1)])])):w("",!0)])]),_:1})]),_:1}),s.project.additional_requirements?(n(),h(te,{key:1,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(V,{color:"primary",icon:"tabler-list-details"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.additional_requirements")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",qa,l(s.project.additional_requirements),1)]),_:1})]),_:1})):w("",!0),s.project.technology_stack||s.project.operating_system?(n(),h(te,{key:2,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(V,{color:"primary",icon:"tabler-device-laptop"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.technical_details")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",Ca,[s.project.technology_stack?(n(),f("div",Sa,[o("h6",Ua,l(a(r)("projects.details.technology_stack")),1),o("div",za,l(s.project.technology_stack),1)])):w("",!0),s.project.operating_system?(n(),f("div",Ia,[o("h6",Da,l(a(r)("projects.details.operating_system")),1),o("div",null,l(s.project.operating_system),1)])):w("",!0)])]),_:1})]),_:1})):w("",!0)])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[o("div",$a,[e(te,{border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(V,{color:"primary",icon:"tabler-file-description"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.description")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",Ma,l(s.project.short_description),1),s.project.application_description?(n(),f("div",Pa,[o("h6",Ba,l(a(r)("projects.details.application_description")),1),o("div",null,l(s.project.application_description),1)])):w("",!0)]),_:1})]),_:1}),s.project.target_users?(n(),h(te,{key:0,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(V,{color:"primary",icon:"tabler-users"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.target_users")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",Ra,l(s.project.target_users),1)]),_:1})]),_:1})):w("",!0),s.project.non_functional_requirements?(n(),h(te,{key:1,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(V,{color:"primary",icon:"tabler-chart-bubble"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.non_functional_requirements")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",La,l(s.project.non_functional_requirements),1)]),_:1})]),_:1})):w("",!0),s.project.priority_modules?(n(),h(te,{key:2,border:"",class:"project-info-card"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(V,{color:"primary",icon:"tabler-star"})]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.details.priority_modules")),1)]),_:1})]),_:1}),e(ne),e(Z,null,{default:t(()=>[o("div",Aa,l(s.project.priority_modules),1)]),_:1})]),_:1})):w("",!0)])]),_:1})]),_:1})]),_:1}))}},[["__scopeId","data-v-64ae6fbd"]]),Vt=Oe({id:"RequirementStore",state:()=>({requirements:[],currentRequirement:null,loading:!1,error:null}),actions:{async fetchRequirements(s=null){this.loading=!0;try{let c="/service/requirements/";s&&(c+=`?project=${s}`);const i=await ie.get(c);return i.status===200?(this.requirements=i.data,{data:i.data,error:null}):{data:[],error:i.data}}catch(c){return this.error=c.message||"Failed to fetch requirements",{data:[],error:this.error}}finally{this.loading=!1}},async fetchRequirementById(s){this.loading=!0;try{const c=await ie.get(`/service/requirements/${s}/`);return c.status===200?(this.currentRequirement=c.data,{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to fetch requirement",{data:null,error:this.error}}finally{this.loading=!1}},async createRequirement(s){this.loading=!0;try{const c=await ie.post("/service/requirements/",s);return c.status===201?(this.requirements.length&&this.requirements.push(c.data),{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to create requirement",{data:null,error:this.error}}finally{this.loading=!1}},async updateRequirement(s,c){this.loading=!0;try{const i=await ie.put(`/service/requirements/${s}/`,c);if(i.status===200){if(this.requirements.length){const r=this.requirements.findIndex(v=>v.id===s);r!==-1&&(this.requirements[r]=i.data)}return this.currentRequirement&&this.currentRequirement.id===s&&(this.currentRequirement=i.data),{data:i.data,error:null}}return{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to update requirement",{data:null,error:this.error}}finally{this.loading=!1}},async deleteRequirement(s){this.loading=!0;try{const c=await ie.delete(`/service/requirements/${s}/`);return c.status===204?(this.requirements.length&&(this.requirements=this.requirements.filter(i=>i.id!==s)),this.currentRequirement&&this.currentRequirement.id===s&&(this.currentRequirement=null),{success:!0,error:null}):{success:!1,error:c.data}}catch(c){return this.error=c.message||"Failed to delete requirement",{success:!1,error:this.error}}finally{this.loading=!1}},async createComment(s,c){this.loading=!0;try{const i=await ie.post("/service/requirement-comments/",{requirement:s,text:c.text,status:c.status||"active",responsible_user:c.responsibleUser||null});return i.status===201?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to create comment",{data:null,error:this.error}}finally{this.loading=!1}},async deleteComment(s){this.loading=!0;try{const c=await ie.delete(`/service/requirement-comments/${s}/`);return c.status===204?{success:!0,error:null}:{success:!1,error:c.data}}catch(c){return this.error=c.message||"Failed to delete comment",{success:!1,error:this.error}}finally{this.loading=!1}}}}),Qe=Oe("mockup",()=>{const s=j([]),c=j(!1),i=j(null);return{mockups:s,loading:c,error:i,fetchProjectMockups:async r=>{c.value=!0,i.value=null;try{const v=await ie.get(`/service/projects/${r}/mockups/`);return s.value=v.data,v.data}catch(v){throw i.value="Failed to fetch mockups",console.error(v),v}finally{c.value=!1}},fetchMockupById:async r=>{c.value=!0,i.value=null;try{const v=await ie.get(`/service/mockups/${r}/`),d=s.value.findIndex(m=>m.id===r);return d!==-1&&(s.value[d]=v.data),v}catch(v){throw i.value="Failed to fetch mockup",console.error(v),v}finally{c.value=!1}},regenerateMockup:async(r,v)=>{c.value=!0,i.value=null;try{const d=await ie.post(`/service/mockups/${r}/regenerate/`,v),m=s.value.findIndex(b=>b.id===r);return m!==-1&&(s.value[m]=d.data),d.data}catch(d){throw i.value="Failed to regenerate mockup",console.error(d),d}finally{c.value=!1}},regenerateAllMockups:async r=>{c.value=!0,i.value=null;try{const v=await ie.post(`/service/projects/${r}/regenerate-mockups/`);return s.value=v.data,v.data}catch(v){throw i.value="Failed to regenerate all mockups",console.error(v),v}finally{c.value=!1}},updateMockupById:async(r,v)=>{c.value=!0,i.value=null;try{return await ie.put(`/service/mockups/${r}/`,v)}catch(d){throw i.value="Failed to update mockup",console.error(d),d}finally{c.value=!1}},deleteMockupById:async r=>{c.value=!0,i.value=null;try{return(await ie.delete(`/service/mockups/${r}/`)).status===204}catch(v){throw i.value="Failed to delete mockup",console.error(v),v}finally{c.value=!1}}}}),Oa={key:0,class:"text-h5"},Na={class:"text-h5"},Ea={key:0,class:"ms-2 d-flex align-center"},Wa={class:"text-caption"},Ta={key:0},Ga={key:1},Xa={class:"mockup-metadata d-flex align-center px-6 py-3"},Ha={class:"d-flex align-center"},Ja={class:"text-caption"},Ka={class:"d-flex align-center ms-4"},Za={class:"text-caption"},Qa={key:0,class:"d-flex align-center ms-4"},Ya={class:"text-caption"},el={key:1,class:"d-flex align-center ms-4"},tl={class:"text-caption"},al={class:"mockup-content pa-0"},ll={class:"text-h6 mb-2"},rl={class:"text-body-1 text-medium-emphasis max-width-md text-center"},sl=["srcdoc","title"],ol={key:2,class:"d-flex flex-column justify-center align-center pa-6",style:{height:"400px"}},il={class:"text-h6 mb-2"},nl={class:"text-medium-emphasis text-center"},cl={class:"text-body-1 mb-3"},nt=Ue({__name:"MockupPreviewDialog",props:{modelValue:{type:Boolean,default:!1},mockup:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1}},emits:["update:modelValue","delete","regenerate"],setup(s,{emit:c}){const i=s,{t:r}=he(),v=Y({get:()=>i.modelValue,set:D=>c("update:modelValue",D)}),d=Qe(),m=j(!1),b=j(!1),C=j({...i.mockup}),S=j(!1),U=j(null),z=j(!1),R=j(""),A=j({show:!1,text:"",color:"success"}),I=Y(()=>i.mockup.generation_status==="in_progress"||i.mockup.generation_status==="pending"||i.mockup.needs_regeneration),X=D=>D?(D=parseInt(D),new Date(D).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",W=()=>{m.value=!m.value},O=()=>{b.value&&(C.value={...i.mockup}),b.value=!b.value},Q=async()=>{S.value=!0;try{const{data:D,error:M}=await d.updateMockupById(i.mockup.id,{...C.value,needs_regeneration:!1,generation_status:"completed"});D&&!M?(B(r("projects.mockups.notifications.updated")),Object.assign(i.mockup,D),b.value=!1,v.value=!1):B(r("projects.mockups.notifications.update_failed"),"error")}catch(D){B(r("projects.mockups.notifications.update_error",{error:D.message}),"error")}finally{S.value=!1}},N=()=>{c("delete"),v.value=!1},K=async()=>{z.value=!0},E=async()=>{S.value=!0;try{i.mockup.user_story?await d.regenerateMockup(i.mockup.id,{user_story_id:i.mockup.user_story.id,feedback:R.value}):i.mockup.requirement?await d.regenerateMockup(i.mockup.id,{requirement_id:i.mockup.requirement.id,feedback:R.value}):await d.regenerateMockup(i.mockup.id,{feedback:R.value}),B(r("projects.mockups.notifications.regeneration_started")),z.value=!1,R.value="",v.value=!1,U.value=setInterval($,5e3)}catch(D){B(r("projects.mockups.notifications.regeneration_error",{error:D.message}),"error")}finally{S.value=!1}},B=(D,M="success")=>{A.value={show:!0,text:D,color:M}},$=()=>{I.value&&v.value&&d.fetchMockupById(i.mockup.id).then(({data:D})=>{D&&Object.assign(i.mockup,D)})};return ve(()=>i.mockup,D=>{C.value={...D}},{deep:!0}),Ce(()=>{U.value=setInterval($,5e3)}),Ne(()=>{U.value&&clearInterval(U.value)}),(D,M)=>{const q=ke("IconBtn");return n(),h(be,{modelValue:a(v),"onUpdate:modelValue":M[9]||(M[9]=G=>De(v)?v.value=G:null),fullscreen:m.value,"max-width":m.value?"100%":"900",scrollable:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex py-3 px-5"},{default:t(()=>[b.value?(n(),f("h5",Oa,l(a(r)("projects.mockups.actions.edit")),1)):(n(),f(ae,{key:1},[o("h5",Na,l(s.mockup.name),1),e(J,{color:a(je)(s.mockup.status),size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${s.mockup.status}`)),1)]),_:1},8,["color"]),a(I)?(n(),f("div",Ea,[e(me,{indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"}),o("span",Wa,l(s.mockup.generation_status==="in_progress"?a(r)("projects.mockups.status.generating"):a(r)("projects.mockups.status.pending")),1)])):w("",!0)],64)),e(le),e(P,{icon:"",variant:"text",onClick:W},{default:t(()=>[e(V,{icon:m.value?"tabler-minimize":"tabler-maximize"},null,8,["icon"])]),_:1}),e(q,{onClick:M[0]||(M[0]=G=>v.value=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),_:1}),e(ne),e(Z,{class:lt({"pa-0":!b.value&&s.mockup.html_content,"pa-6":b.value||!s.mockup.html_content}),style:Re({height:m.value?"calc(100vh - 120px)":"70vh",maxHeight:"800px"})},{default:t(()=>[b.value?(n(),f("div",Ta,[e(Se,{onSubmit:we(Q,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:C.value.name,"onUpdate:modelValue":M[1]||(M[1]=G=>C.value.name=G),label:a(r)("projects.mockups.name"),required:"",rules:[G=>!!G||a(r)("projects.mockups.validation.name_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:C.value.status,"onUpdate:modelValue":M[2]||(M[2]=G=>C.value.status=G),label:a(r)("projects.details.status"),items:[{title:a(r)("projects.status.draft"),value:"draft"},{title:a(r)("projects.status.active"),value:"active"},{title:a(r)("projects.status.archived"),value:"archived"},{title:a(r)("projects.status.completed"),value:"completed"}],required:""},null,8,["modelValue","label","items"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:C.value.html_content,"onUpdate:modelValue":M[3]||(M[3]=G=>C.value.html_content=G),label:a(r)("projects.mockups.html_content"),rows:"15",rules:[G=>!!G||a(r)("projects.mockups.validation.html_required")],monospace:""},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),f("div",Ga,[o("div",Xa,[o("div",Ha,[e(V,{icon:"tabler-calendar",class:"me-2",size:"18"}),o("span",Ja,l(a(r)("projects.details.created_at"))+": "+l(X(s.mockup.created_at)),1)]),o("div",Ka,[e(V,{icon:"tabler-calendar-event",class:"me-2",size:"18"}),o("span",Za,l(a(r)("projects.details.updated_at"))+": "+l(X(s.mockup.updated_at)),1)]),s.mockup.requirement?(n(),f("div",Qa,[e(V,{icon:"tabler-file-check",class:"me-2",size:"18"}),o("span",Ya,l(a(r)("projects.details.requirement"))+": "+l(s.mockup.requirement_name),1)])):w("",!0),s.mockup.user_story?(n(),f("div",el,[e(V,{icon:"tabler-user-check",class:"me-2",size:"18"}),o("span",tl,l(a(r)("projects.details.user_story"))+": "+l(s.mockup.user_story_name),1)])):w("",!0)]),e(ne),o("div",al,[a(I)?(n(),f("div",{key:0,class:"d-flex flex-column justify-center align-center",style:Re({height:m.value?"calc(100vh - 180px)":"calc(70vh - 110px)"})},[e(me,{indeterminate:"",color:"primary",size:"64",class:"mb-4"}),o("h4",ll,l(s.mockup.generation_status==="in_progress"?a(r)("projects.mockups.status.generating"):a(r)("projects.mockups.status.preparing")),1),o("p",rl,l(s.mockup.generation_status==="in_progress"?a(r)("projects.mockups.status.generating_description"):a(r)("projects.mockups.status.preparing_description")),1)],4)):s.mockup.html_content?(n(),f("iframe",{key:1,srcdoc:s.mockup.html_content,class:"mockup-iframe",style:Re([{width:"100%",border:"none"},{height:m.value?"calc(100vh - 180px)":"calc(70vh - 110px)"}]),sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",title:a(r)("projects.mockups.preview")},null,12,sl)):(n(),f("div",ol,[e(V,{icon:"tabler-code-off",size:"64",color:"secondary",class:"mb-4"}),o("h4",il,l(a(r)("projects.mockups.no_content.title")),1),o("p",nl,l(a(r)("projects.mockups.no_content.description")),1)]))])]))]),_:1},8,["class","style"]),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[b.value?(n(),f(ae,{key:0},[e(P,{color:"secondary",variant:"tonal",onClick:O,disabled:S.value},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1},8,["disabled"]),e(le),e(P,{color:"primary",onClick:Q,loading:S.value},{default:t(()=>[u(l(a(r)("projects.actions.save")),1)]),_:1},8,["loading"])],64)):(n(),f(ae,{key:1},[s.isAdmin?(n(),h(P,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:N},{default:t(()=>[u(l(a(r)("projects.actions.delete")),1)]),_:1})):w("",!0),s.hasManagerPermission?(n(),h(P,{key:1,color:"warning",variant:"tonal","prepend-icon":"tabler-refresh",onClick:K,loading:a(I)||S.value,disabled:a(I),class:"ms-2"},{default:t(()=>[u(l(a(r)("projects.mockups.actions.regenerate")),1)]),_:1},8,["loading","disabled"])):w("",!0),e(le),s.hasManagerPermission?(n(),h(P,{key:2,class:"ms-2",color:"primary",variant:"tonal","prepend-icon":"tabler-code",onClick:O},{default:t(()=>[u(l(a(r)("projects.mockups.actions.edit")),1)]),_:1})):w("",!0)],64))]),_:1})]),_:1}),e(be,{modelValue:z.value,"onUpdate:modelValue":M[6]||(M[6]=G=>z.value=G),"max-width":"600",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"pt-3 pb-0"},{default:t(()=>[u(l(a(r)("projects.mockups.regeneration.title")),1)]),_:1}),e(Z,null,{default:t(()=>[o("p",cl,l(a(r)("projects.mockups.regeneration.description")),1),e(qe,{autofocus:"",modelValue:R.value,"onUpdate:modelValue":M[4]||(M[4]=G=>R.value=G),label:a(r)("projects.mockups.fields.feedback"),hint:a(r)("projects.mockups.placeholders.feedback"),"aria-placeholder":"t('projects.mockups.placeholders.feedback')",rows:"4",counter:""},null,8,["modelValue","label","hint"])]),_:1}),e(pe,null,{default:t(()=>[e(P,{color:"secondary",variant:"tonal",onClick:M[5]||(M[5]=G=>z.value=!1)},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1}),e(le),e(P,{color:"primary",onClick:E,loading:S.value},{default:t(()=>[u(l(a(r)("projects.mockups.actions.regenerate")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ve,{modelValue:A.value.show,"onUpdate:modelValue":M[8]||(M[8]=G=>A.value.show=G),color:A.value.color,timeout:5e3},{actions:t(()=>[e(q,{onClick:M[7]||(M[7]=G=>A.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(A.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue","fullscreen","max-width"])}}},[["__scopeId","data-v-e7f2b0d9"]]),ul={key:0,class:"text-h5"},dl={key:1,class:"text-h5"},ml={key:0},pl={key:1},vl={class:"d-flex align-center mb-5"},fl={class:"d-flex align-center"},_l={class:"text-medium-emphasis d-flex align-center"},gl={class:"text-caption me-4"},yl={class:"text-caption"},hl={class:"text-h4 mb-4"},bl={class:"text-body-1 whitespace-pre-wrap"},jl={key:0,class:"text-center pa-6"},kl={class:"text-h6 mb-2"},xl={class:"text-medium-emphasis mb-4"},wl={key:1},Vl={class:"d-flex justify-space-between align-center mb-4"},ql={class:"text-h5"},Cl={class:"mb-2"},Sl={key:0,class:"mt-3"},Ul={class:"text-subtitle-2"},zl={class:"pl-4"},Il={key:0},Dl={key:0,class:"text-center mt-4"},$l={key:0,class:"text-center pa-6"},Ml={class:"text-h6 mb-2"},Pl={class:"text-medium-emphasis"},Bl={key:1},Rl={class:"d-flex align-center"},Ll={class:"mockup-preview mb-3"},Al={class:"overflow-hidden position-relative rounded bg-grey-lighten-4",style:{height:"150px"}},Fl={key:0,class:"d-flex justify-center align-center h-100"},Ol={class:"text-center"},Nl={class:"text-caption"},El={key:1,class:"html-preview"},Wl={key:2,class:"d-flex justify-center align-center h-100"},Tl={class:"preview-overlay d-flex justify-center align-center"},Gl={key:0,class:"mb-2"},Xl={class:"d-flex align-center justify-space-between"},Hl={class:"d-flex align-center"},Jl={class:"text-caption"},Kl={key:0,class:"text-center pa-6"},Zl={class:"text-h6 mb-2"},Ql={class:"text-medium-emphasis"},Yl={key:1},er={class:"text-caption"},tr={class:"text-caption text-medium-emphasis"},ar={class:"d-flex align-center mb-2"},lr={class:"text-caption"},rr={class:"text-body-2 whitespace-pre-wrap"},sr={class:"d-flex justify-end mt-2"},or={key:1,class:"text-center pa-6"},ir={class:"text-h6 mb-2"},nr={class:"text-medium-emphasis"},cr={key:2},ur={class:"d-flex align-center"},dr={class:"d-flex align-center"},mr={class:"text-caption text-medium-emphasis ml-2"},pr={class:"comment-text mt-2 whitespace-pre-wrap"},vr=Ue({__name:"RequirementDetailsDialog",props:{modelValue:{type:Boolean,default:!1},requirement:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},hasModeratorPermission:{type:Boolean,default:!1}},emits:["update:modelValue","update","delete","view-user-stories"],setup(s,{emit:c}){const i=s,{t:r}=he(),v=Y({get:()=>i.modelValue,set:ee=>c("update:modelValue",ee)}),d=Vt(),m=Qe(),b=j(0),C=j(!1),S=j({...i.requirement}),U=j(""),z=j(!1),R=j({show:!1,text:"",color:"success"}),A=j(null),I=j(!1),X=j(null),W=[{title:r("projects.categories.functional"),value:"functional"},{title:r("projects.categories.nonfunctional"),value:"nonfunctional"},{title:r("projects.categories.uiux"),value:"uiux"},{title:r("projects.categories.other"),value:"other"}],O=[{title:r("projects.status.draft"),value:"draft"},{title:r("projects.status.active"),value:"active"},{title:r("projects.status.archived"),value:"archived"},{title:r("projects.status.completed"),value:"completed"}],Q=[{title:r("projects.requirements.types.feature"),value:"feature"},{title:r("projects.requirements.types.constraint"),value:"constraint"},{title:r("projects.requirements.types.quality"),value:"quality"},{title:r("projects.requirements.types.interface"),value:"interface"},{title:r("projects.requirements.types.security"),value:"security"},{title:r("projects.requirements.types.performance"),value:"performance"},{title:r("projects.requirements.types.other"),value:"other"}],N=Y(()=>i.requirement.history||[]),K=Y(()=>i.requirement.comments||[]),E=Y(()=>i.requirement.user_stories||[]),B=Y(()=>i.requirement.mockups||[]),$=ee=>ee?(ee=parseInt(ee),new Date(ee).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",D=()=>{C.value&&(S.value={...i.requirement}),C.value=!C.value,b.value="0"},M=()=>{v.value&&d.fetchRequirementById(i.requirement.id).then(({data:ee})=>{ee&&Object.assign(i.requirement,ee)})};Ce(()=>{X.value=setInterval(M,5e3)}),Ne(()=>{X.value&&clearInterval(X.value)});const q=()=>{c("update",S.value),C.value=!1,v.value=!1},G=()=>{c("delete"),v.value=!1},k=()=>{c("view-user-stories",i.requirement),v.value=!1},x=async()=>{if(U.value.trim()){z.value=!0;try{const{data:ee,error:F}=await d.createComment(i.requirement.id,{text:U.value,status:"active"});if(ee&&!F){_(r("projects.requirements.notifications.comment_added")),U.value="";const{data:y}=await d.fetchRequirementById(i.requirement.id);y&&Object.assign(i.requirement,y)}else _(r("projects.requirements.notifications.comment_add_failed"),"error")}catch(ee){_(r("projects.requirements.notifications.comment_add_failed")+": "+ee.message,"error")}finally{z.value=!1}}},_=(ee,F="success")=>{R.value={show:!0,text:ee,color:F}};return ve(()=>i.requirement,ee=>{S.value={...ee}},{deep:!0}),(ee,F)=>{const y=ke("IconBtn");return n(),h(be,{modelValue:a(v),"onUpdate:modelValue":F[12]||(F[12]=p=>De(v)?v.value=p:null),"max-width":"900",scrollable:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex pt-5 px-5"},{default:t(()=>[C.value?(n(),f("h5",ul,l(a(r)("projects.requirements.actions.edit")),1)):(n(),f("h5",dl,l(a(r)("projects.requirements.actions.view_details")),1)),e(le),e(y,{onClick:F[0]||(F[0]=p=>v.value=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),_:1}),e(Z,{class:"pb-0"},{default:t(()=>[e(rt,{modelValue:b.value,"onUpdate:modelValue":F[1]||(F[1]=p=>b.value=p),"slider-color":"primary","align-tabs":"start"},{default:t(()=>[e(ge,{value:"0"},{default:t(()=>[e(V,{size:"18",icon:"tabler-info-circle",start:""}),u(" "+l(a(r)("projects.requirements.tabs.details")),1)]),_:1}),e(ge,{value:"1"},{default:t(()=>[e(V,{size:"18",icon:"tabler-user-check",start:""}),u(" "+l(a(r)("projects.requirements.tabs.user_stories"))+" ",1),a(E).length?(n(),h(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(E).length),1)]),_:1})):w("",!0)]),_:1}),e(ge,{value:"2"},{default:t(()=>[e(V,{size:"18",icon:"tabler-photo",start:""}),u(" "+l(a(r)("projects.requirements.tabs.mockups"))+" ",1),a(B).length?(n(),h(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(B).length),1)]),_:1})):w("",!0)]),_:1}),e(ge,{value:"3"},{default:t(()=>[e(V,{size:"18",icon:"tabler-history",start:""}),u(" "+l(a(r)("projects.requirements.tabs.history"))+" ",1),a(N).length?(n(),h(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(N).length),1)]),_:1})):w("",!0)]),_:1}),e(ge,{value:"4"},{default:t(()=>[e(V,{size:"18",icon:"tabler-messages",start:""}),u(" "+l(a(r)("projects.requirements.tabs.comments"))+" ",1),a(K).length?(n(),h(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(K).length),1)]),_:1})):w("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ne),e(Z,{class:"pa-6",style:{"min-height":"400px","max-height":"70vh"}},{default:t(()=>[e(st,{modelValue:b.value,"onUpdate:modelValue":F[8]||(F[8]=p=>b.value=p),class:"mt-5"},{default:t(()=>[e(ye,{value:"0"},{default:t(()=>[C.value?(n(),f("div",ml,[e(Se,{onSubmit:we(q,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:S.value.title,"onUpdate:modelValue":F[2]||(F[2]=p=>S.value.title=p),label:a(r)("projects.requirements.title"),required:"",rules:[p=>!!p||a(r)("validation.required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:S.value.category,"onUpdate:modelValue":F[3]||(F[3]=p=>S.value.category=p),label:a(r)("projects.requirements.category"),items:W,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:S.value.requirement_type,"onUpdate:modelValue":F[4]||(F[4]=p=>S.value.requirement_type=p),label:a(r)("projects.requirements.type"),items:Q,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:S.value.status,"onUpdate:modelValue":F[5]||(F[5]=p=>S.value.status=p),label:a(r)("projects.requirements.status"),items:O,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:S.value.description,"onUpdate:modelValue":F[6]||(F[6]=p=>S.value.description=p),label:a(r)("projects.requirements.description"),required:"",rows:"8",rules:[p=>!!p||a(r)("validation.required")]},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),f("div",pl,[o("div",vl,[e(J,{color:a(tt)(s.requirement.category),size:"small",label:"",class:"me-2"},{default:t(()=>[u(l(a(r)(`projects.categories.${s.requirement.category}`)),1)]),_:1},8,["color"]),e(J,{color:a(je)(s.requirement.status),size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${s.requirement.status}`)),1)]),_:1},8,["color"]),e(J,{color:"secondary",size:"small",label:"",class:"ms-2"},{default:t(()=>[u(" v"+l(s.requirement.version_number),1)]),_:1}),s.requirement.requirement_type?(n(),h(J,{key:0,color:"info",size:"small",label:"",class:"ms-2"},{default:t(()=>[u(l(a(r)(`projects.requirements.types.${s.requirement.requirement_type}`)),1)]),_:1})):w("",!0),e(le)]),o("div",fl,[o("div",_l,[e(V,{size:"18",icon:"tabler-calendar",class:"me-1"}),o("span",gl,l(a(r)("projects.details.updated_at"))+": "+l($(s.requirement.updated_at)),1),e(V,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),o("span",yl,l(a(r)("projects.details.created_at"))+": "+l($(s.requirement.created_at)),1)])]),o("h4",hl,l(s.requirement.title),1),o("div",bl,l(s.requirement.description),1)]))]),_:1}),e(ye,{value:"1"},{default:t(()=>[a(E).length===0?(n(),f("div",jl,[e(V,{icon:"tabler-user-check",size:"64",color:"secondary",class:"mb-3"}),o("h4",kl,l(a(r)("projects.requirements.user_stories.empty.title")),1),o("p",xl,l(a(r)("projects.requirements.user_stories.empty.description")),1),e(P,{color:"primary",onClick:k},{default:t(()=>[u(l(a(r)("projects.requirements.actions.generate_user_stories")),1)]),_:1})])):(n(),f("div",wl,[o("div",Vl,[o("h5",ql,l(a(r)("projects.requirements.user_stories.title")),1),e(P,{color:"primary",variant:"tonal",onClick:k},{default:t(()=>[u(l(a(r)("projects.requirements.actions.view_all_stories")),1)]),_:1})]),(n(!0),f(ae,null,de(a(E).slice(0,3),(p,T)=>(n(),h(te,{key:p.id,class:"mb-4",border:""},{default:t(()=>[e(fe,null,{append:t(()=>[e(J,{color:a(je)(p.status),size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${p.status}`)),1)]),_:2},1032,["color"])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.requirements.user_stories.as_a",{role:p.role})),1)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>[o("p",Cl,[o("strong",null,l(a(r)("projects.requirements.user_stories.i_want_to"))+":",1),u(" "+l(p.action),1)]),o("p",null,[o("strong",null,l(a(r)("projects.requirements.user_stories.so_that"))+":",1),u(" "+l(p.benefit),1)]),p.acceptance_criteria&&p.acceptance_criteria.length>0?(n(),f("div",Sl,[o("div",Ul,l(a(r)("projects.requirements.user_stories.acceptance_criteria"))+":",1),o("ul",zl,[(n(!0),f(ae,null,de(p.acceptance_criteria.slice(0,2),(g,re)=>(n(),f("li",{key:re},l(g),1))),128)),p.acceptance_criteria.length>2?(n(),f("li",Il,l(a(r)("projects.requirements.user_stories.and_more",{count:p.acceptance_criteria.length-2})),1)):w("",!0)])])):w("",!0)]),_:2},1024)]),_:2},1024))),128)),a(E).length>3?(n(),f("div",Dl,[e(P,{color:"primary",variant:"tonal",onClick:k},{default:t(()=>[u(l(a(r)("projects.requirements.actions.view_all_stories_count",{count:a(E).length})),1)]),_:1})])):w("",!0)]))]),_:1}),e(ye,{value:"2"},{default:t(()=>[a(B).length===0?(n(),f("div",$l,[e(V,{icon:"tabler-photo-off",size:"64",color:"secondary",class:"mb-3"}),o("h4",Ml,l(a(r)("projects.requirements.mockups.empty.title")),1),o("p",Pl,l(a(r)("projects.requirements.mockups.empty.description")),1)])):(n(),f("div",Bl,[e(oe,null,{default:t(()=>[(n(!0),f(ae,null,de(a(B),p=>(n(),h(L,{key:p.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(te,{class:"mockup-card h-100",onClick:T=>(async g=>{const{data:re}=await m.fetchMockupById(g.id);A.value=re||g,I.value=!0})(p),border:"",hover:""},{default:t(()=>[e(fe,null,{append:t(()=>[o("div",Rl,[p.generation_status==="in_progress"||p.generation_status==="pending"||p.needs_regeneration?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):w("",!0),e(J,{color:a(je)(p.status),size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${p.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(p.name),1)]),_:2},1024)]),_:2},1024),e(ne),e(Z,null,{default:t(()=>[o("div",Ll,[o("div",Al,[p.generation_status==="in_progress"||p.generation_status==="pending"?(n(),f("div",Fl,[o("div",Ol,[e(me,{indeterminate:"",color:"primary",size:"40",class:"mb-2"}),o("div",Nl,l(a(r)("projects.mockups.status.generating")),1)])])):p.image?(n(),f("div",El,[e(Ee,{src:p.image,alt:p.name},null,8,["src","alt"])])):(n(),f("div",Wl,[e(V,{icon:"tabler-file-code",size:"48",color:"secondary"})])),o("div",Tl,[e(P,{color:"primary",variant:"elevated",size:"small","prepend-icon":"tabler-eye",disabled:p.generation_status==="in_progress"||p.generation_status==="pending"},{default:t(()=>[u(l(a(r)("projects.mockups.actions.preview")),1)]),_:2},1032,["disabled"])])])]),p.needs_regeneration?(n(),f("div",Gl,[e(J,{color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(r)("projects.mockups.status.regenerating")),1)]),_:1})])):w("",!0),o("div",Xl,[o("div",Hl,[e(V,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",Jl,l($(p.created_at)),1)])])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]))]),_:1}),e(ye,{value:"3"},{default:t(()=>[a(N).length===0?(n(),f("div",Kl,[e(V,{icon:"tabler-history",size:"64",color:"secondary",class:"mb-3"}),o("h4",Zl,l(a(r)("projects.requirements.history.empty.title")),1),o("p",Ql,l(a(r)("projects.requirements.history.empty.description")),1)])):(n(),f("div",Yl,[e(xt,{density:"compact",align:"start"},{default:t(()=>[(n(!0),f(ae,null,de(a(N),(p,T)=>(n(),h(wt,{key:T,"dot-color":"primary",size:"small"},{opposite:t(()=>[o("div",er,l($(p.changed_at)),1),o("div",tr,"v"+l(p.version_number),1)]),default:t(()=>[e(te,{border:""},{default:t(()=>[e(fe,null,{append:t(()=>[e(J,{color:a(je)(p.status),size:"small",label:"",class:"ms-2"},{default:t(()=>[u(l(a(r)(`projects.status.${p.status}`)),1)]),_:2},1032,["color"])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(p.title),1)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>[o("div",ar,[e(J,{color:a(tt)(p.category),size:"small",label:"",class:"me-2"},{default:t(()=>[u(l(a(r)(`projects.categories.${p.category}`)),1)]),_:2},1032,["color"]),o("span",lr,l(a(r)("projects.requirements.history.changed_by"))+": "+l(p.changed_by?p.changed_by.username:a(r)("projects.requirements.history.unknown")),1)]),o("div",rr,l(p.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1}),e(ye,{value:"4"},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:U.value,"onUpdate:modelValue":F[7]||(F[7]=p=>U.value=p),label:a(r)("projects.requirements.comments.add"),rows:"3",counter:"",disabled:z.value},null,8,["modelValue","label","disabled"]),o("div",sr,[e(P,{color:"primary",size:"small",loading:z.value,disabled:!U.value.trim(),onClick:x},{default:t(()=>[u(l(a(r)("projects.requirements.comments.add_button")),1)]),_:1},8,["loading","disabled"])])]),_:1}),e(L,{cols:"12"},{default:t(()=>[a(K).length?(n(),h(ne,{key:0,class:"mb-4"})):w("",!0),a(K).length===0?(n(),f("div",or,[e(V,{icon:"tabler-messages",size:"64",color:"secondary",class:"mb-3"}),o("h4",ir,l(a(r)("projects.requirements.comments.empty.title")),1),o("p",nr,l(a(r)("projects.requirements.comments.empty.description")),1)])):(n(),f("div",cr,[(n(!0),f(ae,null,de(a(K),p=>(n(),f("div",{key:p.id,class:"comment-item mb-4"},[e(te,{border:""},{default:t(()=>[e(Z,{class:"py-2"},{default:t(()=>[o("div",ur,[e(ze,{color:"primary",variant:"tonal",size:"36",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-user"})]),_:1}),o("div",null,[o("div",dr,[o("strong",null,l(p.user?p.user.username:a(r)("projects.requirements.comments.unknown_user")),1),o("div",mr,l($(p.created_at)),1)])]),e(le),s.isAdmin||s.hasManagerPermission?(n(),h(y,{key:0,size:"small",color:"error",variant:"text",onClick:T=>(async g=>{z.value=!0;try{const{success:re,error:H}=await d.deleteComment(g);if(re&&!H){_(r("projects.requirements.notifications.comment_deleted"));const{data:ue}=await d.fetchRequirementById(i.requirement.id);ue&&Object.assign(i.requirement,ue)}else _(r("projects.requirements.notifications.comment_delete_failed"),"error")}catch(re){_(r("projects.requirements.notifications.comment_delete_failed")+": "+re.message,"error")}finally{z.value=!1}})(p.id),disabled:z.value},{default:t(()=>[e(V,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick","disabled"])):w("",!0)]),o("div",pr,l(p.text),1)]),_:2},1024)]),_:2},1024)]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[C.value?(n(),f(ae,{key:0},[e(P,{color:"secondary",variant:"tonal",onClick:D},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1}),e(le),e(P,{color:"primary",onClick:q},{default:t(()=>[u(l(a(r)("projects.actions.save")),1)]),_:1})],64)):(n(),f(ae,{key:1},[s.isAdmin?(n(),h(P,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:G},{default:t(()=>[u(l(a(r)("projects.requirements.actions.delete")),1)]),_:1})):w("",!0),s.hasModeratorPermission&&a(E).length===0?(n(),h(P,{key:1,color:"info",variant:"tonal","prepend-icon":"tabler-user-check",class:"ms-2",onClick:k},{default:t(()=>[u(l(a(r)("projects.requirements.actions.generate_user_stories")),1)]),_:1})):w("",!0),e(le),s.hasModeratorPermission?(n(),h(P,{key:2,color:"primary","prepend-icon":"tabler-edit",onClick:D},{default:t(()=>[u(l(a(r)("projects.requirements.actions.edit")),1)]),_:1})):w("",!0)],64))]),_:1})]),_:1}),e(Ve,{modelValue:R.value.show,"onUpdate:modelValue":F[10]||(F[10]=p=>R.value.show=p),color:R.value.color,timeout:5e3},{actions:t(()=>[e(y,{onClick:F[9]||(F[9]=p=>R.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(R.value.text)+" ",1)]),_:1},8,["modelValue","color"]),A.value?(n(),h(nt,{key:0,modelValue:I.value,"onUpdate:modelValue":F[11]||(F[11]=p=>I.value=p),mockup:A.value,"is-admin":s.isAdmin,"has-manager-permission":s.hasManagerPermission},null,8,["modelValue","mockup","is-admin","has-manager-permission"])):w("",!0)]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-85cccabb"]]),fr={class:"text-h5"},_r={__name:"RequirementCreateDialog",props:{modelValue:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},requirementData:{type:Object,default:()=>({})}},emits:["update:modelValue","submit"],setup(s,{emit:c}){const i=s,{t:r}=he(),v=Y({get:()=>i.modelValue,set:I=>c("update:modelValue",I)}),d=j({title:i.editMode&&i.requirementData?i.requirementData.title:"",description:i.editMode&&i.requirementData?i.requirementData.description:"",category:i.editMode&&i.requirementData?i.requirementData.category:"functional",status:i.editMode&&i.requirementData?i.requirementData.status:"draft"}),m=[I=>!!I||r("validation.required"),I=>I.length<=255||r("projects.requirements.validation.title_length")],b=[I=>!!I||r("validation.required")],C=[{title:r("projects.categories.functional"),value:"functional"},{title:r("projects.categories.nonfunctional"),value:"nonfunctional"},{title:r("projects.categories.uiux"),value:"uiux"},{title:r("projects.categories.other"),value:"other"}],S=[{title:r("projects.status.draft"),value:"draft"},{title:r("projects.status.active"),value:"active"},{title:r("projects.status.archived"),value:"archived"},{title:r("projects.status.completed"),value:"completed"}],U=j(null),z=()=>{d.value={title:"",description:"",category:"functional",status:"draft"},U.value&&U.value.resetValidation()},R=()=>{v.value=!1,z()},A=async()=>{const{valid:I}=await U.value.validate();I&&(c("submit",d.value),v.value=!1,z())};return ve(v,I=>{I||z()}),(I,X)=>{const W=ke("IconBtn");return n(),h(be,{modelValue:a(v),"onUpdate:modelValue":X[4]||(X[4]=O=>De(v)?v.value=O:null),"max-width":"700",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex pt-5 px-5"},{default:t(()=>[o("h5",fr,l(i.editMode?a(r)("projects.requirements.actions.edit"):a(r)("projects.requirements.actions.add")),1),e(le),e(W,{onClick:R},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),_:1}),e(Z,{class:"px-5 pt-4"},{default:t(()=>[e(Se,{ref_key:"formRef",ref:U,onSubmit:we(A,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:d.value.title,"onUpdate:modelValue":X[0]||(X[0]=O=>d.value.title=O),label:a(r)("projects.requirements.title"),rules:m,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:d.value.category,"onUpdate:modelValue":X[1]||(X[1]=O=>d.value.category=O),label:a(r)("projects.requirements.category"),items:C,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:d.value.status,"onUpdate:modelValue":X[2]||(X[2]=O=>d.value.status=O),label:a(r)("projects.requirements.status"),items:S,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:d.value.description,"onUpdate:modelValue":X[3]||(X[3]=O=>d.value.description=O),label:a(r)("projects.requirements.description"),rules:b,required:"",rows:"6"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[e(P,{variant:"tonal",color:"secondary",onClick:R},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1}),e(le),e(P,{color:"primary",onClick:A},{default:t(()=>[u(l(i.editMode?a(r)("projects.actions.update"):a(r)("projects.actions.create")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}};function Te(s){return{all:s=s||new Map,on:function(c,i){var r=s.get(c);r?r.push(i):s.set(c,[i])},off:function(c,i){var r=s.get(c);r&&(i?r.splice(r.indexOf(i)>>>0,1):s.set(c,[]))},emit:function(c,i){var r=s.get(c);r&&r.slice().map(function(v){v(i)}),(r=s.get("*"))&&r.slice().map(function(v){v(c,i)})}}}const gr={key:0,class:"mb-4"},yr={key:1,class:"d-flex justify-center align-center",style:{height:"300px"}},hr={key:2,class:"text-center pa-4"},br={class:"text-h6 mb-2"},jr={class:"text-body-1 text-medium-emphasis mb-6"},kr={class:"d-flex align-center"},xr={class:"text-body-2 mb-3"},wr={class:"d-flex align-center justify-space-between mb-2"},Vr={class:"d-flex align-center"},qr={class:"text-caption text-capitalize"},Cr={class:"d-flex align-center"},Sr={class:"text-caption"},Ur={class:"d-flex align-center"},zr={class:"text-caption"},Ir={key:0,class:"mt-3"},Dr={__name:"ProjectRequirementsList",props:{projectId:{type:String,required:!0},requirements:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh","view-user-stories"],setup(s,{emit:c}){const i=s,{t:r}=he(),v=Vt(),d=Be(),m=j(""),b=j([]),C=j(["draft","active","completed"]),S=j(null),U=j(!1),z=j(!1),R=j(!1),A=j(!1),I=j({show:!1,text:"",color:"success"}),X=Y(()=>d.is_admin()),W=j(!1),O=j(!1),Q=j(!1),N=async()=>{W.value=await d.hasProjectRoleAtLeast(i.projectId,"MANAGER"),O.value=await d.hasProjectRoleAtLeast(i.projectId,"ADMIN"),Q.value=await d.hasProjectWriteAccess(i.projectId)},K=Y(()=>i.requirements.some(F=>F.user_stories&&F.user_stories.some(y=>y.generation_status==="in_progress"||y.generation_status==="pending")||F.mockups&&F.mockups.some(y=>y.generation_status==="in_progress"||y.generation_status==="pending"||y.needs_regeneration))),E=[{title:r("projects.categories.functional"),value:"functional"},{title:r("projects.categories.nonfunctional"),value:"nonfunctional"},{title:r("projects.categories.uiux"),value:"uiux"},{title:r("projects.categories.other"),value:"other"}],B=[{title:r("projects.status.draft"),value:"draft"},{title:r("projects.status.active"),value:"active"},{title:r("projects.status.archived"),value:"archived"},{title:r("projects.status.completed"),value:"completed"}],$=Y(()=>i.requirements.filter(F=>{const y=!m.value||F.title.toLowerCase().includes(m.value.toLowerCase())||F.description.toLowerCase().includes(m.value.toLowerCase()),p=b.value.length===0||b.value.includes(F.category),T=C.value.includes(F.status);return y&&p&&T})),D=Te(),M=()=>{z.value=!0},q=async F=>{A.value=!0;try{const{data:y,error:p}=await v.createRequirement({...F,project:i.projectId});y&&!p?(_("projects.requirements.notifications.created"),c("refresh")):_("projects.requirements.notifications.create_failed","error")}catch{_("projects.requirements.notifications.create_failed","error")}finally{A.value=!1}},G=async F=>{A.value=!0;try{const{data:y,error:p}=await v.updateRequirement(S.value.id,F);y&&!p?(_("projects.requirements.notifications.updated"),c("refresh")):_("projects.requirements.notifications.update_failed","error")}catch{_("projects.requirements.notifications.update_failed","error")}finally{A.value=!1}},k=async()=>{if(S.value){A.value=!0,R.value=!1;try{const{success:F,error:y}=await v.deleteRequirement(S.value.id);F&&!y?(_("projects.requirements.notifications.deleted"),c("refresh"),U.value=!1):_("projects.requirements.notifications.delete_failed","error")}catch{_("projects.requirements.notifications.delete_failed","error")}finally{A.value=!1}}},x=F=>{c("view-user-stories",F)},_=(F,y="success")=>{I.value={show:!0,text:r(F),color:y}},ee=(F,y=120)=>!F||F.length<=y?F:F.substring(0,y)+"...";return Ce(()=>{N(),D.on("project-refresh",()=>{v.fetchRequirements(i.projectId,{silent:!0}).then(({data:F})=>{F&&c("refresh")})})}),ve(U,F=>{F?D.on("project-refresh",async()=>{if(S.value){const{data:y}=await v.fetchRequirementById(S.value.id);y&&(S.value=y)}}):D.off("project-refresh")}),ve(()=>i.projectId,()=>{N()}),(F,y)=>{const p=We,T=ke("IconBtn");return n(),h(Z,{class:"pa-6"},{default:t(()=>[a(K)?(n(),f("div",gr,[e(xe,{type:"info",variant:"tonal",border:"start",class:"d-flex align-center"},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"24",class:"me-3"}),o("span",null,l(a(r)("projects.requirements.actions.generate_user_stories")),1)]),_:1})])):w("",!0),e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"4"},{default:t(()=>[e(ce,{modelValue:m.value,"onUpdate:modelValue":y[0]||(y[0]=g=>m.value=g),density:"compact",placeholder:a(r)("projects.requirements.actions.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(L,{cols:"12",md:"3"},{default:t(()=>[e(_e,{modelValue:b.value,"onUpdate:modelValue":y[1]||(y[1]=g=>b.value=g),items:E,density:"compact","hide-details":"",label:a(r)("projects.requirements.actions.category"),variant:"outlined",multiple:"",chips:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"3"},{default:t(()=>[e(_e,{modelValue:C.value,"onUpdate:modelValue":y[2]||(y[2]=g=>C.value=g),items:B,density:"compact","hide-details":"",label:a(r)("projects.requirements.actions.status"),variant:"outlined",multiple:"",chips:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[O.value?(n(),h(P,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:M,loading:A.value,block:""},{default:t(()=>[u(l(a(r)("projects.requirements.actions.add")),1)]),_:1},8,["loading"])):w("",!0)]),_:1})]),_:1}),e(ne,{class:"my-5"}),s.loading?(n(),f("div",yr,[e(me,{indeterminate:"",color:"primary"})])):a($).length===0?(n(),f("div",hr,[e(V,{icon:"tabler-file-search",size:"64",color:"secondary",class:"mb-4"}),o("h4",br,l(a(r)("projects.requirements.empty.title")),1),o("p",jr,l(m.value||b.value.length>0||C.value.length>0?a(r)("projects.requirements.empty.filtered"):a(r)("projects.requirements.empty.no_requirements")),1),O.value&&!m.value&&b.value.length===0&&C.value.length===0?(n(),h(P,{key:0,color:"primary",onClick:M,"prepend-icon":"tabler-plus"},{default:t(()=>[u(l(a(r)("projects.requirements.actions.add_requirement")),1)]),_:1})):w("",!0)])):(n(),h(oe,{key:3},{default:t(()=>[(n(!0),f(ae,null,de(a($),g=>(n(),h(L,{key:g.id,cols:"12"},{default:t(()=>[e(te,{class:"requirement-card",onClick:re=>(async H=>{const{data:ue}=await v.fetchRequirementById(H.id);S.value=ue||H,U.value=!0})(g),border:"",hover:""},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:a(tt)(g.category),variant:"tonal",size:"42"},{default:t(()=>[g.category==="functional"?(n(),h(V,{key:0,icon:"tabler-function"})):g.category==="nonfunctional"?(n(),h(V,{key:1,icon:"tabler-chart-bar"})):g.category==="uiux"?(n(),h(V,{key:2,icon:"tabler-palette"})):(n(),h(V,{key:3,icon:"tabler-file-description"}))]),_:2},1032,["color"])]),append:t(()=>[o("div",kr,[g.user_stories&&g.user_stories.some(re=>re.generation_status==="in_progress"||re.generation_status==="pending")||g.mockups&&g.mockups.some(re=>re.generation_status==="in_progress"||re.generation_status==="pending"||re.needs_regeneration)?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):w("",!0),g.user_stories&&g.user_stories.some(re=>re.generation_status==="pending")||g.mockups&&g.mockups.some(re=>re.generation_status==="pending"||re.needs_regeneration)?(n(),h(J,{key:1,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(r)("projects.requirements.actions.generate_user_stories")),1)]),_:1})):w("",!0),e(J,{color:a(je)(g.status),size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${g.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(g.handle)+" "+l(g.title),1)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>{return[o("p",xr,l(ee(g.description)),1),o("div",wr,[o("div",Vr,[e(V,{size:"16",icon:"tabler-tag",class:"me-1"}),o("span",qr,l(a(r)(`projects.categories.${g.category}`)),1)]),o("div",Cr,[e(V,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",Sr,l((re=g.updated_at,re?(re=parseInt(re),new Date(re).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"")),1)]),o("div",Ur,[e(V,{size:"16",icon:"tabler-history",class:"me-1"}),o("span",zr,"v"+l(g.version_number),1)])]),g.user_stories&&g.user_stories.length>0?(n(),f("div",Ir,[e(P,{size:"small",variant:"tonal",color:"primary","prepend-icon":"tabler-user-check",onClick:we(H=>x(g),["stop"])},{default:t(()=>[u(l(g.user_stories.length)+" "+l(a(r)(g.user_stories.length===1?"projects.requirements.user_stories.single":"projects.requirements.user_stories.multiple")),1)]),_:2},1032,["onClick"])])):w("",!0)];var re}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),S.value?(n(),h(vr,{key:4,modelValue:U.value,"onUpdate:modelValue":y[3]||(y[3]=g=>U.value=g),requirement:S.value,onDelete:y[4]||(y[4]=g=>R.value=!0),onUpdate:G,onViewUserStories:x,"is-admin":a(X),"has-manager-permission":W.value,"has-moderator-permission":O.value},null,8,["modelValue","requirement","is-admin","has-manager-permission","has-moderator-permission"])):w("",!0),e(_r,{modelValue:z.value,"onUpdate:modelValue":y[5]||(y[5]=g=>z.value=g),onSubmit:q},null,8,["modelValue"]),e(p,{isDialogVisible:R.value,"onUpdate:isDialogVisible":y[6]||(y[6]=g=>R.value=g),confirmationMsg:a(r)("projects.requirements.delete_confirm.message"),onConfirm:k},null,8,["isDialogVisible","confirmationMsg"]),e(Ve,{modelValue:I.value.show,"onUpdate:modelValue":y[8]||(y[8]=g=>I.value.show=g),color:I.value.color,timeout:5e3},{actions:t(()=>[e(T,{onClick:y[7]||(y[7]=g=>I.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(I.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},$r=Ue(Dr,[["__scopeId","data-v-3c8f88b7"]]),Mr={key:0,class:"mb-4"},Pr={class:"d-flex align-center"},Br={key:1,class:"d-flex justify-center align-center",style:{height:"300px"}},Rr={key:2,class:"text-center pa-4"},Lr={class:"text-h6 mb-2"},Ar={class:"text-body-1 text-medium-emphasis mb-6"},Fr={class:"d-flex align-center"},Or={class:"mockup-preview mb-3"},Nr={class:"overflow-hidden position-relative rounded bg-grey-lighten-4",style:{height:"150px"}},Er={key:0,class:"d-flex justify-center align-center h-100"},Wr={class:"text-center"},Tr={class:"text-caption"},Gr={key:1,class:"html-preview"},Xr={key:2,class:"d-flex justify-center align-center h-100"},Hr={class:"preview-overlay d-flex justify-center align-center"},Jr={key:0,class:"mb-2"},Kr={key:1,class:"mb-2"},Zr={class:"text-caption font-weight-medium"},Qr={key:2,class:"mb-2"},Yr={class:"text-caption font-weight-medium"},es={class:"d-flex align-center justify-space-between"},ts={class:"d-flex align-center"},as={class:"text-caption"},ls={__name:"ProjectMockupsList",props:{projectId:{type:String,required:!0},mockups:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(s,{emit:c}){const i=s,r=Qe(),v=Be(),{t:d}=he(),m=j(""),b=j(null),C=j(!1),S=j(!1),U=j(!1);j(null);const z=j({show:!1,text:"",color:"success"}),R=Y(()=>v.is_admin()),A=j(!1),I=j(!1),X=async()=>{A.value=await v.hasProjectRoleAtLeast(i.projectId,"MANAGER"),I.value=await v.hasProjectRoleAtLeast(i.projectId,"ADMIN")},W=Y(()=>i.mockups.filter(B=>B.needs_regeneration||B.generation_status==="in_progress"||B.generation_status==="pending").length),O=Y(()=>i.mockups.filter(B=>!m.value||B.name.toLowerCase().includes(m.value.toLowerCase())||B.requirement&&B.requirement.toLowerCase().includes(m.value.toLowerCase()))),Q=Te(),N=async()=>{if(b.value){U.value=!0,S.value=!1;try{const{success:B,error:$}=await r.deleteMockupById(b.value.id);B&&!$?(K(d("projects.mockups.notifications.deleted")),c("refresh"),C.value=!1):K(d("projects.mockups.notifications.delete_failed"),"error")}catch(B){K(d("projects.mockups.notifications.delete_failed")+": "+B.message,"error")}finally{U.value=!1}}},K=(B,$="success")=>{z.value={show:!0,text:B,color:$}},E=Y(()=>i.mockups.some(B=>B.generation_status==="in_progress"||B.generation_status==="pending"||B.needs_regeneration));return Ce(()=>{X(),Q.on("project-refresh",()=>{r.fetchProjectMockups(i.projectId).then(({data:B})=>{B&&c("refresh")})})}),ve(C,B=>{B?Q.on("project-refresh",async()=>{if(b.value){const{data:$}=await r.fetchMockupById(b.value.id);$&&(b.value=$)}}):Q.off("project-refresh")}),ve(()=>i.projectId,()=>{X()}),(B,$)=>{const D=We,M=ke("IconBtn");return n(),h(Z,{class:"pa-6"},{default:t(()=>[a(E)?(n(),f("div",Mr,[e(xe,{type:"info",variant:"tonal",border:"start",class:"d-flex align-center"},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"24",class:"me-3"}),o("span",null,l(a(d)("projects.mockups.status.generating")),1)]),_:1})])):w("",!0),e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"6"},{default:t(()=>[e(ce,{modelValue:m.value,"onUpdate:modelValue":$[0]||($[0]=q=>m.value=q),density:"compact",placeholder:a(d)("projects.mockups.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(L,{cols:"12",md:"6",class:"d-flex align-center"},{default:t(()=>[a(W)>0?(n(),h(xe,{key:0,type:"info",variant:"tonal",density:"compact",class:"mb-0 flex-grow-1 me-2"},{default:t(()=>[o("div",Pr,[e(me,{indeterminate:"",color:"info",size:"16",width:"2",class:"me-2"}),o("span",null,l(a(W))+" "+l(a(d)("projects.mockups.status.pending_count")),1)])]),_:1})):w("",!0)]),_:1})]),_:1}),e(ne,{class:"my-5"}),s.loading?(n(),f("div",Br,[e(me,{indeterminate:"",color:"primary"})])):a(O).length===0?(n(),f("div",Rr,[e(V,{icon:"tabler-photo-off",size:"64",color:"secondary",class:"mb-4"}),o("h4",Lr,l(a(d)("projects.mockups.empty.title")),1),o("p",Ar,l(m.value?a(d)("projects.mockups.empty.filtered"):a(d)("projects.mockups.empty.description")),1)])):(n(),h(oe,{key:3},{default:t(()=>[(n(!0),f(ae,null,de(a(O),q=>(n(),h(L,{key:q.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(te,{class:"mockup-card h-100",onClick:G=>(async k=>{const{data:x}=await r.fetchMockupById(k.id);b.value=x||k,C.value=!0})(q),border:"",hover:""},{default:t(()=>[e(fe,null,{append:t(()=>[o("div",Fr,[q.generation_status==="in_progress"||q.generation_status==="pending"||q.needs_regeneration?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):w("",!0),q.generation_status==="pending"||q.needs_regeneration?(n(),h(J,{key:1,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(d)("projects.mockups.status.generating")),1)]),_:1})):w("",!0),e(J,{color:a(je)(q.status),size:"small",label:""},{default:t(()=>[u(l(a(d)(`projects.status.${q.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(q.name),1)]),_:2},1024)]),_:2},1024),e(ne),e(Z,null,{default:t(()=>{return[o("div",Or,[o("div",Nr,[q.generation_status==="in_progress"||q.generation_status==="pending"?(n(),f("div",Er,[o("div",Wr,[e(me,{indeterminate:"",color:"primary",size:"40",class:"mb-2"}),o("div",Tr,l(a(d)("projects.mockups.status.generating")),1)])])):q.image?(n(),f("div",Gr,[e(Ee,{src:q.image,alt:q.name},null,8,["src","alt"])])):(n(),f("div",Xr,[e(V,{icon:"tabler-file-code",size:"48",color:"secondary"})])),o("div",Hr,[e(P,{color:"primary",variant:"elevated",size:"small","prepend-icon":"tabler-eye",disabled:q.generation_status==="in_progress"||q.generation_status==="pending"},{default:t(()=>[u(l(a(d)("projects.mockups.actions.preview")),1)]),_:2},1032,["disabled"])])])]),q.needs_regeneration?(n(),f("div",Jr,[e(J,{color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(d)("projects.mockups.status.regenerating")),1)]),_:1})])):w("",!0),q.requirement?(n(),f("div",Kr,[o("span",Zr,l(a(d)("projects.details.requirement"))+": ",1),e(J,{size:"x-small",color:"primary",class:"ms-1"},{default:t(()=>[u(l(q.requirement_name),1)]),_:2},1024)])):w("",!0),q.user_story?(n(),f("div",Qr,[o("span",Yr,l(a(d)("projects.details.user_story"))+": ",1),e(J,{size:"x-small",color:"primary",class:"ms-1"},{default:t(()=>[u(l(q.user_story_name),1)]),_:2},1024)])):w("",!0),o("div",es,[o("div",ts,[e(V,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",as,l((G=q.created_at,G?new Date(parseInt(G)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"")),1)])])];var G}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),b.value?(n(),h(nt,{key:4,modelValue:C.value,"onUpdate:modelValue":$[1]||($[1]=q=>C.value=q),mockup:b.value,onDelete:$[2]||($[2]=q=>S.value=!0),"is-admin":a(R),"has-manager-permission":A.value},null,8,["modelValue","mockup","is-admin","has-manager-permission"])):w("",!0),e(D,{isDialogVisible:S.value,"onUpdate:isDialogVisible":$[3]||($[3]=q=>S.value=q),confirmationMsg:a(d)("projects.mockups.delete_confirm.message"),onConfirm:N},null,8,["isDialogVisible","confirmationMsg"]),e(Ve,{modelValue:z.value.show,"onUpdate:modelValue":$[5]||($[5]=q=>z.value.show=q),color:z.value.color,timeout:5e3},{actions:t(()=>[e(M,{onClick:$[4]||($[4]=q=>z.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(z.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},rs=Ue(ls,[["__scopeId","data-v-aa91b02c"]]),qt=Oe({id:"DevelopmentPlanStore",state:()=>({plans:[],currentPlan:null,loading:!1,error:null}),actions:{async fetchDevelopmentPlans(s=null){this.loading=!0;try{let c="/service/development-plans/";s&&(c+=`?project=${s}`);const i=await ie.get(c);return i.status===200?(this.plans=i.data,{data:i.data,error:null}):{data:[],error:i.data}}catch(c){return this.error=c.message||"Failed to fetch development plans",{data:[],error:this.error}}finally{this.loading=!1}},async fetchDevelopmentPlanById(s){this.loading=!0;try{const c=await ie.get(`/service/development-plans/${s}/`);return c.status===200?(this.currentPlan=c.data,{data:c.data,error:null}):{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to fetch development plan",{data:null,error:this.error}}finally{this.loading=!1}},async createDevelopmentPlan(s){this.loading=!0;try{const c=await ie.post("/service/development-plans/",{project:s,status:"draft"});return c.status===201?{data:c.data,error:null}:{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to create development plan",{data:null,error:this.error}}finally{this.loading=!1}},async updateDevelopmentPlan(s,c){this.loading=!0;try{const i=await ie.put(`/service/development-plans/${s}/`,c);return i.status===200?(this.currentPlan&&this.currentPlan.id===s&&(this.currentPlan=i.data),{data:i.data,error:null}):{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to update development plan",{data:null,error:this.error}}finally{this.loading=!1}},async createPlanVersion(s,c){this.loading=!0;try{const i=await ie.post(`/service/development-plans/${s}/new_version/`,c);return i.status===201?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to create plan version",{data:null,error:this.error}}finally{this.loading=!1}},async fetchPlanVersionById(s){this.loading=!0;try{const c=await ie.get(`/service/development-plan-versions/${s}/`);return c.status===200?{data:c.data,error:null}:{data:null,error:c.data}}catch(c){return this.error=c.message||"Failed to fetch plan version",{data:null,error:this.error}}finally{this.loading=!1}},async updatePlanVersion(s,c){this.loading=!0;try{const i=await ie.put(`/service/development-plan-versions/${s}/`,c);return i.status===200?{data:i.data,error:null}:{data:null,error:i.data}}catch(i){return this.error=i.message||"Failed to update plan version",{data:null,error:this.error}}finally{this.loading=!1}},async setCurrentPlanVersion(s,c,i){this.loading=!0;try{const r=await this.fetchDevelopmentPlanById(s);if(!r.data)return{data:null,error:"Plan not found"};const v=await this.fetchPlanVersionById(c);return v.data?await this.updateDevelopmentPlan(s,{current_version_number:v.data.version_number,status:r.data.status,project:i}):{data:null,error:"Version not found"}}catch(r){return this.error=r.message||"Failed to set current plan version",{data:null,error:this.error}}finally{this.loading=!1}}}}),Ct=s=>(Rt("data-v-a1b84d78"),s=s(),Lt(),s),ss={key:0,class:"text-h5"},os={key:1,class:"text-h5"},is={key:0},ns={class:"text-left",style:{"min-width":"200px"}},cs={class:"text-right",style:{"min-width":"120px"}},us={class:"text-right",style:{"min-width":"120px"}},ds={class:"text-right",style:{"min-width":"120px"}},ms=Ct(()=>o("th",{class:"text-right",style:{width:"50px"}},null,-1)),ps={class:"text-right"},vs={colspan:"3",class:"text-right font-weight-bold"},fs={class:"text-right font-weight-bold"},_s=Ct(()=>o("td",null,null,-1)),gs={key:1},ys={class:"d-flex flex-wrap justify-space-between mb-4"},hs={class:"d-flex align-center"},bs={class:"d-flex align-center"},js={class:"text-caption"},ks={key:0,class:"text-caption ms-3"},xs={class:"text-h4 font-weight-bold"},ws={class:"text-caption text-medium-emphasis text-right"},Vs={class:"text-left",style:{"min-width":"200px"}},qs={class:"text-right",style:{"min-width":"120px"}},Cs={class:"text-right",style:{"min-width":"120px"}},Ss={class:"text-right",style:{"min-width":"120px"}},Us={class:"text-right"},zs={class:"text-right"},Is={class:"text-right"},Ds={key:0},$s={colspan:"4",class:"text-center"},Ms={class:"text-body-1 whitespace-pre-wrap"},Ps=Ue({__name:"PlanVersionDialog",props:{modelValue:{type:Boolean,default:!1},version:{type:Object,required:!0},isCurrent:{type:Boolean,default:!1},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},planId:{type:String,default:null},projectId:{type:String,default:null},preliminaryBudget:{type:Number,default:0}},emits:["update:modelValue","refresh"],setup(s,{emit:c}){const i=s,{t:r}=he(),v=Y({get:()=>i.modelValue,set:$=>c("update:modelValue",$)}),d=qt(),m=j(!1),b=j({...i.version}),C=j([]),S=j(!1),U=j({show:!1,text:"",color:"success"}),z=j(null),R=Y(()=>C.value.reduce(($,D)=>$+D.cost,0)),A=Y(()=>i.preliminaryBudget>0&&R.value>i.preliminaryBudget),I=$=>$||$===0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format($):"-",X=()=>{m.value&&(b.value={...i.version},C.value=E(i.version.roles_and_hours)),m.value=!m.value},W=()=>{v.value&&d.fetchPlanVersionById(i.version.id).then(({data:$})=>{$&&(Object.assign(i.version,$),m.value||(C.value=E($.roles_and_hours)))})};Ce(()=>{C.value=E(i.version.roles_and_hours),z.value=setInterval(W,5e3)}),Ne(()=>{z.value&&clearInterval(z.value)});const O=()=>{C.value.push({role:"",hours:0,cost:0})},Q=$=>{$.cost=$.hours*($.rate||30)},N=async()=>{S.value=!0;try{const $={...b.value,roles_and_hours:JSON.stringify(C.value),estimated_cost:R.value},{data:D,error:M}=await d.updatePlanVersion(i.version.id,$);D&&!M?(B(r("projects.development_plan.notifications.version_updated")),Object.assign(i.version,D),m.value=!1,v.value=!1,c("refresh")):B(r("projects.development_plan.notifications.version_update_failed"),"error")}catch($){B(r("projects.development_plan.notifications.version_update_failed")+": "+$.message,"error")}finally{S.value=!1}},K=async()=>{if(i.planId){S.value=!0;try{const{data:$,error:D}=await d.setCurrentPlanVersion(i.planId,i.version.id,i.projectId);$&&!D?(B(r("projects.development_plan.notifications.set_current_success")),v.value=!1,c("refresh")):B(r("projects.development_plan.notifications.set_current_failed"),"error")}catch($){B(r("projects.development_plan.notifications.set_current_failed")+": "+$.message,"error")}finally{S.value=!1}}},E=$=>{if(!$)return[];try{return typeof $=="string"?JSON.parse($):$}catch(D){return console.error("Error parsing roles and hours:",D),[]}},B=($,D="success")=>{U.value={show:!0,text:$,color:D}};return ve(()=>i.version,$=>{b.value={...$},C.value=E($.roles_and_hours)},{deep:!0}),($,D)=>{const M=ke("IconBtn");return n(),h(be,{modelValue:a(v),"onUpdate:modelValue":D[6]||(D[6]=q=>De(v)?v.value=q:null),"max-width":"900",scrollable:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex py-3 px-5"},{default:t(()=>[m.value?(n(),f("h5",ss,l(a(r)("projects.development_plan.actions.edit")),1)):(n(),f("h5",os,[u(l(a(r)("projects.development_plan.version.version"))+" "+l(s.version.version_number)+" ",1),s.isCurrent?(n(),h(J,{key:0,color:"primary",size:"small",label:"",class:"ms-2"},{default:t(()=>[u(l(a(r)("projects.development_plan.version.current")),1)]),_:1})):w("",!0)])),e(le),e(M,{onClick:D[0]||(D[0]=q=>v.value=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),_:1}),e(ne),e(Z,{class:"pa-6"},{default:t(()=>[m.value?(n(),f("div",is,[e(Se,{onSubmit:we(N,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12",md:"4"},{default:t(()=>[e(ce,{modelValue:b.value.estimated_cost,"onUpdate:modelValue":D[1]||(D[1]=q=>b.value.estimated_cost=q),modelModifiers:{number:!0},label:a(r)("projects.development_plan.estimated_cost"),type:"number",required:"",disabled:"","model-value":a(R)},null,8,["modelValue","label","model-value"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:b.value.status,"onUpdate:modelValue":D[2]||(D[2]=q=>b.value.status=q),label:a(r)("projects.details.status"),items:[{title:a(r)("projects.status.draft"),value:"draft"},{title:a(r)("projects.status.active"),value:"active"},{title:a(r)("projects.status.archived"),value:"archived"},{title:a(r)("projects.status.completed"),value:"completed"}],required:""},null,8,["modelValue","label","items"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(te,{variant:"outlined"},{default:t(()=>[e(se,{class:"d-flex align-center"},{default:t(()=>[u(l(a(r)("projects.development_plan.version.roles_hours_breakdown"))+" ",1),e(le),e(P,{color:"primary",variant:"tonal",size:"small","prepend-icon":"tabler-plus",onClick:O},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.add_role")),1)]),_:1})]),_:1}),e(Z,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(Pe,null,{default:t(()=>[o("thead",null,[o("tr",null,[o("th",ns,l(a(r)("projects.development_plan.version.role")),1),o("th",cs,l(a(r)("projects.development_plan.version.hours")),1),o("th",us,l(a(r)("projects.development_plan.version.rate")),1),o("th",ds,l(a(r)("projects.development_plan.version.cost")),1),ms])]),o("tbody",null,[(n(!0),f(ae,null,de(C.value,(q,G)=>(n(),f("tr",{key:G},[o("td",null,[e(ce,{modelValue:q.role,"onUpdate:modelValue":k=>q.role=k,density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[e(ce,{modelValue:q.hours,"onUpdate:modelValue":[k=>q.hours=k,k=>Q(q)],modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[e(ce,{modelValue:q.rate,"onUpdate:modelValue":[k=>q.rate=k,k=>Q(q)],modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right","model-value":q.rate||30},null,8,["modelValue","onUpdate:modelValue","model-value"])]),o("td",null,[e(ce,{modelValue:q.cost,"onUpdate:modelValue":k=>q.cost=k,modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),o("td",ps,[e(P,{icon:"",variant:"text",color:"error",size:"small",onClick:k=>(x=>{C.value.splice(x,1)})(G)},{default:t(()=>[e(V,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128))]),o("tfoot",null,[o("tr",null,[o("td",vs,l(a(r)("projects.development_plan.version.total"))+": ",1),o("td",fs,l(a(R).toLocaleString("en-US",{style:"currency",currency:"USD"})),1),_s])])]),_:1})]),_:1}),e(L,{cols:"12"},{default:t(()=>[a(A)?(n(),h(xe,{key:0,type:"warning",variant:"tonal",class:"mt-4"},{default:t(()=>[u(l(a(r)("projects.development_plan.validation.over_budget",{total:a(R).toLocaleString("en-US",{style:"currency",currency:"USD"}),budget:s.preliminaryBudget.toLocaleString("en-US",{style:"currency",currency:"USD"})})),1)]),_:1})):w("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:b.value.notes,"onUpdate:modelValue":D[3]||(D[3]=q=>b.value.notes=q),label:a(r)("projects.development_plan.notes"),rows:"4"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),f("div",gs,[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>{return[o("div",ys,[o("div",hs,[e(J,{color:a(je)(s.version.status),size:"small",label:""},{default:t(()=>[u(l(Bt(s.version.status)),1)]),_:1},8,["color"])]),o("div",bs,[o("span",js,l(a(r)("projects.development_plan.version.created"))+": "+l((q=s.version.created_at,q?new Date(parseInt(q)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"")),1),s.version.created_by?(n(),f("span",ks,l(a(r)("projects.development_plan.version.created_by"))+": "+l(s.version.created_by.username),1)):w("",!0)]),o("div",null,[o("h4",xs,l(I(s.version.estimated_cost)),1),o("div",ws,l(a(r)("projects.development_plan.version.estimated_total_cost")),1)])])];var q}),_:1}),e(L,{cols:"12"},{default:t(()=>[a(A)?(n(),h(xe,{key:0,type:"warning",variant:"tonal",class:"mt-4"},{default:t(()=>[u(l(a(r)("projects.development_plan.validation.over_budget",{total:a(R).toLocaleString("en-US",{style:"currency",currency:"USD"}),budget:s.preliminaryBudget.toLocaleString("en-US",{style:"currency",currency:"USD"})})),1)]),_:1})):w("",!0)]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(te,{variant:"outlined",class:"mb-4"},{default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.development_plan.version.roles_hours_breakdown")),1)]),_:1}),e(Z,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(Pe,null,{default:t(()=>[o("thead",null,[o("tr",null,[o("th",Vs,l(a(r)("projects.development_plan.version.role")),1),o("th",qs,l(a(r)("projects.development_plan.version.hours")),1),o("th",Cs,l(a(r)("projects.development_plan.version.rate")),1),o("th",Ss,l(a(r)("projects.development_plan.version.cost")),1)])]),o("tbody",null,[(n(!0),f(ae,null,de(C.value,(q,G)=>(n(),f("tr",{key:G},[o("td",null,l(q.role),1),o("td",Us,l(q.hours),1),o("td",zs,l(q.rate||30),1),o("td",Is,l(I(q.cost)),1)]))),128)),C.value.length===0?(n(),f("tr",Ds,[o("td",$s,l(a(r)("projects.development_plan.version.no_roles")),1)])):w("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s.version.notes?(n(),h(L,{key:0,cols:"12"},{default:t(()=>[e(te,{variant:"outlined"},{default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.development_plan.notes")),1)]),_:1}),e(Z,null,{default:t(()=>[o("div",Ms,l(s.version.notes),1)]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1})]))]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[m.value?(n(),f(ae,{key:0},[e(P,{color:"secondary",variant:"tonal",onClick:X,disabled:S.value},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1},8,["disabled"]),e(le),e(P,{color:"primary",onClick:N,loading:S.value},{default:t(()=>[u(l(a(r)("projects.actions.save")),1)]),_:1},8,["loading"])],64)):(n(),f(ae,{key:1},[!s.isCurrent&&s.hasManagerPermission?(n(),h(P,{key:0,color:"primary",variant:"tonal",onClick:K,loading:S.value,"prepend-icon":"tabler-check"},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.set_current")),1)]),_:1},8,["loading"])):w("",!0),e(le),s.hasManagerPermission?(n(),h(P,{key:1,color:"primary","prepend-icon":"tabler-edit",onClick:X},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.edit")),1)]),_:1})):w("",!0)],64))]),_:1})]),_:1}),e(Ve,{modelValue:U.value.show,"onUpdate:modelValue":D[5]||(D[5]=q=>U.value.show=q),color:U.value.color,timeout:5e3},{actions:t(()=>[e(M,{onClick:D[4]||(D[4]=q=>U.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(U.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-a1b84d78"]]),Bs={class:"text-h5"},Rs={class:"text-subtitle-1 mb-4"},Ls={class:"text-left",style:{"min-width":"200px"}},As={class:"text-right",style:{"min-width":"120px"}},Fs={class:"text-right",style:{"min-width":"120px"}},Os={class:"text-right",style:{"min-width":"120px"}},Ns=o("th",{class:"text-right",style:{width:"50px"}},null,-1),Es={class:"text-right"},Ws={colspan:"3",class:"text-right font-weight-bold"},Ts={class:"text-right font-weight-bold"},Gs=o("td",null,null,-1),Xs={__name:"PlanVersionCreateDialog",props:{modelValue:{type:Boolean,default:!1},planId:{type:String,required:!0},projectId:{type:String,required:!0},currentVersionNumber:{type:Number,default:0},preliminaryBudget:{type:Number,default:0}},emits:["update:modelValue","submit"],setup(s,{emit:c}){const i=s,{t:r}=he(),v=Y({get:()=>i.modelValue,set:W=>c("update:modelValue",W)}),d=j([{role:"Product Manager",hours:60,cost:1800},{role:"System Analyst",hours:40,cost:1e3},{role:"UX/UI Designer",hours:90,cost:2250},{role:"Flutter Developer (Middle)",hours:240,cost:4800},{role:"Backend Developer",hours:120,cost:2400},{role:"QA Engineer",hours:80,cost:1440},{role:"DevOps/Deployment Specialist",hours:20,cost:400},{role:"Support/Documentation Specialist",hours:16,cost:320}]),m=j({estimated_cost:1e4,notes:"",status:"draft"}),b=Y(()=>d.value.reduce((W,O)=>W+O.cost,0)),C=Y(()=>i.preliminaryBudget>0&&b.value>i.preliminaryBudget),S=[W=>!!W||r("projects.development_plan.validation.estimated_cost_required"),W=>!isNaN(parseFloat(W))||r("projects.development_plan.validation.estimated_cost_number")],U=j(null),z=()=>{d.value=[{role:"Product Manager",hours:60,cost:1800},{role:"System Analyst",hours:40,cost:1e3},{role:"UX/UI Designer",hours:90,cost:2250},{role:"Flutter Developer (Middle)",hours:240,cost:4800},{role:"Backend Developer",hours:120,cost:2400},{role:"QA Engineer",hours:80,cost:1440},{role:"DevOps/Deployment Specialist",hours:20,cost:400},{role:"Support/Documentation Specialist",hours:16,cost:320}],m.value={estimated_cost:1e4,notes:"",status:"draft"},U.value&&U.value.resetValidation()},R=()=>{v.value=!1,z()},A=()=>{d.value.push({role:"",hours:0,cost:0})},I=W=>{W.cost=W.hours*(W.rate||30)},X=async()=>{const{valid:W}=await U.value.validate();if(W){const O={...m.value,roles_and_hours:JSON.stringify(d.value),estimated_cost:b.value};c("submit",O),v.value=!1,z()}};return ve(v,W=>{W||z()}),(W,O)=>{const Q=ke("IconBtn");return n(),h(be,{modelValue:a(v),"onUpdate:modelValue":O[3]||(O[3]=N=>De(v)?v.value=N:null),"max-width":"900",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex pt-5 px-5"},{default:t(()=>[o("h5",Bs,l(a(r)("projects.development_plan.actions.new_version")),1),e(le),e(Q,{onClick:R},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),_:1}),e(Z,{class:"px-5 pt-4"},{default:t(()=>[o("p",Rs,l(a(r)("projects.development_plan.creating_version",{version:s.currentVersionNumber+1})),1),e(Se,{ref_key:"formRef",ref:U,onSubmit:we(X,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12",md:"6"},{default:t(()=>[e(ce,{modelValue:m.value.estimated_cost,"onUpdate:modelValue":O[0]||(O[0]=N=>m.value.estimated_cost=N),modelModifiers:{number:!0},label:a(r)("projects.development_plan.estimated_cost"),type:"number",rules:S,required:"",disabled:"","model-value":a(b)},null,8,["modelValue","label","model-value"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:m.value.status,"onUpdate:modelValue":O[1]||(O[1]=N=>m.value.status=N),label:a(r)("projects.details.status"),items:[{title:a(r)("projects.status.draft"),value:"draft"},{title:a(r)("projects.status.active"),value:"active"},{title:a(r)("projects.status.archived"),value:"archived"},{title:a(r)("projects.status.completed"),value:"completed"}],required:""},null,8,["modelValue","label","items"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(te,{variant:"outlined"},{default:t(()=>[e(se,{class:"d-flex align-center"},{default:t(()=>[u(l(a(r)("projects.development_plan.version.roles_hours_breakdown"))+" ",1),e(le),e(P,{color:"primary",variant:"tonal",size:"small","prepend-icon":"tabler-plus",onClick:A},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.add_role")),1)]),_:1})]),_:1}),e(Z,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(Pe,null,{default:t(()=>[o("thead",null,[o("tr",null,[o("th",Ls,l(a(r)("projects.development_plan.version.role")),1),o("th",As,l(a(r)("projects.development_plan.version.hours")),1),o("th",Fs,l(a(r)("projects.development_plan.version.rate")),1),o("th",Os,l(a(r)("projects.development_plan.version.cost")),1),Ns])]),o("tbody",null,[(n(!0),f(ae,null,de(d.value,(N,K)=>(n(),f("tr",{key:K},[o("td",null,[e(ce,{modelValue:N.role,"onUpdate:modelValue":E=>N.role=E,density:"compact","hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[e(ce,{modelValue:N.hours,"onUpdate:modelValue":[E=>N.hours=E,E=>I(N)],modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[e(ce,{modelValue:N.rate,"onUpdate:modelValue":[E=>N.rate=E,E=>I(N)],modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right","model-value":N.rate||30},null,8,["modelValue","onUpdate:modelValue","model-value"])]),o("td",null,[e(ce,{modelValue:N.cost,"onUpdate:modelValue":E=>N.cost=E,modelModifiers:{number:!0},type:"number",density:"compact","hide-details":"",variant:"outlined",class:"text-right",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),o("td",Es,[e(P,{icon:"",variant:"text",color:"error",size:"small",onClick:E=>(B=>{d.value.splice(B,1)})(K)},{default:t(()=>[e(V,{icon:"tabler-trash"})]),_:2},1032,["onClick"])])]))),128))]),o("tfoot",null,[o("tr",null,[o("td",Ws,l(a(r)("projects.development_plan.version.total"))+": ",1),o("td",Ts,l(a(b).toLocaleString("en-US",{style:"currency",currency:"USD"})),1),Gs])])]),_:1})]),_:1}),e(L,{cols:"12"},{default:t(()=>[a(C)?(n(),h(xe,{key:0,type:"warning",variant:"tonal",class:"mt-4"},{default:t(()=>[u(l(a(r)("projects.development_plan.validation.over_budget",{total:a(b).toLocaleString("en-US",{style:"currency",currency:"USD"}),budget:s.preliminaryBudget.toLocaleString("en-US",{style:"currency",currency:"USD"})})),1)]),_:1})):w("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:m.value.notes,"onUpdate:modelValue":O[2]||(O[2]=N=>m.value.notes=N),label:a(r)("projects.development_plan.notes"),rows:"4"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[e(P,{variant:"tonal",color:"secondary",onClick:R},{default:t(()=>[u(l(a(r)("projects.actions.cancel")),1)]),_:1}),e(le),e(P,{color:"primary",onClick:X},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.create_version")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Hs={key:0,class:"d-flex justify-center align-center",style:{height:"300px"}},Js={key:1,class:"text-center pa-6"},Ks={class:"text-h6 mb-2"},Zs={class:"text-body-1 text-medium-emphasis mb-6"},Qs={key:2},Ys={class:"d-flex flex-column"},eo={class:"text-h6 mb-2"},to={class:"text-h4 font-weight-bold"},ao={class:"text-caption text-medium-emphasis"},lo={class:"text-h6 mb-3"},ro={class:"text-right"},so={class:"text-right"},oo={class:"text-right"},io={class:"text-right"},no={class:"d-flex align-center justify-space-between mb-4"},co={class:"text-h5"},uo={class:"text-right"},mo={class:"text-right"},po=["onClick"],vo={class:"d-flex align-center"},fo={class:"font-weight-medium"},_o={class:"text-right"},go={class:"text-right"},yo={key:1,class:"text-center pa-4"},ho={class:"text-medium-emphasis"},bo={key:2,class:"text-center pa-4"},jo={class:"text-medium-emphasis"},ko={__name:"ProjectDevelopmentPlan",props:{projectId:{type:String,required:!0},developmentPlan:{type:Object,default:()=>({})},loading:{type:Boolean,default:!1},preliminaryBudget:{type:Number,default:0}},emits:["refresh"],setup(s,{emit:c}){const i=s,{t:r}=he(),v=qt(),d=Be(),m=j(null),b=j(!1),C=j(!1),S=j(!1),U=j({show:!1,text:"",color:"success"}),z=Y(()=>d.is_admin()),R=j(!1),A=async()=>{R.value=await d.hasProjectRoleAtLeast(i.projectId,"MANAGER")},I=Y(()=>i.developmentPlan&&i.developmentPlan.id),X=Y(()=>I.value&&i.developmentPlan.versions?[...i.developmentPlan.versions].sort((M,q)=>q.version_number-M.version_number):[]),W=Y(()=>I.value?X.value.find(M=>M.version_number===i.developmentPlan.current_version_number):null),O=M=>M?new Date(parseInt(M)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",Q=M=>M||M===0?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(M):"-",N=M=>{m.value=M,b.value=!0},K=()=>{C.value=!0},E=async M=>{S.value=!0;try{const{data:q,error:G}=await v.createPlanVersion(i.developmentPlan.id,M);q&&!G?($(r("projects.development_plan.notifications.version_created")),c("refresh")):$(r("projects.development_plan.notifications.version_create_failed"),"error")}catch(q){$(r("projects.development_plan.notifications.version_create_failed")+": "+q.message,"error")}finally{S.value=!1,C.value=!1}},B=async()=>{S.value=!0;try{const{data:M,error:q}=await v.createDevelopmentPlan(i.projectId);M&&!q?($(r("projects.development_plan.notifications.created")),c("refresh")):$(r("projects.development_plan.notifications.create_failed"),"error")}catch(M){$(r("projects.development_plan.notifications.create_failed")+": "+M.message,"error")}finally{S.value=!1}},$=(M,q="success")=>{U.value={show:!0,text:M,color:q}},D=M=>{if(!M)return[];try{return typeof M=="string"?JSON.parse(M):M}catch(q){return console.error("Error parsing roles and hours:",q),[]}};return A(),ve(()=>i.projectId,()=>{A()}),(M,q)=>{const G=ke("IconBtn");return n(),h(Z,{class:"pa-6"},{default:t(()=>[s.loading?(n(),f("div",Hs,[e(me,{indeterminate:"",color:"primary"})])):a(I)?(n(),f("div",Qs,[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(te,{border:"",class:"mb-4"},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:"primary",variant:"tonal",rounded:"",size:"42"},{default:t(()=>[e(V,{icon:"tabler-calendar-stats"})]),_:1})]),append:t(()=>[e(J,{color:"primary",size:"small",label:"",class:"me-2"},{default:t(()=>[u(" v"+l(s.developmentPlan.current_version_number),1)]),_:1}),e(J,{color:s.developmentPlan.status==="active"?"success":"warning",size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${s.developmentPlan.status}`)),1)]),_:1},8,["color"])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(r)("projects.development_plan.current_plan")),1)]),_:1})]),_:1}),e(ne),a(W)?(n(),h(Z,{key:0},{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"4"},{default:t(()=>[o("div",Ys,[o("div",eo,l(a(r)("projects.development_plan.estimated_cost")),1),o("div",to,l(Q(a(W).estimated_cost)),1),o("div",ao,l(a(r)("projects.development_plan.version.created"))+": "+l(O(a(W).created_at)),1)])]),_:1}),e(L,{cols:"12",md:"8"},{default:t(()=>[o("div",lo,l(a(r)("projects.development_plan.version.roles_hours_breakdown")),1),e(Pe,{density:"compact"},{default:t(()=>[o("thead",null,[o("tr",null,[o("th",null,l(a(r)("projects.development_plan.version.role")),1),o("th",ro,l(a(r)("projects.development_plan.version.hours")),1),o("th",so,l(a(r)("projects.development_plan.version.cost")),1)])]),o("tbody",null,[(n(!0),f(ae,null,de(D(a(W).roles_and_hours),(k,x)=>(n(),f("tr",{key:x},[o("td",null,l(k.role),1),o("td",oo,l(k.hours),1),o("td",io,l(Q(k.cost)),1)]))),128))])]),_:1}),e(P,{color:"primary",variant:"tonal",class:"mt-4",size:"small",onClick:q[0]||(q[0]=k=>N(a(W)))},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.view_details")),1)]),_:1})]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1}),e(L,{cols:"12"},{default:t(()=>[o("div",no,[o("h5",co,l(a(r)("projects.development_plan.version_history")),1),R.value?(n(),h(P,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:K,disabled:S.value},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.new_version")),1)]),_:1},8,["disabled"])):w("",!0)]),a(X).length>1?(n(),h(Pe,{key:0},{default:t(()=>[o("thead",null,[o("tr",null,[o("th",null,l(a(r)("projects.development_plan.version.version")),1),o("th",null,l(a(r)("projects.development_plan.version.created")),1),o("th",null,l(a(r)("projects.details.status")),1),o("th",uo,l(a(r)("projects.development_plan.estimated_cost")),1),o("th",mo,l(a(r)("projects.actions.title")),1)])]),o("tbody",null,[(n(!0),f(ae,null,de(a(X),k=>(n(),f("tr",{key:k.id,class:lt({"bg-primary-lighten-5":k.version_number===s.developmentPlan.current_version_number}),style:{cursor:"pointer"},onClick:x=>N(k)},[o("td",null,[o("div",vo,[o("span",fo,"v"+l(k.version_number),1),k.version_number===s.developmentPlan.current_version_number?(n(),h(J,{key:0,color:"primary",size:"x-small",label:"",class:"ms-2"},{default:t(()=>[u(l(a(r)("projects.development_plan.version.current")),1)]),_:1})):w("",!0)])]),o("td",null,l(O(k.created_at)),1),o("td",null,[e(J,{color:k.status==="active"?"success":"warning",size:"small",label:""},{default:t(()=>[u(l(a(r)(`projects.status.${k.status}`)),1)]),_:2},1032,["color"])]),o("td",_o,l(Q(k.estimated_cost)),1),o("td",go,[e(P,{icon:"",variant:"text",size:"small",color:"primary",onClick:we(x=>N(k),["stop"])},{default:t(()=>[e(V,{icon:"tabler-eye"})]),_:2},1032,["onClick"])])],10,po))),128))])]),_:1})):a(X).length===1?(n(),f("div",yo,[o("p",ho,l(a(r)("projects.development_plan.version.only_one_version")),1)])):(n(),f("div",bo,[o("p",jo,l(a(r)("projects.development_plan.version.no_versions")),1)]))]),_:1})]),_:1})])):(n(),f("div",Js,[e(V,{icon:"tabler-calendar-time",size:"64",color:"secondary",class:"mb-4"}),o("h4",Ks,l(a(r)("projects.development_plan.empty.title")),1),o("p",Zs,l(a(r)("projects.development_plan.empty.description")),1),R.value?(n(),h(P,{key:0,color:"primary",onClick:B,loading:S.value},{default:t(()=>[u(l(a(r)("projects.development_plan.actions.create_plan")),1)]),_:1},8,["loading"])):w("",!0)])),m.value?(n(),h(Ps,{key:3,modelValue:b.value,"onUpdate:modelValue":q[1]||(q[1]=k=>b.value=k),version:m.value,"is-current":m.value&&s.developmentPlan&&m.value.version_number===s.developmentPlan.current_version_number,"is-admin":a(z),"has-manager-permission":R.value,"plan-id":s.developmentPlan?s.developmentPlan.id:null,"preliminary-budget":s.preliminaryBudget,"project-id":s.developmentPlan?s.developmentPlan.project:null,onRefresh:q[2]||(q[2]=k=>c("refresh"))},null,8,["modelValue","version","is-current","is-admin","has-manager-permission","plan-id","preliminary-budget","project-id"])):w("",!0),e(Xs,{modelValue:C.value,"onUpdate:modelValue":q[3]||(q[3]=k=>C.value=k),"plan-id":s.developmentPlan?s.developmentPlan.id:null,"current-version-number":s.developmentPlan?s.developmentPlan.current_version_number:0,"preliminary-budget":s.preliminaryBudget,"project-id":s.developmentPlan?s.developmentPlan.project:null,onSubmit:E},null,8,["modelValue","plan-id","current-version-number","preliminary-budget","project-id"]),e(Ve,{modelValue:U.value.show,"onUpdate:modelValue":q[5]||(q[5]=k=>U.value.show=k),color:U.value.color,timeout:5e3},{actions:t(()=>[e(G,{onClick:q[4]||(q[4]=k=>U.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(U.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},xo={key:0,class:"text-h5"},wo={key:1,class:"text-h5"},Vo={key:0},qo={class:"align-center justify-space-between mb-3"},Co={class:"text-subtitle-1 font-weight-medium"},So={key:1,class:"text-medium-emphasis text-center pa-4 rounded bg-grey-lighten-5"},Uo={key:1},zo={class:"d-flex align-center mb-5"},Io={class:"d-flex align-center"},Do={class:"text-medium-emphasis d-flex align-center"},$o={class:"text-caption me-4"},Mo={class:"text-caption"},Po={class:"user-story-format mb-6"},Bo={class:"text-h5 mb-4"},Ro={class:"text-primary"},Lo={class:"text-h5 mb-4"},Ao={class:"text-primary"},Fo={class:"text-h5 mb-4"},Oo={class:"text-primary"},No={key:0},Eo={class:"text-h6 mb-3"},Wo={key:1,class:"text-medium-emphasis text-center pa-4"},To={key:2,class:"mt-6"},Go={key:0,class:"text-center pa-6"},Xo={class:"text-h6 mb-2"},Ho={class:"text-medium-emphasis"},Jo={key:1},Ko={class:"d-flex align-center"},Zo={class:"mockup-preview mb-3"},Qo={class:"overflow-hidden position-relative rounded bg-grey-lighten-4",style:{height:"150px"}},Yo={key:0,class:"d-flex justify-center align-center h-100"},ei={class:"text-center"},ti={class:"text-caption"},ai={key:1,class:"html-preview"},li={key:2,class:"d-flex justify-center align-center h-100"},ri={class:"preview-overlay d-flex justify-center align-center"},si={key:0,class:"mb-2"},oi={class:"d-flex align-center justify-space-between"},ii={class:"d-flex align-center"},ni={class:"text-caption"},ci={key:0,class:"text-center pa-6"},ui={class:"text-h6 mb-2"},di={class:"text-medium-emphasis"},mi={key:1},pi={class:"text-caption"},vi={class:"text-caption text-medium-emphasis"},fi={class:"text-primary"},_i={class:"mb-2"},gi={class:"text-primary"},yi={class:"mb-4"},hi={class:"text-primary"},bi={key:0},ji={class:"text-subtitle-2 font-weight-medium mb-2"},ki={class:"ms-3"},xi={class:"text-caption mt-3"},wi={class:"d-flex justify-end mt-2"},Vi={key:1,class:"text-center pa-6"},qi={class:"text-h6 mb-2"},Ci={class:"text-medium-emphasis"},Si={key:2},Ui={class:"d-flex align-center"},zi={class:"d-flex align-center"},Ii={class:"text-caption text-medium-emphasis ml-2"},Di={class:"comment-text mt-2 whitespace-pre-wrap"},$i={class:"text-body-1 mb-3"},Mi=Ue({__name:"UserStoryDetailsDialog",props:{modelValue:{type:Boolean,default:!1},userStory:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},hasModeratorPermission:{type:Boolean,default:!1}},emits:["update:modelValue","update","delete","regenerate"],setup(s,{emit:c}){const i=s,r=Y({get:()=>i.modelValue,set:y=>c("update:modelValue",y)}),v=ot(),d=Qe(),{t:m}=he(),b=j(0),C=j(!1),S=j({...i.userStory}),U=j(""),z=j(""),R=j(""),A=j(!1),I=j(!1),X=j(null),W=j(!1),O=j({show:!1,text:"",color:"success"}),Q=j(null),N=[{title:m("projects.status.draft"),value:"draft"},{title:m("projects.status.active"),value:"active"},{title:m("projects.status.archived"),value:"archived"},{title:m("projects.status.completed"),value:"completed"}],K=Y(()=>i.userStory.history||[]),E=Y(()=>i.userStory.comments||[]),B=Y(()=>i.userStory.mockups||[]),$=y=>y?(y=parseInt(y),new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",D=()=>{C.value&&(S.value={...i.userStory},U.value=""),C.value=!C.value,b.value="0"},M=()=>{U.value.trim()&&(S.value.acceptance_criteria||(S.value.acceptance_criteria=[]),S.value.acceptance_criteria.push(U.value.trim()),U.value="")},q=()=>{r.value&&v.fetchUserStoryById(i.userStory.id).then(({data:y})=>{y&&Object.assign(i.userStory,y)})};Ce(()=>{Q.value=setInterval(q,5e3)}),Ne(()=>{Q.value&&clearInterval(Q.value)});const G=()=>{c("update",S.value),C.value=!1,r.value=!1},k=()=>{c("delete"),r.value=!1},x=()=>{R.value="",A.value=!0},_=()=>{c("regenerate",R.value),A.value=!1,r.value=!1},ee=async()=>{if(z.value.trim()){I.value=!0;try{const{data:y,error:p}=await v.createComment(i.userStory.id,{text:z.value,status:"active"});if(y&&!p){F("Comment added successfully"),z.value="";const{data:T}=await v.fetchUserStoryById(i.userStory.id);T&&Object.assign(i.userStory,T)}else F("Failed to add comment","error")}catch(y){F("Failed to add comment: "+y.message,"error")}finally{I.value=!1}}},F=(y,p="success")=>{O.value={show:!0,text:y,color:p}};return ve(()=>i.userStory,y=>{S.value={...y}},{deep:!0}),(y,p)=>{const T=ke("IconBtn");return n(),h(be,{modelValue:a(r),"onUpdate:modelValue":p[15]||(p[15]=g=>De(r)?r.value=g:null),"max-width":"900",scrollable:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex pt-5 px-5"},{default:t(()=>[C.value?(n(),f("h5",xo,l(a(m)("projects.user_stories.title.edit")),1)):(n(),f("h5",wo,l(a(m)("projects.user_stories.title.details")),1)),e(le),e(T,{onClick:p[0]||(p[0]=g=>r.value=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),_:1}),e(Z,{class:"pb-0"},{default:t(()=>[e(rt,{modelValue:b.value,"onUpdate:modelValue":p[1]||(p[1]=g=>b.value=g),"slider-color":"primary","align-tabs":"start"},{default:t(()=>[e(ge,{value:"0"},{default:t(()=>[e(V,{size:"18",icon:"tabler-user-check",start:""}),u(" "+l(a(m)("projects.requirements.tabs.details")),1)]),_:1}),e(ge,{value:"1"},{default:t(()=>[e(V,{size:"18",icon:"tabler-photo",start:""}),u(" "+l(a(m)("projects.requirements.tabs.mockups"))+" ",1),a(B).length?(n(),h(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(B).length),1)]),_:1})):w("",!0)]),_:1}),e(ge,{value:"2"},{default:t(()=>[e(V,{size:"18",icon:"tabler-history",start:""}),u(" "+l(a(m)("projects.requirements.tabs.history"))+" ",1),a(K).length?(n(),h(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(K).length),1)]),_:1})):w("",!0)]),_:1}),e(ge,{value:"3"},{default:t(()=>[e(V,{size:"18",icon:"tabler-messages",start:""}),u(" "+l(a(m)("projects.requirements.tabs.comments"))+" ",1),a(E).length?(n(),h(J,{key:0,size:"x-small",color:"primary",class:"ms-2"},{default:t(()=>[u(l(a(E).length),1)]),_:1})):w("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ne),e(Z,{class:"pa-6",style:{"min-height":"400px","max-height":"70vh"}},{default:t(()=>[e(st,{modelValue:b.value,"onUpdate:modelValue":p[8]||(p[8]=g=>b.value=g),class:"mt-5"},{default:t(()=>[e(ye,{value:"0"},{default:t(()=>[C.value?(n(),f("div",Vo,[e(Se,{onSubmit:we(G,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:S.value.role,"onUpdate:modelValue":p[2]||(p[2]=g=>S.value.role=g),label:a(m)("projects.user_stories.fields.role"),required:"",rules:[g=>!!g||a(m)("projects.user_stories.validation.role_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:S.value.action,"onUpdate:modelValue":p[3]||(p[3]=g=>S.value.action=g),label:a(m)("projects.user_stories.fields.action"),required:"",rules:[g=>!!g||a(m)("projects.user_stories.validation.action_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:S.value.benefit,"onUpdate:modelValue":p[4]||(p[4]=g=>S.value.benefit=g),label:a(m)("projects.user_stories.fields.benefit"),required:"",rules:[g=>!!g||a(m)("projects.user_stories.validation.benefit_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:S.value.status,"onUpdate:modelValue":p[5]||(p[5]=g=>S.value.status=g),label:a(m)("projects.user_stories.fields.status"),items:N,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[o("div",qo,[o("div",Co,l(a(m)("projects.user_stories.fields.acceptance_criteria")),1),e(oe,{class:"w-100"},{default:t(()=>[e(L,{cols:"10",sm:"8"},{default:t(()=>[e(ce,{modelValue:U.value,"onUpdate:modelValue":p[6]||(p[6]=g=>U.value=g),placeholder:a(m)("projects.user_stories.fields.add_criterion"),density:"compact","hide-details":"",class:"me-2",onKeyup:ht(M,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1}),e(L,{cols:"2",sm:"4"},{default:t(()=>[e(P,{color:"primary",size:"small",disabled:!U.value.trim(),onClick:M},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.add")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),S.value.acceptance_criteria&&S.value.acceptance_criteria.length>0?(n(),h(Ge,{key:0},{default:t(()=>[(n(!0),f(ae,null,de(S.value.acceptance_criteria,(g,re)=>(n(),h(Xe,{key:re},{prepend:t(()=>[e(V,{icon:"tabler-check",color:"success"})]),append:t(()=>[e(T,{color:"error",variant:"text",size:"small",onClick:H=>(ue=>{S.value.acceptance_criteria.splice(ue,1)})(re)},{default:t(()=>[e(V,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick"])]),default:t(()=>[e(He,null,{default:t(()=>[u(l(g),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),f("div",So,l(a(m)("projects.user_stories.empty.acceptance_criteria.description")),1))]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),f("div",Uo,[o("div",zo,[e(J,{color:a(je)(s.userStory.status),size:"small",label:"",class:"me-2"},{default:t(()=>[u(l(a(m)(`projects.status.${s.userStory.status}`)),1)]),_:1},8,["color"]),e(J,{color:"secondary",size:"small",label:"",class:"ms-2"},{default:t(()=>[u(" v"+l(s.userStory.version_number),1)]),_:1})]),o("div",Io,[o("div",Do,[e(V,{size:"18",icon:"tabler-calendar",class:"me-1"}),o("span",$o,l(a(m)("projects.details.updated_at"))+": "+l($(s.userStory.updated_at)),1),e(V,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),o("span",Mo,l(a(m)("projects.details.created_at"))+": "+l($(s.userStory.created_at)),1)])]),o("div",Po,[o("div",Bo,[o("span",Ro,l(a(m)("projects.user_stories.fields.role")),1),u(" "+l(s.userStory.role)+", ",1)]),o("div",Lo,[o("span",Ao,l(a(m)("projects.user_stories.fields.action")),1),u(" "+l(s.userStory.action)+", ",1)]),o("div",Fo,[o("span",Oo,l(a(m)("projects.user_stories.fields.benefit")),1),u(" "+l(s.userStory.benefit)+". ",1)])]),e(ne,{class:"mb-4"}),s.userStory.acceptance_criteria&&s.userStory.acceptance_criteria.length>0?(n(),f("div",No,[o("div",Eo,l(a(m)("projects.user_stories.fields.acceptance_criteria")),1),e(Ge,null,{default:t(()=>[(n(!0),f(ae,null,de(s.userStory.acceptance_criteria,(g,re)=>(n(),h(Xe,{key:re,class:"px-0"},{prepend:t(()=>[e(V,{icon:"tabler-check",color:"success",class:"me-2"})]),default:t(()=>[e(He,null,{default:t(()=>[u(l(g),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):(n(),f("div",Wo,l(a(m)("projects.user_stories.empty.acceptance_criteria.description")),1)),s.userStory.generation_status==="in_progress"?(n(),f("div",To,[e(xe,{color:"info",variant:"tonal",icon:"tabler-refresh"},{default:t(()=>[e(kt,null,{default:t(()=>[u(l(a(m)("projects.user_stories.regeneration.title")),1)]),_:1}),o("p",null,l(a(m)("projects.user_stories.regeneration.description")),1)]),_:1})])):w("",!0)]))]),_:1}),e(ye,{value:"1"},{default:t(()=>[a(B).length===0?(n(),f("div",Go,[e(V,{icon:"tabler-photo-off",size:"64",color:"secondary",class:"mb-3"}),o("h4",Xo,l(a(m)("projects.user_stories.mockups.empty.title")),1),o("p",Ho,l(a(m)("projects.user_stories.mockups.empty.description")),1)])):(n(),f("div",Jo,[e(oe,null,{default:t(()=>[(n(!0),f(ae,null,de(a(B),g=>(n(),h(L,{key:g.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(te,{class:"mockup-card h-100",onClick:re=>{X.value=g,W.value=!0},border:"",hover:""},{default:t(()=>[e(fe,null,{append:t(()=>[o("div",Ko,[g.generation_status==="in_progress"||g.generation_status==="pending"||g.needs_regeneration?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):w("",!0),e(J,{color:a(je)(g.status),size:"small",label:""},{default:t(()=>[u(l(a(m)(`projects.status.${g.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(g.name),1)]),_:2},1024)]),_:2},1024),e(ne),e(Z,null,{default:t(()=>[o("div",Zo,[o("div",Qo,[g.generation_status==="in_progress"||g.generation_status==="pending"?(n(),f("div",Yo,[o("div",ei,[e(me,{indeterminate:"",color:"primary",size:"40",class:"mb-2"}),o("div",ti,l(a(m)("projects.mockups.status.generating")),1)])])):g.image?(n(),f("div",ai,[e(Ee,{src:g.image,alt:g.name},null,8,["src","alt"])])):(n(),f("div",li,[e(V,{icon:"tabler-file-code",size:"48",color:"secondary"})])),o("div",ri,[e(P,{color:"primary",variant:"elevated",size:"small","prepend-icon":"tabler-eye",disabled:g.generation_status==="in_progress"||g.generation_status==="pending",onClick:re=>(async H=>{const{data:ue}=await d.fetchMockupById(H.id);X.value=ue||H,W.value=!0})(g)},{default:t(()=>[u(l(a(m)("projects.mockups.actions.preview")),1)]),_:2},1032,["disabled","onClick"])])])]),g.needs_regeneration?(n(),f("div",si,[e(J,{color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(m)("projects.mockups.status.regenerating")),1)]),_:1})])):w("",!0),o("div",oi,[o("div",ii,[e(V,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",ni,l($(g.created_at)),1)])])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]))]),_:1}),e(ye,{value:"2"},{default:t(()=>[a(K).length===0?(n(),f("div",ci,[e(V,{icon:"tabler-history",size:"64",color:"secondary",class:"mb-3"}),o("h4",ui,l(a(m)("projects.user_stories.empty.history.title")),1),o("p",di,l(a(m)("projects.user_stories.empty.history.description")),1)])):(n(),f("div",mi,[e(xt,{density:"compact",align:"start"},{default:t(()=>[(n(!0),f(ae,null,de(a(K),(g,re)=>(n(),h(wt,{key:re,"dot-color":"primary",size:"small"},{opposite:t(()=>[o("div",pi,l($(g.changed_at)),1),o("div",vi,"v"+l(g.version_number),1)]),default:t(()=>[e(te,{border:""},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:"primary",variant:"tonal",size:"36"},{default:t(()=>[e(V,{icon:"tabler-user-check"})]),_:1})]),append:t(()=>[e(J,{color:a(je)(g.status),size:"small",label:"",class:"ms-2"},{default:t(()=>[u(l(a(m)(`projects.status.${g.status}`)),1)]),_:2},1032,["color"])]),default:t(()=>[e(se,null,{default:t(()=>[o("span",fi,l(a(m)("projects.user_stories.fields.role")),1),u(" "+l(g.role),1)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>[o("p",_i,[o("span",gi,l(a(m)("projects.user_stories.fields.action")),1),u(" "+l(g.action),1)]),o("p",yi,[o("span",hi,l(a(m)("projects.user_stories.fields.benefit")),1),u(" "+l(g.benefit),1)]),g.acceptance_criteria&&g.acceptance_criteria.length>0?(n(),f("div",bi,[o("div",ji,l(a(m)("projects.user_stories.fields.acceptance_criteria"))+": ",1),o("ul",ki,[(n(!0),f(ae,null,de(g.acceptance_criteria,(H,ue)=>(n(),f("li",{key:ue},l(H),1))),128))])])):w("",!0),o("div",xi,l(a(m)("projects.requirements.history.changed_by"))+": "+l(g.changed_by?g.changed_by.username:a(m)("projects.requirements.history.unknown")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1}),e(ye,{value:"3"},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:z.value,"onUpdate:modelValue":p[7]||(p[7]=g=>z.value=g),label:a(m)("projects.requirements.comments.add"),rows:"3",counter:"",disabled:I.value},null,8,["modelValue","label","disabled"]),o("div",wi,[e(P,{color:"primary",size:"small",loading:I.value,disabled:!z.value.trim(),onClick:ee},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.add_comment")),1)]),_:1},8,["loading","disabled"])])]),_:1}),e(L,{cols:"12"},{default:t(()=>[a(E).length?(n(),h(ne,{key:0,class:"mb-4"})):w("",!0),a(E).length===0?(n(),f("div",Vi,[e(V,{icon:"tabler-messages",size:"64",color:"secondary",class:"mb-3"}),o("h4",qi,l(a(m)("projects.user_stories.empty.comments.title")),1),o("p",Ci,l(a(m)("projects.user_stories.empty.comments.description")),1)])):(n(),f("div",Si,[(n(!0),f(ae,null,de(a(E),g=>(n(),f("div",{key:g.id,class:"comment-item mb-4"},[e(te,{border:""},{default:t(()=>[e(Z,{class:"py-2"},{default:t(()=>[o("div",Ui,[e(ze,{color:"primary",variant:"tonal",size:"36",class:"me-3"},{default:t(()=>[e(V,{icon:"tabler-user"})]),_:1}),o("div",null,[o("div",zi,[o("strong",null,l(g.user?g.user.username:a(m)("projects.requirements.comments.unknown_user")),1),o("div",Ii,l($(g.created_at)),1)])]),e(le),s.isAdmin||s.hasManagerPermission?(n(),h(T,{key:0,size:"small",color:"error",variant:"text",onClick:re=>(async H=>{I.value=!0;try{const{success:ue,error:$e}=await v.deleteComment(H);if(ue&&!$e){F("Comment deleted successfully");const{data:Ie}=await v.fetchUserStoryById(i.userStory.id);Ie&&Object.assign(i.userStory,Ie)}else F("Failed to delete comment","error")}catch(ue){F("Failed to delete comment: "+ue.message,"error")}finally{I.value=!1}})(g.id),disabled:I.value},{default:t(()=>[e(V,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick","disabled"])):w("",!0)]),o("div",Di,l(g.text),1)]),_:2},1024)]),_:2},1024)]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[C.value?(n(),f(ae,{key:0},[e(P,{color:"secondary",variant:"tonal",onClick:D},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.cancel")),1)]),_:1}),e(le),e(P,{color:"primary",onClick:G},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.save")),1)]),_:1})],64)):(n(),f(ae,{key:1},[s.isAdmin?(n(),h(P,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:k},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.delete")),1)]),_:1})):w("",!0),s.hasModeratorPermission?(n(),h(P,{key:1,color:"info",variant:"tonal","prepend-icon":"tabler-refresh",class:"ms-2",onClick:x},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.regenerate")),1)]),_:1})):w("",!0),e(le),s.hasModeratorPermission?(n(),h(P,{key:2,color:"primary","prepend-icon":"tabler-edit",onClick:D},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.edit")),1)]),_:1})):w("",!0)],64))]),_:1})]),_:1}),e(be,{modelValue:A.value,"onUpdate:modelValue":p[11]||(p[11]=g=>A.value=g),"max-width":"600",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"pt-3 pb-0"},{default:t(()=>[u(l(a(m)("projects.user_stories.regeneration.title")),1)]),_:1}),e(Z,null,{default:t(()=>[o("p",$i,l(a(m)("projects.user_stories.regeneration.description")),1),e(qe,{autofocus:"",modelValue:R.value,"onUpdate:modelValue":p[9]||(p[9]=g=>R.value=g),label:a(m)("projects.user_stories.fields.feedback"),hint:a(m)("projects.user_stories.placeholders.feedback"),rows:"4",counter:""},null,8,["modelValue","label","hint"])]),_:1}),e(pe,null,{default:t(()=>[e(P,{color:"secondary",variant:"tonal",onClick:p[10]||(p[10]=g=>A.value=!1)},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.cancel")),1)]),_:1}),e(le),e(P,{color:"primary",onClick:_},{default:t(()=>[u(l(a(m)("projects.user_stories.actions.regenerate")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),X.value?(n(),h(nt,{key:0,modelValue:W.value,"onUpdate:modelValue":p[12]||(p[12]=g=>W.value=g),mockup:X.value,"is-admin":s.isAdmin,"has-manager-permission":s.hasManagerPermission},null,8,["modelValue","mockup","is-admin","has-manager-permission"])):w("",!0),e(Ve,{modelValue:O.value.show,"onUpdate:modelValue":p[14]||(p[14]=g=>O.value.show=g),color:O.value.color,timeout:5e3},{actions:t(()=>[e(T,{onClick:p[13]||(p[13]=g=>O.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(O.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue"])}}},[["__scopeId","data-v-4a0d3cc9"]]),Pi={class:"text-h5"},Bi={class:"text-subtitle-1 font-weight-medium"},Ri={class:"d-flex align-center justify-space-between mb-3"},Li={key:1,class:"text-medium-emphasis text-center pa-4 rounded bg-grey-lighten-5"},Ai={__name:"UserStoryCreateDialog",props:{modelValue:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1},userStoryData:{type:Object,default:()=>({})}},emits:["update:modelValue","submit"],setup(s,{emit:c}){const i=s,{t:r}=he(),v=Y({get:()=>i.modelValue,set:W=>c("update:modelValue",W)}),d=j({role:i.editMode&&i.userStoryData?i.userStoryData.role:"",action:i.editMode&&i.userStoryData?i.userStoryData.action:"",benefit:i.editMode&&i.userStoryData?i.userStoryData.benefit:"",acceptance_criteria:i.editMode&&i.userStoryData?[...i.userStoryData.acceptance_criteria]:[],status:i.editMode&&i.userStoryData?i.userStoryData.status:"draft"}),m=j(""),b=j(null),C=[W=>!!W||r("projects.user_stories.validation.role_required")],S=[W=>!!W||r("projects.user_stories.validation.action_required")],U=[W=>!!W||r("projects.user_stories.validation.benefit_required")],z=[{title:r("projects.status.draft"),value:"draft"},{title:r("projects.status.active"),value:"active"},{title:r("projects.status.archived"),value:"archived"},{title:r("projects.status.completed"),value:"completed"}],R=()=>{m.value.trim()&&(d.value.acceptance_criteria||(d.value.acceptance_criteria=[]),d.value.acceptance_criteria.push(m.value.trim()),m.value="")},A=()=>{d.value={role:"",action:"",benefit:"",acceptance_criteria:[],status:"draft"},m.value="",b.value&&b.value.resetValidation()},I=()=>{v.value=!1,A()},X=async()=>{const{valid:W}=await b.value.validate();W&&(c("submit",d.value),v.value=!1,A())};return ve(v,W=>{W||A()}),(W,O)=>{const Q=ke("IconBtn");return n(),h(be,{modelValue:a(v),"onUpdate:modelValue":O[5]||(O[5]=N=>De(v)?v.value=N:null),"max-width":"700",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex pt-5 px-5"},{default:t(()=>[o("h5",Pi,l(i.editMode?a(r)("projects.user_stories.title.edit"):a(r)("projects.user_stories.title.create")),1),e(le),e(Q,{onClick:I},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),_:1}),e(Z,{class:"px-5 pt-4"},{default:t(()=>[e(Se,{ref_key:"formRef",ref:b,onSubmit:we(X,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:d.value.role,"onUpdate:modelValue":O[0]||(O[0]=N=>d.value.role=N),label:a(r)("projects.user_stories.fields.role"),rules:C,placeholder:a(r)("projects.user_stories.placeholders.role"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:d.value.action,"onUpdate:modelValue":O[1]||(O[1]=N=>d.value.action=N),label:a(r)("projects.user_stories.fields.action"),rules:S,placeholder:a(r)("projects.user_stories.placeholders.action"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:d.value.benefit,"onUpdate:modelValue":O[2]||(O[2]=N=>d.value.benefit=N),label:a(r)("projects.user_stories.fields.benefit"),rules:U,placeholder:a(r)("projects.user_stories.placeholders.benefit"),required:""},null,8,["modelValue","label","placeholder"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:d.value.status,"onUpdate:modelValue":O[3]||(O[3]=N=>d.value.status=N),label:a(r)("projects.user_stories.fields.status"),items:z,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[o("div",Bi,l(a(r)("projects.user_stories.fields.acceptance_criteria")),1),o("div",Ri,[e(oe,{class:"w-100"},{default:t(()=>[e(L,{cols:"10",sm:"8"},{default:t(()=>[e(ce,{modelValue:m.value,"onUpdate:modelValue":O[4]||(O[4]=N=>m.value=N),placeholder:a(r)("projects.user_stories.fields.add_criterion"),density:"compact","hide-details":"",class:"me-2",onKeyup:ht(R,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1}),e(L,{cols:"2",sm:"4"},{default:t(()=>[e(P,{color:"primary",size:"small",disabled:!m.value.trim(),onClick:R},{default:t(()=>[u(l(a(r)("projects.user_stories.actions.add")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),d.value.acceptance_criteria&&d.value.acceptance_criteria.length>0?(n(),h(Ge,{key:0},{default:t(()=>[(n(!0),f(ae,null,de(d.value.acceptance_criteria,(N,K)=>(n(),h(Xe,{key:K},{prepend:t(()=>[e(V,{icon:"tabler-check",color:"success"})]),append:t(()=>[e(Q,{color:"error",variant:"text",size:"small",onClick:E=>(B=>{d.value.acceptance_criteria.splice(B,1)})(K)},{default:t(()=>[e(V,{icon:"tabler-trash",size:"18"})]),_:2},1032,["onClick"])]),default:t(()=>[e(He,null,{default:t(()=>[u(l(N),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),f("div",Li,l(a(r)("projects.user_stories.empty.acceptance_criteria.description")),1))]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[e(P,{variant:"tonal",color:"secondary",onClick:I},{default:t(()=>[u(l(a(r)("projects.user_stories.actions.cancel")),1)]),_:1}),e(le),e(P,{color:"primary",onClick:X},{default:t(()=>[u(l(i.editMode?a(r)("projects.user_stories.actions.save"):a(r)("projects.user_stories.actions.create")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Fi={key:0,class:"mb-4"},Oi={key:1,class:"d-flex justify-center align-center",style:{height:"300px"}},Ni={key:2,class:"text-center pa-4"},Ei={class:"text-h6 mb-2"},Wi={class:"text-body-1 text-medium-emphasis mb-6"},Ti={class:"d-flex align-center"},Gi={class:"text-body-1 mb-2"},Xi={class:"font-weight-medium text-primary"},Hi={class:"text-body-1 mb-4"},Ji={class:"font-weight-medium text-primary"},Ki={key:0},Zi={class:"text-subtitle-2 font-weight-medium mb-2 text-primary"},Qi={class:"ml-4"},Yi={key:0},en={class:"d-flex align-center justify-space-between mt-3"},tn={class:"d-flex align-center"},an={class:"text-caption"},ln={class:"d-flex align-center"},rn={class:"text-caption"},sn=Ue({__name:"UserStoriesList",props:{projectId:{type:String,required:!0},requirementId:{type:String,required:!1,default:null},userStories:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(s,{emit:c}){const i=s,r=ot(),v=Be(),{t:d}=he(),m=j(""),b=j(["draft","active","completed"]),C=j(null),S=j(!1),U=j(!1),z=j(!1),R=j(!1),A=j({show:!1,text:"",color:"success"}),I=Te(),X=Y(()=>v.is_admin()),W=j(!1),O=j(!1),Q=j(!1),N=[{title:d("projects.status.draft"),value:"draft"},{title:d("projects.status.active"),value:"active"},{title:d("projects.status.archived"),value:"archived"},{title:d("projects.status.completed"),value:"completed"}],K=Y(()=>i.userStories.filter(x=>{const _=!m.value||x.role.toLowerCase().includes(m.value.toLowerCase())||x.action.toLowerCase().includes(m.value.toLowerCase())||x.benefit.toLowerCase().includes(m.value.toLowerCase()),ee=b.value.includes(x.status);return _&&ee})),E=Y(()=>i.userStories.some(x=>x.generation_status==="in_progress"||x.generation_status==="pending")),B=()=>{U.value=!0},$=async x=>{R.value=!0;try{const{data:_,error:ee}=await r.createUserStory({...x,requirement:i.requirementId});_&&!ee?(G("User story created successfully"),c("refresh")):G("Failed to create user story","error")}catch(_){G("Failed to create user story: "+_.message,"error")}finally{R.value=!1}},D=async x=>{R.value=!0;try{const{data:_,error:ee}=await r.updateUserStory(C.value.id,x);_&&!ee?(G("User story updated successfully"),c("refresh")):G("Failed to update user story","error")}catch(_){G("Failed to update user story: "+_.message,"error")}finally{R.value=!1}},M=async()=>{if(C.value){R.value=!0,z.value=!1;try{const{success:x,error:_}=await r.deleteUserStory(C.value.id);x&&!_?(G("User story deleted successfully"),c("refresh"),S.value=!1):G("Failed to delete user story","error")}catch(x){G("Failed to delete user story: "+x.message,"error")}finally{R.value=!1}}},q=async(x="")=>{if(C.value){R.value=!0;try{const{data:_,error:ee}=await r.regenerateUserStory(C.value.id,x);_&&!ee?(G("User story regeneration started"),setTimeout(()=>{c("refresh")},3e3)):G("Failed to regenerate user story","error")}catch(_){G("Failed to regenerate user story: "+_.message,"error")}finally{R.value=!1}}},G=(x,_="success")=>{A.value={show:!0,text:x,color:_}},k=async()=>{W.value=await v.hasProjectRoleAtLeast(i.projectId,"MANAGER"),O.value=await v.hasProjectRoleAtLeast(i.projectId,"ADMIN"),Q.value=await v.hasProjectWriteAccess(i.projectId)};return Ce(()=>{k(),!i.requirementId||i.userStories.length||i.loading||r.fetchUserStories(i.requirementId).then(({data:x})=>{x&&c("refresh")}),I.on("project-refresh",()=>{r.fetchUserStories(i.requirementId,{silent:!0}).then(({data:x})=>{x&&c("refresh")})})}),ve(S,x=>{x?I.on("project-refresh",async()=>{if(C.value){const{data:_}=await r.fetchUserStoryById(C.value.id);_&&(C.value=_)}}):I.off("project-refresh")}),ve(()=>i.projectId,()=>{k()}),(x,_)=>{const ee=We,F=ke("IconBtn");return n(),h(Z,{class:"pa-6"},{default:t(()=>[a(E)?(n(),f("div",Fi,[e(xe,{type:"info",variant:"tonal",border:"start",class:"d-flex align-center"},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"24",class:"me-3"}),o("span",null,l(a(d)("projects.user_stories.regeneration.title")),1)]),_:1})])):w("",!0),e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"6"},{default:t(()=>[e(ce,{modelValue:m.value,"onUpdate:modelValue":_[0]||(_[0]=y=>m.value=y),density:"compact",placeholder:a(d)("projects.user_stories.actions.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:b.value,"onUpdate:modelValue":_[1]||(_[1]=y=>b.value=y),items:N,density:"compact","hide-details":"",label:a(d)("projects.user_stories.fields.status"),variant:"outlined",multiple:"",chips:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"2",class:"d-flex align-center"},{default:t(()=>[O.value&&s.requirementId?(n(),h(P,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:B,loading:R.value,block:""},{default:t(()=>[u(l(a(d)("projects.user_stories.actions.add")),1)]),_:1},8,["loading"])):w("",!0)]),_:1})]),_:1}),e(ne,{class:"my-5"}),s.loading?(n(),f("div",Oi,[e(me,{indeterminate:"",color:"primary"})])):a(K).length===0?(n(),f("div",Ni,[e(V,{icon:"tabler-notebook",size:"64",color:"secondary",class:"mb-4"}),o("h4",Ei,l(a(d)("projects.user_stories.empty.title")),1),o("p",Wi,l(m.value||b.value.length>0?a(d)("projects.user_stories.empty.filtered"):a(d)("projects.user_stories.empty.description")),1),O.value&&s.requirementId&&!m.value&&b.value.length===0?(n(),h(P,{key:0,color:"primary",onClick:B,"prepend-icon":"tabler-plus"},{default:t(()=>[u(l(a(d)("projects.user_stories.actions.create")),1)]),_:1})):w("",!0)])):(n(),h(oe,{key:3},{default:t(()=>[(n(!0),f(ae,null,de(a(K),y=>(n(),h(L,{key:y.id,cols:"12",md:"6"},{default:t(()=>[e(te,{class:"user-story-card h-100 d-flex flex-column",onClick:p=>(async T=>{const{data:g}=await r.fetchUserStoryById(T.id);C.value=g||T,S.value=!0})(y),border:"",hover:""},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:"primary",variant:"tonal",size:"42"},{default:t(()=>[e(V,{icon:"tabler-user-check"})]),_:1})]),append:t(()=>[o("div",Ti,[y.generation_status==="in_progress"||y.generation_status==="pending"?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):w("",!0),y.generation_status==="pending"?(n(),h(J,{key:1,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(d)("projects.user_stories.regeneration.title")),1)]),_:1})):w("",!0),e(J,{color:a(je)(y.status),size:"small",label:""},{default:t(()=>[u(l(x.$t(`projects.status.${y.status}`)),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(a(d)("projects.user_stories.fields.role"))+" "+l(y.role),1)]),_:2},1024)]),_:2},1024),e(Z,{class:"d-flex flex-column"},{default:t(()=>{return[o("p",Gi,[o("span",Xi,l(a(d)("projects.user_stories.fields.action"))+":",1),u(" "+l(y.action),1)]),o("p",Hi,[o("span",Ji,l(a(d)("projects.user_stories.fields.benefit"))+":",1),u(" "+l(y.benefit),1)]),y.acceptance_criteria&&y.acceptance_criteria.length>0?(n(),f("div",Ki,[o("div",Zi,l(a(d)("projects.user_stories.fields.acceptance_criteria"))+":",1),o("ul",Qi,[(n(!0),f(ae,null,de(y.acceptance_criteria.slice(0,2),(T,g)=>(n(),f("li",{key:g},l(T),1))),128)),y.acceptance_criteria.length>2?(n(),f("li",Yi,l(a(d)("projects.user_stories.and_more",{count:y.acceptance_criteria.length-2})),1)):w("",!0)])])):w("",!0),e(le),o("div",en,[o("div",tn,[e(V,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",an,l((p=y.updated_at,p?(p=parseInt(p),new Date(p).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})):"")),1)]),o("div",ln,[e(V,{size:"16",icon:"tabler-history",class:"me-1"}),o("span",rn,"v"+l(y.version_number),1)])])];var p}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),C.value?(n(),h(Mi,{key:4,modelValue:S.value,"onUpdate:modelValue":_[2]||(_[2]=y=>S.value=y),"user-story":C.value,onDelete:_[3]||(_[3]=y=>z.value=!0),onUpdate:D,onRegenerate:q,"is-admin":a(X),"has-manager-permission":W.value,"has-moderator-permission":O.value},null,8,["modelValue","user-story","is-admin","has-manager-permission","has-moderator-permission"])):w("",!0),e(Ai,{modelValue:U.value,"onUpdate:modelValue":_[4]||(_[4]=y=>U.value=y),onSubmit:$},null,8,["modelValue"]),e(ee,{isDialogVisible:z.value,"onUpdate:isDialogVisible":_[5]||(_[5]=y=>z.value=y),confirmationMsg:a(d)("projects.user_stories.delete_confirm.message"),onConfirm:M},null,8,["isDialogVisible","confirmationMsg"]),e(Ve,{modelValue:A.value.show,"onUpdate:modelValue":_[7]||(_[7]=y=>A.value.show=y),color:A.value.color,timeout:5e3},{actions:t(()=>[e(F,{onClick:_[6]||(_[6]=y=>A.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(A.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},[["__scopeId","data-v-a1c18f3d"]]),on={key:0,class:"text-h5"},nn={class:"text-h5"},cn={key:0},un={class:"text-subtitle-1 font-weight-medium mb-2"},dn={class:"bg-grey-lighten-5 rounded pa-3"},mn={class:"text-medium-emphasis text-caption mb-2"},pn={key:1},vn={key:0,class:"pa-5"},fn={class:"d-flex justify-center my-8"},_n={class:"d-flex align-center justify-center text-medium-emphasis"},gn={class:"text-caption me-4"},yn={class:"text-caption"},hn={key:1,class:"diagram-content pa-0"},bn={class:"diagram-metadata d-flex align-center px-6 py-3"},jn={key:0,class:"ms-2"},kn={class:"text-medium-emphasis d-flex align-center"},xn={class:"text-caption me-4"},wn={class:"text-caption"},Vn={key:2,class:"d-flex flex-column justify-center align-center pa-6",style:{height:"400px"}},qn={class:"text-h6 mb-2"},Cn={class:"text-medium-emphasis text-center"},Sn=Ue({__name:"UmlDiagramDetailsDialog",props:{modelValue:{type:Boolean,default:!1},diagram:{type:Object,required:!0},isAdmin:{type:Boolean,default:!1},hasManagerPermission:{type:Boolean,default:!1},hasModeratorPermission:{type:Boolean,default:!1}},emits:["update:modelValue","delete","regenerate"],setup(s,{emit:c}){const i=s,r=Y({get:()=>i.modelValue,set:E=>c("update:modelValue",E)}),v=it(),d=j(!1),m=j(!1),b=j({...i.diagram}),C=j(!1),S=j({show:!1,text:"",color:"success"}),{t:U}=he(),z=[{title:U("projects.status.draft"),value:"draft"},{title:U("projects.status.active"),value:"active"},{title:U("projects.status.archived"),value:"archived"},{title:U("projects.status.completed"),value:"completed"}],R=E=>E?(E=parseInt(E),new Date(E).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})):"",A=()=>{d.value=!d.value},I=()=>{m.value&&(b.value={...i.diagram}),m.value=!m.value},X=j(null),W=()=>{r.value&&v.fetchDiagramById(i.diagram.id).then(({data:E})=>{E&&Object.assign(i.diagram,E)})};Ce(()=>{X.value=setInterval(W,5e3)}),Ne(()=>{X.value&&clearInterval(X.value)});const O=async()=>{C.value=!0;try{const{data:E,error:B}=await v.updateDiagram(i.diagram.id,b.value);E&&!B?(K(U("projects.uml_diagrams.notifications.updated")),Object.assign(i.diagram,E),m.value=!1,r.value=!1):K(U("projects.uml_diagrams.notifications.update_failed"),"error")}catch(E){K(U("projects.uml_diagrams.notifications.update_failed")+": "+E.message,"error")}finally{C.value=!1}},Q=()=>{c("delete"),r.value=!1},N=async()=>{C.value=!0;try{const{data:E,error:B}=await v.regenerateDiagram(i.diagram.id);E&&!B?(K(U("projects.uml_diagrams.notifications.regeneration_started")),r.value=!1,setTimeout(()=>{c("regenerate")},3e3)):K(U("projects.uml_diagrams.notifications.regeneration_failed"),"error")}catch(E){K(U("projects.uml_diagrams.notifications.regeneration_failed")+": "+E.message,"error")}finally{C.value=!1}},K=(E,B="success")=>{S.value={show:!0,text:E,color:B}};return ve(()=>i.diagram,E=>{b.value={...E}},{deep:!0}),(E,B)=>{const $=ke("IconBtn");return n(),h(be,{modelValue:a(r),"onUpdate:modelValue":B[7]||(B[7]=D=>De(r)?r.value=D:null),fullscreen:d.value,"max-width":d.value?"100%":"900",scrollable:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"d-flex py-3 px-5"},{default:t(()=>[m.value?(n(),f("h5",on,l(a(U)("projects.uml_diagrams.actions.edit")),1)):(n(),f(ae,{key:1},[o("h5",nn,l(s.diagram.name),1),e(J,{class:"ms-2",color:"secondary",size:"small",label:""},{default:t(()=>[u(l(a(U)(`projects.uml_diagrams.types.${s.diagram.diagram_type}`)),1)]),_:1})],64)),e(le),e(P,{icon:"",variant:"text",onClick:A},{default:t(()=>[e(V,{icon:d.value?"tabler-minimize":"tabler-maximize"},null,8,["icon"])]),_:1}),e($,{onClick:B[0]||(B[0]=D=>r.value=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),_:1}),e(ne),e(Z,{class:lt({"pa-0":!m.value&&s.diagram.content,"pa-6":m.value||!s.diagram.content}),style:Re({height:d.value?"calc(100vh - 120px)":"70vh",maxHeight:"800px"})},{default:t(()=>[m.value?(n(),f("div",cn,[e(Se,{onSubmit:we(O,["prevent"])},{default:t(()=>[e(oe,{class:"mt-3"},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:b.value.name,"onUpdate:modelValue":B[1]||(B[1]=D=>b.value.name=D),label:a(U)("projects.uml_diagrams.name"),required:"",rules:[D=>!!D||a(U)("projects.uml_diagrams.validation.name_required")]},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12",md:"6"},{default:t(()=>[e(_e,{modelValue:b.value.status,"onUpdate:modelValue":B[2]||(B[2]=D=>b.value.status=D),label:a(U)("projects.uml_diagrams.status.title"),items:z,required:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(qe,{modelValue:b.value.notes,"onUpdate:modelValue":B[3]||(B[3]=D=>b.value.notes=D),label:a(U)("projects.uml_diagrams.notes"),rows:"4"},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[o("div",un,l(a(U)("projects.uml_diagrams.content")),1),o("div",dn,[o("div",mn,l(a(U)("projects.uml_diagrams.content_hint")),1),e(qe,{modelValue:b.value.content,"onUpdate:modelValue":B[4]||(B[4]=D=>b.value.content=D),rows:"15",monospace:"","hide-details":""},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])):(n(),f("div",pn,[s.diagram.generation_status==="in_progress"?(n(),f("div",vn,[e(xe,{color:"info",variant:"tonal",icon:"tabler-refresh"},{default:t(()=>[e(kt,null,{default:t(()=>[u(l(a(U)("projects.uml_diagrams.status.generating")),1)]),_:1}),o("p",null,l(a(U)("projects.uml_diagrams.status.generating_description")),1)]),_:1}),o("div",fn,[e(me,{indeterminate:"",color:"primary",size:"64"})]),o("div",_n,[e(V,{size:"18",icon:"tabler-calendar",class:"me-1"}),o("span",gn,l(a(U)("projects.details.updated_at"))+": "+l(R(s.diagram.updated_at)),1),e(V,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),o("span",yn,l(a(U)("projects.details.created_at"))+": "+l(R(s.diagram.created_at)),1)])])):s.diagram.content?(n(),f("div",hn,[o("div",bn,[e(J,{color:a(je)(s.diagram.status),size:"small",label:"",class:"me-2"},{default:t(()=>[u(l(a(U)(`projects.status.${s.diagram.status}`)),1)]),_:1},8,["color"]),s.diagram.notes?(n(),f("div",jn,[e(Gt,null,{activator:t(({props:D})=>[e(V,bt({icon:"tabler-info-circle",size:"18",color:"info"},D),null,16)]),default:t(()=>[o("span",null,l(s.diagram.notes),1)]),_:1})])):w("",!0),e(le),o("div",kn,[e(V,{size:"18",icon:"tabler-calendar",class:"me-1"}),o("span",xn,l(a(U)("projects.details.updated_at"))+": "+l(R(s.diagram.updated_at)),1),e(V,{size:"18",icon:"tabler-calendar-plus",class:"me-1"}),o("span",wn,l(a(U)("projects.details.created_at"))+": "+l(R(s.diagram.created_at)),1)])]),e(ne),o("div",{class:"diagram-svg-container pa-4 d-flex justify-center align-center",style:Re({height:d.value?"calc(100vh - 180px)":"calc(70vh - 110px)",overflow:"auto"})},[s.diagram.content?(n(),h(Ee,{key:0,src:a(jt)(s.diagram.content),class:"diagram-svg",alt:"Generated Diagram"},null,8,["src"])):w("",!0)],4)])):(n(),f("div",Vn,[e(V,{icon:"tabler-chart-dots-2",size:"64",color:"secondary",class:"mb-4"}),o("h4",qn,l(a(U)("projects.uml_diagrams.status.no_content.title")),1),o("p",Cn,l(a(U)("projects.uml_diagrams.status.no_content.description")),1)]))]))]),_:1},8,["class","style"]),e(ne),e(pe,{class:"pa-4"},{default:t(()=>[m.value?(n(),f(ae,{key:0},[e(P,{color:"secondary",variant:"tonal",onClick:I,disabled:C.value},{default:t(()=>[u(l(a(U)("projects.actions.cancel")),1)]),_:1},8,["disabled"]),e(le),e(P,{color:"primary",onClick:O,loading:C.value},{default:t(()=>[u(l(a(U)("projects.actions.save")),1)]),_:1},8,["loading"])],64)):(n(),f(ae,{key:1},[s.isAdmin?(n(),h(P,{key:0,color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:Q},{default:t(()=>[u(l(a(U)("projects.uml_diagrams.actions.delete")),1)]),_:1})):w("",!0),s.hasModeratorPermission?(n(),h(P,{key:1,color:"info",variant:"tonal","prepend-icon":"tabler-refresh",class:"ms-2",onClick:N,loading:C.value},{default:t(()=>[u(l(a(U)("projects.uml_diagrams.actions.regenerate")),1)]),_:1},8,["loading"])):w("",!0),e(le),s.hasModeratorPermission?(n(),h(P,{key:2,color:"primary","prepend-icon":"tabler-edit",onClick:I},{default:t(()=>[u(l(a(U)("projects.uml_diagrams.actions.edit")),1)]),_:1})):w("",!0)],64))]),_:1})]),_:1}),e(Ve,{modelValue:S.value.show,"onUpdate:modelValue":B[6]||(B[6]=D=>S.value.show=D),color:S.value.color,timeout:5e3},{actions:t(()=>[e($,{onClick:B[5]||(B[5]=D=>S.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(S.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1},8,["modelValue","fullscreen","max-width"])}}},[["__scopeId","data-v-036dfd63"]]),Un={key:0,class:"mb-4"},zn={key:1,class:"d-flex justify-center align-center",style:{height:"300px"}},In={key:2,class:"text-center pa-4"},Dn={class:"text-h6 mb-2"},$n={class:"text-body-1 text-medium-emphasis mb-6"},Mn={class:"d-flex align-center"},Pn={class:"mb-3 d-flex align-center"},Bn={class:"diagram-preview mb-3"},Rn={class:"overflow-hidden position-relative rounded bg-grey-lighten-4",style:{height:"150px"}},Ln={class:"d-flex justify-center align-center h-100"},An={key:0,class:"text-center pa-2"},Fn={class:"text-caption"},On={key:1,class:"diagram-thumbnail pa-2"},Nn={key:2,class:"text-center"},En={class:"text-caption mt-2"},Wn={class:"preview-overlay d-flex justify-center align-center"},Tn={class:"d-flex align-center justify-space-between"},Gn={class:"d-flex align-center"},Xn={class:"text-caption"},Hn={class:"text-body-1 mb-4"},Jn=Ue({__name:"UmlDiagramList",props:{projectId:{type:String,required:!0},diagrams:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(s,{emit:c}){const i=s,r=it(),v=Be(),{t:d}=he(),m=j(""),b=j("all"),C=j(null),S=j(!1),U=j(!1),z=j(!1),R=j(!1),A=j({show:!1,text:"",color:"success"}),I=Y(()=>v.is_admin()),X=j(!1),W=j(!1),O=async()=>{X.value=await v.hasProjectRoleAtLeast(i.projectId,"MANAGER"),W.value=await v.hasProjectRoleAtLeast(i.projectId,"ADMIN")},Q=[{title:d("projects.uml_diagrams.types.all"),value:"all"},{title:d("projects.uml_diagrams.types.class"),value:"class"},{title:d("projects.uml_diagrams.types.sequence"),value:"sequence"},{title:d("projects.uml_diagrams.types.activity"),value:"activity"},{title:d("projects.uml_diagrams.types.usecase"),value:"use_case"},{title:d("projects.uml_diagrams.types.state"),value:"state"},{title:d("projects.uml_diagrams.types.component"),value:"component"},{title:d("projects.uml_diagrams.types.deployment"),value:"deployment"},{title:d("projects.uml_diagrams.types.er"),value:"er"}],N=j("class"),K=Y(()=>i.diagrams.filter(x=>{const _=!m.value||x.name.toLowerCase().includes(m.value.toLowerCase())||x.diagram_type.toLowerCase().includes(m.value.toLowerCase()),ee=b.value==="all"||x.diagram_type.toLowerCase()===b.value.toLowerCase();return _&&ee})),E=Y(()=>i.diagrams.some(x=>x.generation_status==="in_progress"||x.generation_status==="pending")),B=Te(),$=()=>{N.value="class",z.value=!0},D=async()=>{z.value=!1,R.value=!0;try{const{data:x,error:_}=await r.generateDiagrams(i.projectId,N.value);x&&!_?(q(d("projects.uml_diagrams.notifications.generation_started")),setTimeout(()=>{c("refresh")},3e3)):q(d("projects.uml_diagrams.notifications.generation_failed"),"error")}catch(x){q(d("projects.uml_diagrams.notifications.generation_failed")+": "+x.message,"error")}finally{R.value=!1}},M=async()=>{if(C.value){R.value=!0,U.value=!1;try{const{success:x,error:_}=await r.deleteDiagram(C.value.id);x&&!_?(q(d("projects.uml_diagrams.notifications.delete_success")),c("refresh"),S.value=!1):q(d("projects.uml_diagrams.notifications.delete_failed"),"error")}catch(x){q(d("projects.uml_diagrams.notifications.delete_failed")+": "+x.message,"error")}finally{R.value=!1}}},q=(x,_="success")=>{A.value={show:!0,text:x,color:_}},G=x=>{switch(x.toLowerCase()){case"all":default:return"tabler-chart-dots";case"class":return"tabler-box";case"sequence":return"tabler-arrow-right-square";case"activity":return"tabler-activity";case"usecase":return"tabler-user-check";case"state":return"tabler-circle-check";case"component":return"tabler-puzzle";case"deployment":return"tabler-server";case"er":return"tabler-database"}},k=x=>{switch(x.toLowerCase()){case"all":return d("projects.uml_diagrams.types.all");case"class":return d("projects.uml_diagrams.types.class");case"sequence":return d("projects.uml_diagrams.types.sequence");case"activity":return d("projects.uml_diagrams.types.activity");case"usecase":return d("projects.uml_diagrams.types.usecase");case"state":return d("projects.uml_diagrams.types.state");case"component":return d("projects.uml_diagrams.types.component");case"deployment":return d("projects.uml_diagrams.types.deployment");case"er":return d("projects.uml_diagrams.types.er");default:return x.charAt(0).toUpperCase()+x.slice(1)+" "+d("projects.uml_diagrams.types.diagram")}};return Ce(()=>{O(),B.on("project-refresh",()=>{r.fetchDiagrams(i.projectId,{silent:!0}).then(({data:x})=>{x&&c("refresh")})})}),ve(S,x=>{x?B.on("project-refresh",async()=>{if(C.value){const{data:_}=await r.fetchDiagramById(C.value.id);_&&(C.value=_)}}):B.off("project-refresh")}),ve(()=>i.projectId,()=>{O()}),(x,_)=>{const ee=We,F=ke("IconBtn");return n(),h(Z,{class:"pa-6"},{default:t(()=>[a(E)?(n(),f("div",Un,[e(xe,{type:"info",variant:"tonal",border:"start",class:"d-flex align-center"},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"24",class:"me-3"}),o("span",null,l(a(d)("projects.uml_diagrams.status.generating")),1)]),_:1})])):w("",!0),e(oe,null,{default:t(()=>[e(L,{cols:"12",md:"4"},{default:t(()=>[e(ce,{modelValue:m.value,"onUpdate:modelValue":_[0]||(_[0]=y=>m.value=y),density:"compact",placeholder:a(d)("projects.uml_diagrams.actions.search"),"prepend-inner-icon":"tabler-search","hide-details":"",variant:"outlined",clearable:""},null,8,["modelValue","placeholder"])]),_:1}),e(L,{cols:"12",md:"4"},{default:t(()=>[e(_e,{modelValue:b.value,"onUpdate:modelValue":_[1]||(_[1]=y=>b.value=y),items:Q,density:"compact","hide-details":"",label:a(d)("projects.uml_diagrams.type"),variant:"outlined"},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12",md:"4",class:"d-flex align-center"},{default:t(()=>[W.value?(n(),h(P,{key:0,color:"primary","prepend-icon":"tabler-plus",onClick:$,loading:R.value,block:""},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.actions.generate")),1)]),_:1},8,["loading"])):w("",!0)]),_:1})]),_:1}),e(ne,{class:"my-5"}),s.loading?(n(),f("div",zn,[e(me,{indeterminate:"",color:"primary"})])):a(K).length===0?(n(),f("div",In,[e(V,{icon:"tabler-chart-dots",size:"64",color:"secondary",class:"mb-4"}),o("h4",Dn,l(a(d)("projects.uml_diagrams.empty.title")),1),o("p",$n,l(m.value||b.value!=="all"?a(d)("projects.uml_diagrams.empty.filtered"):a(d)("projects.uml_diagrams.empty.description")),1),W.value&&!m.value&&b.value==="all"?(n(),h(P,{key:0,color:"primary",onClick:$,"prepend-icon":"tabler-plus"},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.actions.generate")),1)]),_:1})):w("",!0)])):(n(),h(oe,{key:3},{default:t(()=>[(n(!0),f(ae,null,de(a(K),y=>(n(),h(L,{key:y.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(te,{class:"diagram-card h-100",onClick:p=>(async T=>{const{data:g}=await r.fetchDiagramById(T.id);C.value=g||T,S.value=!0})(y),border:"",hover:""},{default:t(()=>[e(fe,null,{prepend:t(()=>[e(ze,{color:"primary",variant:"tonal",size:"42"},{default:t(()=>[e(V,{icon:G(y.diagram_type)},null,8,["icon"])]),_:2},1024)]),append:t(()=>[o("div",Mn,[y.generation_status==="in_progress"||y.generation_status==="pending"?(n(),h(me,{key:0,indeterminate:"",color:"primary",size:"20",width:"2",class:"me-2"})):w("",!0),y.generation_status==="pending"?(n(),h(J,{key:1,color:"warning",size:"small",label:"","prepend-icon":"tabler-refresh"},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.status.generating")),1)]),_:1})):w("",!0),e(J,{color:a(je)(y.status),size:"small",label:""},{default:t(()=>[u(l(y.status),1)]),_:2},1032,["color"])])]),default:t(()=>[e(se,null,{default:t(()=>[u(l(y.name),1)]),_:2},1024)]),_:2},1024),e(Z,null,{default:t(()=>{return[o("div",Pn,[e(J,{color:"secondary",size:"small",label:"",class:"me-2"},{default:t(()=>[u(l(k(y.diagram_type)),1)]),_:2},1024)]),o("div",Bn,[o("div",Rn,[o("div",Ln,[y.generation_status==="in_progress"?(n(),f("div",An,[e(me,{indeterminate:"",color:"primary",size:"40",class:"mb-2"}),o("div",Fn,l(a(d)("projects.uml_diagrams.status.generating")),1)])):y.content?(n(),f("div",On,[y.content?(n(),h(Ee,{key:0,src:a(jt)(y.content),class:"diagram-svg",alt:a(d)("projects.uml_diagrams.title")},null,8,["src","alt"])):w("",!0)])):(n(),f("div",Nn,[e(V,{icon:G(y.diagram_type),size:"48",color:"secondary"},null,8,["icon"]),o("div",En,l(a(d)("projects.uml_diagrams.status.no_content.title")),1)]))]),o("div",Wn,[e(P,{color:"primary",variant:"elevated",size:"small","prepend-icon":"tabler-eye"},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.actions.view")),1)]),_:1})])])]),o("div",Tn,[o("div",Gn,[e(V,{size:"16",icon:"tabler-calendar",class:"me-1"}),o("span",Xn,l((p=y.created_at,p?(p=parseInt(p),new Date(p).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})):"")),1)])])];var p}),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),C.value?(n(),h(Sn,{key:4,modelValue:S.value,"onUpdate:modelValue":_[2]||(_[2]=y=>S.value=y),diagram:C.value,onDelete:_[3]||(_[3]=y=>U.value=!0),"is-admin":a(I),"has-manager-permission":X.value,"has-moderator-permission":W.value},null,8,["modelValue","diagram","is-admin","has-manager-permission","has-moderator-permission"])):w("",!0),e(be,{modelValue:z.value,"onUpdate:modelValue":_[6]||(_[6]=y=>z.value=y),"max-width":"600",persistent:""},{default:t(()=>[e(te,null,{default:t(()=>[e(se,{class:"pt-5 pb-2"},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.generation.title")),1)]),_:1}),e(Z,null,{default:t(()=>[o("p",Hn,l(a(d)("projects.uml_diagrams.generation.description")),1),e(_e,{modelValue:N.value,"onUpdate:modelValue":_[4]||(_[4]=y=>N.value=y),items:Q,label:a(d)("projects.uml_diagrams.type")},null,8,["modelValue","label"])]),_:1}),e(pe,null,{default:t(()=>[e(P,{color:"secondary",variant:"tonal",onClick:_[5]||(_[5]=y=>z.value=!1)},{default:t(()=>[u(l(a(d)("projects.user_stories.actions.cancel")),1)]),_:1}),e(le),e(P,{color:"primary",onClick:D},{default:t(()=>[u(l(a(d)("projects.uml_diagrams.actions.generate")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ee,{isDialogVisible:U.value,"onUpdate:isDialogVisible":_[7]||(_[7]=y=>U.value=y),confirmationMsg:a(d)("projects.uml_diagrams.delete_confirm.message"),onConfirm:M},null,8,["isDialogVisible","confirmationMsg"]),e(Ve,{modelValue:A.value.show,"onUpdate:modelValue":_[9]||(_[9]=y=>A.value.show=y),color:A.value.color,timeout:5e3},{actions:t(()=>[e(F,{onClick:_[8]||(_[8]=y=>A.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(A.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},[["__scopeId","data-v-61af0646"]]),Kn={class:"d-flex justify-space-between align-center mb-4"},Zn={class:"text-h5"},Qn={key:2,class:"d-flex justify-center align-center",style:{"min-height":"200px"}},Yn={__name:"ProjectExportsList",props:{projectId:{type:String,required:!0},exports:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(s,{emit:c}){const{t:i}=he(),r=d=>{switch(d){case"completed":return"success";case"pending":return"warning";case"in_progress":return"info";case"failed":return"error";default:return"grey"}},v=()=>{c("refresh")};return(d,m)=>(n(),h(te,null,{default:t(()=>[e(Z,null,{default:t(()=>[o("div",Kn,[o("h2",Zn,l(a(i)("projects.exports.title")),1),e(P,{icon:"",variant:"text",color:"primary",onClick:v,loading:s.loading},{default:t(()=>[e(V,{icon:"tabler-refresh"})]),_:1},8,["loading"])]),!s.loading&&s.exports.length>0?(n(),h(Pe,{key:0},{default:t(()=>[o("thead",null,[o("tr",null,[o("th",null,l(a(i)("projects.exports.table.format")),1),o("th",null,l(a(i)("projects.exports.table.status")),1),o("th",null,l(a(i)("projects.exports.table.created_by")),1),o("th",null,l(a(i)("projects.exports.table.created_at")),1),o("th",null,l(a(i)("projects.exports.table.actions")),1)])]),o("tbody",null,[(n(!0),f(ae,null,de(s.exports,b=>{return n(),f("tr",{key:b.id},[o("td",null,l(b.fmt.toUpperCase()),1),o("td",null,[e(J,{color:r(b.status),size:"small"},{default:t(()=>[u(l(a(i)(`projects.exports.status.${b.status}`))+" ",1),b.status==="in_progress"?(n(),h(V,{key:0,class:"ml-1",icon:"tabler-loader",spin:""})):w("",!0)]),_:2},1032,["color"])]),o("td",null,l(b.created_by.username),1),o("td",null,l((C=b.created_at,new Date(parseInt(C)).toLocaleString())),1),o("td",null,[b.url&&b.status==="completed"?(n(),h(P,{key:0,icon:"",variant:"text",color:"primary",onClick:S=>(U=>{U.url&&window.open(U.url,"_blank")})(b)},{default:t(()=>[e(V,{icon:"tabler-download"})]),_:2},1032,["onClick"])):b.status==="in_progress"?(n(),h(P,{key:1,disabled:"",icon:"",variant:"text",color:"primary"},{default:t(()=>[e(V,{icon:"tabler-hourglass"})]),_:1})):w("",!0)])]);var C}),128))])]),_:1})):s.loading||s.exports.length!==0?(n(),f("div",Qn,[e(me,{indeterminate:"",color:"primary",size:"64"})])):(n(),h(xe,{key:1,type:"info",variant:"tonal",class:"mt-4"},{default:t(()=>[u(l(a(i)("projects.exports.empty")),1)]),_:1}))]),_:1})]),_:1}))}},ec={key:0},tc={key:0},ac={class:"d-flex gap-2"},lc={__name:"ProjectRoles",props:{projectId:{type:String,required:!0}},emits:["updated"],setup(s,{emit:c}){const i=s,{t:r}=he(),v=At(),d=Be(),m=Y(()=>v.projectRoles[i.projectId]||[]),b=j(!1),C=j(!1),S=j(!1),U=j(!1),z=j(!1),R=j({user_email:"",role:""}),A=j({id:null,username:"",role:""}),I=j(null),X=Y(()=>d.userData.username),W=j(!1),O=[{text:r("projects.roles.role_types.owner"),value:"OWNER"},{text:r("projects.roles.role_types.admin"),value:"ADMIN"},{text:r("projects.roles.role_types.manager"),value:"MANAGER"},{text:r("projects.roles.role_types.member"),value:"MEMBER"},{text:r("projects.roles.role_types.viewer"),value:"VIEWER"}],Q=k=>({OWNER:"purple",ADMIN:"red",MANAGER:"orange",MEMBER:"blue",VIEWER:"green"})[k]||"grey",N=()=>{R.value={user_email:"",role:"VIEWER"},S.value=!0},K=j({show:!1,text:"",color:"error"}),E=k=>{let x="An unexpected error occurred";if(typeof k=="string")x=k;else if(k&&k.detail)x=k.detail;else if(k&&k.user_email)x=`Email error: ${k.user_email}`;else if(k&&k.user)x=`User error: ${k.user}`;else if(k&&k.role)x=`Role error: ${k.role}`;else if(k&&k.non_field_errors)x=k.non_field_errors[0];else if(k&&typeof k=="object"){const _=Object.keys(k)[0];_&&k[_]&&(x=`${_}: ${Array.isArray(k[_])?k[_][0]:k[_]}`)}K.value={show:!0,text:x,color:"error"}},B=(k,x="error")=>{K.value={show:!0,text:k,color:x}},$=async()=>{if(R.value.user_email&&R.value.role){C.value=!0;try{const{data:k,error:x}=await v.addProjectRole(i.projectId,R.value);k&&!x?(B(r("projects.roles.notifications.role_added"),"success"),setTimeout(()=>{S.value=!1,c("updated"),d.clearProjectRoleCache(i.projectId)},1e3)):x&&E(x)}catch(k){E(k.message||"Failed to add member")}finally{C.value=!1}}},D=async()=>{if(A.value.id&&A.value.role){C.value=!0;try{const{data:k,error:x}=await v.updateProjectRole(i.projectId,A.value.id,{role:A.value.role});k&&!x?(B(r("projects.roles.notifications.role_updated"),"success"),setTimeout(()=>{U.value=!1,c("updated"),d.clearProjectRoleCache(i.projectId)},1e3)):x&&E(x)}catch(k){E(k.message||"Failed to update role")}finally{C.value=!1}}},M=async()=>{var k;if((k=I.value)!=null&&k.id){C.value=!0;try{const{success:x,error:_}=await v.deleteProjectRole(i.projectId,I.value.id);x&&!_?(z.value=!1,I.value=null,c("updated"),d.clearProjectRoleCache(i.projectId)):_&&E(_)}catch(x){E(x.message||"Failed to remove member")}finally{C.value=!1}}},q=async()=>{b.value=!0;try{const{data:k,error:x}=await v.fetchProjectRoles(i.projectId);x&&E(x)}catch(k){E(k.message||"Failed to fetch project members")}finally{b.value=!1}},G=async()=>{W.value=await d.hasProjectRoleAtLeast(i.projectId,"MANAGER")};return ve(()=>i.projectId,()=>{i.projectId&&(q(),G())},{immediate:!0}),Ce(async()=>{i.projectId&&(await q(),await G())}),(k,x)=>(n(),h(te,null,{default:t(()=>[e(se,{class:"d-flex justify-space-between align-center"},{default:t(()=>[u(l(k.$t("projects.roles.title"))+" ",1),W.value?(n(),h(P,{key:0,color:"primary",size:"small",onClick:N},{default:t(()=>[e(V,{size:"18",start:"",icon:"tabler-plus"}),u(" "+l(k.$t("projects.roles.add_member")),1)]),_:1})):w("",!0)]),_:1}),e(Z,null,{default:t(()=>[a(m)&&a(m).length>0?(n(),h(Pe,{key:0},{default:t(()=>[o("thead",null,[o("tr",null,[o("th",null,l(k.$t("projects.roles.user")),1),o("th",null,l(k.$t("projects.roles.email")),1),o("th",null,l(k.$t("projects.roles.role")),1),W.value?(n(),f("th",ec,l(k.$t("projects.roles.actions")),1)):w("",!0)])]),o("tbody",null,[(n(!0),f(ae,null,de(a(m),_=>(n(),f("tr",{key:_.id},[o("td",null,l(_.first_name)+" "+l(_.last_name),1),o("td",null,l(_.email),1),o("td",null,[W.value&&_.username!==a(X)?(n(),h(J,{key:0,color:Q(_.role),onClick:ee=>(F=>{A.value={id:F.id,username:F.username,role:F.role},U.value=!0})(_),class:"font-weight-medium cursor-pointer"},{default:t(()=>[u(l(k.$t(`projects.roles.role_types.${_.role.toLowerCase()}`)),1)]),_:2},1032,["color","onClick"])):(n(),h(J,{key:1,color:Q(_.role),class:"font-weight-medium"},{default:t(()=>[u(l(k.$t(`projects.roles.role_types.${_.role.toLowerCase()}`)),1)]),_:2},1032,["color"]))]),W.value?(n(),f("td",tc,[o("div",ac,[_.username!==a(X)&&_.role!=="OWNER"?(n(),h(P,{key:0,density:"compact",icon:"",variant:"text",disabled:C.value,onClick:ee=>(F=>{I.value=F,z.value=!0})(_)},{default:t(()=>[e(V,{icon:"tabler-trash",size:"20",color:"error"})]),_:2},1032,["disabled","onClick"])):w("",!0)])])):w("",!0)]))),128))])]),_:1})):b.value?w("",!0):(n(),h(xe,{key:1,type:"info",variant:"tonal"},{default:t(()=>[u(l(k.$t("projects.roles.no_members")),1)]),_:1})),b.value?(n(),h(Le,{key:2,indeterminate:""})):w("",!0)]),_:1}),e(be,{modelValue:S.value,"onUpdate:modelValue":x[3]||(x[3]=_=>S.value=_),"max-width":"600px"},{default:t(()=>[e(te,null,{default:t(()=>[e(se,null,{default:t(()=>[u(l(k.$t("projects.roles.add_member")),1)]),_:1}),e(Z,null,{default:t(()=>[e(Se,{ref:"addRoleForm",onSubmit:we($,["prevent"])},{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:R.value.user_email,"onUpdate:modelValue":x[0]||(x[0]=_=>R.value.user_email=_),label:k.$t("projects.roles.email"),rules:[_=>!!_||k.$t("validation.required"),_=>/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(_)||k.$t("validation.email")],required:""},null,8,["modelValue","label","rules"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(_e,{modelValue:R.value.role,"onUpdate:modelValue":x[1]||(x[1]=_=>R.value.role=_),items:O,"item-title":"text","item-value":"value",label:k.$t("projects.roles.role"),rules:[_=>!!_||k.$t("validation.required")],required:""},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(pe,null,{default:t(()=>[e(le),e(P,{color:"error",text:"",onClick:x[2]||(x[2]=_=>S.value=!1)},{default:t(()=>[u(l(k.$t("projects.actions.cancel")),1)]),_:1}),e(P,{color:"primary",loading:C.value,disabled:!R.value.user_email||!R.value.role,onClick:$},{default:t(()=>[u(l(k.$t("projects.actions.add")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(be,{modelValue:U.value,"onUpdate:modelValue":x[7]||(x[7]=_=>U.value=_),"max-width":"600px"},{default:t(()=>[e(te,null,{default:t(()=>[e(se,null,{default:t(()=>[u(l(k.$t("projects.roles.edit_role")),1)]),_:1}),e(Z,null,{default:t(()=>[e(Se,{ref:"editRoleForm",onSubmit:we(D,["prevent"])},{default:t(()=>[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(ce,{modelValue:A.value.username,"onUpdate:modelValue":x[4]||(x[4]=_=>A.value.username=_),label:k.$t("projects.roles.user"),disabled:""},null,8,["modelValue","label"])]),_:1}),e(L,{cols:"12"},{default:t(()=>[e(_e,{modelValue:A.value.role,"onUpdate:modelValue":x[5]||(x[5]=_=>A.value.role=_),items:O,"item-title":"text","item-value":"value",label:k.$t("projects.roles.role"),rules:[_=>!!_||k.$t("validation.required")],required:""},null,8,["modelValue","label","rules"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),e(pe,null,{default:t(()=>[e(le),e(P,{color:"error",text:"",onClick:x[6]||(x[6]=_=>U.value=!1)},{default:t(()=>[u(l(k.$t("projects.actions.cancel")),1)]),_:1}),e(P,{color:"primary",loading:C.value,disabled:!A.value.role,onClick:D},{default:t(()=>[u(l(k.$t("projects.actions.save")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(be,{modelValue:z.value,"onUpdate:modelValue":x[9]||(x[9]=_=>z.value=_),"max-width":"400px"},{default:t(()=>[e(te,null,{default:t(()=>[e(se,null,{default:t(()=>[u(l(k.$t("projects.roles.delete_role")),1)]),_:1}),e(Z,null,{default:t(()=>{var _,ee;return[u(l(k.$t("projects.roles.delete_confirmation",{user:`${(_=I.value)==null?void 0:_.first_name} ${(ee=I.value)==null?void 0:ee.last_name}`})),1)]}),_:1}),e(pe,null,{default:t(()=>[e(le),e(P,{color:"grey",text:"",onClick:x[8]||(x[8]=_=>z.value=!1)},{default:t(()=>[u(l(k.$t("projects.actions.cancel")),1)]),_:1}),e(P,{color:"error",loading:C.value,onClick:M},{default:t(()=>[u(l(k.$t("projects.actions.delete")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ve,{modelValue:K.value.show,"onUpdate:modelValue":x[11]||(x[11]=_=>K.value.show=_),color:K.value.color,timeout:5e3},{actions:t(()=>[e(P,{icon:"",onClick:x[10]||(x[10]=_=>K.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(K.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1}))}},rc={class:"text-center"},sc={class:"d-flex flex-wrap justify-space-between align-center"},oc={class:"d-flex align-center"},ic={class:"text-h3"},nc={__name:"[id]",setup(s){const c=Ot(),i=Nt(),r=Et();ot(),it();const v=Be(),{t:d}=he(),m=j(!0),b=j(null),C=j("0"),S=j(!1),U=j(!1),z=j(!1),R=j({show:!1,text:"",color:"success"}),A=Y(()=>c.params.id),I=Y(()=>r.currentProject);Y(()=>v.is_admin());const X=j(!1),W=j(!1),O=j(!1),Q=j(!1),N=j(null),K=j(!1),E=[{title:"Markdown",value:"md",icon:"tabler-markdown"},{title:"PDF",value:"pdf",icon:"tabler-file-text"},{title:"HTML",value:"html",icon:"tabler-code"}],B=Te(),$=j(null);Y(()=>[{title:d("projects.tabs.info"),icon:"tabler-info-circle",value:"0"},{title:d("projects.tabs.requirements"),icon:"tabler-list-check",value:"1"},{title:d("projects.tabs.user_stories"),icon:"tabler-user-check",value:"2"},{title:d("projects.tabs.mockups"),icon:"tabler-photo",value:"3"},{title:d("projects.tabs.uml_diagrams"),icon:"tabler-chart-dots",value:"4"},{title:d("projects.tabs.development_plan"),icon:"tabler-chart-bar",value:"5"},{title:d("projects.tabs.exports"),icon:"tabler-file-export",value:"6"},{title:d("projects.tabs.roles"),icon:"tabler-users",value:"7"}]);const D=async()=>{I.value||(m.value=!0),b.value=null;try{const{data:p,error:T}=await r.fetchProjectById(A.value);T&&(b.value=T,M("projects.errors.loading_failed"))}catch(p){b.value=p.message||"Failed to load project details",M("projects.errors.loading_failed")}finally{m.value=!1}},M=(p,T="success")=>{R.value={show:!0,text:d(p),color:T}},q=()=>{S.value=!0},G=async(p=!1)=>{if(p){U.value=!1,z.value=!0;try{const{success:T,error:g}=await r.deleteProject(A.value);T&&!g?(M("projects.notifications.deleted"),i.push({name:"projects"})):M("projects.notifications.error")}catch{M("projects.errors.delete_failed","error")}finally{z.value=!1}}},k=async p=>{z.value=!0;try{const{data:T,error:g}=await r.updateProject(A.value,p);M(T&&!g?"projects.notifications.updated":"projects.notifications.error")}catch{M("projects.errors.update_failed","error")}finally{z.value=!1}},x=async()=>{z.value=!0;try{const{data:p,error:T}=await r.generateRequirements(A.value);p&&!T?M("projects.notifications.requirements_generation_started"):M("projects.notifications.requirements_generation_failed","error")}catch{M("projects.notifications.requirements_generation_failed","error")}finally{z.value=!1}},_=async()=>{z.value=!0;try{const{data:p,error:T}=await r.generatePlan(A.value);p&&!T?M("projects.notifications.plan_generation_started"):M("projects.notifications.plan_generation_failed","error")}catch{M("projects.notifications.plan_generation_failed","error")}finally{z.value=!1}},ee=async()=>{z.value=!0;try{const{data:p,error:T}=await r.generateMockups(A.value);p&&!T?M("projects.notifications.mockups_generation_started"):M("projects.notifications.mockups_generation_failed","error")}catch{M("projects.notifications.mockups_generation_failed","error")}finally{z.value=!1}},F=p=>{N.value=p,C.value="2"},y=async()=>{X.value=await v.hasProjectRole(A.value,["OWNER"]),W.value=await v.hasProjectRoleAtLeast(A.value,"MANAGER"),O.value=await v.hasProjectRoleAtLeast(A.value,"ADMIN"),Q.value=await v.hasProjectRoleAtLeast(A.value,"MEMBER")};return Ce(async()=>{await D(),$.value=setInterval(()=>{B.emit("project-refresh"),D()},8e3),await y()}),Ft(()=>{$.value&&(clearInterval($.value),$.value=null)}),(p,T)=>{const g=We,re=ke("IconBtn");return n(),h(Tt,{fluid:""},{default:t(()=>[m.value&&!a(I)?(n(),h(oe,{key:0},{default:t(()=>[e(L,{cols:"12",class:"d-flex justify-center align-center",style:{"min-height":"400px"}},{default:t(()=>[e(me,{indeterminate:"",color:"primary",size:"64"})]),_:1})]),_:1})):b.value&&!a(I)?(n(),h(oe,{key:1},{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(xe,{color:"error",variant:"tonal",title:a(d)("projects.errors.loading_failed"),text:a(d)("projects.errors.loading_failed"),class:"mb-4"},null,8,["title","text"]),o("div",rc,[e(P,{color:"primary",onClick:D},{default:t(()=>[u(l(p.$t("projects.actions.retry")),1)]),_:1}),e(P,{color:"secondary",variant:"outlined",class:"ms-2",to:{name:"projects"}},{default:t(()=>[u(l(p.$t("projects.actions.back_to_projects")),1)]),_:1})])]),_:1})]),_:1})):a(I)?(n(),f(ae,{key:2},[e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[o("div",sc,[o("div",oc,[e(P,{icon:"",variant:"text",class:"me-3",to:{name:"projects"}},{default:t(()=>[e(V,{icon:"tabler-arrow-left"})]),_:1}),o("h3",ic,l(a(I).name),1)]),e(le),e(oe,{class:"d-flex align-center mt-3 mt-sm-0"},{default:t(()=>[e(L,{cols:"6",sm:"3"},{default:t(()=>[e(P,{color:"info",variant:"tonal","prepend-icon":"tabler-refresh",class:"w-100 me-2",onClick:D,loading:z.value},{default:t(()=>[u(l(p.$t("projects.actions.refresh")),1)]),_:1},8,["loading"])]),_:1}),Q.value?(n(),h(L,{key:0,cols:"6",sm:"3"},{default:t(()=>[e(Xt,{class:"w-100",modelValue:K.value,"onUpdate:modelValue":T[0]||(T[0]=H=>K.value=H),location:"top",loading:z.value},{activator:t(({props:H})=>[e(P,bt(H,{color:"secondary",variant:"outlined","prepend-icon":"tabler-file-export",class:"me-2 w-100"}),{default:t(()=>[u(l(p.$t("projects.actions.export_srs")),1)]),_:2},1040)]),default:t(()=>[e(Ge,null,{default:t(()=>[(n(),f(ae,null,de(E,H=>e(Xe,{key:H.value,value:H.value,onClick:ue=>{(async($e="md")=>{z.value=!0;try{const{data:Ie,error:Me}=await r.exportSrs(A.value,$e);Ie&&!Me?(M("projects.notifications.srs_export_started"),C.value="6"):M("projects.notifications.srs_export_failed","error")}catch{M("projects.notifications.srs_export_failed","error")}finally{z.value=!1}})(H.value),K.value=!1}},{prepend:t(()=>[e(V,{icon:H.icon},null,8,["icon"])]),default:t(()=>[e(He,null,{default:t(()=>[u(l(H.title),1)]),_:2},1024)]),_:2},1032,["value","onClick"])),64))]),_:1})]),_:1},8,["modelValue","loading"])]),_:1})):w("",!0),W.value?(n(),h(L,{key:1,cols:"6",sm:"3"},{default:t(()=>[e(P,{color:"primary","prepend-icon":"tabler-edit",class:"me-2 w-100",onClick:q,loading:z.value},{default:t(()=>[u(l(p.$t("projects.actions.edit")),1)]),_:1},8,["loading"])]),_:1})):w("",!0),O.value?(n(),h(L,{key:2,cols:"6",sm:"3"},{default:t(()=>[e(P,{class:"w-100",color:"error",variant:"tonal","prepend-icon":"tabler-trash",onClick:T[1]||(T[1]=H=>U.value=!0),loading:z.value},{default:t(()=>[u(l(p.$t("projects.actions.delete")),1)]),_:1},8,["loading"])]),_:1})):w("",!0)]),_:1})])]),_:1})]),_:1}),e(oe,null,{default:t(()=>[e(L,{cols:"12"},{default:t(()=>[e(te,null,{default:t(()=>[e(rt,{modelValue:C.value,"onUpdate:modelValue":T[2]||(T[2]=H=>C.value=H),"bg-color":"primary",grow:"","slider-color":"white"},{default:t(()=>[e(ge,{value:"0",color:"white"},{default:t(()=>[e(V,{size:"18",icon:"tabler-info-circle",start:""}),u(" "+l(p.$t("projects.tabs.overview")),1)]),_:1}),e(ge,{value:"1",color:"white"},{default:t(()=>{var H;return[e(V,{size:"18",icon:"tabler-list",start:""}),u(" "+l(p.$t("projects.tabs.requirements"))+" ",1),(H=a(I).requirements)!=null&&H.length?(n(),h(J,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>[u(l(a(I).requirements.length),1)]),_:1})):w("",!0)]}),_:1}),e(ge,{value:"2",color:"white"},{default:t(()=>{var H;return[e(V,{size:"18",icon:"tabler-user-check",start:""}),u(" "+l(p.$t("projects.tabs.user_stories"))+" ",1),(H=a(I).user_stories)!=null&&H.length?(n(),h(J,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>{var ue;return[u(l(((ue=a(I).user_stories)==null?void 0:ue.length)||0),1)]}),_:1})):w("",!0)]}),_:1}),e(ge,{value:"3",color:"white"},{default:t(()=>{var H;return[e(V,{size:"18",icon:"tabler-layout-kanban",start:""}),u(" "+l(p.$t("projects.tabs.mockups"))+" ",1),(H=a(I).mockups)!=null&&H.length?(n(),h(J,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>[u(l(a(I).mockups.length),1)]),_:1})):w("",!0)]}),_:1}),e(ge,{value:"4",color:"white"},{default:t(()=>{var H;return[e(V,{size:"18",icon:"tabler-chart-dots",start:""}),u(" "+l(p.$t("projects.tabs.uml_diagrams"))+" ",1),(H=a(I).uml_diagrams)!=null&&H.length?(n(),h(J,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>{var ue;return[u(l(((ue=a(I).uml_diagrams)==null?void 0:ue.length)||0),1)]}),_:1})):w("",!0)]}),_:1}),e(ge,{value:"5",color:"white"},{default:t(()=>[e(V,{size:"18",icon:"tabler-chart-dots",start:""}),u(" "+l(p.$t("projects.tabs.development_plan")),1)]),_:1}),e(ge,{value:"6",color:"white"},{default:t(()=>{var H;return[e(V,{size:"18",icon:"tabler-file-export",start:""}),u(" "+l(p.$t("projects.tabs.exports"))+" ",1),(H=a(I).srs_exports)!=null&&H.length?(n(),h(J,{key:0,size:"x-small",color:"white",class:"ms-2"},{default:t(()=>{var ue;return[u(l(((ue=a(I).srs_exports)==null?void 0:ue.length)||0),1)]}),_:1})):w("",!0)]}),_:1}),e(ge,{value:"7",color:"white"},{default:t(()=>[e(V,{size:"18",icon:"tabler-users",start:""}),u(" "+l(p.$t("projects.tabs.roles")),1)]),_:1})]),_:1},8,["modelValue"]),e(ne),e(st,{modelValue:C.value,"onUpdate:modelValue":T[6]||(T[6]=H=>C.value=H)},{default:t(()=>[e(ye,{value:"0"},{default:t(()=>[e(Fa,{project:a(I),loading:m.value},null,8,["project","loading"])]),_:1}),e(ye,{value:"1"},{default:t(()=>[e(pe,{class:"pt-3 px-6"},{default:t(()=>[e(le),Q.value?(n(),h(P,{key:0,color:"primary","prepend-icon":"tabler-refresh",onClick:x,loading:z.value},{default:t(()=>[u(l(a(d)("projects.requirements.actions.generate")),1)]),_:1},8,["loading"])):w("",!0)]),_:1}),e($r,{"project-id":a(I).id,requirements:a(I).requirements||[],"can-manage":Q.value,onSelected:T[3]||(T[3]=H=>N.value=H),onViewUserStories:F},null,8,["project-id","requirements","can-manage"])]),_:1}),e(ye,{value:"2"},{default:t(()=>{var H,ue;return[e(pe,{class:"pt-3 px-6"},{default:t(()=>[N.value?(n(),h(P,{key:0,color:"secondary",variant:"tonal","prepend-icon":"tabler-arrow-left",onClick:T[4]||(T[4]=$e=>N.value=null)},{default:t(()=>[u(l(p.$t("projects.actions.back_to_all_user_stories")),1)]),_:1})):w("",!0),e(le),Q.value?(n(),h(P,{key:1,color:"primary","prepend-icon":"tabler-refresh",onClick:T[5]||(T[5]=$e=>(async(Ie=null)=>{z.value=!0;try{let Me;if(Ie){const{data:Ye,error:et}=await r.generateUserStories(A.value,Ie);Me={data:Ye,error:et}}else{const{data:Ye,error:et}=await r.generateUserStories(A.value);Me={data:Ye,error:et}}Me.data&&!Me.error?M("projects.notifications.user_stories_generation_started"):M("projects.notifications.user_stories_generation_failed","error")}catch{M("projects.notifications.user_stories_generation_failed","error")}finally{z.value=!1}})(N.value?N.value.id:null)),loading:z.value},{default:t(()=>[u(l(p.$t(N.value?"projects.actions.generate_user_stories_for_requirement":"projects.actions.generate_all_user_stories")),1)]),_:1},8,["loading"])):w("",!0)]),_:1}),e(sn,{"project-id":a(I).id,"requirement-id":N.value?N.value.id:null,"user-stories":N.value?((ue=(H=a(I).requirements)==null?void 0:H.find($e=>$e.id===N.value.id))==null?void 0:ue.user_stories)||[]:a(I).user_stories||[],"can-manage":Q.value},null,8,["project-id","requirement-id","user-stories","can-manage"])]}),_:1}),e(ye,{value:"3"},{default:t(()=>[e(pe,{class:"pt-3 px-6"},{default:t(()=>[e(le),Q.value?(n(),h(P,{key:0,color:"primary","prepend-icon":"tabler-refresh",onClick:ee,loading:z.value},{default:t(()=>[u(l(a(d)("projects.mockups.actions.generate")),1)]),_:1},8,["loading"])):w("",!0)]),_:1}),e(rs,{"project-id":a(I).id,"can-manage":Q.value,mockups:a(I).mockups||[],onRefresh:D},null,8,["project-id","can-manage","mockups"])]),_:1}),e(ye,{value:"4"},{default:t(()=>[e(Jn,{"project-id":a(I).id,diagrams:a(I).uml_diagrams||[],"can-manage":Q.value,onRefresh:D},null,8,["project-id","diagrams","can-manage"])]),_:1}),e(ye,{value:"5"},{default:t(()=>[e(pe,{class:"pt-3 px-6"},{default:t(()=>[e(le),Q.value?(n(),h(P,{key:0,color:"primary","prepend-icon":"tabler-refresh",onClick:_,loading:z.value},{default:t(()=>[u(l(p.$t("projects.development_plan.actions.generate")),1)]),_:1},8,["loading"])):w("",!0)]),_:1}),e(ko,{"project-id":a(I).id,"development-plan":a(I).development_plan,"can-manage":Q.value,onRefresh:D},null,8,["project-id","development-plan","can-manage"])]),_:1}),e(ye,{value:"6"},{default:t(()=>[e(Yn,{"project-id":a(I).id,exports:a(I).srs_exports||[],onRefresh:D},null,8,["project-id","exports"])]),_:1}),e(ye,{value:"7"},{default:t(()=>[e(lc,{"project-id":a(I).id,onUpdated:y,onRefresh:D},null,8,["project-id"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})],64)):w("",!0),a(I)?(n(),h(Wt,{key:3,modelValue:S.value,"onUpdate:modelValue":T[7]||(T[7]=H=>S.value=H),"edit-mode":"","project-data":a(I),onSubmit:k},null,8,["modelValue","project-data"])):w("",!0),e(g,{isDialogVisible:U.value,"onUpdate:isDialogVisible":T[8]||(T[8]=H=>U.value=H),confirmationMsg:a(d)("projects.delete_confirm.message"),onConfirm:G},null,8,["isDialogVisible","confirmationMsg"]),e(Ve,{modelValue:R.value.show,"onUpdate:modelValue":T[10]||(T[10]=H=>R.value.show=H),color:R.value.color,timeout:5e3},{actions:t(()=>[e(re,{onClick:T[9]||(T[9]=H=>R.value.show=!1)},{default:t(()=>[e(V,{icon:"tabler-x"})]),_:1})]),default:t(()=>[u(l(R.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}};typeof ut=="function"&&ut(nc);export{nc as default};
